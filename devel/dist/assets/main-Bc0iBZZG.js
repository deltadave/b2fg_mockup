var Rt=Object.freeze,yr=Object.defineProperty;var Ot=(n,e)=>Rt(yr(n,"raw",{value:Rt(e||n.slice())}));(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var Ge=!1,Ye=!1,Z=[],Je=-1;function br(n){vr(n)}function vr(n){Z.includes(n)||Z.push(n),_r()}function Sr(n){let e=Z.indexOf(n);e!==-1&&e>Je&&Z.splice(e,1)}function _r(){!Ye&&!Ge&&(Ge=!0,queueMicrotask(wr))}function wr(){Ge=!1,Ye=!0;for(let n=0;n<Z.length;n++)Z[n](),Je=n;Z.length=0,Je=-1,Ye=!1}var ue,ie,de,sn,Ze=!0;function Cr(n){Ze=!1,n(),Ze=!0}function xr(n){ue=n.reactive,de=n.release,ie=e=>n.effect(e,{scheduler:t=>{Ze?br(t):t()}}),sn=n.raw}function Nt(n){ie=n}function Er(n){let e=()=>{};return[r=>{let i=ie(r);return n._x_effects||(n._x_effects=new Set,n._x_runEffects=()=>{n._x_effects.forEach(s=>s())}),n._x_effects.add(i),e=()=>{i!==void 0&&(n._x_effects.delete(i),de(i))},i},()=>{e()}]}function on(n,e){let t=!0,r,i=ie(()=>{let s=n();JSON.stringify(s),t?r=s:queueMicrotask(()=>{e(s,r),r=s}),t=!1});return()=>de(i)}var an=[],ln=[],cn=[];function $r(n){cn.push(n)}function gt(n,e){typeof e=="function"?(n._x_cleanups||(n._x_cleanups=[]),n._x_cleanups.push(e)):(e=n,ln.push(e))}function un(n){an.push(n)}function dn(n,e,t){n._x_attributeCleanups||(n._x_attributeCleanups={}),n._x_attributeCleanups[e]||(n._x_attributeCleanups[e]=[]),n._x_attributeCleanups[e].push(t)}function fn(n,e){n._x_attributeCleanups&&Object.entries(n._x_attributeCleanups).forEach(([t,r])=>{(e===void 0||e.includes(t))&&(r.forEach(i=>i()),delete n._x_attributeCleanups[t])})}function Lr(n){var e,t;for((e=n._x_effects)==null||e.forEach(Sr);(t=n._x_cleanups)!=null&&t.length;)n._x_cleanups.pop()()}var pt=new MutationObserver(bt),ht=!1;function mt(){pt.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),ht=!0}function gn(){Ar(),pt.disconnect(),ht=!1}var he=[];function Ar(){let n=pt.takeRecords();he.push(()=>n.length>0&&bt(n));let e=he.length;queueMicrotask(()=>{if(he.length===e)for(;he.length>0;)he.shift()()})}function L(n){if(!ht)return n();gn();let e=n();return mt(),e}var yt=!1,Fe=[];function Mr(){yt=!0}function Ir(){yt=!1,bt(Fe),Fe=[]}function bt(n){if(yt){Fe=Fe.concat(n);return}let e=[],t=new Set,r=new Map,i=new Map;for(let s=0;s<n.length;s++)if(!n[s].target._x_ignoreMutationObserver&&(n[s].type==="childList"&&(n[s].removedNodes.forEach(o=>{o.nodeType===1&&o._x_marker&&t.add(o)}),n[s].addedNodes.forEach(o=>{if(o.nodeType===1){if(t.has(o)){t.delete(o);return}o._x_marker||e.push(o)}})),n[s].type==="attributes")){let o=n[s].target,a=n[s].attributeName,l=n[s].oldValue,c=()=>{r.has(o)||r.set(o,[]),r.get(o).push({name:a,value:o.getAttribute(a)})},u=()=>{i.has(o)||i.set(o,[]),i.get(o).push(a)};o.hasAttribute(a)&&l===null?c():o.hasAttribute(a)?(u(),c()):u()}i.forEach((s,o)=>{fn(o,s)}),r.forEach((s,o)=>{an.forEach(a=>a(o,s))});for(let s of t)e.some(o=>o.contains(s))||ln.forEach(o=>o(s));for(let s of e)s.isConnected&&cn.forEach(o=>o(s));e=null,t=null,r=null,i=null}function pn(n){return Ce(le(n))}function we(n,e,t){return n._x_dataStack=[e,...le(t||n)],()=>{n._x_dataStack=n._x_dataStack.filter(r=>r!==e)}}function le(n){return n._x_dataStack?n._x_dataStack:typeof ShadowRoot=="function"&&n instanceof ShadowRoot?le(n.host):n.parentNode?le(n.parentNode):[]}function Ce(n){return new Proxy({objects:n},kr)}var kr={ownKeys({objects:n}){return Array.from(new Set(n.flatMap(e=>Object.keys(e))))},has({objects:n},e){return e==Symbol.unscopables?!1:n.some(t=>Object.prototype.hasOwnProperty.call(t,e)||Reflect.has(t,e))},get({objects:n},e,t){return e=="toJSON"?Tr:Reflect.get(n.find(r=>Reflect.has(r,e))||{},e,t)},set({objects:n},e,t,r){const i=n.find(o=>Object.prototype.hasOwnProperty.call(o,e))||n[n.length-1],s=Object.getOwnPropertyDescriptor(i,e);return s!=null&&s.set&&(s!=null&&s.get)?s.set.call(r,t)||!0:Reflect.set(i,e,t)}};function Tr(){return Reflect.ownKeys(this).reduce((e,t)=>(e[t]=Reflect.get(this,t),e),{})}function hn(n){let e=r=>typeof r=="object"&&!Array.isArray(r)&&r!==null,t=(r,i="")=>{Object.entries(Object.getOwnPropertyDescriptors(r)).forEach(([s,{value:o,enumerable:a}])=>{if(a===!1||o===void 0||typeof o=="object"&&o!==null&&o.__v_skip)return;let l=i===""?s:"".concat(i,".").concat(s);typeof o=="object"&&o!==null&&o._x_interceptor?r[s]=o.initialize(n,l,s):e(o)&&o!==r&&!(o instanceof Element)&&t(o,l)})};return t(n)}function mn(n,e=()=>{}){let t={initialValue:void 0,_x_interceptor:!0,initialize(r,i,s){return n(this.initialValue,()=>Fr(r,i),o=>Qe(r,i,o),i,s)}};return e(t),r=>{if(typeof r=="object"&&r!==null&&r._x_interceptor){let i=t.initialize.bind(t);t.initialize=(s,o,a)=>{let l=r.initialize(s,o,a);return t.initialValue=l,i(s,o,a)}}else t.initialValue=r;return t}}function Fr(n,e){return e.split(".").reduce((t,r)=>t[r],n)}function Qe(n,e,t){if(typeof e=="string"&&(e=e.split(".")),e.length===1)n[e[0]]=t;else{if(e.length===0)throw error;return n[e[0]]||(n[e[0]]={}),Qe(n[e[0]],e.slice(1),t)}}var yn={};function D(n,e){yn[n]=e}function et(n,e){let t=Pr(e);return Object.entries(yn).forEach(([r,i])=>{Object.defineProperty(n,"$".concat(r),{get(){return i(e,t)},enumerable:!1})}),n}function Pr(n){let[e,t]=Cn(n),r={interceptor:mn,...e};return gt(n,t),r}function Rr(n,e,t,...r){try{return t(...r)}catch(i){_e(i,n,e)}}function _e(n,e,t=void 0){n=Object.assign(n!=null?n:{message:"No error message given."},{el:e,expression:t}),console.warn("Alpine Expression Error: ".concat(n.message,"\n\n").concat(t?'Expression: "'+t+'"\n\n':""),e),setTimeout(()=>{throw n},0)}var ke=!0;function bn(n){let e=ke;ke=!1;let t=n();return ke=e,t}function Q(n,e,t={}){let r;return I(n,e)(i=>r=i,t),r}function I(...n){return vn(...n)}var vn=Sn;function Or(n){vn=n}function Sn(n,e){let t={};et(t,n);let r=[t,...le(n)],i=typeof e=="function"?Nr(r,e):Dr(r,e,n);return Rr.bind(null,n,e,i)}function Nr(n,e){return(t=()=>{},{scope:r={},params:i=[]}={})=>{let s=e.apply(Ce([r,...n]),i);Pe(t,s)}}var Ue={};function Br(n,e){if(Ue[n])return Ue[n];let t=Object.getPrototypeOf(async function(){}).constructor,r=/^[\n\s]*if.*\(.*\)/.test(n.trim())||/^(let|const)\s/.test(n.trim())?"(async()=>{ ".concat(n," })()"):n,s=(()=>{try{let o=new t(["__self","scope"],"with (scope) { __self.result = ".concat(r," }; __self.finished = true; return __self.result;"));return Object.defineProperty(o,"name",{value:"[Alpine] ".concat(n)}),o}catch(o){return _e(o,e,n),Promise.resolve()}})();return Ue[n]=s,s}function Dr(n,e,t){let r=Br(e,t);return(i=()=>{},{scope:s={},params:o=[]}={})=>{r.result=void 0,r.finished=!1;let a=Ce([s,...n]);if(typeof r=="function"){let l=r(r,a).catch(c=>_e(c,t,e));r.finished?(Pe(i,r.result,a,o,t),r.result=void 0):l.then(c=>{Pe(i,c,a,o,t)}).catch(c=>_e(c,t,e)).finally(()=>r.result=void 0)}}}function Pe(n,e,t,r,i){if(ke&&typeof e=="function"){let s=e.apply(t,r);s instanceof Promise?s.then(o=>Pe(n,o,t,r)).catch(o=>_e(o,i,e)):n(s)}else typeof e=="object"&&e instanceof Promise?e.then(s=>n(s)):n(e)}var vt="x-";function fe(n=""){return vt+n}function zr(n){vt=n}var Re={},rn;function A(n,e){return Re[n]=e,{before(t){if(!Re[t]){console.warn(String.raw(rn||(rn=Ot(["Cannot find directive `","`. `","` will use the default order of execution"],["Cannot find directive \\`","\\`. \\`","\\` will use the default order of execution"])),t,n));return}const r=J.indexOf(t);J.splice(r>=0?r:J.indexOf("DEFAULT"),0,n)}}}function Xr(n){return Object.keys(Re).includes(n)}function St(n,e,t){if(e=Array.from(e),n._x_virtualDirectives){let s=Object.entries(n._x_virtualDirectives).map(([a,l])=>({name:a,value:l})),o=_n(s);s=s.map(a=>o.find(l=>l.name===a.name)?{name:"x-bind:".concat(a.name),value:'"'.concat(a.value,'"')}:a),e=e.concat(s)}let r={};return e.map($n((s,o)=>r[s]=o)).filter(An).map(Ur(r,t)).sort(qr).map(s=>Wr(n,s))}function _n(n){return Array.from(n).map($n()).filter(e=>!An(e))}var tt=!1,be=new Map,wn=Symbol();function jr(n){tt=!0;let e=Symbol();wn=e,be.set(e,[]);let t=()=>{for(;be.get(e).length;)be.get(e).shift()();be.delete(e)},r=()=>{tt=!1,t()};n(t),r()}function Cn(n){let e=[],t=a=>e.push(a),[r,i]=Er(n);return e.push(i),[{Alpine:xe,effect:r,cleanup:t,evaluateLater:I.bind(I,n),evaluate:Q.bind(Q,n)},()=>e.forEach(a=>a())]}function Wr(n,e){let t=()=>{},r=Re[e.type]||t,[i,s]=Cn(n);dn(n,e.original,s);let o=()=>{n._x_ignore||n._x_ignoreSelf||(r.inline&&r.inline(n,e,i),r=r.bind(r,n,e,i),tt?be.get(wn).push(r):r())};return o.runCleanups=s,o}var xn=(n,e)=>({name:t,value:r})=>(t.startsWith(n)&&(t=t.replace(n,e)),{name:t,value:r}),En=n=>n;function $n(n=()=>{}){return({name:e,value:t})=>{let{name:r,value:i}=Ln.reduce((s,o)=>o(s),{name:e,value:t});return r!==e&&n(r,e),{name:r,value:i}}}var Ln=[];function _t(n){Ln.push(n)}function An({name:n}){return Mn().test(n)}var Mn=()=>new RegExp("^".concat(vt,"([^:^.]+)\\b"));function Ur(n,e){return({name:t,value:r})=>{let i=t.match(Mn()),s=t.match(/:([a-zA-Z0-9\-_:]+)/),o=t.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],a=e||n[t]||t;return{type:i?i[1]:null,value:s?s[1]:null,modifiers:o.map(l=>l.replace(".","")),expression:r,original:a}}}var nt="DEFAULT",J=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",nt,"teleport"];function qr(n,e){let t=J.indexOf(n.type)===-1?nt:n.type,r=J.indexOf(e.type)===-1?nt:e.type;return J.indexOf(t)-J.indexOf(r)}function ve(n,e,t={}){n.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,composed:!0,cancelable:!0}))}function ne(n,e){if(typeof ShadowRoot=="function"&&n instanceof ShadowRoot){Array.from(n.children).forEach(i=>ne(i,e));return}let t=!1;if(e(n,()=>t=!0),t)return;let r=n.firstElementChild;for(;r;)ne(r,e),r=r.nextElementSibling}function R(n,...e){console.warn("Alpine Warning: ".concat(n),...e)}var Bt=!1;function Hr(){Bt&&R("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),Bt=!0,document.body||R("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),ve(document,"alpine:init"),ve(document,"alpine:initializing"),mt(),$r(e=>W(e,ne)),gt(e=>pe(e)),un((e,t)=>{St(e,t).forEach(r=>r())});let n=e=>!Ne(e.parentElement,!0);Array.from(document.querySelectorAll(Tn().join(","))).filter(n).forEach(e=>{W(e)}),ve(document,"alpine:initialized"),setTimeout(()=>{Yr()})}var wt=[],In=[];function kn(){return wt.map(n=>n())}function Tn(){return wt.concat(In).map(n=>n())}function Fn(n){wt.push(n)}function Pn(n){In.push(n)}function Ne(n,e=!1){return ge(n,t=>{if((e?Tn():kn()).some(i=>t.matches(i)))return!0})}function ge(n,e){if(n){if(e(n))return n;if(n._x_teleportBack&&(n=n._x_teleportBack),!!n.parentElement)return ge(n.parentElement,e)}}function Vr(n){return kn().some(e=>n.matches(e))}var Rn=[];function Kr(n){Rn.push(n)}var Gr=1;function W(n,e=ne,t=()=>{}){ge(n,r=>r._x_ignore)||jr(()=>{e(n,(r,i)=>{r._x_marker||(t(r,i),Rn.forEach(s=>s(r,i)),St(r,r.attributes).forEach(s=>s()),r._x_ignore||(r._x_marker=Gr++),r._x_ignore&&i())})})}function pe(n,e=ne){e(n,t=>{Lr(t),fn(t),delete t._x_marker})}function Yr(){[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach(([e,t,r])=>{Xr(t)||r.some(i=>{if(document.querySelector(i))return R('found "'.concat(i,'", but missing ').concat(e," plugin")),!0})})}var rt=[],Ct=!1;function xt(n=()=>{}){return queueMicrotask(()=>{Ct||setTimeout(()=>{it()})}),new Promise(e=>{rt.push(()=>{n(),e()})})}function it(){for(Ct=!1;rt.length;)rt.shift()()}function Jr(){Ct=!0}function Et(n,e){return Array.isArray(e)?Dt(n,e.join(" ")):typeof e=="object"&&e!==null?Zr(n,e):typeof e=="function"?Et(n,e()):Dt(n,e)}function Dt(n,e){let t=i=>i.split(" ").filter(s=>!n.classList.contains(s)).filter(Boolean),r=i=>(n.classList.add(...i),()=>{n.classList.remove(...i)});return e=e===!0?e="":e||"",r(t(e))}function Zr(n,e){let t=a=>a.split(" ").filter(Boolean),r=Object.entries(e).flatMap(([a,l])=>l?t(a):!1).filter(Boolean),i=Object.entries(e).flatMap(([a,l])=>l?!1:t(a)).filter(Boolean),s=[],o=[];return i.forEach(a=>{n.classList.contains(a)&&(n.classList.remove(a),o.push(a))}),r.forEach(a=>{n.classList.contains(a)||(n.classList.add(a),s.push(a))}),()=>{o.forEach(a=>n.classList.add(a)),s.forEach(a=>n.classList.remove(a))}}function Be(n,e){return typeof e=="object"&&e!==null?Qr(n,e):ei(n,e)}function Qr(n,e){let t={};return Object.entries(e).forEach(([r,i])=>{t[r]=n.style[r],r.startsWith("--")||(r=ti(r)),n.style.setProperty(r,i)}),setTimeout(()=>{n.style.length===0&&n.removeAttribute("style")}),()=>{Be(n,t)}}function ei(n,e){let t=n.getAttribute("style",e);return n.setAttribute("style",e),()=>{n.setAttribute("style",t||"")}}function ti(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function st(n,e=()=>{}){let t=!1;return function(){t?e.apply(this,arguments):(t=!0,n.apply(this,arguments))}}A("transition",(n,{value:e,modifiers:t,expression:r},{evaluate:i})=>{typeof r=="function"&&(r=i(r)),r!==!1&&(!r||typeof r=="boolean"?ri(n,t,e):ni(n,r,e))});function ni(n,e,t){On(n,Et,""),{enter:i=>{n._x_transition.enter.during=i},"enter-start":i=>{n._x_transition.enter.start=i},"enter-end":i=>{n._x_transition.enter.end=i},leave:i=>{n._x_transition.leave.during=i},"leave-start":i=>{n._x_transition.leave.start=i},"leave-end":i=>{n._x_transition.leave.end=i}}[t](e)}function ri(n,e,t){On(n,Be);let r=!e.includes("in")&&!e.includes("out")&&!t,i=r||e.includes("in")||["enter"].includes(t),s=r||e.includes("out")||["leave"].includes(t);e.includes("in")&&!r&&(e=e.filter((y,v)=>v<e.indexOf("out"))),e.includes("out")&&!r&&(e=e.filter((y,v)=>v>e.indexOf("out")));let o=!e.includes("opacity")&&!e.includes("scale"),a=o||e.includes("opacity"),l=o||e.includes("scale"),c=a?0:1,u=l?me(e,"scale",95)/100:1,d=me(e,"delay",0)/1e3,f=me(e,"origin","center"),m="opacity, transform",g=me(e,"duration",150)/1e3,_=me(e,"duration",75)/1e3,p="cubic-bezier(0.4, 0.0, 0.2, 1)";i&&(n._x_transition.enter.during={transformOrigin:f,transitionDelay:"".concat(d,"s"),transitionProperty:m,transitionDuration:"".concat(g,"s"),transitionTimingFunction:p},n._x_transition.enter.start={opacity:c,transform:"scale(".concat(u,")")},n._x_transition.enter.end={opacity:1,transform:"scale(1)"}),s&&(n._x_transition.leave.during={transformOrigin:f,transitionDelay:"".concat(d,"s"),transitionProperty:m,transitionDuration:"".concat(_,"s"),transitionTimingFunction:p},n._x_transition.leave.start={opacity:1,transform:"scale(1)"},n._x_transition.leave.end={opacity:c,transform:"scale(".concat(u,")")})}function On(n,e,t={}){n._x_transition||(n._x_transition={enter:{during:t,start:t,end:t},leave:{during:t,start:t,end:t},in(r=()=>{},i=()=>{}){ot(n,e,{during:this.enter.during,start:this.enter.start,end:this.enter.end},r,i)},out(r=()=>{},i=()=>{}){ot(n,e,{during:this.leave.during,start:this.leave.start,end:this.leave.end},r,i)}})}window.Element.prototype._x_toggleAndCascadeWithTransitions=function(n,e,t,r){const i=document.visibilityState==="visible"?requestAnimationFrame:setTimeout;let s=()=>i(t);if(e){n._x_transition&&(n._x_transition.enter||n._x_transition.leave)?n._x_transition.enter&&(Object.entries(n._x_transition.enter.during).length||Object.entries(n._x_transition.enter.start).length||Object.entries(n._x_transition.enter.end).length)?n._x_transition.in(t):s():n._x_transition?n._x_transition.in(t):s();return}n._x_hidePromise=n._x_transition?new Promise((o,a)=>{n._x_transition.out(()=>{},()=>o(r)),n._x_transitioning&&n._x_transitioning.beforeCancel(()=>a({isFromCancelledTransition:!0}))}):Promise.resolve(r),queueMicrotask(()=>{let o=Nn(n);o?(o._x_hideChildren||(o._x_hideChildren=[]),o._x_hideChildren.push(n)):i(()=>{let a=l=>{let c=Promise.all([l._x_hidePromise,...(l._x_hideChildren||[]).map(a)]).then(([u])=>u==null?void 0:u());return delete l._x_hidePromise,delete l._x_hideChildren,c};a(n).catch(l=>{if(!l.isFromCancelledTransition)throw l})})})};function Nn(n){let e=n.parentNode;if(e)return e._x_hidePromise?e:Nn(e)}function ot(n,e,{during:t,start:r,end:i}={},s=()=>{},o=()=>{}){if(n._x_transitioning&&n._x_transitioning.cancel(),Object.keys(t).length===0&&Object.keys(r).length===0&&Object.keys(i).length===0){s(),o();return}let a,l,c;ii(n,{start(){a=e(n,r)},during(){l=e(n,t)},before:s,end(){a(),c=e(n,i)},after:o,cleanup(){l(),c()}})}function ii(n,e){let t,r,i,s=st(()=>{L(()=>{t=!0,r||e.before(),i||(e.end(),it()),e.after(),n.isConnected&&e.cleanup(),delete n._x_transitioning})});n._x_transitioning={beforeCancels:[],beforeCancel(o){this.beforeCancels.push(o)},cancel:st(function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();s()}),finish:s},L(()=>{e.start(),e.during()}),Jr(),requestAnimationFrame(()=>{if(t)return;let o=Number(getComputedStyle(n).transitionDuration.replace(/,.*/,"").replace("s",""))*1e3,a=Number(getComputedStyle(n).transitionDelay.replace(/,.*/,"").replace("s",""))*1e3;o===0&&(o=Number(getComputedStyle(n).animationDuration.replace("s",""))*1e3),L(()=>{e.before()}),r=!0,requestAnimationFrame(()=>{t||(L(()=>{e.end()}),it(),setTimeout(n._x_transitioning.finish,o+a),i=!0)})})}function me(n,e,t){if(n.indexOf(e)===-1)return t;const r=n[n.indexOf(e)+1];if(!r||e==="scale"&&isNaN(r))return t;if(e==="duration"||e==="delay"){let i=r.match(/([0-9]+)ms/);if(i)return i[1]}return e==="origin"&&["top","right","left","center","bottom"].includes(n[n.indexOf(e)+2])?[r,n[n.indexOf(e)+2]].join(" "):r}var H=!1;function K(n,e=()=>{}){return(...t)=>H?e(...t):n(...t)}function si(n){return(...e)=>H&&n(...e)}var Bn=[];function De(n){Bn.push(n)}function oi(n,e){Bn.forEach(t=>t(n,e)),H=!0,Dn(()=>{W(e,(t,r)=>{r(t,()=>{})})}),H=!1}var at=!1;function ai(n,e){e._x_dataStack||(e._x_dataStack=n._x_dataStack),H=!0,at=!0,Dn(()=>{li(e)}),H=!1,at=!1}function li(n){let e=!1;W(n,(r,i)=>{ne(r,(s,o)=>{if(e&&Vr(s))return o();e=!0,i(s,o)})})}function Dn(n){let e=ie;Nt((t,r)=>{let i=e(t);return de(i),()=>{}}),n(),Nt(e)}function zn(n,e,t,r=[]){switch(n._x_bindings||(n._x_bindings=ue({})),n._x_bindings[e]=t,e=r.includes("camel")?mi(e):e,e){case"value":ci(n,t);break;case"style":di(n,t);break;case"class":ui(n,t);break;case"selected":case"checked":fi(n,e,t);break;default:Xn(n,e,t);break}}function ci(n,e){if(Un(n))n.attributes.value===void 0&&(n.value=e),window.fromModel&&(typeof e=="boolean"?n.checked=Te(n.value)===e:n.checked=zt(n.value,e));else if($t(n))Number.isInteger(e)?n.value=e:!Array.isArray(e)&&typeof e!="boolean"&&![null,void 0].includes(e)?n.value=String(e):Array.isArray(e)?n.checked=e.some(t=>zt(t,n.value)):n.checked=!!e;else if(n.tagName==="SELECT")hi(n,e);else{if(n.value===e)return;n.value=e===void 0?"":e}}function ui(n,e){n._x_undoAddedClasses&&n._x_undoAddedClasses(),n._x_undoAddedClasses=Et(n,e)}function di(n,e){n._x_undoAddedStyles&&n._x_undoAddedStyles(),n._x_undoAddedStyles=Be(n,e)}function fi(n,e,t){Xn(n,e,t),pi(n,e,t)}function Xn(n,e,t){[null,void 0,!1].includes(t)&&bi(e)?n.removeAttribute(e):(jn(e)&&(t=e),gi(n,e,t))}function gi(n,e,t){n.getAttribute(e)!=t&&n.setAttribute(e,t)}function pi(n,e,t){n[e]!==t&&(n[e]=t)}function hi(n,e){const t=[].concat(e).map(r=>r+"");Array.from(n.options).forEach(r=>{r.selected=t.includes(r.value)})}function mi(n){return n.toLowerCase().replace(/-(\w)/g,(e,t)=>t.toUpperCase())}function zt(n,e){return n==e}function Te(n){return[1,"1","true","on","yes",!0].includes(n)?!0:[0,"0","false","off","no",!1].includes(n)?!1:n?!!n:null}var yi=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","shadowrootclonable","shadowrootdelegatesfocus","shadowrootserializable"]);function jn(n){return yi.has(n)}function bi(n){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(n)}function vi(n,e,t){return n._x_bindings&&n._x_bindings[e]!==void 0?n._x_bindings[e]:Wn(n,e,t)}function Si(n,e,t,r=!0){if(n._x_bindings&&n._x_bindings[e]!==void 0)return n._x_bindings[e];if(n._x_inlineBindings&&n._x_inlineBindings[e]!==void 0){let i=n._x_inlineBindings[e];return i.extract=r,bn(()=>Q(n,i.expression))}return Wn(n,e,t)}function Wn(n,e,t){let r=n.getAttribute(e);return r===null?typeof t=="function"?t():t:r===""?!0:jn(e)?!![e,"true"].includes(r):r}function $t(n){return n.type==="checkbox"||n.localName==="ui-checkbox"||n.localName==="ui-switch"}function Un(n){return n.type==="radio"||n.localName==="ui-radio"}function qn(n,e){var t;return function(){var r=this,i=arguments,s=function(){t=null,n.apply(r,i)};clearTimeout(t),t=setTimeout(s,e)}}function Hn(n,e){let t;return function(){let r=this,i=arguments;t||(n.apply(r,i),t=!0,setTimeout(()=>t=!1,e))}}function Vn({get:n,set:e},{get:t,set:r}){let i=!0,s,o=ie(()=>{let a=n(),l=t();if(i)r(qe(a)),i=!1;else{let c=JSON.stringify(a),u=JSON.stringify(l);c!==s?r(qe(a)):c!==u&&e(qe(l))}s=JSON.stringify(n()),JSON.stringify(t())});return()=>{de(o)}}function qe(n){return typeof n=="object"?JSON.parse(JSON.stringify(n)):n}function _i(n){(Array.isArray(n)?n:[n]).forEach(t=>t(xe))}var Y={},Xt=!1;function wi(n,e){if(Xt||(Y=ue(Y),Xt=!0),e===void 0)return Y[n];Y[n]=e,hn(Y[n]),typeof e=="object"&&e!==null&&e.hasOwnProperty("init")&&typeof e.init=="function"&&Y[n].init()}function Ci(){return Y}var Kn={};function xi(n,e){let t=typeof e!="function"?()=>e:e;return n instanceof Element?Gn(n,t()):(Kn[n]=t,()=>{})}function Ei(n){return Object.entries(Kn).forEach(([e,t])=>{Object.defineProperty(n,e,{get(){return(...r)=>t(...r)}})}),n}function Gn(n,e,t){let r=[];for(;r.length;)r.pop()();let i=Object.entries(e).map(([o,a])=>({name:o,value:a})),s=_n(i);return i=i.map(o=>s.find(a=>a.name===o.name)?{name:"x-bind:".concat(o.name),value:'"'.concat(o.value,'"')}:o),St(n,i,t).map(o=>{r.push(o.runCleanups),o()}),()=>{for(;r.length;)r.pop()()}}var Yn={};function $i(n,e){Yn[n]=e}function Li(n,e){return Object.entries(Yn).forEach(([t,r])=>{Object.defineProperty(n,t,{get(){return(...i)=>r.bind(e)(...i)},enumerable:!1})}),n}var Ai={get reactive(){return ue},get release(){return de},get effect(){return ie},get raw(){return sn},version:"3.14.9",flushAndStopDeferringMutations:Ir,dontAutoEvaluateFunctions:bn,disableEffectScheduling:Cr,startObservingMutations:mt,stopObservingMutations:gn,setReactivityEngine:xr,onAttributeRemoved:dn,onAttributesAdded:un,closestDataStack:le,skipDuringClone:K,onlyDuringClone:si,addRootSelector:Fn,addInitSelector:Pn,interceptClone:De,addScopeToNode:we,deferMutations:Mr,mapAttributes:_t,evaluateLater:I,interceptInit:Kr,setEvaluator:Or,mergeProxies:Ce,extractProp:Si,findClosest:ge,onElRemoved:gt,closestRoot:Ne,destroyTree:pe,interceptor:mn,transition:ot,setStyles:Be,mutateDom:L,directive:A,entangle:Vn,throttle:Hn,debounce:qn,evaluate:Q,initTree:W,nextTick:xt,prefixed:fe,prefix:zr,plugin:_i,magic:D,store:wi,start:Hr,clone:ai,cloneNode:oi,bound:vi,$data:pn,watch:on,walk:ne,data:$i,bind:xi},xe=Ai;function Mi(n,e){const t=Object.create(null),r=n.split(",");for(let i=0;i<r.length;i++)t[r[i]]=!0;return i=>!!t[i]}var Ii=Object.freeze({}),ki=Object.prototype.hasOwnProperty,ze=(n,e)=>ki.call(n,e),ee=Array.isArray,Se=n=>Jn(n)==="[object Map]",Ti=n=>typeof n=="string",Lt=n=>typeof n=="symbol",Xe=n=>n!==null&&typeof n=="object",Fi=Object.prototype.toString,Jn=n=>Fi.call(n),Zn=n=>Jn(n).slice(8,-1),At=n=>Ti(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Pi=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},Ri=Pi(n=>n.charAt(0).toUpperCase()+n.slice(1)),Qn=(n,e)=>n!==e&&(n===n||e===e),lt=new WeakMap,ye=[],X,te=Symbol("iterate"),ct=Symbol("Map key iterate");function Oi(n){return n&&n._isEffect===!0}function Ni(n,e=Ii){Oi(n)&&(n=n.raw);const t=zi(n,e);return e.lazy||t(),t}function Bi(n){n.active&&(er(n),n.options.onStop&&n.options.onStop(),n.active=!1)}var Di=0;function zi(n,e){const t=function(){if(!t.active)return n();if(!ye.includes(t)){er(t);try{return ji(),ye.push(t),X=t,n()}finally{ye.pop(),tr(),X=ye[ye.length-1]}}};return t.id=Di++,t.allowRecurse=!!e.allowRecurse,t._isEffect=!0,t.active=!0,t.raw=n,t.deps=[],t.options=e,t}function er(n){const{deps:e}=n;if(e.length){for(let t=0;t<e.length;t++)e[t].delete(n);e.length=0}}var ce=!0,Mt=[];function Xi(){Mt.push(ce),ce=!1}function ji(){Mt.push(ce),ce=!0}function tr(){const n=Mt.pop();ce=n===void 0?!0:n}function B(n,e,t){if(!ce||X===void 0)return;let r=lt.get(n);r||lt.set(n,r=new Map);let i=r.get(t);i||r.set(t,i=new Set),i.has(X)||(i.add(X),X.deps.push(i),X.options.onTrack&&X.options.onTrack({effect:X,target:n,type:e,key:t}))}function V(n,e,t,r,i,s){const o=lt.get(n);if(!o)return;const a=new Set,l=u=>{u&&u.forEach(d=>{(d!==X||d.allowRecurse)&&a.add(d)})};if(e==="clear")o.forEach(l);else if(t==="length"&&ee(n))o.forEach((u,d)=>{(d==="length"||d>=r)&&l(u)});else switch(t!==void 0&&l(o.get(t)),e){case"add":ee(n)?At(t)&&l(o.get("length")):(l(o.get(te)),Se(n)&&l(o.get(ct)));break;case"delete":ee(n)||(l(o.get(te)),Se(n)&&l(o.get(ct)));break;case"set":Se(n)&&l(o.get(te));break}const c=u=>{u.options.onTrigger&&u.options.onTrigger({effect:u,target:n,key:t,type:e,newValue:r,oldValue:i,oldTarget:s}),u.options.scheduler?u.options.scheduler(u):u()};a.forEach(c)}var Wi=Mi("__proto__,__v_isRef,__isVue"),nr=new Set(Object.getOwnPropertyNames(Symbol).map(n=>Symbol[n]).filter(Lt)),Ui=rr(),qi=rr(!0),jt=Hi();function Hi(){const n={};return["includes","indexOf","lastIndexOf"].forEach(e=>{n[e]=function(...t){const r=E(this);for(let s=0,o=this.length;s<o;s++)B(r,"get",s+"");const i=r[e](...t);return i===-1||i===!1?r[e](...t.map(E)):i}}),["push","pop","shift","unshift","splice"].forEach(e=>{n[e]=function(...t){Xi();const r=E(this)[e].apply(this,t);return tr(),r}}),n}function rr(n=!1,e=!1){return function(r,i,s){if(i==="__v_isReactive")return!n;if(i==="__v_isReadonly")return n;if(i==="__v_raw"&&s===(n?e?os:ar:e?ss:or).get(r))return r;const o=ee(r);if(!n&&o&&ze(jt,i))return Reflect.get(jt,i,s);const a=Reflect.get(r,i,s);return(Lt(i)?nr.has(i):Wi(i))||(n||B(r,"get",i),e)?a:ut(a)?!o||!At(i)?a.value:a:Xe(a)?n?lr(a):Ft(a):a}}var Vi=Ki();function Ki(n=!1){return function(t,r,i,s){let o=t[r];if(!n&&(i=E(i),o=E(o),!ee(t)&&ut(o)&&!ut(i)))return o.value=i,!0;const a=ee(t)&&At(r)?Number(r)<t.length:ze(t,r),l=Reflect.set(t,r,i,s);return t===E(s)&&(a?Qn(i,o)&&V(t,"set",r,i,o):V(t,"add",r,i)),l}}function Gi(n,e){const t=ze(n,e),r=n[e],i=Reflect.deleteProperty(n,e);return i&&t&&V(n,"delete",e,void 0,r),i}function Yi(n,e){const t=Reflect.has(n,e);return(!Lt(e)||!nr.has(e))&&B(n,"has",e),t}function Ji(n){return B(n,"iterate",ee(n)?"length":te),Reflect.ownKeys(n)}var Zi={get:Ui,set:Vi,deleteProperty:Gi,has:Yi,ownKeys:Ji},Qi={get:qi,set(n,e){return console.warn('Set operation on key "'.concat(String(e),'" failed: target is readonly.'),n),!0},deleteProperty(n,e){return console.warn('Delete operation on key "'.concat(String(e),'" failed: target is readonly.'),n),!0}},It=n=>Xe(n)?Ft(n):n,kt=n=>Xe(n)?lr(n):n,Tt=n=>n,je=n=>Reflect.getPrototypeOf(n);function $e(n,e,t=!1,r=!1){n=n.__v_raw;const i=E(n),s=E(e);e!==s&&!t&&B(i,"get",e),!t&&B(i,"get",s);const{has:o}=je(i),a=r?Tt:t?kt:It;if(o.call(i,e))return a(n.get(e));if(o.call(i,s))return a(n.get(s));n!==i&&n.get(e)}function Le(n,e=!1){const t=this.__v_raw,r=E(t),i=E(n);return n!==i&&!e&&B(r,"has",n),!e&&B(r,"has",i),n===i?t.has(n):t.has(n)||t.has(i)}function Ae(n,e=!1){return n=n.__v_raw,!e&&B(E(n),"iterate",te),Reflect.get(n,"size",n)}function Wt(n){n=E(n);const e=E(this);return je(e).has.call(e,n)||(e.add(n),V(e,"add",n,n)),this}function Ut(n,e){e=E(e);const t=E(this),{has:r,get:i}=je(t);let s=r.call(t,n);s?sr(t,r,n):(n=E(n),s=r.call(t,n));const o=i.call(t,n);return t.set(n,e),s?Qn(e,o)&&V(t,"set",n,e,o):V(t,"add",n,e),this}function qt(n){const e=E(this),{has:t,get:r}=je(e);let i=t.call(e,n);i?sr(e,t,n):(n=E(n),i=t.call(e,n));const s=r?r.call(e,n):void 0,o=e.delete(n);return i&&V(e,"delete",n,void 0,s),o}function Ht(){const n=E(this),e=n.size!==0,t=Se(n)?new Map(n):new Set(n),r=n.clear();return e&&V(n,"clear",void 0,void 0,t),r}function Me(n,e){return function(r,i){const s=this,o=s.__v_raw,a=E(o),l=e?Tt:n?kt:It;return!n&&B(a,"iterate",te),o.forEach((c,u)=>r.call(i,l(c),l(u),s))}}function Ie(n,e,t){return function(...r){const i=this.__v_raw,s=E(i),o=Se(s),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=i[n](...r),u=t?Tt:e?kt:It;return!e&&B(s,"iterate",l?ct:te),{next(){const{value:d,done:f}=c.next();return f?{value:d,done:f}:{value:a?[u(d[0]),u(d[1])]:u(d),done:f}},[Symbol.iterator](){return this}}}}function U(n){return function(...e){{const t=e[0]?'on key "'.concat(e[0],'" '):"";console.warn("".concat(Ri(n)," operation ").concat(t,"failed: target is readonly."),E(this))}return n==="delete"?!1:this}}function es(){const n={get(s){return $e(this,s)},get size(){return Ae(this)},has:Le,add:Wt,set:Ut,delete:qt,clear:Ht,forEach:Me(!1,!1)},e={get(s){return $e(this,s,!1,!0)},get size(){return Ae(this)},has:Le,add:Wt,set:Ut,delete:qt,clear:Ht,forEach:Me(!1,!0)},t={get(s){return $e(this,s,!0)},get size(){return Ae(this,!0)},has(s){return Le.call(this,s,!0)},add:U("add"),set:U("set"),delete:U("delete"),clear:U("clear"),forEach:Me(!0,!1)},r={get(s){return $e(this,s,!0,!0)},get size(){return Ae(this,!0)},has(s){return Le.call(this,s,!0)},add:U("add"),set:U("set"),delete:U("delete"),clear:U("clear"),forEach:Me(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(s=>{n[s]=Ie(s,!1,!1),t[s]=Ie(s,!0,!1),e[s]=Ie(s,!1,!0),r[s]=Ie(s,!0,!0)}),[n,t,e,r]}var[ts,ns,qs,Hs]=es();function ir(n,e){const t=n?ns:ts;return(r,i,s)=>i==="__v_isReactive"?!n:i==="__v_isReadonly"?n:i==="__v_raw"?r:Reflect.get(ze(t,i)&&i in r?t:r,i,s)}var rs={get:ir(!1)},is={get:ir(!0)};function sr(n,e,t){const r=E(t);if(r!==t&&e.call(n,r)){const i=Zn(n);console.warn("Reactive ".concat(i," contains both the raw and reactive versions of the same object").concat(i==="Map"?" as keys":"",", which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible."))}}var or=new WeakMap,ss=new WeakMap,ar=new WeakMap,os=new WeakMap;function as(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function ls(n){return n.__v_skip||!Object.isExtensible(n)?0:as(Zn(n))}function Ft(n){return n&&n.__v_isReadonly?n:cr(n,!1,Zi,rs,or)}function lr(n){return cr(n,!0,Qi,is,ar)}function cr(n,e,t,r,i){if(!Xe(n))return console.warn("value cannot be made reactive: ".concat(String(n))),n;if(n.__v_raw&&!(e&&n.__v_isReactive))return n;const s=i.get(n);if(s)return s;const o=ls(n);if(o===0)return n;const a=new Proxy(n,o===2?r:t);return i.set(n,a),a}function E(n){return n&&E(n.__v_raw)||n}function ut(n){return!!(n&&n.__v_isRef===!0)}D("nextTick",()=>xt);D("dispatch",n=>ve.bind(ve,n));D("watch",(n,{evaluateLater:e,cleanup:t})=>(r,i)=>{let s=e(r),a=on(()=>{let l;return s(c=>l=c),l},i);t(a)});D("store",Ci);D("data",n=>pn(n));D("root",n=>Ne(n));D("refs",n=>(n._x_refs_proxy||(n._x_refs_proxy=Ce(cs(n))),n._x_refs_proxy));function cs(n){let e=[];return ge(n,t=>{t._x_refs&&e.push(t._x_refs)}),e}var He={};function ur(n){return He[n]||(He[n]=0),++He[n]}function us(n,e){return ge(n,t=>{if(t._x_ids&&t._x_ids[e])return!0})}function ds(n,e){n._x_ids||(n._x_ids={}),n._x_ids[e]||(n._x_ids[e]=ur(e))}D("id",(n,{cleanup:e})=>(t,r=null)=>{let i="".concat(t).concat(r?"-".concat(r):"");return fs(n,i,e,()=>{let s=us(n,t),o=s?s._x_ids[t]:ur(t);return r?"".concat(t,"-").concat(o,"-").concat(r):"".concat(t,"-").concat(o)})});De((n,e)=>{n._x_id&&(e._x_id=n._x_id)});function fs(n,e,t,r){if(n._x_id||(n._x_id={}),n._x_id[e])return n._x_id[e];let i=r();return n._x_id[e]=i,t(()=>{delete n._x_id[e]}),i}D("el",n=>n);dr("Focus","focus","focus");dr("Persist","persist","persist");function dr(n,e,t){D(e,r=>R("You can't use [$".concat(e,'] without first installing the "').concat(n,'" plugin here: https://alpinejs.dev/plugins/').concat(t),r))}A("modelable",(n,{expression:e},{effect:t,evaluateLater:r,cleanup:i})=>{let s=r(e),o=()=>{let u;return s(d=>u=d),u},a=r("".concat(e," = __placeholder")),l=u=>a(()=>{},{scope:{__placeholder:u}}),c=o();l(c),queueMicrotask(()=>{if(!n._x_model)return;n._x_removeModelListeners.default();let u=n._x_model.get,d=n._x_model.set,f=Vn({get(){return u()},set(m){d(m)}},{get(){return o()},set(m){l(m)}});i(f)})});A("teleport",(n,{modifiers:e,expression:t},{cleanup:r})=>{n.tagName.toLowerCase()!=="template"&&R("x-teleport can only be used on a <template> tag",n);let i=Vt(t),s=n.content.cloneNode(!0).firstElementChild;n._x_teleport=s,s._x_teleportBack=n,n.setAttribute("data-teleport-template",!0),s.setAttribute("data-teleport-target",!0),n._x_forwardEvents&&n._x_forwardEvents.forEach(a=>{s.addEventListener(a,l=>{l.stopPropagation(),n.dispatchEvent(new l.constructor(l.type,l))})}),we(s,{},n);let o=(a,l,c)=>{c.includes("prepend")?l.parentNode.insertBefore(a,l):c.includes("append")?l.parentNode.insertBefore(a,l.nextSibling):l.appendChild(a)};L(()=>{o(s,i,e),K(()=>{W(s)})()}),n._x_teleportPutBack=()=>{let a=Vt(t);L(()=>{o(n._x_teleport,a,e)})},r(()=>L(()=>{s.remove(),pe(s)}))});var gs=document.createElement("div");function Vt(n){let e=K(()=>document.querySelector(n),()=>gs)();return e||R('Cannot find x-teleport element for selector: "'.concat(n,'"')),e}var fr=()=>{};fr.inline=(n,{modifiers:e},{cleanup:t})=>{e.includes("self")?n._x_ignoreSelf=!0:n._x_ignore=!0,t(()=>{e.includes("self")?delete n._x_ignoreSelf:delete n._x_ignore})};A("ignore",fr);A("effect",K((n,{expression:e},{effect:t})=>{t(I(n,e))}));function dt(n,e,t,r){let i=n,s=l=>r(l),o={},a=(l,c)=>u=>c(l,u);if(t.includes("dot")&&(e=ps(e)),t.includes("camel")&&(e=hs(e)),t.includes("passive")&&(o.passive=!0),t.includes("capture")&&(o.capture=!0),t.includes("window")&&(i=window),t.includes("document")&&(i=document),t.includes("debounce")){let l=t[t.indexOf("debounce")+1]||"invalid-wait",c=Oe(l.split("ms")[0])?Number(l.split("ms")[0]):250;s=qn(s,c)}if(t.includes("throttle")){let l=t[t.indexOf("throttle")+1]||"invalid-wait",c=Oe(l.split("ms")[0])?Number(l.split("ms")[0]):250;s=Hn(s,c)}return t.includes("prevent")&&(s=a(s,(l,c)=>{c.preventDefault(),l(c)})),t.includes("stop")&&(s=a(s,(l,c)=>{c.stopPropagation(),l(c)})),t.includes("once")&&(s=a(s,(l,c)=>{l(c),i.removeEventListener(e,s,o)})),(t.includes("away")||t.includes("outside"))&&(i=document,s=a(s,(l,c)=>{n.contains(c.target)||c.target.isConnected!==!1&&(n.offsetWidth<1&&n.offsetHeight<1||n._x_isShown!==!1&&l(c))})),t.includes("self")&&(s=a(s,(l,c)=>{c.target===n&&l(c)})),(ys(e)||gr(e))&&(s=a(s,(l,c)=>{bs(c,t)||l(c)})),i.addEventListener(e,s,o),()=>{i.removeEventListener(e,s,o)}}function ps(n){return n.replace(/-/g,".")}function hs(n){return n.toLowerCase().replace(/-(\w)/g,(e,t)=>t.toUpperCase())}function Oe(n){return!Array.isArray(n)&&!isNaN(n)}function ms(n){return[" ","_"].includes(n)?n:n.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase()}function ys(n){return["keydown","keyup"].includes(n)}function gr(n){return["contextmenu","click","mouse"].some(e=>n.includes(e))}function bs(n,e){let t=e.filter(s=>!["window","document","prevent","stop","once","capture","self","away","outside","passive"].includes(s));if(t.includes("debounce")){let s=t.indexOf("debounce");t.splice(s,Oe((t[s+1]||"invalid-wait").split("ms")[0])?2:1)}if(t.includes("throttle")){let s=t.indexOf("throttle");t.splice(s,Oe((t[s+1]||"invalid-wait").split("ms")[0])?2:1)}if(t.length===0||t.length===1&&Kt(n.key).includes(t[0]))return!1;const i=["ctrl","shift","alt","meta","cmd","super"].filter(s=>t.includes(s));return t=t.filter(s=>!i.includes(s)),!(i.length>0&&i.filter(o=>((o==="cmd"||o==="super")&&(o="meta"),n["".concat(o,"Key")])).length===i.length&&(gr(n.type)||Kt(n.key).includes(t[0])))}function Kt(n){if(!n)return[];n=ms(n);let e={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return e[n]=n,Object.keys(e).map(t=>{if(e[t]===n)return t}).filter(t=>t)}A("model",(n,{modifiers:e,expression:t},{effect:r,cleanup:i})=>{let s=n;e.includes("parent")&&(s=n.parentNode);let o=I(s,t),a;typeof t=="string"?a=I(s,"".concat(t," = __placeholder")):typeof t=="function"&&typeof t()=="string"?a=I(s,"".concat(t()," = __placeholder")):a=()=>{};let l=()=>{let f;return o(m=>f=m),Gt(f)?f.get():f},c=f=>{let m;o(g=>m=g),Gt(m)?m.set(f):a(()=>{},{scope:{__placeholder:f}})};typeof t=="string"&&n.type==="radio"&&L(()=>{n.hasAttribute("name")||n.setAttribute("name",t)});var u=n.tagName.toLowerCase()==="select"||["checkbox","radio"].includes(n.type)||e.includes("lazy")?"change":"input";let d=H?()=>{}:dt(n,u,e,f=>{c(Ve(n,e,f,l()))});if(e.includes("fill")&&([void 0,null,""].includes(l())||$t(n)&&Array.isArray(l())||n.tagName.toLowerCase()==="select"&&n.multiple)&&c(Ve(n,e,{target:n},l())),n._x_removeModelListeners||(n._x_removeModelListeners={}),n._x_removeModelListeners.default=d,i(()=>n._x_removeModelListeners.default()),n.form){let f=dt(n.form,"reset",[],m=>{xt(()=>n._x_model&&n._x_model.set(Ve(n,e,{target:n},l())))});i(()=>f())}n._x_model={get(){return l()},set(f){c(f)}},n._x_forceModelUpdate=f=>{f===void 0&&typeof t=="string"&&t.match(/\./)&&(f=""),window.fromModel=!0,L(()=>zn(n,"value",f)),delete window.fromModel},r(()=>{let f=l();e.includes("unintrusive")&&document.activeElement.isSameNode(n)||n._x_forceModelUpdate(f)})});function Ve(n,e,t,r){return L(()=>{if(t instanceof CustomEvent&&t.detail!==void 0)return t.detail!==null&&t.detail!==void 0?t.detail:t.target.value;if($t(n))if(Array.isArray(r)){let i=null;return e.includes("number")?i=Ke(t.target.value):e.includes("boolean")?i=Te(t.target.value):i=t.target.value,t.target.checked?r.includes(i)?r:r.concat([i]):r.filter(s=>!vs(s,i))}else return t.target.checked;else{if(n.tagName.toLowerCase()==="select"&&n.multiple)return e.includes("number")?Array.from(t.target.selectedOptions).map(i=>{let s=i.value||i.text;return Ke(s)}):e.includes("boolean")?Array.from(t.target.selectedOptions).map(i=>{let s=i.value||i.text;return Te(s)}):Array.from(t.target.selectedOptions).map(i=>i.value||i.text);{let i;return Un(n)?t.target.checked?i=t.target.value:i=r:i=t.target.value,e.includes("number")?Ke(i):e.includes("boolean")?Te(i):e.includes("trim")?i.trim():i}}})}function Ke(n){let e=n?parseFloat(n):null;return Ss(e)?e:n}function vs(n,e){return n==e}function Ss(n){return!Array.isArray(n)&&!isNaN(n)}function Gt(n){return n!==null&&typeof n=="object"&&typeof n.get=="function"&&typeof n.set=="function"}A("cloak",n=>queueMicrotask(()=>L(()=>n.removeAttribute(fe("cloak")))));Pn(()=>"[".concat(fe("init"),"]"));A("init",K((n,{expression:e},{evaluate:t})=>typeof e=="string"?!!e.trim()&&t(e,{},!1):t(e,{},!1)));A("text",(n,{expression:e},{effect:t,evaluateLater:r})=>{let i=r(e);t(()=>{i(s=>{L(()=>{n.textContent=s})})})});A("html",(n,{expression:e},{effect:t,evaluateLater:r})=>{let i=r(e);t(()=>{i(s=>{L(()=>{n.innerHTML=s,n._x_ignoreSelf=!0,W(n),delete n._x_ignoreSelf})})})});_t(xn(":",En(fe("bind:"))));var pr=(n,{value:e,modifiers:t,expression:r,original:i},{effect:s,cleanup:o})=>{if(!e){let l={};Ei(l),I(n,r)(u=>{Gn(n,u,i)},{scope:l});return}if(e==="key")return _s(n,r);if(n._x_inlineBindings&&n._x_inlineBindings[e]&&n._x_inlineBindings[e].extract)return;let a=I(n,r);s(()=>a(l=>{l===void 0&&typeof r=="string"&&r.match(/\./)&&(l=""),L(()=>zn(n,e,l,t))})),o(()=>{n._x_undoAddedClasses&&n._x_undoAddedClasses(),n._x_undoAddedStyles&&n._x_undoAddedStyles()})};pr.inline=(n,{value:e,modifiers:t,expression:r})=>{e&&(n._x_inlineBindings||(n._x_inlineBindings={}),n._x_inlineBindings[e]={expression:r,extract:!1})};A("bind",pr);function _s(n,e){n._x_keyExpression=e}Fn(()=>"[".concat(fe("data"),"]"));A("data",(n,{expression:e},{cleanup:t})=>{if(ws(n))return;e=e===""?"{}":e;let r={};et(r,n);let i={};Li(i,r);let s=Q(n,e,{scope:i});(s===void 0||s===!0)&&(s={}),et(s,n);let o=ue(s);hn(o);let a=we(n,o);o.init&&Q(n,o.init),t(()=>{o.destroy&&Q(n,o.destroy),a()})});De((n,e)=>{n._x_dataStack&&(e._x_dataStack=n._x_dataStack,e.setAttribute("data-has-alpine-state",!0))});function ws(n){return H?at?!0:n.hasAttribute("data-has-alpine-state"):!1}A("show",(n,{modifiers:e,expression:t},{effect:r})=>{let i=I(n,t);n._x_doHide||(n._x_doHide=()=>{L(()=>{n.style.setProperty("display","none",e.includes("important")?"important":void 0)})}),n._x_doShow||(n._x_doShow=()=>{L(()=>{n.style.length===1&&n.style.display==="none"?n.removeAttribute("style"):n.style.removeProperty("display")})});let s=()=>{n._x_doHide(),n._x_isShown=!1},o=()=>{n._x_doShow(),n._x_isShown=!0},a=()=>setTimeout(o),l=st(d=>d?o():s(),d=>{typeof n._x_toggleAndCascadeWithTransitions=="function"?n._x_toggleAndCascadeWithTransitions(n,d,o,s):d?a():s()}),c,u=!0;r(()=>i(d=>{!u&&d===c||(e.includes("immediate")&&(d?a():s()),l(d),c=d,u=!1)}))});A("for",(n,{expression:e},{effect:t,cleanup:r})=>{let i=xs(e),s=I(n,i.items),o=I(n,n._x_keyExpression||"index");n._x_prevKeys=[],n._x_lookup={},t(()=>Cs(n,i,s,o)),r(()=>{Object.values(n._x_lookup).forEach(a=>L(()=>{pe(a),a.remove()})),delete n._x_prevKeys,delete n._x_lookup})});function Cs(n,e,t,r){let i=o=>typeof o=="object"&&!Array.isArray(o),s=n;t(o=>{Es(o)&&o>=0&&(o=Array.from(Array(o).keys(),p=>p+1)),o===void 0&&(o=[]);let a=n._x_lookup,l=n._x_prevKeys,c=[],u=[];if(i(o))o=Object.entries(o).map(([p,y])=>{let v=Yt(e,y,p,o);r(C=>{u.includes(C)&&R("Duplicate key on x-for",n),u.push(C)},{scope:{index:p,...v}}),c.push(v)});else for(let p=0;p<o.length;p++){let y=Yt(e,o[p],p,o);r(v=>{u.includes(v)&&R("Duplicate key on x-for",n),u.push(v)},{scope:{index:p,...y}}),c.push(y)}let d=[],f=[],m=[],g=[];for(let p=0;p<l.length;p++){let y=l[p];u.indexOf(y)===-1&&m.push(y)}l=l.filter(p=>!m.includes(p));let _="template";for(let p=0;p<u.length;p++){let y=u[p],v=l.indexOf(y);if(v===-1)l.splice(p,0,y),d.push([_,p]);else if(v!==p){let C=l.splice(p,1)[0],S=l.splice(v-1,1)[0];l.splice(p,0,S),l.splice(v,0,C),f.push([C,S])}else g.push(y);_=y}for(let p=0;p<m.length;p++){let y=m[p];y in a&&(L(()=>{pe(a[y]),a[y].remove()}),delete a[y])}for(let p=0;p<f.length;p++){let[y,v]=f[p],C=a[y],S=a[v],b=document.createElement("div");L(()=>{S||R('x-for ":key" is undefined or invalid',s,v,a),S.after(b),C.after(S),S._x_currentIfEl&&S.after(S._x_currentIfEl),b.before(C),C._x_currentIfEl&&C.after(C._x_currentIfEl),b.remove()}),S._x_refreshXForScope(c[u.indexOf(v)])}for(let p=0;p<d.length;p++){let[y,v]=d[p],C=y==="template"?s:a[y];C._x_currentIfEl&&(C=C._x_currentIfEl);let S=c[v],b=u[v],w=document.importNode(s.content,!0).firstElementChild,$=ue(S);we(w,$,s),w._x_refreshXForScope=O=>{Object.entries(O).forEach(([G,Ee])=>{$[G]=Ee})},L(()=>{C.after(w),K(()=>W(w))()}),typeof b=="object"&&R("x-for key cannot be an object, it must be a string or an integer",s),a[b]=w}for(let p=0;p<g.length;p++)a[g[p]]._x_refreshXForScope(c[u.indexOf(g[p])]);s._x_prevKeys=u})}function xs(n){let e=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,t=/^\s*\(|\)\s*$/g,r=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,i=n.match(r);if(!i)return;let s={};s.items=i[2].trim();let o=i[1].replace(t,"").trim(),a=o.match(e);return a?(s.item=o.replace(e,"").trim(),s.index=a[1].trim(),a[2]&&(s.collection=a[2].trim())):s.item=o,s}function Yt(n,e,t,r){let i={};return/^\[.*\]$/.test(n.item)&&Array.isArray(e)?n.item.replace("[","").replace("]","").split(",").map(o=>o.trim()).forEach((o,a)=>{i[o]=e[a]}):/^\{.*\}$/.test(n.item)&&!Array.isArray(e)&&typeof e=="object"?n.item.replace("{","").replace("}","").split(",").map(o=>o.trim()).forEach(o=>{i[o]=e[o]}):i[n.item]=e,n.index&&(i[n.index]=t),n.collection&&(i[n.collection]=r),i}function Es(n){return!Array.isArray(n)&&!isNaN(n)}function hr(){}hr.inline=(n,{expression:e},{cleanup:t})=>{let r=Ne(n);r._x_refs||(r._x_refs={}),r._x_refs[e]=n,t(()=>delete r._x_refs[e])};A("ref",hr);A("if",(n,{expression:e},{effect:t,cleanup:r})=>{n.tagName.toLowerCase()!=="template"&&R("x-if can only be used on a <template> tag",n);let i=I(n,e),s=()=>{if(n._x_currentIfEl)return n._x_currentIfEl;let a=n.content.cloneNode(!0).firstElementChild;return we(a,{},n),L(()=>{n.after(a),K(()=>W(a))()}),n._x_currentIfEl=a,n._x_undoIf=()=>{L(()=>{pe(a),a.remove()}),delete n._x_currentIfEl},a},o=()=>{n._x_undoIf&&(n._x_undoIf(),delete n._x_undoIf)};t(()=>i(a=>{a?s():o()})),r(()=>n._x_undoIf&&n._x_undoIf())});A("id",(n,{expression:e},{evaluate:t})=>{t(e).forEach(i=>ds(n,i))});De((n,e)=>{n._x_ids&&(e._x_ids=n._x_ids)});_t(xn("@",En(fe("on:"))));A("on",K((n,{value:e,modifiers:t,expression:r},{cleanup:i})=>{let s=r?I(n,r):()=>{};n.tagName.toLowerCase()==="template"&&(n._x_forwardEvents||(n._x_forwardEvents=[]),n._x_forwardEvents.includes(e)||n._x_forwardEvents.push(e));let o=dt(n,e,t,a=>{s(()=>{},{scope:{$event:a},params:[a]})});i(()=>o())}));We("Collapse","collapse","collapse");We("Intersect","intersect","intersect");We("Focus","trap","focus");We("Mask","mask","mask");function We(n,e,t){A(e,r=>R("You can't use [x-".concat(e,'] without first installing the "').concat(n,'" plugin here: https://alpinejs.dev/plugins/').concat(t),r))}xe.setEvaluator(Sn);xe.setReactivityEngine({reactive:Ft,effect:Ni,release:Bi,raw:E});var $s=xe,M=$s;class Ls{constructor(e){this.overrides=new Map,this.config=e,this.loadLocalOverrides()}isEnabled(e){if(this.overrides.has(e))return this.overrides.get(e);const t=this.config.flags[e];return t?t.enabled?t.rolloutPercentage!==void 0?this.checkRolloutPercentage(e,t.rolloutPercentage):t.conditions?this.evaluateConditions(t.conditions):t.enabled:!1:(console.warn("Feature flag '".concat(e,"' not found. Defaulting to false.")),!1)}enable(e){this.overrides.set(e,!0),this.saveLocalOverrides()}disable(e){this.overrides.set(e,!1),this.saveLocalOverrides()}clearOverride(e){this.overrides.delete(e),this.saveLocalOverrides()}clearAllOverrides(){this.overrides.clear(),this.saveLocalOverrides()}getFlag(e){return this.config.flags[e]||null}getAllFlags(){return{...this.config.flags}}getOverrides(){return Object.fromEntries(this.overrides)}checkRolloutPercentage(e,t){if(t<=0)return!1;if(t>=100)return!0;const r=this.config.userId||this.config.sessionId||"anonymous";return this.simpleHash("".concat(e,":").concat(r))%100<t}evaluateConditions(e){return e.environment?e.environment===this.config.environment:e.userId&&this.config.userId?(Array.isArray(e.userId)?e.userId:[e.userId]).includes(this.config.userId):!0}simpleHash(e){let t=0;for(let r=0;r<e.length;r++){const i=e.charCodeAt(r);t=(t<<5)-t+i,t=t&t}return Math.abs(t)}loadLocalOverrides(){if(!(typeof window>"u"))try{const e=localStorage.getItem("featureFlags_overrides");if(e){const t=JSON.parse(e);this.overrides=new Map(Object.entries(t))}}catch(e){console.warn("Failed to load feature flag overrides from localStorage:",e)}}saveLocalOverrides(){if(!(typeof window>"u"))try{const e=Object.fromEntries(this.overrides);localStorage.setItem("featureFlags_overrides",JSON.stringify(e))}catch(e){console.warn("Failed to save feature flag overrides to localStorage:",e)}}}const As={environment:"development",flags:{character_fetcher:{key:"character_fetcher",enabled:!0,description:"Use new CharacterFetcher service for D&D Beyond API calls",rolloutPercentage:100},modern_converter:{key:"modern_converter",enabled:!0,description:"Enable the new Alpine.js-based character converter",rolloutPercentage:100},legacy_fallback:{key:"legacy_fallback",enabled:!0,description:"Show fallback option to legacy converter"},bulk_conversion:{key:"bulk_conversion",enabled:!0,description:"Enable bulk character conversion feature",rolloutPercentage:100},advanced_mapping:{key:"advanced_mapping",enabled:!0,description:"Enable advanced field mapping configuration"},character_preview:{key:"character_preview",enabled:!0,description:"Show character preview before conversion",rolloutPercentage:100},export_formats:{key:"export_formats",enabled:!0,description:"Enable multiple export format options (JSON, PDF, etc.)",rolloutPercentage:100},performance_metrics:{key:"performance_metrics",enabled:!0,description:"Collect and display performance metrics",conditions:{environment:"development"}},debug_character_data:{key:"debug_character_data",enabled:!0,description:"Log detailed character data to console for debugging",rolloutPercentage:100},object_search_service:{key:"object_search_service",enabled:!0,description:"Use new ObjectSearch service instead of legacy getObjects() function",rolloutPercentage:100},string_sanitizer_service:{key:"string_sanitizer_service",enabled:!0,description:"Use new StringSanitizer service instead of legacy fixQuote() function",rolloutPercentage:100},safe_access_service:{key:"safe_access_service",enabled:!0,description:"Use new SafeAccess service instead of legacy safeAccess() function",rolloutPercentage:100},ability_constants:{key:"ability_constants",enabled:!0,description:"Use new AbilityConstants instead of legacy justAbilities array",rolloutPercentage:100},ability_score_processor:{key:"ability_score_processor",enabled:!0,description:"Use new AbilityScoreProcessor service instead of legacy processAbilityScoreBonuses() function",rolloutPercentage:100},debug_ability_score_processor:{key:"debug_ability_score_processor",enabled:!1,description:"Enable detailed debugging output for ability score modifier sources",conditions:{environment:"development"}},spell_slot_calculator:{key:"spell_slot_calculator",enabled:!0,description:"Use new SpellSlotCalculator service instead of legacy getSpellSlots() function",rolloutPercentage:100},debug_spell_slot_calculator:{key:"debug_spell_slot_calculator",enabled:!1,description:"Enable detailed debugging output for spell slot calculations",conditions:{environment:"development"}},inventory_processor:{key:"inventory_processor",enabled:!0,description:"Use new InventoryProcessor service instead of legacy inventory functions",rolloutPercentage:100},encumbrance_calculator:{key:"encumbrance_calculator",enabled:!0,description:"Use new EncumbranceCalculator service instead of legacy calculateEncumbrance() function",rolloutPercentage:100},inventory_processor_debug:{key:"inventory_processor_debug",enabled:!0,description:"Enable detailed debugging output for inventory processing",conditions:{environment:"development"}},encumbrance_calculator_debug:{key:"encumbrance_calculator_debug",enabled:!1,description:"Enable detailed debugging output for encumbrance calculations",conditions:{environment:"development"}},feature_processor:{key:"feature_processor",enabled:!0,description:"Use new FeatureProcessor service instead of legacy feature processing",rolloutPercentage:100},feature_processor_debug:{key:"feature_processor_debug",enabled:!1,description:"Enable detailed debugging output for feature processing",conditions:{environment:"development"}},weaponlist_debug:{key:"weaponlist_debug",enabled:!0,description:"Enable detailed debugging output for weaponlist XML generation",conditions:{environment:"development"}},spelllist_debug:{key:"spelllist_debug",enabled:!0,description:"Enable detailed debugging output for spelllist XML generation",conditions:{environment:"development"}}}},h=new Ls(As);class mr{constructor(){this.PROXY_URL="https://uakari-indigo.fly.dev/",this.DNDBEYOND_API_BASE="https://character-service.dndbeyond.com/character/v5/character/",this.REQUEST_TIMEOUT=3e4,this.MAX_RETRIES=3}validateCharacterID(e){if(!e||typeof e!="string")return{valid:!1,error:"Character ID is required"};const t=e.trim(),r=t.match(/dndbeyond\.com\/characters\/(\d+)/);return r?{valid:!0,sanitized:r[1]}:t.match(/^\d+$/)?{valid:!0,sanitized:t}:{valid:!1,error:"Invalid format. Use character ID or D&D Beyond character URL"}}async fetchCharacter(e){const t=this.validateCharacterID(e);if(!t.valid)return{success:!1,error:t.error};const r=t.sanitized;console.log("Fetching character data for ID:",r);const i="".concat(this.PROXY_URL).concat(this.DNDBEYOND_API_BASE).concat(r);console.log("Fetch URL:",i);let s=null;for(let a=1;a<=this.MAX_RETRIES;a++)try{console.log("Fetch attempt ".concat(a,"/").concat(this.MAX_RETRIES));const l=new AbortController,c=setTimeout(()=>l.abort(),this.REQUEST_TIMEOUT),u=await fetch(i,{method:"GET",headers:{Accept:"application/json","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Origin:"https://www.dndbeyond.com","X-Requested-With":"XMLHttpRequest"},signal:l.signal});if(clearTimeout(c),!u.ok)return{success:!1,error:this.getErrorMessage(u.status),statusCode:u.status};let d;try{d=await u.json()}catch(m){return{success:!1,error:"JSON parsing error: ".concat(m.message)}}let f;if(d.success&&d.data)f=d.data;else if(d.id&&d.name)f=d;else return{success:!1,error:"Invalid response format from D&D Beyond API"};return this.isValidCharacterData(f)?(console.log("Character data fetched successfully:",f.name),{success:!0,data:f}):{success:!1,error:"Invalid character data received from D&D Beyond"}}catch(l){if(s=l,console.warn("Fetch attempt ".concat(a," failed:"),l),this.isNonRetryableError(l))break;if(a<this.MAX_RETRIES){const c=Math.pow(2,a)*1e3;await new Promise(u=>setTimeout(u,c))}}return{success:!1,error:this.formatFinalError(s)}}getErrorMessage(e){switch(e){case 401:return"Character not found or not public. Ensure character visibility is set to Public.";case 403:return"Access denied. Character must be set to Public visibility.";case 404:return"Character not found. Please check the character ID.";case 429:return"Rate limit exceeded. Please wait before trying again.";case 500:case 502:case 503:return"D&D Beyond server error. Please try again later.";default:return"Unable to fetch character data (Error ".concat(e,"). Please try again.")}}isValidCharacterData(e){return e&&typeof e=="object"&&typeof e.id=="number"&&typeof e.name=="string"&&e.name.length>0}isNonRetryableError(e){return e.name==="AbortError"||e.message.includes("401")||e.message.includes("403")||e.message.includes("404")}formatFinalError(e){return e?e.name==="AbortError"?"Request timed out. Please check your connection and try again.":e.message.includes("Failed to fetch")||e.message.includes("NetworkError")?"Network error. Please check your internet connection and try again.":e.message.includes("CORS")?"CORS error. The proxy service may be temporarily unavailable.":"Network error: ".concat(e.message,". Please try again."):"Unknown error occurred while fetching character data"}async checkServiceHealth(){try{return(await fetch(this.PROXY_URL,{method:"HEAD",timeout:5e3})).ok}catch(e){return console.warn("Proxy service health check failed:",e),!1}}}const Ms=new mr;class oe{constructor(){this.alignmentConfig=null,this.abilityConfig=null,this.currencyConfig=null,this.gameRulesConfig=null}static getInstance(){return oe.instance||(oe.instance=new oe),oe.instance}async loadConfigs(){try{const[e,t,r,i]=await Promise.all([this.loadConfig("/src/config/dnd5e/alignments.json"),this.loadConfig("/src/config/dnd5e/abilities.json"),this.loadConfig("/src/config/dnd5e/currencies.json"),this.loadConfig("/src/config/dnd5e/game-rules.json")]);this.alignmentConfig=e,this.abilityConfig=t,this.currencyConfig=r,this.gameRulesConfig=i,console.log("✅ Game configuration loaded successfully")}catch(e){throw console.error("❌ Failed to load game configuration:",e),e}}async loadConfig(e){const t=await fetch(e);if(!t.ok)throw new Error("Failed to load config from ".concat(e,": ").concat(t.statusText));return await t.json()}getAlignmentName(e){if(!this.alignmentConfig)return console.warn("Alignment config not loaded, using fallback"),"True Neutral";const t=(e==null?void 0:e.toString())||"5";return this.alignmentConfig.mappings[t]||this.alignmentConfig.default}getAbilities(){return this.abilityConfig?this.abilityConfig.abilities:(console.warn("Ability config not loaded, using fallback"),[{id:1,name:"strength",displayName:"Strength",abbreviation:"STR"},{id:2,name:"dexterity",displayName:"Dexterity",abbreviation:"DEX"},{id:3,name:"constitution",displayName:"Constitution",abbreviation:"CON"},{id:4,name:"intelligence",displayName:"Intelligence",abbreviation:"INT"},{id:5,name:"wisdom",displayName:"Wisdom",abbreviation:"WIS"},{id:6,name:"charisma",displayName:"Charisma",abbreviation:"CHA"}])}calculateAbilityModifier(e){return Math.floor((e-10)/2)}getDefaultAbilityScore(){var e;return((e=this.abilityConfig)==null?void 0:e.calculations.defaultScore)||10}getCurrencies(){return this.currencyConfig?this.currencyConfig.currencies:[{name:"PP",displayName:"Platinum Pieces",value:10},{name:"GP",displayName:"Gold Pieces",value:1},{name:"EP",displayName:"Electrum Pieces",value:.5},{name:"SP",displayName:"Silver Pieces",value:.1},{name:"CP",displayName:"Copper Pieces",value:.01}]}calculateProficiencyBonus(e){return this.gameRulesConfig?e>=17?6:e>=13?5:e>=9?4:e>=5?3:2:Math.ceil(e/4)+1}getBaseArmorClass(){var e;return((e=this.gameRulesConfig)==null?void 0:e.armorClass.baseAC)||10}getDefaultSize(){var e;return((e=this.gameRulesConfig)==null?void 0:e.sizes.default)||"Medium"}getHitDiceTypes(){var e;return((e=this.gameRulesConfig)==null?void 0:e.hitDice.types)||["d6","d8","d10","d12"]}getDefaultHitDie(){var e;return((e=this.gameRulesConfig)==null?void 0:e.hitDice.default)||"d8"}isLoaded(){return!!(this.alignmentConfig&&this.abilityConfig&&this.currencyConfig&&this.gameRulesConfig)}}const F=oe.getInstance();class z{static find(e,t="",r=""){if(!e||typeof e!="object")return[];const i=[],s=[e],o=new WeakSet;for(;s.length>0;){const a=s.pop();if(!(!a||typeof a!="object"||o.has(a))){o.add(a);for(const[l,c]of Object.entries(a))typeof c=="object"&&c!==null&&s.push(c),((t===""||l===t)&&(r===""||c===r)||t===l&&r===""||r===c&&t==="")&&(i.includes(a)||i.push(a))}}return i}static findAdvanced(e,t,r={}){if(!e||typeof e!="object")return[];const{maxDepth:i=50,includeArrays:s=!0,caseSensitive:o=!0,excludeKeys:a=[]}=r,l=[],c=[{obj:e,depth:0}],u=new WeakSet;for(;c.length>0;){const{obj:d,depth:f}=c.pop();if(!(!d||typeof d!="object"||u.has(d)||f>i)){u.add(d);for(const[m,g]of Object.entries(d))a.includes(m)||(typeof g=="object"&&g!==null&&(s||!Array.isArray(g))&&c.push({obj:g,depth:f+1}),this.matchesCriteria(m,g,t,o)&&(l.includes(d)||l.push(d)))}}return l}static findByEntityType(e,t){return this.find(e,"entityTypeId",t.toString())}static findByType(e,t){return this.find(e,"type",t)}static findByValue(e,t){return this.find(e,"",t)}static findByKey(e,t){return this.find(e,t,"")}static matchesCriteria(e,t,r,i){const{key:s,value:o,matchMode:a="exact"}=r;let l=!0;if(s!==void 0){const u=i?e:e.toLowerCase(),d=i?s:s.toLowerCase();switch(a){case"partial":l=u.includes(d);break;case"regex":l=new RegExp(d,i?"g":"gi").test(u);break;default:l=u===d}}let c=!0;if(o!==void 0)if(typeof t=="string"&&typeof o=="string"){const u=i?t:t.toLowerCase(),d=i?o:o.toLowerCase();switch(a){case"partial":c=u.includes(d);break;case"regex":c=new RegExp(d,i?"g":"gi").test(u);break;default:c=u===d}}else c=t===o;return l&&c}static getAllKeys(e,t=10){const r=new Set,i=[{obj:e,depth:0}],s=new WeakSet;for(;i.length>0;){const{obj:o,depth:a}=i.pop();if(!(!o||typeof o!="object"||s.has(o)||a>t)){s.add(o);for(const[l,c]of Object.entries(o))r.add(l),typeof c=="object"&&c!==null&&i.push({obj:c,depth:a+1})}}return Array.from(r).sort()}}class N{static sanitizeForXML(e,t={}){if(e==null||e==="")return"";const r=String(e),{maxLength:i=1e3,allowNewlines:s=!1,allowTabs:o=!1,preserveSpaces:a=!0,removeEventHandlers:l=!0,removeDangerousProtocols:c=!0}=t;let u=r;return c&&(u=u.replace(/javascript:/gi,"").replace(/vbscript:/gi,"").replace(/data:/gi,"")),l&&(u=u.replace(/on\w+\s*=/gi,"")),s||(u=u.replace(/\n/g," "),u=u.replace(/\r/g," ")),o||(u=u.replace(/\t/g," ")),s&&o?u=u.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""):s?u=u.replace(/[\x00-\x08\x0B-\x0C\x0E-\x1F\x7F]/g,""):o?u=u.replace(/[\x00-\x08\x0A\x0B\x0C\x0D\x0E-\x1F\x7F]/g,""):u=u.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""),u=u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/=/g,"&#x3D;").replace(/\//g,"&#x2F;"),u=u.substring(0,i),a?u.trim():u.replace(/\s+/g," ").trim()}static sanitizeWithReport(e,t={}){if(e==null||e==="")return{sanitized:"",wasModified:!1,originalLength:0,finalLength:0,removedPatterns:[]};const r=String(e),i=r.length,s=[];let o=r;/javascript:/gi.test(o)&&s.push("javascript: protocol"),/vbscript:/gi.test(o)&&s.push("vbscript: protocol"),/data:/gi.test(o)&&s.push("data: protocol"),/on\w+\s*=/gi.test(o)&&s.push("event handlers"),/[\x00-\x1F\x7F]/.test(o)&&s.push("control characters");const a=this.sanitizeForXML(e,t);return{sanitized:a,wasModified:a!==r,originalLength:i,finalLength:a.length,removedPatterns:s}}static sanitizeHTML(e,t={}){if(e==null||e==="")return"";const{maxLength:r=1e4,allowNewlines:i=!0,allowTabs:s=!1}=t;let a=String(e).substring(0,r).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x2F;/g,"/");return a=a.replace(/&rsquo;/g,"'").replace(/&lsquo;/g,"'").replace(/&rdquo;/g,'"').replace(/&ldquo;/g,'"').replace(/&ndash;/g,"-").replace(/&mdash;/g,"-").replace(/&#34;/g,'"').replace(/&nbsp;/g," "),a=a.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/\s*on\w+\s*=\s*[^>\s]*/gi,"").replace(/javascript:/gi,"").replace(/vbscript:/gi,""),i||(a=a.replace(/\n/g," ").replace(/\r/g," ")),s||(a=a.replace(/\t/g," ")),!i&&!s&&(a=a.replace(/\s+/g," ")),a.trim().substring(0,r)}static sanitizeText(e,t={}){if(e==null||e==="")return"";const{maxLength:r=1e3,allowNewlines:i=!1,allowTabs:s=!1}=t;let o=String(e);return i||(o=o.replace(/[\n\r]/g," ")),s||(o=o.replace(/\t/g," ")),i&&s?o=o.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""):i?o=o.replace(/[\x00-\x08\x0B-\x0C\x0E-\x1F\x7F]/g,""):s?o=o.replace(/[\x00-\x08\x0A\x0B\x0C\x0D\x0E-\x1F\x7F]/g,""):o=o.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""),o=o.substring(0,r),!i&&!s&&(o=o.replace(/\s+/g," ")),o.trim()}static escapeXMLAttribute(e){return e==null||e===""?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}static isXMLSafe(e){return!e||typeof e!="string"?!0:![/javascript:/gi,/vbscript:/gi,/on\w+\s*=/gi,/<script/gi,/<iframe/gi,/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/].some(r=>r.test(e))}static normalizeToASCII(e){return e==null||e===""?"":String(e).replace(/[\u2018\u2019]/g,"'").replace(/[\u201c\u201d]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/[\u2026]/g,"...").replace(/[àáâãäå]/g,"a").replace(/[ÀÁÂÃÄÅ]/g,"A").replace(/[èéêë]/g,"e").replace(/[ÈÉÊË]/g,"E").replace(/[ìíîï]/g,"i").replace(/[ÌÍÎÏ]/g,"I").replace(/[òóôõö]/g,"o").replace(/[ÒÓÔÕÖ]/g,"O").replace(/[ùúûü]/g,"u").replace(/[ÙÚÛÜ]/g,"U").replace(/[ñ]/g,"n").replace(/[Ñ]/g,"N").replace(/[ç]/g,"c").replace(/[Ç]/g,"C")}}class se{static get(e,t,r=null,i={}){const{throwOnError:s=!1,logWarnings:o=!0,maxDepth:a=50,caseSensitive:l=!0}=i;try{if(!e||typeof e!="object"||!t||typeof t!="string")return r;const c=t.split(".");if(c.length>a){const f="Path depth exceeds maximum (".concat(a,"): ").concat(t);if(o&&console.warn(f),s)throw new Error(f);return r}let u=e,d="";for(let f=0;f<c.length;f++){const m=c[f];if(d+=(f>0?".":"")+m,u==null||typeof u!="object")return r;let g=m;if(!l&&!(m in u)){const _=Object.keys(u).find(p=>p.toLowerCase()===m.toLowerCase());_&&(g=_)}if(!(g in u))return r;u=u[g]}return u!=null?u:r}catch(c){const u="Safe access failed for path: ".concat(t);if(o&&console.warn(u,c),s)throw new Error("".concat(u,": ").concat(c instanceof Error?c.message:String(c)));return r}}static getWithResult(e,t,r={}){const{maxDepth:i=50,caseSensitive:s=!0}=r;if(!e||typeof e!="object")return{value:null,found:!1,path:t,depth:0,error:"Invalid object provided"};if(!t||typeof t!="string")return{value:null,found:!1,path:t,depth:0,error:"Invalid path provided"};try{const o=t.split(".");if(o.length>i)return{value:null,found:!1,path:t,depth:o.length,error:"Path depth exceeds maximum (".concat(i,")")};let a=e,l=0;for(const c of o){if(l++,a==null||typeof a!="object")return{value:null,found:!1,path:t,depth:l,error:"Cannot access property '".concat(c,"' on ").concat(typeof a)};let u=c;if(!s&&!(c in a)){const d=Object.keys(a).find(f=>f.toLowerCase()===c.toLowerCase());d&&(u=d)}if(!(u in a))return{value:null,found:!1,path:t,depth:l,error:"Property '".concat(c,"' not found")};a=a[u]}return{value:a,found:!0,path:t,depth:l,error:void 0}}catch(o){return{value:null,found:!1,path:t,depth:0,error:o instanceof Error?o.message:String(o)}}}static has(e,t,r={}){const i=this.getWithResult(e,t,r);return i.found&&i.value!==null&&i.value!==void 0}static getMultiple(e,t,r={}){const i={};for(const s of t)i[s]=this.get(e,s,null,r);return i}static set(e,t,r,i={}){const{maxDepth:s=50,caseSensitive:o=!0}=i;try{if(!e||typeof e!="object"||!t||typeof t!="string")return!1;const a=t.split(".");if(a.length>s)return!1;let l=e;for(let u=0;u<a.length-1;u++){const d=a[u];(!(d in l)||typeof l[d]!="object"||l[d]===null)&&(l[d]={}),l=l[d]}const c=a[a.length-1];return l[c]=r,!0}catch(a){return i.logWarnings&&console.warn("Safe set failed for path: ".concat(t),a),!1}}static delete(e,t,r={}){try{if(!e||typeof e!="object")return!1;const i=t.split("."),s=i.slice(0,-1).join("."),o=i[i.length-1];if(i.length===1)return o in e?(delete e[o],!0):!1;const a=this.get(e,s,null,r);return a&&typeof a=="object"&&o in a?(delete a[o],!0):!1}catch(i){return r.logWarnings&&console.warn("Safe delete failed for path: ".concat(t),i),!1}}static getAllPaths(e,t=10,r=""){const i=[];if(!e||typeof e!="object"||t<=0)return i;for(const[s,o]of Object.entries(e)){const a=r?"".concat(r,".").concat(s):s;if(i.push(a),typeof o=="object"&&o!==null&&t>1){const l=this.getAllPaths(o,t-1,a);i.push(...l)}}return i.sort()}}const T=["strength","dexterity","constitution","intelligence","wisdom","charisma"],Jt=[{id:1,name:"strength",abbreviation:"STR",description:"Measures physical power and carrying capacity"},{id:2,name:"dexterity",abbreviation:"DEX",description:"Measures agility, reflexes, and balance"},{id:3,name:"constitution",abbreviation:"CON",description:"Measures health, stamina, and vital force"},{id:4,name:"intelligence",abbreviation:"INT",description:"Measures reasoning ability, memory, and analytical thinking"},{id:5,name:"wisdom",abbreviation:"WIS",description:"Measures awareness, intuition, and insight"},{id:6,name:"charisma",abbreviation:"CHA",description:"Measures force of personality, leadership, and confidence"}],Is=10,ks=1,Ts=30,Fs=20;class k{static calculateModifier(e){return Math.floor((e-10)/2)}static getAbilityById(e){return Jt.find(t=>t.id===e)||null}static getAbilityByName(e){return Jt.find(t=>t.name.toLowerCase()===e.toLowerCase())||null}static getAbilityIdByName(e){const t=T.indexOf(e.toLowerCase());return t>=0?t+1:0}static getAbilityNameById(e){return T[e-1]||null}static getAbbreviation(e){const t=this.getAbilityByName(e);return t?t.abbreviation:null}static isValidScore(e,t=!0){const r=ks,i=t?Ts:Fs;return e>=r&&e<=i}static calculateAllModifiers(e){return e.map((t,r)=>({score:t,modifier:this.calculateModifier(t)}))}static calculateSaveBonus(e,t,r){return this.calculateModifier(e)+(r?t:0)}static calculateCarryingCapacity(e,t=!1){const r=t?2:1,i=e*15*r;return{normal:e*5*r,encumbered:e*10*r,heavilyEncumbered:i,maximum:i,liftPushDrag:e*30*r}}static convertLegacyAbilities(e,t,r){const i={};return T.forEach((s,o)=>{var u,d,f;const a=((u=e==null?void 0:e[o])==null?void 0:u.value)||Is,l=((d=t==null?void 0:t[o])==null?void 0:d.value)||0,c=(f=r==null?void 0:r[o])==null?void 0:f.value;i[s]=c!=null?c:a+l}),i}}const Pt=class Pt{static setDebugMode(e){this.debugEnabled=e}static debugAbilityModifierSources(e){if(!this.debugEnabled)return;if(console.group("🔍 Detailed Ability Score Modifier Analysis"),console.log("📊 Base Ability Scores:"),e.stats&&Array.isArray(e.stats)?e.stats.forEach((r,i)=>{const s=T[i];console.log("  ".concat(s,": ").concat(r.value||10," (base)"))}):console.log("  No base stats found - using defaults (10)"),console.log("\n💪 Existing Bonus Stats (from D&D Beyond):"),e.bonusStats&&Array.isArray(e.bonusStats)){let r=!1;e.bonusStats.forEach((i,s)=>{const o=T[s];i.value&&i.value>0&&(console.log("  ".concat(o,": +").concat(i.value," (pre-calculated by D&D Beyond)")),r=!0)}),r||console.log("  No existing bonus stats from D&D Beyond")}else console.log("  No existing bonus stats from D&D Beyond");if(console.log("\n🔄 Override Stats:"),e.overrideStats&&Array.isArray(e.overrideStats)){let r=!1;e.overrideStats.forEach((i,s)=>{const o=T[s];i.value!==null&&i.value!==void 0&&(console.log("  ".concat(o,": ").concat(i.value," (OVERRIDE - replaces base + bonuses)")),r=!0)}),r||console.log("  No overrides found")}else console.log("  No override stats found");const t=["race","class","background","item","feat"];t.forEach(r=>{if(console.log("\n🎯 ".concat(r.toUpperCase()," Modifiers:")),!e.modifiers||!e.modifiers[r]){console.log("  No ".concat(r," modifiers found"));return}const i=e.modifiers[r];let s=0,o=0;i.forEach((a,l)=>{if(a.type==="bonus"&&a.subType&&a.subType.endsWith("-score")){const c=a.subType.replace("-score",""),u=a.fixedValue||0;console.log("    ✅ ".concat(c,"-score: +").concat(u," ").concat(a.friendlyTypeName?"(".concat(a.friendlyTypeName,")"):"")),(a.componentId||a.componentTypeId)&&console.log("       🔗 Component: ".concat(a.componentId||"N/A"," (Type: ").concat(a.componentTypeId||"N/A",")")),(a.entityId||a.entityTypeId)&&console.log("       🎲 Entity: ".concat(a.entityId||"N/A"," (Type: ").concat(a.entityTypeId||"N/A",")")),s++}else console.log("    ⚙️  ".concat(a.subType||"unknown",": ").concat(a.fixedValue||0," (").concat(a.type||"unknown",")")),o++}),console.log("  📈 Summary: ".concat(s," ability modifiers, ").concat(o," other modifiers"))}),console.log("\n🎯 Final Ability Score Breakdown:"),console.log("  [Comparing D&D Beyond pre-calculated vs manually calculated bonuses]"),T.forEach((r,i)=>{var g,_,p,y,v,C;const s=((_=(g=e.stats)==null?void 0:g[i])==null?void 0:_.value)||10,o=((y=(p=e.bonusStats)==null?void 0:p[i])==null?void 0:y.value)||0,a=(C=(v=e.overrideStats)==null?void 0:v[i])==null?void 0:C.value;let l=0;t.forEach(S=>{var b;(b=e.modifiers)!=null&&b[S]&&e.modifiers[S].forEach(w=>{if(w.type==="bonus"&&w.subType==="".concat(r,"-score")){const $=parseInt(String(w.fixedValue))||0;$>0&&(l+=$)}})});const c=a!=null?a:s+o,u=a!=null?a:s+l,d=k.calculateModifier(c),f=k.calculateModifier(u),m=o!==l?" ⚠️  MISMATCH!":"";console.log("  ".concat(r.padEnd(12)," ").concat(s.toString().padStart(2)," (base) + ").concat(o.toString().padStart(2)," (D&DB) = ").concat(c.toString().padStart(2)," [").concat(d>=0?"+":"").concat(d,"]")),console.log("  ".concat(" ".padEnd(12)," ").concat(s.toString().padStart(2)," (base) + ").concat(l.toString().padStart(2)," (calc) = ").concat(u.toString().padStart(2)," [").concat(f>=0?"+":"").concat(f,"]").concat(m)),console.log("")}),console.groupEnd()}static processAbilityScoreBonuses(e){console.log("AbilityScoreProcessor: Processing ability score bonuses from all sources..."),this.debugAbilityModifierSources(e);const t=[];e.bonusStats&&[...e.bonusStats];let r=[];for(let a=1;a<=6;a++)r.push({id:a,name:null,value:0});["race","class","background","item","feat"].forEach(a=>{e.modifiers&&e.modifiers[a]&&e.modifiers[a].forEach(l=>{if(l.type==="bonus"&&l.subType&&l.subType.endsWith("-score")){const c=l.subType.replace("-score",""),u=k.getAbilityIdByName(c);if(u>0&&l.fixedValue!==null&&l.fixedValue!==void 0){const d=parseInt(String(l.fixedValue))||0;d>0&&r[u-1]&&(r[u-1].value+=d,t.push({source:a,ability:c,bonus:d}),console.log("Applied ".concat(a," bonus: +").concat(d," to ").concat(c," (ID: ").concat(u,")")))}}})});const s={};T.forEach((a,l)=>{var p,y,v;const c=l+1,u=this.getTotalAbilityScore(e,c,r),d=(p=e.stats)==null?void 0:p.find(C=>C.id===c),f=(d==null?void 0:d.value)||10,m=((y=r[l])==null?void 0:y.value)||0,g=(v=e.overrideStats)==null?void 0:v.find(C=>C.id===c),_=(g==null?void 0:g.value)||null;s[a]={base:f,bonus:m,override:_,total:u,modifier:k.calculateModifier(u)}});const o=T.map((a,l)=>{var c;return{ability:a,bonus:((c=r[l])==null?void 0:c.value)||0}}).filter(a=>a.bonus>0);return console.log("Final ability score bonuses:"),o.forEach(({ability:a,bonus:l})=>{console.log("  ".concat(a,": +").concat(l))}),{processedBonuses:r,totalScores:s,debugInfo:{appliedBonuses:t,finalBonusSummary:o}}}static getTotalAbilityScore(e,t,r){var l,c,u;let i=10;e.stats&&e.stats.length>=t&&(i=((l=e.stats[t-1])==null?void 0:l.value)||10);let s=0;const o=r||e.bonusStats;o&&o.length>=t&&(s=((c=o[t-1])==null?void 0:c.value)||0);let a=null;return e.overrideStats&&e.overrideStats.length>=t&&(a=(u=e.overrideStats[t-1])==null?void 0:u.value),a!==null?a:i+s}static processLegacyFormat(e){const t=this.processAbilityScoreBonuses(e);return T.map((r,i)=>{const s=i+1,o=t.totalScores[r],a=t.debugInfo.appliedBonuses.filter(d=>d.ability===r),l=a.filter(d=>d.source==="race").reduce((d,f)=>d+f.bonus,0),c=a.filter(d=>d.source==="feat").reduce((d,f)=>d+f.bonus,0),u=a.filter(d=>d.source==="item").reduce((d,f)=>d+f.bonus,0);return{id:s,name:r,base:(o==null?void 0:o.base)||10,racial:l,feat:c,item:u,total:(o==null?void 0:o.total)||10,modifier:(o==null?void 0:o.modifier)||0}})}static validateCharacterData(e){const t=[],r=[];return e?(!e.stats||!Array.isArray(e.stats)?r.push("Character stats array is missing or invalid - will use defaults"):e.stats.length<6&&r.push("Character stats array has ".concat(e.stats.length," entries, expected 6")),e.bonusStats&&!Array.isArray(e.bonusStats)&&r.push("Character bonusStats is not an array - will initialize"),e.overrideStats&&!Array.isArray(e.overrideStats)&&r.push("Character overrideStats is not an array"),e.modifiers&&typeof e.modifiers!="object"&&r.push("Character modifiers is not an object"),e.modifiers&&["race","class","background","item","feat"].forEach(s=>{e.modifiers[s]&&!Array.isArray(e.modifiers[s])&&r.push("Character modifiers.".concat(s," is not an array"))}),{isValid:t.length===0,issues:t,warnings:r}):(t.push("Character data is null or undefined"),{isValid:!1,issues:t,warnings:r})}};Pt.debugEnabled=!1;let P=Pt;const Zt={1:{1:2,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},2:{1:3,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},3:{1:4,2:2,3:0,4:0,5:0,6:0,7:0,8:0,9:0},4:{1:4,2:3,3:0,4:0,5:0,6:0,7:0,8:0,9:0},5:{1:4,2:3,3:2,4:0,5:0,6:0,7:0,8:0,9:0},6:{1:4,2:3,3:3,4:0,5:0,6:0,7:0,8:0,9:0},7:{1:4,2:3,3:3,4:1,5:0,6:0,7:0,8:0,9:0},8:{1:4,2:3,3:3,4:2,5:0,6:0,7:0,8:0,9:0},9:{1:4,2:3,3:3,4:3,5:1,6:0,7:0,8:0,9:0},10:{1:4,2:3,3:3,4:3,5:2,6:0,7:0,8:0,9:0},11:{1:4,2:3,3:3,4:3,5:2,6:1,7:0,8:0,9:0},12:{1:4,2:3,3:3,4:3,5:2,6:1,7:0,8:0,9:0},13:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:0,9:0},14:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:0,9:0},15:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:1,9:0},16:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:1,9:0},17:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:1,9:1},18:{1:4,2:3,3:3,4:3,5:3,6:1,7:1,8:1,9:1},19:{1:4,2:3,3:3,4:3,5:3,6:2,7:1,8:1,9:1},20:{1:4,2:3,3:3,4:3,5:3,6:2,7:2,8:1,9:1}},Ps={1:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},2:{1:2,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},3:{1:3,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},4:{1:3,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},5:{1:4,2:2,3:0,4:0,5:0,6:0,7:0,8:0,9:0},6:{1:4,2:2,3:0,4:0,5:0,6:0,7:0,8:0,9:0},7:{1:4,2:3,3:0,4:0,5:0,6:0,7:0,8:0,9:0},8:{1:4,2:3,3:0,4:0,5:0,6:0,7:0,8:0,9:0},9:{1:4,2:3,3:2,4:0,5:0,6:0,7:0,8:0,9:0},10:{1:4,2:3,3:2,4:0,5:0,6:0,7:0,8:0,9:0},11:{1:4,2:3,3:3,4:0,5:0,6:0,7:0,8:0,9:0},12:{1:4,2:3,3:3,4:0,5:0,6:0,7:0,8:0,9:0},13:{1:4,2:3,3:3,4:1,5:0,6:0,7:0,8:0,9:0},14:{1:4,2:3,3:3,4:1,5:0,6:0,7:0,8:0,9:0},15:{1:4,2:3,3:3,4:2,5:0,6:0,7:0,8:0,9:0},16:{1:4,2:3,3:3,4:2,5:0,6:0,7:0,8:0,9:0},17:{1:4,2:3,3:3,4:3,5:1,6:0,7:0,8:0,9:0},18:{1:4,2:3,3:3,4:3,5:1,6:0,7:0,8:0,9:0},19:{1:4,2:3,3:3,4:3,5:2,6:0,7:0,8:0,9:0},20:{1:4,2:3,3:3,4:3,5:2,6:0,7:0,8:0,9:0}},Qt={1:{1:2,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},2:{1:2,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},3:{1:2,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},4:{1:3,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},5:{1:3,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},6:{1:3,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},7:{1:4,2:2,3:0,4:0,5:0,6:0,7:0,8:0,9:0},8:{1:4,2:2,3:0,4:0,5:0,6:0,7:0,8:0,9:0},9:{1:4,2:2,3:0,4:0,5:0,6:0,7:0,8:0,9:0},10:{1:4,2:3,3:0,4:0,5:0,6:0,7:0,8:0,9:0},11:{1:4,2:3,3:0,4:0,5:0,6:0,7:0,8:0,9:0},12:{1:4,2:3,3:0,4:0,5:0,6:0,7:0,8:0,9:0},13:{1:4,2:3,3:2,4:0,5:0,6:0,7:0,8:0,9:0},14:{1:4,2:3,3:2,4:0,5:0,6:0,7:0,8:0,9:0},15:{1:4,2:3,3:2,4:0,5:0,6:0,7:0,8:0,9:0},16:{1:4,2:3,3:3,4:0,5:0,6:0,7:0,8:0,9:0},17:{1:4,2:3,3:3,4:0,5:0,6:0,7:0,8:0,9:0},18:{1:4,2:3,3:3,4:0,5:0,6:0,7:0,8:0,9:0},19:{1:4,2:3,3:3,4:1,5:0,6:0,7:0,8:0,9:0},20:{1:4,2:3,3:3,4:1,5:0,6:0,7:0,8:0,9:0}},Rs={1:{warlockLevel:1,slotLevel:1,slotCount:1,shortRestRecharge:!0},2:{warlockLevel:2,slotLevel:1,slotCount:2,shortRestRecharge:!0},3:{warlockLevel:3,slotLevel:2,slotCount:2,shortRestRecharge:!0},4:{warlockLevel:4,slotLevel:2,slotCount:2,shortRestRecharge:!0},5:{warlockLevel:5,slotLevel:3,slotCount:2,shortRestRecharge:!0},6:{warlockLevel:6,slotLevel:3,slotCount:2,shortRestRecharge:!0},7:{warlockLevel:7,slotLevel:4,slotCount:2,shortRestRecharge:!0},8:{warlockLevel:8,slotLevel:4,slotCount:2,shortRestRecharge:!0},9:{warlockLevel:9,slotLevel:5,slotCount:2,shortRestRecharge:!0},10:{warlockLevel:10,slotLevel:5,slotCount:2,shortRestRecharge:!0},11:{warlockLevel:11,slotLevel:5,slotCount:3,shortRestRecharge:!0},12:{warlockLevel:12,slotLevel:5,slotCount:3,shortRestRecharge:!0},13:{warlockLevel:13,slotLevel:5,slotCount:3,shortRestRecharge:!0},14:{warlockLevel:14,slotLevel:5,slotCount:3,shortRestRecharge:!0},15:{warlockLevel:15,slotLevel:5,slotCount:3,shortRestRecharge:!0},16:{warlockLevel:16,slotLevel:5,slotCount:3,shortRestRecharge:!0},17:{warlockLevel:17,slotLevel:5,slotCount:4,shortRestRecharge:!0},18:{warlockLevel:18,slotLevel:5,slotCount:4,shortRestRecharge:!0},19:{warlockLevel:19,slotLevel:5,slotCount:4,shortRestRecharge:!0},20:{warlockLevel:20,slotLevel:5,slotCount:4,shortRestRecharge:!0}},Os={bard:"full",cleric:"full",druid:"full",sorcerer:"full",wizard:"full",paladin:"half",ranger:"half",artificer:"third",fighter:"third",rogue:"third",warlock:"pact"},Ns={fighter:["eldritch_knight"],rogue:["arcane_trickster"],ranger:[]},ae=class ae{static setDebugMode(e){this.debugEnabled=e}calculateSpellSlots(e,t=this.getDefaultOptions()){(ae.debugEnabled||h.isEnabled("spell_slot_calculator_debug"))&&console.log("🔮 SpellSlotCalculator: Calculating spell slots",{classCount:e.length,classes:e.map(f=>"".concat(f.classDefinition.name).concat(f.level)),options:t});const r=this.analyzeSpellcastingClasses(e,t),i=r.filter(f=>f.casterType!=="none"),s=i.some(f=>f.isPactMagic),o=i.some(f=>!f.isPactMagic&&f.casterType!=="none");let a,l,c,u;if(s&&!o)a="pact_magic_only",l=this.getEmptySpellSlots(),c=this.calculatePactMagicSlots(r),u=0;else if(i.length===1)a="single_class",l=this.calculateSingleClassSpellSlots(i[0]),c=this.getEmptySpellSlots(),u=i[0].casterLevel;else if(i.length>1){a="multiclass";const f=this.calculateMulticlassSpellSlots(r,t);l=f.regularSpellSlots,c=f.pactMagicSlots,u=f.totalCasterLevel}else a="single_class",l=this.getEmptySpellSlots(),c=this.getEmptySpellSlots(),u=0;const d={spellSlots:l,pactMagicSlots:c,multiclassCasterLevel:u,totalCasterClasses:i.length,debugInfo:{classBreakdown:r,calculationMethod:a,casterLevelCalculation:this.buildCasterLevelCalculation(r)}};return(ae.debugEnabled||h.isEnabled("spell_slot_calculator_debug"))&&console.log("🔮 SpellSlotCalculator: Result",{method:a,multiclassCasterLevel:u,totalCasterClasses:i.length,spellSlots:this.summarizeSpellSlots(l),pactMagic:this.summarizeSpellSlots(c)}),d}generateSpellSlotsXML(e){const t=this.generateRegularSpellSlotsXML(e.spellSlots),r=this.generatePactMagicSlotsXML(e.pactMagicSlots),i=this.combineSpellSlotXML(t,r);return{spellSlotsXML:t,pactMagicXML:r,combinedXML:i}}analyzeSpellcastingClasses(e,t){return e.map(r=>{var c;const i=r.classDefinition.name.toLowerCase(),s=Os[i]||"none";let o=s;if((s==="third"||s==="none")&&(this.checkSpellcastingSubclass(r)||(o="none")),i==="ranger"&&t.handleSpelllessRanger){const u=(c=r.subclassDefinition)==null?void 0:c.name.toLowerCase().replace(/\s+/g,"_");(u==="spellless"||u==="beast_master_spellless")&&(o="none")}const a=this.calculateClassCasterLevel(r,o),l=i==="warlock";return{className:i,casterType:o,casterLevel:a,spellSlots:this.getSpellSlotsForProgression(o,r.level,i),isPactMagic:l,spellcastingAbility:this.getSpellcastingAbility(i),actualClassLevel:r.level}})}checkSpellcastingSubclass(e){var s;const t=e.classDefinition.name.toLowerCase(),r=(s=e.subclassDefinition)==null?void 0:s.name.toLowerCase().replace(/\s+/g,"_");if(!r)return!1;const i=Ns[t];return i?i.length===0||i.includes(r):!1}calculateClassCasterLevel(e,t){switch(t){case"full":return e.level;case"half":return Math.floor(e.level/2);case"third":return Math.floor(e.level/3);case"pact":return 0;default:return 0}}getSpellSlotsForProgression(e,t,r){if(e==="none")return this.getEmptySpellSlots();switch(e){case"full":return Zt[t]||this.getEmptySpellSlots();case"half":return Ps[t]||this.getEmptySpellSlots();case"third":return r==="artificer"?Qt[t]||this.getEmptySpellSlots():t<3?this.getEmptySpellSlots():Qt[t]||this.getEmptySpellSlots();case"pact":return this.convertPactMagicToSpellSlots(t);default:return this.getEmptySpellSlots()}}calculateSingleClassSpellSlots(e){return e.spellSlots}calculateMulticlassSpellSlots(e,t){const r=e.filter(l=>!l.isPactMagic&&l.casterType!=="none"),i=e.filter(l=>l.isPactMagic),s=r.reduce((l,c)=>l+c.casterLevel,0),o=Zt[s]||this.getEmptySpellSlots(),a=i.length>0?this.calculatePactMagicSlots(i):this.getEmptySpellSlots();return{regularSpellSlots:o,pactMagicSlots:a,totalCasterLevel:s}}calculatePactMagicSlots(e){const t=e.find(r=>r.className==="warlock");return!t||!t.actualClassLevel?this.getEmptySpellSlots():this.convertPactMagicToSpellSlots(t.actualClassLevel)}convertPactMagicToSpellSlots(e){const t=Rs[e];if(!t)return this.getEmptySpellSlots();const r=this.getEmptySpellSlots();return r[t.slotLevel]=t.slotCount,r}generateRegularSpellSlotsXML(e){let t="";for(let r=1;r<=9;r++){const i=e[r];t+="			<spellslots".concat(r,">\n"),t+='				<max type="number">'.concat(i,"</max>\n"),t+="			</spellslots".concat(r,">\n")}return t}generatePactMagicSlotsXML(e){let t="";for(let r=1;r<=9;r++){const i=e[r];t+="			<pactmagicslots".concat(r,">\n"),t+='				<max type="number">'.concat(i,"</max>\n"),t+="			</pactmagicslots".concat(r,">\n")}return t}combineSpellSlotXML(e,t){let r="		<powermeta>\n";return r+=t,r+=e,r+="		</powermeta>",r}getSpellcastingAbility(e){return{wizard:"INT",artificer:"INT",fighter:"INT",rogue:"INT",cleric:"WIS",druid:"WIS",ranger:"WIS",bard:"CHA",sorcerer:"CHA",warlock:"CHA",paladin:"CHA"}[e]}buildCasterLevelCalculation(e){return e.map(t=>({className:t.className,level:t.casterLevel,casterType:t.casterType,contributesToCasterLevel:t.isPactMagic?0:t.casterLevel}))}getEmptySpellSlots(){return{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0}}summarizeSpellSlots(e){return Object.entries(e).filter(([r,i])=>i>0).map(([r,i])=>"".concat(r,":").concat(i)).join(", ")||"none"}getDefaultOptions(){return{includeDebugInfo:!0,strictMulticlassRules:!0,handleSpelllessRanger:!0,includePactMagicInMainSlots:!1}}static validateClassData(e){const t=[];return e.forEach((r,i)=>{var s,o;(s=r.classDefinition)!=null&&s.name||t.push("Class at index ".concat(i," missing name")),(typeof r.level!="number"||r.level<1||r.level>20)&&t.push("Class ".concat(((o=r.classDefinition)==null?void 0:o.name)||i," has invalid level: ").concat(r.level))}),{isValid:t.length===0,errors:t}}static getSpellSlotsForClass(e,t,r){const i=new ae,s={id:1,level:t,classDefinition:{id:1,name:e,canCastSpells:!0},subclassDefinition:r?{id:1,name:r}:void 0};return i.calculateSpellSlots([s]).spellSlots}static toLegacyFormat(e){return Object.entries(e).map(([t,r])=>({level:parseInt(t),slots:r}))}static validateClassInfo(e){var r;const t=[];return!e||typeof e!="object"?(t.push("Class info must be an object"),{isValid:!1,errors:t}):(Array.isArray(e)||((r=e.classDefinition)!=null&&r.name||t.push("Class definition name is required"),(typeof e.level!="number"||e.level<1||e.level>20)&&t.push("Class level must be between 1 and 20")),{isValid:t.length===0,errors:t})}};ae.debugEnabled=!1;let j=ae;class re{constructor(e){if(this.pounds=e,e<0)throw new Error("Weight cannot be negative")}add(e){return new re(this.pounds+e.pounds)}multiply(e){if(e<0)throw new Error("Weight multiplier cannot be negative");return new re(this.pounds*e)}isZero(){return this.pounds===0}}class ft{constructor(e){if(this.amount=e,e<0)throw new Error("Quantity cannot be negative")}isZero(){return this.amount===0}multiply(e){return e.multiply(this.amount)}}class Bs{padIndex(e){return String(e).padStart(5,"0")}generateItemXML(e,t,r=0){const i="	".repeat(3),s="	".repeat(4),o=this.padIndex(t);let a="".concat(i,"<id-").concat(o,">\n");return a+="".concat(s,'<count type="number">').concat(e.count,"</count>\n"),a+="".concat(s,'<name type="string">').concat(e.name,"</name>\n"),a+="".concat(s,'<weight type="number">').concat(e.weight,"</weight>\n"),a+="".concat(s,'<locked type="number">').concat(e.isLocked?1:0,"</locked>\n"),a+="".concat(s,'<isidentified type="number">').concat(e.isIdentified?1:0,"</isidentified>\n"),e.type&&(a+="".concat(s,'<type type="string">').concat(e.type,"</type>\n")),e.cost&&(a+="".concat(s,'<cost type="string">').concat(e.cost.value," ").concat(e.cost.denomination,"</cost>\n")),e.description&&(a+="".concat(s,'<description type="formattedtext">\n'),a+="".concat(s,"	<p>").concat(e.description,"</p>\n"),a+="".concat(s,"</description>\n")),e.properties&&e.properties.length>0&&(a+="".concat(s,'<properties type="string">').concat(e.properties.join(", "),"</properties>\n")),e.location&&(a+="".concat(s,'<location type="string">').concat(e.location,"</location>\n")),a+="".concat(i,"</id-").concat(o,">\n"),a}generateContainerXML(e,t,r,i=0){const s={id:e.id.toString(),name:e.definition.name,type:e.definition.subType||e.definition.filterType,weight:e.definition.weight,count:e.quantity,isIdentified:!0,isLocked:!1};return this.generateItemXML(s,r,i)}}class en{constructor(e){this.xml="",this.itemCount=0,this.strategy=e}reset(){return this.xml="",this.itemCount=0,this}addInventoryHeader(){return this.xml+="	<inventorylist>\n",this}addInventoryFooter(){return this.xml+="	</inventorylist>",this}addItem(e){return this.itemCount++,this.xml+=this.strategy.generateItemXML(e,this.itemCount,0),this}build(){return{xml:this.xml,itemCount:this.itemCount}}}class Ds{constructor(e=new Bs){this.xmlStrategy=e,this.xmlBuilder=new en(e)}processInventory(e,t,r=this.getDefaultOptions()){h.isEnabled("inventory_processor_debug")&&console.log("📦 InventoryProcessor: Processing inventory",{characterId:t,itemCount:e.length,options:r});const i=this.buildNestedStructure(e,t,r),s=this.generateInventoryXML(i,r),o=this.calculateStatistics(i),a={nestedStructure:i,xmlResult:s,statistics:o};return h.isEnabled("inventory_processor_debug")&&console.log("📦 InventoryProcessor: Processing complete",{totalItems:o.totalItems,containerCount:o.containerCount,xmlLength:s.xml.length}),a}buildNestedStructure(e,t,r){const i=new Map,s=new Map;e.forEach(c=>{const u=c.containerEntityId.toString();!r.includeZeroQuantityItems&&c.quantity<=0||(c.definition.isContainer&&s.set(c.id.toString(),{...c,definition:{...c.definition,isContainer:!0},contents:[],currentWeight:0}),i.has(u)||i.set(u,[]),i.get(u).push(c))});const o=t.toString(),a=i.get(o)||[];s.forEach((c,u)=>{const d=i.get(u)||[];c.contents=d,c.currentWeight=this.calculateContainerWeight(d)});const l=this.calculateTotalInventoryWeight(a,s);return{characterId:t,rootItems:a,containers:s,totalItems:e.length,totalWeight:l}}generateInventoryXML(e,t){this.xmlBuilder.reset().addInventoryHeader();let r=0,i=0,s=0;const o=[];e.rootItems.forEach(c=>{if(c.quantity<=0&&!t.includeZeroQuantityItems){i++;return}const u=this.convertItemToXMLFormat(c,t);this.xmlBuilder.addItem(u),r++,c.definition.isContainer&&(s++,c.definition.weightMultiplier===0&&o.push(c.definition.name))}),e.containers.forEach((c,u)=>{c.contents.forEach(d=>{if(d.quantity<=0&&!t.includeZeroQuantityItems){i++;return}const f=this.convertItemToXMLFormat(d,t);f.location=c.definition.name,this.xmlBuilder.addItem(f),r++})});const{xml:a,itemCount:l}=this.xmlBuilder.addInventoryFooter().build();return{xml:a,itemCount:l,totalWeight:e.totalWeight,containerCount:s,debugInfo:{processedItems:r,skippedItems:i,containerItems:s,magicContainers:o}}}convertItemToXMLFormat(e,t){const r=t.sanitizeOutput?N.sanitizeForXML(e.customName||e.definition.name):e.customName||e.definition.name,i=t.sanitizeOutput?N.sanitizeForXML(e.definition.subType||e.definition.filterType):e.definition.subType||e.definition.filterType,s={id:e.id.toString(),name:r,type:i,weight:(e.customWeight||e.definition.weight)/(e.definition.bundleSize||1),count:e.quantity,isIdentified:t.markItemsAsIdentified,isLocked:!0};return t.includeCostInformation&&e.definition.cost&&(s.cost={value:e.definition.cost.quantity,denomination:e.definition.cost.unit}),t.generateDetailedXML&&e.definition.description&&(s.description=t.sanitizeOutput?N.sanitizeHTML(e.definition.description):e.definition.description),s}convertItemsToXMLFormat(e,t){return e.filter(r=>t.includeZeroQuantityItems||r.quantity>0).map(r=>this.convertItemToXMLFormat(r,t))}calculateContainerWeight(e){return e.reduce((t,r)=>{const i=new re(r.definition.weight||0),s=new ft(r.quantity);return t+s.multiply(i).pounds},0)}calculateTotalInventoryWeight(e,t){let r=0;return e.forEach(i=>{const s=new re(i.definition.weight||0),o=new ft(i.quantity);r+=o.multiply(s).pounds}),r}calculateStatistics(e){return{totalItems:e.totalItems,containerCount:e.containers.size,magicContainers:Array.from(e.containers.values()).filter(t=>t.definition.weightMultiplier===0).length,totalWeight:e.totalWeight}}getDefaultOptions(){return{includeZeroQuantityItems:!1,respectContainerHierarchy:!0,generateDetailedXML:!1,sanitizeOutput:!0,includeCostInformation:!0,markItemsAsIdentified:!0}}static validateInventoryData(e){const t=[];return e.forEach((r,i)=>{(!r.id||r.id<=0)&&t.push("Item at index ".concat(i," has invalid ID: ").concat(r.id)),r.definition||t.push("Item at index ".concat(i," missing definition")),r.definition.name||t.push("Item at index ".concat(i," missing name")),typeof r.quantity!="number"&&t.push("Item ".concat(r.definition.name," has invalid quantity: ").concat(r.quantity))}),{isValid:t.length===0,errors:t}}setXMLStrategy(e){this.xmlStrategy=e,this.xmlBuilder=new en(e)}}class tn{constructor(){this.ENCUMBRANCE_MULTIPLIERS={ENCUMBERED_THRESHOLD:5,HEAVILY_THRESHOLD:10,MAXIMUM_CAPACITY:15,PUSH_DRAG_LIFT:30}}calculateEncumbrance(e,t,r={includeContainerWeights:!0,respectMagicContainers:!0,applyRacialTraits:!0}){h.isEnabled("encumbrance_calculator_debug")&&console.log("🎒 EncumbranceCalculator: Calculating encumbrance",{characterId:e.id,inventoryItems:t.length,options:r});const i=this.calculateTotalWeight(t,e.id,r),s=this.calculateCarryingCapacity(e,r),o=this.determineEncumbranceLevel(i.totalWeight,s),{speedPenalty:a,disadvantageOnChecks:l}=this.calculatePenalties(o),c={totalWeight:i.totalWeight,carryingCapacity:{normal:s.maximum,push:s.maximum*2,lift:s.maximum*2,powerfulBuild:e.hasPowerfulBuild&&r.applyRacialTraits},encumbranceLevel:o,speedPenalty:a,disadvantageOnChecks:l};return h.isEnabled("encumbrance_calculator_debug")&&console.log("🎒 EncumbranceCalculator: Result",{totalWeight:c.totalWeight,encumbranceLevel:c.encumbranceLevel,carryingCapacity:c.carryingCapacity,penalties:{speedPenalty:a,disadvantageOnChecks:l}}),c}calculateTotalWeight(e,t,r){let i=0;const s=[],o=this.buildContainerMultiplierMap(e);return e.forEach(a=>{if(a.quantity<=0)return;const l=new ft(a.quantity),c=new re(a.definition.weight||0),u=a.containerEntityId.toString(),d=t.toString();let f=c.multiply(l.amount),m=!1,g;if(r.respectMagicContainers&&u!==d&&o.has(u)){const _=o.get(u);g=this.findContainerName(e,u),_===0?(f=new re(0),m=!0):f=f.multiply(_)}i+=f.pounds,s.push({itemId:a.id,itemName:a.definition.name,weight:c.pounds,quantity:l.amount,totalWeight:f.pounds,containerName:g,magicContainer:m})}),{totalWeight:i,debugInfo:s}}buildContainerMultiplierMap(e){const t=new Map;return e.forEach(r=>{r.definition.isContainer&&r.definition.weightMultiplier!==void 0&&t.set(r.id.toString(),r.definition.weightMultiplier)}),t}findContainerName(e,t){const r=e.find(i=>i.id.toString()===t);return(r==null?void 0:r.definition.name)||"Unknown Container"}calculateCarryingCapacity(e,t){let r=e.strengthScore;return e.hasPowerfulBuild&&t.applyRacialTraits&&(r=Math.min(r*2,29)),{normal:r*this.ENCUMBRANCE_MULTIPLIERS.ENCUMBERED_THRESHOLD,encumbered:r*this.ENCUMBRANCE_MULTIPLIERS.ENCUMBERED_THRESHOLD,heavilyEncumbered:r*this.ENCUMBRANCE_MULTIPLIERS.HEAVILY_THRESHOLD,maximum:r*this.ENCUMBRANCE_MULTIPLIERS.MAXIMUM_CAPACITY}}determineEncumbranceLevel(e,t){return e>t.maximum?"overloaded":e>t.heavilyEncumbered?"heavily_encumbered":e>t.encumbered?"encumbered":"unencumbered"}calculatePenalties(e){switch(e){case"heavily_encumbered":return{speedPenalty:20,disadvantageOnChecks:!0};case"encumbered":return{speedPenalty:10,disadvantageOnChecks:!1};case"overloaded":return{speedPenalty:0,disadvantageOnChecks:!0};default:return{speedPenalty:0,disadvantageOnChecks:!1}}}getEncumbranceDebugInfo(e,t,r={includeContainerWeights:!0,respectMagicContainers:!0,applyRacialTraits:!0}){const i=this.calculateTotalWeight(t,e.id,r),s=this.calculateCarryingCapacity(e,r);return{itemBreakdown:i.debugInfo,strengthCalculation:{baseStrength:e.strengthScore,modifiers:0,finalStrength:e.strengthScore,powerfulBuild:e.hasPowerfulBuild&&r.applyRacialTraits},carryingCapacityCalculation:s}}static hasPowerfulBuild(e){var r,i;return(i=(r=e.race)==null?void 0:r.fullName)!=null&&i.toLowerCase().includes("goliath")?!0:z.find(e,"name","Powerful Build").length>0}static validateInventoryData(e){const t=[];return e.forEach((r,i)=>{(!r.id||r.id<=0)&&t.push("Item at index ".concat(i," has invalid ID: ").concat(r.id)),r.quantity<0&&t.push("Item ".concat(r.definition.name," has negative quantity: ").concat(r.quantity)),r.definition.weight<0&&t.push("Item ".concat(r.definition.name," has negative weight: ").concat(r.definition.weight))}),{isValid:t.length===0,errors:t}}}const zs={barbarian:{Rage:"resource","Unarmored Defense":"passive","Reckless Attack":"active","Danger Sense":"passive","Primal Path":"passive","Extra Attack":"passive","Fast Movement":"passive","Feral Instinct":"passive","Brutal Critical":"passive","Relentless Rage":"passive","Persistent Rage":"passive","Indomitable Might":"passive","Primal Champion":"passive"},fighter:{"Fighting Style":"passive","Second Wind":"resource","Action Surge":"resource","Martial Archetype":"passive","Extra Attack":"passive",Indomitable:"resource","Superior Critical":"passive",Survivor:"passive"},ranger:{"Favored Enemy":"passive","Natural Explorer":"passive","Fighting Style":"passive",Spellcasting:"spell","Ranger Archetype":"passive","Primeval Awareness":"active","Extra Attack":"passive","Lands Stride":"passive","Hide in Plain Sight":"active",Vanish:"active","Feral Senses":"passive","Foe Slayer":"passive"},rogue:{Expertise:"passive","Sneak Attack":"passive","Thieves Cant":"passive","Cunning Action":"active","Roguish Archetype":"passive","Uncanny Dodge":"passive",Evasion:"passive","Reliable Talent":"passive",Blindsense:"passive","Slippery Mind":"passive",Elusive:"passive","Stroke of Luck":"resource"}},Xs={human:{"Extra Language":"proficiency","Extra Skill":"proficiency",Versatile:"passive"},elf:{Darkvision:"passive","Keen Senses":"proficiency","Fey Ancestry":"passive",Trance:"passive","Elf Weapon Training":"proficiency"},dwarf:{Darkvision:"passive","Dwarven Resilience":"passive","Dwarven Combat Training":"proficiency",Stonecunning:"proficiency"},halfling:{Lucky:"passive",Brave:"passive","Halfling Nimbleness":"passive"},dragonborn:{"Draconic Ancestry":"passive","Breath Weapon":"active","Damage Resistance":"passive"},gnome:{Darkvision:"passive","Gnome Cunning":"passive"},"half-elf":{Darkvision:"passive","Fey Ancestry":"passive","Skill Versatility":"proficiency"},"half-orc":{Darkvision:"passive","Relentless Endurance":"resource","Savage Attacks":"passive"},tiefling:{Darkvision:"passive","Hellish Resistance":"passive","Infernal Legacy":"spell"}};class nn{static validateClassFeature(e){const t=[];return(!e.name||e.name.trim().length===0)&&t.push("Feature name is required"),(!e.className||e.className.trim().length===0)&&t.push("Class name is required"),(typeof e.requiredLevel!="number"||e.requiredLevel<1||e.requiredLevel>20)&&t.push("Required level must be between 1 and 20"),e.type&&!["passive","active","resource","spell"].includes(e.type)&&t.push("Feature type must be passive, active, resource, or spell"),{isValid:t.length===0,errors:t}}static validateRacialTrait(e){const t=[];return(!e.name||e.name.trim().length===0)&&t.push("Trait name is required"),(!e.raceName||e.raceName.trim().length===0)&&t.push("Race name is required"),e.type&&!["passive","active","spell","proficiency"].includes(e.type)&&t.push("Trait type must be passive, active, spell, or proficiency"),{isValid:t.length===0,errors:t}}}const x=class x{constructor(){h.isEnabled("feature_processor_debug")&&(x.debugEnabled=!0)}static setDebugMode(e){this.debugEnabled=e}processCharacterFeatures(e,t=this.getDefaultOptions()){var l,c;(x.debugEnabled||h.isEnabled("feature_processor_debug"))&&console.log("🎭 FeatureProcessor: Processing character features",{classCount:((l=e.classes)==null?void 0:l.length)||0,raceName:(c=e.race)==null?void 0:c.fullName,options:t});const r=t.includeSubclassFeatures?this.processClassFeatures(e,t):[],i=t.includeRacialTraits?this.processRacialTraits(e,t):[],s=this.groupFeaturesByClass(r),o=this.groupTraitsByRace(i),a={classFeatures:r,racialTraits:i,totalFeatures:r.length+i.length,featuresByClass:s,traitsByRace:o,debugInfo:{processingMethod:e.classes.length>1?"multiclass":"single_class",classBreakdown:this.buildClassBreakdown(e,r),raceBreakdown:this.buildRaceBreakdown(e,i),warnings:[]}};return(x.debugEnabled||h.isEnabled("feature_processor_debug"))&&console.log("🎭 FeatureProcessor: Result",{totalFeatures:a.totalFeatures,classFeatureCount:r.length,racialTraitCount:i.length,processingMethod:a.debugInfo.processingMethod}),a}processClassFeatures(e,t){var s,o,a,l,c,u,d,f,m,g,_,p;const r=[],i=new Set;if(!e.classes||!Array.isArray(e.classes))return r;for(const y of e.classes){const v=((o=(s=y.definition)==null?void 0:s.name)==null?void 0:o.toLowerCase())||"unknown",C=y.level||1;if(x.debugEnabled&&console.log("🎭 Processing class: ".concat(v," (level ").concat(C,")"),{hasClassFeatures:!!((a=y.definition)!=null&&a.classFeatures),classFeatureCount:((c=(l=y.definition)==null?void 0:l.classFeatures)==null?void 0:c.length)||0,hasSubclass:!!y.subclassDefinition,hasSubclassFeatures:!!((u=y.subclassDefinition)!=null&&u.classFeatures),subclassFeatureCount:((f=(d=y.subclassDefinition)==null?void 0:d.classFeatures)==null?void 0:f.length)||0,hasCustomFeatures:!!y.classFeatures,customFeatureCount:((m=y.classFeatures)==null?void 0:m.length)||0,hasGrantedFeatures:!!y.grantedClassFeatures,grantedFeatureCount:((g=y.grantedClassFeatures)==null?void 0:g.length)||0}),(_=y.definition)!=null&&_.classFeatures){x.debugEnabled&&console.log("🔍 Processing ".concat(y.definition.classFeatures.length," class features for ").concat(v));const S=this.extractClassFeatures(y.definition.classFeatures,v,C,"class",t,void 0,i);r.push(...S)}if((p=y.subclassDefinition)!=null&&p.classFeatures){x.debugEnabled&&console.log("🔍 Processing ".concat(y.subclassDefinition.classFeatures.length," subclass features for ").concat(v));const S=y.subclassDefinition.name,b=this.extractClassFeatures(y.subclassDefinition.classFeatures,v,C,"subclass",t,S,i);r.push(...b)}if(y.classFeatures&&Array.isArray(y.classFeatures)){x.debugEnabled&&console.log("🔍 Processing additional classFeatures array (".concat(y.classFeatures.length," features)"));const S=this.extractClassFeatures(y.classFeatures,v,C,"class",t,void 0,i);r.push(...S)}if(y.grantedClassFeatures&&Array.isArray(y.grantedClassFeatures)){x.debugEnabled&&console.log("🔍 Processing grantedClassFeatures array (".concat(y.grantedClassFeatures.length," features)"));const S=this.extractClassFeatures(y.grantedClassFeatures,v,C,"class",t,void 0,i);r.push(...S)}}return r}processRacialTraits(e,t){var l,c,u;const r=[],i=new Set;if(!e.race)return x.debugEnabled&&console.log("No race data found in character"),r;const s=e.race.fullName||e.race.baseName||"Unknown Race";x.debugEnabled&&(console.log("🔍 Processing racial traits for: ".concat(s)),console.log("🔍 Full race data structure:",JSON.stringify(e.race,null,2)),console.log("🔍 Checking race.racialTraits:",!!e.race.racialTraits),console.log("🔍 Checking race.traits:",!!e.race.traits),console.log("🔍 Checking race.features:",!!e.race.features),console.log("🔍 Checking race.raceTraits:",!!e.race.raceTraits),console.log("🔍 Checking race.definition:",!!e.race.definition),e.race.definition&&(console.log("🔍 Checking race.definition.racialTraits:",!!e.race.definition.racialTraits),console.log("🔍 Checking race.definition.traits:",!!e.race.definition.traits)),console.log("🔍 Race object keys:",Object.keys(e.race)));let o=null,a="";if(e.race.racialTraits&&Array.isArray(e.race.racialTraits)?(o=e.race.racialTraits,a="race.racialTraits"):e.race.traits&&Array.isArray(e.race.traits)?(o=e.race.traits,a="race.traits"):e.race.features&&Array.isArray(e.race.features)?(o=e.race.features,a="race.features"):(l=e.race.definition)!=null&&l.racialTraits&&Array.isArray(e.race.definition.racialTraits)?(o=e.race.definition.racialTraits,a="race.definition.racialTraits"):(c=e.race.definition)!=null&&c.traits&&Array.isArray(e.race.definition.traits)&&(o=e.race.definition.traits,a="race.definition.traits"),o&&o.length>0){x.debugEnabled&&(console.log("🎯 Found ".concat(o.length," racial traits in ").concat(a)),console.log("🎯 Sample trait structure:",JSON.stringify(o[0],null,2)));const d=this.extractRacialTraits(o,s,"race",t,void 0,i);r.push(...d)}else x.debugEnabled&&console.log("❌ No racial traits array found in any expected location");if((u=e.race.subraceDefinition)!=null&&u.racialTraits&&Array.isArray(e.race.subraceDefinition.racialTraits)){const d=e.race.subraceDefinition.name;x.debugEnabled&&console.log("Found ".concat(e.race.subraceDefinition.racialTraits.length," subrace traits for: ").concat(d));const f=this.extractRacialTraits(e.race.subraceDefinition.racialTraits,s,"subrace",t,d,i);r.push(...f)}return x.debugEnabled&&(console.log("🏁 Final trait count: ".concat(r.length)),r.length>0&&console.log("🏁 Extracted traits:",r.map(d=>d.name))),r}generateFeaturesXML(e,t=this.getDefaultXMLOptions()){return e.classFeatures.length>0?this.generateClassFeaturesXML(e.classFeatures,t):""}generateTraitsXML(e,t=this.getDefaultXMLOptions()){return e.racialTraits.length>0?this.generateRacialTraitsXML(e.racialTraits,t):""}extractClassFeatures(e,t,r,i,s,o,a){const l=[];for(const c of e){const u="id:".concat(c.id);if(x.debugEnabled&&console.log("🔍 Processing feature: ".concat(c.name),{id:c.id,key:u,className:t,source:i,level:c.requiredLevel,hasSeenBefore:a==null?void 0:a.has(u)}),a&&a.has(u)){x.debugEnabled&&console.log("🔄 Skipping duplicate feature: ".concat(c.name," (").concat(u,")"));continue}if(this.shouldSkipFeature(c.name)){x.debugEnabled&&console.log("🚫 Skipping excluded feature: ".concat(c.name));continue}if(s.filterByLevel&&c.requiredLevel>r||c.requiredLevel>s.maxLevel)continue;a&&a.add(u);const d=this.determineFeatureType(c.name,t),f=this.determineFeatureUsage(c.name,t),m={id:c.id,name:c.name,description:s.includeDescriptions?c.description:"",requiredLevel:c.requiredLevel,className:t,subclassName:o,source:i,type:d,uses:f,mechanics:this.extractFeatureMechanics(c.name,c.description)},g=nn.validateClassFeature(m);g.isValid?l.push(m):console.warn("Invalid class feature: ".concat(m.name),g.errors)}return l}extractRacialTraits(e,t,r,i,s,o){const a=[];for(const l of e){x.debugEnabled&&console.log("🔍 Raw trait data:",JSON.stringify(l,null,2));let c,u,d;if(l.definition)c=l.id,u=l.definition.name,d=l.definition.description;else if(l.name)c=l.id||0,u=l.name,d=l.description||"";else{x.debugEnabled&&console.log("🚫 Skipping trait with unrecognized structure:",l);continue}const f=c?"id:".concat(c):"name:".concat(u);if(x.debugEnabled&&console.log("🔍 Processing trait: ".concat(u),{id:c,key:f,raceName:t,source:r,hasSeenBefore:o==null?void 0:o.has(f)}),o&&o.has(f)){x.debugEnabled&&console.log("🔄 Skipping duplicate trait: ".concat(u," (").concat(f,")"));continue}if(this.shouldSkipTrait(u)){x.debugEnabled&&console.log("🚫 Skipping excluded trait: ".concat(u));continue}o&&o.add(f);const m=this.determineTraitType(u,t),g=this.extractTraitMechanics(u,d),_={id:c,name:u,description:i.includeDescriptions?d:"",raceName:t,suraceName:s,source:r,type:m,mechanics:g},p=nn.validateRacialTrait(_);p.isValid?(a.push(_),x.debugEnabled&&console.log("✅ Added trait: ".concat(u))):console.warn("Invalid racial trait: ".concat(_.name),p.errors)}return a}determineFeatureType(e,t){(!t||typeof t!="string")&&(t="unknown");const r=zs[t.toLowerCase()];return r&&r[e]?r[e]:!e||typeof e!="string"?"passive":e.toLowerCase().includes("spellcasting")?"spell":e.toLowerCase().includes("rage")||e.toLowerCase().includes("action surge")?"resource":e.toLowerCase().includes("attack")||e.toLowerCase().includes("maneuver")?"active":"passive"}determineTraitType(e,t){(!t||typeof t!="string")&&(t="unknown");const r=Xs[t.toLowerCase()];return r&&r[e]?r[e]:!e||typeof e!="string"?"passive":e.toLowerCase().includes("proficiency")||e.toLowerCase().includes("training")?"proficiency":e.toLowerCase().includes("spell")||e.toLowerCase().includes("cantrip")?"spell":e.toLowerCase().includes("breath")||e.toLowerCase().includes("endurance")?"active":"passive"}determineFeatureUsage(e,t){if(!e||typeof e!="string")return;(!t||typeof t!="string")&&(t="unknown");const r=e.toLowerCase();if(r.includes("rage")&&t.toLowerCase()==="barbarian")return{type:"long_rest",amount:1,rechargeOn:"long_rest"};if(r.includes("action surge")&&t.toLowerCase()==="fighter")return{type:"short_rest",amount:1,rechargeOn:"short_rest"};if(r.includes("second wind")&&t.toLowerCase()==="fighter")return{type:"short_rest",amount:1,rechargeOn:"short_rest"}}extractFeatureMechanics(e,t){}extractTraitMechanics(e,t){const r={};if(e.toLowerCase().includes("darkvision")){const i=t.match(/(\d+)\s*feet/i);i&&(r.darkvisionRange=parseInt(i[1]))}return(e.toLowerCase().includes("fleet")||e.toLowerCase().includes("swift"))&&(r.speed=35),Object.keys(r).length>0?r:void 0}generateClassFeaturesXML(e,t){let r="";return e.forEach((i,s)=>{const o=String(s+1).padStart(5,"0"),a=t.sanitizeText?N.sanitizeForXML(i.name):i.name,l=t.sanitizeText&&i.description?N.sanitizeForXML(i.description):i.description||"";r+="      <id-".concat(o,'>\n        <locked type="number">1</locked>\n        <name type="string">').concat(a,'</name>\n        <text type="formattedtext">\n          <p>').concat(l,'</p>\n        </text>\n        <source type="string">').concat(i.className).concat(i.subclassName?" (".concat(i.subclassName,")"):"","</source>\n      </id-").concat(o,">\n")}),r}generateRacialTraitsXML(e,t){let r="";return e.forEach((i,s)=>{const o=String(s+1e3).padStart(5,"0"),a=t.sanitizeText?N.sanitizeForXML(i.name):i.name,l=t.sanitizeText&&i.description?N.sanitizeForXML(i.description):i.description||"";r+="      <id-".concat(o,'>\n        <locked type="number">1</locked>\n        <name type="string">').concat(a,'</name>\n        <text type="formattedtext">\n          <p>').concat(l,'</p>\n        </text>\n        <source type="string">').concat(i.raceName).concat(i.suraceName?" (".concat(i.suraceName,")"):"","</source>\n      </id-").concat(o,">\n")}),r}groupFeaturesByClass(e){return e.reduce((t,r)=>{const i=r.subclassName?"".concat(r.className," (").concat(r.subclassName.toLowerCase(),")"):r.className;return t[i]||(t[i]=[]),t[i].push(r),t},{})}groupTraitsByRace(e){return e.reduce((t,r)=>{const i=r.suraceName?"".concat(r.raceName.toLowerCase()," (").concat(r.suraceName.toLowerCase(),")"):r.raceName.toLowerCase();return t[i]||(t[i]=[]),t[i].push(r),t},{})}buildClassBreakdown(e,t){return e.classes.map(r=>{var i,s;return{className:((i=r.definition)==null?void 0:i.name)||"Unknown",level:r.level||1,featureCount:t.filter(o=>{var a,l;return o.className===((l=(a=r.definition)==null?void 0:a.name)==null?void 0:l.toLowerCase())}).length,subclass:(s=r.subclassDefinition)==null?void 0:s.name}})}buildRaceBreakdown(e,t){var r,i,s;return{raceName:((r=e.race)==null?void 0:r.fullName)||"Unknown Race",subraceName:(s=(i=e.race)==null?void 0:i.subraceDefinition)==null?void 0:s.name,traitCount:t.length}}getDefaultOptions(){return{includeSubclassFeatures:!0,includeRacialTraits:!0,includeDescriptions:!0,filterByLevel:!0,maxLevel:20}}getDefaultXMLOptions(){return{includeDescriptions:!0,includeUsageLimits:!0,groupBySource:!0,sanitizeText:!0}}shouldSkipFeature(e){if(!e||typeof e!="string")return!1;const t=["Proficiencies","Ability Score Increase","Core Sorcerer Traits","Metamagic Options"],r=e.toLowerCase();return t.some(i=>r.includes(i.toLowerCase()))}shouldSkipTrait(e){if(!e||typeof e!="string")return!1;const t=["Proficiencies","Ability Score Increase","Languages","Age","Size","Speed","Core Sorcerer Traits","Metamagic Options"],r=e.toLowerCase();return t.some(i=>r.includes(i.toLowerCase()))}static validateCharacterData(e){const t=[];return e?((!e.classes||!Array.isArray(e.classes))&&t.push("Character classes must be an array"),e.race||t.push("Character race is required"),{isValid:t.length===0,errors:t}):(t.push("Character data is required"),{isValid:!1,errors:t})}};x.debugEnabled=!1;let q=x;class js{constructor(){this.characterFetcher=new mr,this.inventoryProcessor=new Ds,this.encumbranceCalculator=new tn,this.spellSlotCalculator=new j,this.featureProcessor=new q,this.initializeGameConfig()}async initializeGameConfig(){if(!F.isLoaded())try{await F.loadConfigs()}catch(e){console.warn("Failed to load game configuration, using fallback values:",e)}}async convertFromDNDBeyond(e){var r,i,s,o,a,l,c,u,d,f;const t=performance.now();try{this.reportProgress("Validating character ID",10);const m=await this.fetchCharacterData(e);if(!m.success)return{success:!1,error:m.error};const g=m.data,_=performance.now()-t;if(h.isEnabled("debug_character_data")){if(console.group("🔍 Character Data Debug Info"),console.log("📋 Basic Info:",{id:g.id,name:g.name,level:this.calculateTotalLevel(g),race:((r=g.race)==null?void 0:r.fullName)||"Unknown",classes:((i=g.classes)==null?void 0:i.map(S=>{var b;return"".concat((b=S.definition)==null?void 0:b.name," ").concat(S.level)}).join(", "))||"None"}),console.log("📊 Stats & Bonuses:",{stats:g.stats,bonusStats:g.bonusStats,overrideStats:g.overrideStats}),console.log("🎒 Equipment & Inventory:",{inventoryCount:((s=g.inventory)==null?void 0:s.length)||0,inventory:(o=g.inventory)==null?void 0:o.slice(0,5),hasMore:(((a=g.inventory)==null?void 0:a.length)||0)>5}),console.log("✨ Spells & Features:",{spellsKnown:((l=g.spells)==null?void 0:l.length)||0,classFeatures:((c=g.classes)==null?void 0:c.reduce((S,b)=>{var w;return S+(((w=b.classFeatures)==null?void 0:w.length)||0)},0))||0,raceFeatures:((d=(u=g.race)==null?void 0:u.racialTraits)==null?void 0:d.length)||0}),console.log("🔧 Modifiers & Bonuses:",{modifiers:g.modifiers?Object.keys(g.modifiers):[],bonuses:g.bonuses?Object.keys(g.bonuses):[]}),console.log("📄 Full Character Object:",g),h.isEnabled("object_search_service")){console.log("🔍 ObjectSearch Service Demo:");const S=z.findByType(g,"proficiency");console.log("Found ".concat(S.length," proficiency modifiers:"),S);const b=z.findByType(g,"feature");console.log("Found ".concat(b.length," class features:"),b.slice(0,3));const w=z.findByEntityType(g,"1446578651");console.log("Found ".concat(w.length," classes via entityTypeId:"),w);const $=z.getAllKeys(g,5);console.log("Available keys (depth 5): ".concat($.length," total"),$.slice(0,20))}if(h.isEnabled("string_sanitizer_service")&&(console.log("🧹 StringSanitizer Service Demo:"),[g.name||"Unknown Character",'<script>alert("XSS")<\/script>Test Name','Character "The Bold" & Strong',"javascript:alert(1)","Text with\nnewlines	and control\0chars"].forEach((b,w)=>{const $=this.sanitizeString(b),O=N.sanitizeWithReport(b);console.log("Test ".concat(w+1,":"),{original:b,sanitized:$,wasModified:O.wasModified,removedPatterns:O.removedPatterns})})),h.isEnabled("safe_access_service")){console.log("🛡️ SafeAccess Service Demo:"),["name","race.fullName","race.definition.name","classes.0.definition.name","classes.0.level","stats.0.value","nonexistent.path","race.racialTraits.0.definition.name","preferences.privacy.showStats"].forEach($=>{const O=this.safeAccess(g,$),G=se.getWithResult(g,$);console.log("Path: ".concat($),{value:O,found:G.found,type:typeof O,depth:G.depth})});const b=se.getMultiple(g,["name","race.fullName","classes.0.level"]);console.log("Multiple path access:",b);const w=se.getAllPaths(g,3);console.log("Available paths (depth 3): ".concat(w.length," total"),w.slice(0,15))}if(h.isEnabled("ability_constants")){console.log("💪 AbilityConstants Demo:");const S=this.getAbilityScores(g);console.log("Character Ability Scores:",S);const b={};if(T.forEach(w=>{const $=S[w]||10;b[w]=k.calculateModifier($)}),console.log("Ability Modifiers:",b),console.log("Ability Mappings:",{strengthId:k.getAbilityIdByName("strength"),dexterityAbbr:k.getAbbreviation("dexterity"),constitutionById:(f=k.getAbilityById(3))==null?void 0:f.name,validScores:{normal:k.isValidScore(18,!1),withMagic:k.isValidScore(22,!0)}}),S.strength){const w=k.calculateCarryingCapacity(S.strength);console.log("Carrying Capacity (STR ".concat(S.strength,"):"),w)}}if(h.isEnabled("ability_score_processor")){console.log("⚡ AbilityScoreProcessor Service Demo:"),h.isEnabled("debug_ability_score_processor")&&(P.setDebugMode(!0),console.log("🔍 Debug mode enabled for ability score processing"));const S=this.processAbilityBonuses(g);console.log("Processed Ability Scores:",S.totalScores),P.setDebugMode(!1),S.debugInfo.appliedBonuses.length>0&&(console.log("Applied Bonuses:",S.debugInfo.appliedBonuses),console.log("Final Bonus Summary:",S.debugInfo.finalBonusSummary));const b=P.processLegacyFormat(g);console.log("Legacy Format Output:",b.slice(0,3)),console.log("Individual Score Calculations:"),T.forEach(($,O)=>{const G=O+1,Ee=P.getTotalAbilityScore(g,G);console.log("  ".concat($," (ID ").concat(G,"): ").concat(Ee," (modifier: ").concat(k.calculateModifier(Ee),")"))});const w=P.validateCharacterData(g);console.log("Character Data Validation:",{isValid:w.isValid,issueCount:w.issues.length,warningCount:w.warnings.length}),w.warnings.length>0&&console.warn("Character Data Warnings:",w.warnings),w.issues.length>0&&console.error("Character Data Issues:",w.issues)}if(h.isEnabled("spell_slot_calculator")){console.log("🪄 SpellSlotCalculator Service Demo:"),h.isEnabled("debug_spell_slot_calculator")&&(j.setDebugMode(!0),console.log("🔍 Debug mode enabled for spell slot calculation"));const S=this.extractClassInfo(g);console.log("Extracted Classes:",S);const b=this.calculateSpellSlots(S);console.log("Calculated Spell Slots:",b.spellSlots),j.setDebugMode(!1),console.log("Caster Level Breakdown:",b.debugInfo.casterLevelCalculation),console.log("Class Breakdown:",b.debugInfo.classBreakdown),console.log("Calculation Method: ".concat(b.debugInfo.calculationMethod));const w=j.toLegacyFormat(b.spellSlots);console.log("Legacy Format Spell Slots:",w.filter(O=>O.slots>0));const $=j.validateClassInfo(S);console.log("Class Data Validation:",{isValid:$.isValid,errorCount:$.errors.length}),$.errors.length>0&&console.error("Class Data Errors:",$.errors)}console.groupEnd()}if(this.reportProgress("Parsing character data",50),h.isEnabled("debug_character_data")){const S=g.traits||{};console.log("🎭 Personality Traits:",{personalityTraits:S.personalityTraits?"".concat(S.personalityTraits.substring(0,50),"..."):"None",ideals:S.ideals?"".concat(S.ideals.substring(0,50),"..."):"None",bonds:S.bonds?"".concat(S.bonds.substring(0,50),"..."):"None",flaws:S.flaws?"".concat(S.flaws.substring(0,50),"..."):"None"})}const p=performance.now(),y=await this.parseCharacterToXML(g),v=performance.now()-p;this.reportProgress("Generating XML",90);const C=performance.now()-t;return this.reportProgress("Conversion complete",100),{success:!0,xml:y,characterData:g,performance:{fetchTime:_,parseTime:v,totalTime:C}}}catch(m){return console.error("Conversion error:",m),{success:!1,error:m instanceof Error?m.message:"Unknown conversion error"}}}async fetchCharacterData(e){return h.isEnabled("character_fetcher")?(console.log("Using new CharacterFetcher service"),this.reportProgress("Fetching from D&D Beyond (new)",25),await this.characterFetcher.fetchCharacter(e)):(console.log("Using legacy character fetching"),this.reportProgress("Fetching from D&D Beyond (legacy)",25),await this.fetchCharacterLegacy(e))}async fetchCharacterLegacy(e){try{const t=this.characterFetcher.validateCharacterID(e);if(!t.valid)return{success:!1,error:t.error};const r=t.sanitized,o="".concat("https://uakari-indigo.fly.dev/").concat("https://character-service.dndbeyond.com/character/v5/character/").concat(r),a=await fetch(o,{method:"GET",headers:{Accept:"application/json","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Origin:"https://www.dndbeyond.com","X-Requested-With":"XMLHttpRequest"}});if(!a.ok){let u;switch(a.status){case 401:case 403:u="Character not found or not public. Ensure character visibility is set to Public.";break;case 404:u="Character not found. Please check the character ID.";break;default:u="Unable to fetch character data (Error ".concat(a.status,"). Please try again.")}return{success:!1,error:u,statusCode:a.status}}const l=await a.json();let c;if(l.success&&l.data)c=l.data;else if(l.id&&l.name)c=l;else return{success:!1,error:"Invalid response format from D&D Beyond API"};return!c||typeof c.id!="number"||!c.name?{success:!1,error:"Invalid character data received from D&D Beyond"}:{success:!0,data:c}}catch(t){console.error("Legacy fetch error:",t);let r="Network error occurred while fetching character data";return t instanceof Error&&(t.message.includes("Failed to fetch")||t.message.includes("NetworkError")?r="Network error. Please check your internet connection and try again.":r=t.message),{success:!1,error:r}}}async parseCharacterToXML(e){var a,l,c,u,d,f,m,g,_,p,y;console.log("parseCharacterToXML called with:",{characterId:e.id,characterName:e.name,dataKeys:Object.keys(e)});const t=this.sanitizeString(e.name||"Unknown Character"),r=e.id||0,i=this.calculateTotalLevel(e),s=F.calculateProficiencyBonus(i),o='<?xml version="1.0" encoding="UTF-8"?>\n<root version="4.7" dataversion="20241002" release="8.1|CoreRPG:7">\n  <character>\n    <name type="string">'.concat(t,'</name>\n    <gender type="string">').concat(this.sanitizeString(e.gender||""),'</gender>\n    <deity type="string">').concat(this.sanitizeString(e.faith||""),'</deity>\n    <age type="string">').concat(this.sanitizeString(e.age||""),'</age>\n    <appearance type="string">').concat(this.sanitizeString(e.hair?"Hair: ".concat(e.hair,", Eyes: ").concat(e.eyes||"",", Skin: ").concat(e.skin||""):""),'</appearance>\n    <height type="string">').concat(this.sanitizeString(e.height||""),'</height>\n    <weight type="string">').concat(this.sanitizeString(e.weight?e.weight.toString():""),'</weight>\n    <size type="string">').concat(F.getDefaultSize(),'</size>\n    <alignment type="string">').concat(this.sanitizeString(F.getAlignmentName(e.alignmentId)),'</alignment>\n    <bonds type="string">').concat(this.sanitizeString(((a=e.traits)==null?void 0:a.bonds)||""),'</bonds>\n    <flaws type="string">').concat(this.sanitizeString(((l=e.traits)==null?void 0:l.flaws)||""),'</flaws>\n    <ideals type="string">').concat(this.sanitizeString(((c=e.traits)==null?void 0:c.ideals)||""),'</ideals>\n    <personalitytraits type="string">').concat(this.sanitizeString(((u=e.traits)==null?void 0:u.personalityTraits)||""),'</personalitytraits>\n    <race type="string">').concat(this.sanitizeString(((d=e.race)==null?void 0:d.fullName)||"Unknown"),'</race>\n    <racelink type="windowreference">\n      <class>reference_race</class>\n      <recordname>reference.race.').concat(this.sanitizeString((((f=e.race)==null?void 0:f.fullName)||"unknown").toLowerCase().replace(/\s+/g,"")),'@*</recordname>\n    </racelink>\n    <background type="string">').concat(this.sanitizeString(((g=(m=e.background)==null?void 0:m.definition)==null?void 0:g.name)||""),'</background>\n    <backgroundlink type="windowreference">\n      <class>reference_background</class>\n      <recordname>reference.background.').concat(this.sanitizeString((((p=(_=e.background)==null?void 0:_.definition)==null?void 0:p.name)||"unknown").toLowerCase().replace(/\s+/g,"")),'@*</recordname>\n    </backgroundlink>\n    <level type="number">').concat(i,'</level>\n    <profbonus type="number">').concat(s,'</profbonus>\n    <notes type="string">').concat(this.generateNotesText(e,r),'</notes>\n    <perception type="number">0</perception>\n    <perceptionmodifier type="number">0</perceptionmodifier>\n    <exp type="number">').concat(e.currentXp||0,'</exp>\n    <expneeded type="number">0</expneeded>\n    \n    <!-- Abilities with proper template structure -->\n    <abilities>\n      ').concat(this.generateAbilitiesXML(e),"\n    </abilities>\n    \n    <!-- Classes with template structure -->\n    <classes>\n      ").concat(((y=e.classes)==null?void 0:y.map((v,C)=>{var S,b,w;return"<id-".concat(String(C+1).padStart(5,"0"),'>\n        <casterpactmagic type="number">0</casterpactmagic>\n        <hddie type="dice">').concat((S=v.definition)!=null&&S.hitDie?"d".concat(v.definition.hitDie):F.getDefaultHitDie(),'</hddie>\n        <hdused type="number">0</hdused>\n        <level type="number">').concat(v.level||1,'</level>\n        <name type="string">').concat(this.sanitizeString(((b=v.definition)==null?void 0:b.name)||"Unknown"),'</name>\n        <shortcut type="windowreference">\n          <class>reference_class</class>\n          <recordname>reference.class.').concat(this.sanitizeString((((w=v.definition)==null?void 0:w.name)||"unknown").toLowerCase()),"@*</recordname>\n        </shortcut>\n      </id-").concat(String(C+1).padStart(5,"0"),">")}).join("\n      "))||"","\n    </classes>\n    \n    <!-- Currency -->\n    <coins>\n      ").concat(this.generateCoinsXML(e),'\n    </coins>\n    \n    <!-- Defenses -->\n    <defenses>\n      <ac>\n        <armor type="number">0</armor>\n        <misc type="number">0</misc>\n        <prof type="number">0</prof>\n        <shield type="number">0</shield>\n        <stat2 type="string">dexterity</stat2>\n        <temporary type="number">0</temporary>\n        <total type="number">').concat(F.getBaseArmorClass(),"</total>\n      </ac>\n    </defenses>\n    \n    ").concat(this.generateEncumbranceXML(e),"\n    \n    <!-- Placeholder sections for Phase 2 -->\n    <featlist>\n      ").concat(this.generateFeatsXML(e),"\n    </featlist>\n    \n    <featurelist>\n      ").concat(this.generateFeaturesXML(e),"\n    </featurelist>\n    \n    ").concat(this.generateInventoryXML(e),"\n    \n    <languagelist>\n      ").concat(this.generateLanguagesXML(e),"\n    </languagelist>\n    \n    <powergrouplist>\n      ").concat(this.generatePowerGroupXML(e),"\n    </powergrouplist>\n    \n    <skilllist>\n      ").concat(this.generateSkillsXML(e),"\n    </skilllist>\n    \n    <proficiencylist>\n      ").concat(this.generateProficienciesXML(e),"\n    </proficiencylist>\n    \n    <traitlist>\n      ").concat(this.generateTraitsXML(e),"\n    </traitlist>\n    \n    <weaponlist>\n      ").concat(this.generateWeaponsXML(e),"\n    </weaponlist>\n    \n    <powers>\n      ").concat(this.generateSpellsXML(e),"\n    </powers>\n    \n    ").concat(this.generatePowerMetaXML(e),"\n  </character>\n</root>");return console.log("Generated mock XML for character:",t),o}reportProgress(e,t,r){this.onProgress&&this.onProgress(e,t),console.log("Progress: ".concat(e," (").concat(t,"%)").concat(r?" - ".concat(r):""))}async checkServiceAvailability(){const e=h.isEnabled("character_fetcher");return{proxyService:await this.characterFetcher.checkServiceHealth(),legacyParser:typeof window<"u"&&!!window.parseCharacter,usingNewFetcher:e}}calculateTotalLevel(e){return!e.classes||!Array.isArray(e.classes)?1:e.classes.reduce((t,r)=>t+(r.level||0),0)||1}generatePowerGroupXML(e){if(!h.isEnabled("spell_slot_calculator"))return"<!-- Spell slots disabled by feature flag -->";try{const t=this.extractClassInfo(e),r=this.calculateSpellSlots(t);if(!r||!r.spellSlots)return"<!-- No spell slots calculated -->";const i=r.spellSlots,s=t.some(l=>l.classDefinition.name.toLowerCase()==="warlock"),o=Object.values(r.spellSlots).some(l=>l>0),a=Object.values(r.pactMagicSlots).some(l=>l>0);return!o&&!a?"<!-- Character has no spell slots -->":s&&a?this.generatePactMagicPowerGroupXML(e,t):this.generateRegularSpellPowerGroupXML(r.spellSlots,r.debugInfo)}catch(t){return console.error("Error generating spell slots XML:",t),"<!-- Error generating spell slots -->"}}generateRegularSpellPowerGroupXML(e,t){const r=[{key:"level1",name:"1st Level"},{key:"level2",name:"2nd Level"},{key:"level3",name:"3rd Level"},{key:"level4",name:"4th Level"},{key:"level5",name:"5th Level"},{key:"level6",name:"6th Level"},{key:"level7",name:"7th Level"},{key:"level8",name:"8th Level"},{key:"level9",name:"9th Level"}];let i="",s=1;return r.forEach(o=>{const a=e[o.key]||0;a>0&&(i+="      <id-".concat(String(s).padStart(5,"0"),'>\n        <castertype type="string">memorized</castertype>\n        <name type="string">').concat(this.sanitizeString(o.name+" Spells"),'</name>\n        <stat type="string">charisma</stat>\n        <powers>\n          <!-- Spell slots: ').concat(a," -->\n        </powers>\n      </id-").concat(String(s).padStart(5,"0"),">\n"),s++)}),i||"<!-- No spell slots available -->"}generatePactMagicPowerGroupXML(e,t){const r=t.find(s=>s.name==="warlock");return r?(this.getWarlockPactMagicSlots(r.level),'      <id-00001>\n        <castertype type="string">pact</castertype>\n        <name type="string">Pact Magic</name>\n        <stat type="string">charisma</stat>\n        <powers>\n          <!-- Warlock spells -->\n        </powers>\n      </id-00001>\n'):"<!-- No warlock class found -->"}getWarlockPactMagicSlots(e){return e>=17?{level5:4}:e>=15?{level5:3}:e>=11?{level5:2}:e>=9?{level5:2}:e>=7?{level4:2}:e>=5?{level3:2}:e>=3?{level2:2}:e>=2?{level1:2}:e>=1?{level1:1}:{}}generatePowerMetaXML(e){if(!h.isEnabled("spell_slot_calculator"))return"<!-- Spell slot meta disabled by feature flag -->";try{const t=this.extractClassInfo(e),r=this.calculateSpellSlots(t);if(!r||!r.spellSlots)return"<!-- No spell slot meta calculated -->";const i=this.spellSlotCalculator.generateSpellSlotsXML(r);return"    ".concat(i.combinedXML)}catch(t){return console.error("Failed to generate spell slot meta XML:",t),"<!-- Spell slot meta generation failed -->"}}generateSpellSlotsXML(e){if(!h.isEnabled("spell_slot_calculator"))return"<!-- Spell slots disabled by feature flag -->";try{const t=this.extractClassInfo(e),r=this.calculateSpellSlots(t);if(!r||!r.spellSlots)return"<!-- No spell slots calculated -->";const i=this.spellSlotCalculator.generateSpellSlotsXML(r),s=Object.values(r.spellSlots).some(a=>a>0),o=Object.values(r.pactMagicSlots).some(a=>a>0);return!s&&!o?"<!-- Character has no spell slots -->":i.spellSlotsXML||i.pactMagicXML}catch(t){return console.error("Failed to generate spell slots XML:",t),"<!-- Spell slots generation failed -->"}}generateAbilitiesXML(e){const t=F.getAbilities(),r=this.getAbilityScores(e);return t.map(i=>{const s=r[i.name]||F.getDefaultAbilityScore(),o=F.calculateAbilityModifier(s);return"<".concat(i.name,'>\n        <bonus type="number">').concat(o,'</bonus>\n        <save type="number">').concat(o,'</save>\n        <savemodifier type="number">0</savemodifier>\n        <saveprof type="number">0</saveprof>\n        <score type="number">').concat(s,"</score>\n      </").concat(i.name,">")}).join("\n      ")}sanitizeString(e){return h.isEnabled("string_sanitizer_service"),N.sanitizeForXML(e)}safeAccess(e,t,r=null){return h.isEnabled("safe_access_service"),se.get(e,t,r)}processAbilityBonuses(e){return h.isEnabled("ability_score_processor"),P.processAbilityScoreBonuses(e)}getAbilityScores(e){if(h.isEnabled("ability_score_processor")){const t=P.processAbilityScoreBonuses(e),r={};return T.forEach(i=>{var s;r[i]=((s=t.totalScores[i])==null?void 0:s.total)||10}),r}else{if(h.isEnabled("ability_constants"))return k.convertLegacyAbilities(e.stats||[],e.bonusStats,e.overrideStats);{const t={};return["strength","dexterity","constitution","intelligence","wisdom","charisma"].forEach((i,s)=>{var c,u,d,f,m,g;const o=((u=(c=e.stats)==null?void 0:c[s])==null?void 0:u.value)||10,a=((f=(d=e.bonusStats)==null?void 0:d[s])==null?void 0:f.value)||0,l=(g=(m=e.overrideStats)==null?void 0:m[s])==null?void 0:g.value;t[i]=l!=null?l:o+a}),t}}}enableAbilityScoreDebug(e=!0){P.setDebugMode(e),console.log("🔍 Ability Score Processor debug mode ".concat(e?"enabled":"disabled"))}enableSpellSlotDebug(e=!0){j.setDebugMode(e),console.log("🪄 Spell Slot Calculator debug mode ".concat(e?"enabled":"disabled"))}extractClassInfo(e){return!e.classes||!Array.isArray(e.classes)?[]:e.classes.map((t,r)=>{var a,l,c,u,d,f,m;const i=((a=t.definition)==null?void 0:a.name)||"unknown",s=t.level||1,o=(l=t.subclassDefinition)==null?void 0:l.name;return{id:((c=t.definition)==null?void 0:c.id)||r+1,level:s,classDefinition:{id:((u=t.definition)==null?void 0:u.id)||r+1,name:i,canCastSpells:((d=t.definition)==null?void 0:d.canCastSpells)||!1,spellCastingAbilityId:(f=t.definition)==null?void 0:f.spellCastingAbilityId},subclassDefinition:o?{id:((m=t.subclassDefinition)==null?void 0:m.id)||0,name:o}:void 0}})}calculateSpellSlots(e){return h.isEnabled("spell_slot_calculator")?this.spellSlotCalculator.calculateSpellSlots(e):this.spellSlotCalculator.calculateSpellSlots(e)}generateEncumbranceXML(e){try{const t=this.calculateEncumbrance(e);return t?(console.log("⚖️ Generated encumbrance XML: ".concat(t.totalWeight," lbs, ").concat(t.encumbranceLevel)),'<!-- Encumbrance -->\n    <encumbrance>\n      <encumbered type="number">'.concat(t.carryingCapacity.normal,'</encumbered>\n      <encumberedheavy type="number">').concat(t.carryingCapacity.normal*2,'</encumberedheavy>\n      <liftpushdrag type="number">').concat(t.carryingCapacity.push,'</liftpushdrag>\n      <load type="number">').concat(Math.round(t.totalWeight),'</load>\n      <max type="number">').concat(t.carryingCapacity.normal,"</max>\n    </encumbrance>")):(console.warn("No encumbrance data calculated"),'<!-- Encumbrance -->\n    <encumbrance>\n      <encumbered type="number">0</encumbered>\n      <encumberedheavy type="number">0</encumberedheavy>\n      <liftpushdrag type="number">0</liftpushdrag>\n      <load type="number">0</load>\n      <max type="number">0</max>\n    </encumbrance>')}catch(t){return console.error("Failed to generate encumbrance XML:",t),'<!-- Encumbrance generation failed -->\n    <encumbrance>\n      <encumbered type="number">0</encumbered>\n      <encumberedheavy type="number">0</encumberedheavy>\n      <liftpushdrag type="number">0</liftpushdrag>\n      <load type="number">0</load>\n      <max type="number">0</max>\n    </encumbrance>'}}generateInventoryXML(e){try{const t=this.processInventory(e);return t.xmlResult&&t.xmlResult.xml?(console.log("📦 Generated inventory XML: ".concat(t.statistics.totalItems," items")),t.xmlResult.xml):(console.warn("No inventory XML generated"),"<inventorylist>\n			<!-- No inventory items -->\n		</inventorylist>")}catch(t){return console.error("Failed to generate inventory XML:",t),"<inventorylist>\n			<!-- Inventory generation failed -->\n		</inventorylist>"}}generateFeaturesXML(e){if(h.isEnabled("feature_processor"))try{console.log("🎭 Using modern FeatureProcessor service for class features"),h.isEnabled("feature_processor_debug")&&q.setDebugMode(!0);const t=this.featureProcessor.processCharacterFeatures(e),r=this.featureProcessor.generateFeaturesXML(t);if(q.setDebugMode(!1),h.isEnabled("feature_processor_debug")){console.log("Class Features Breakdown:",t.debugInfo.classBreakdown),console.log("Processing Method: ".concat(t.debugInfo.processingMethod)),console.log("Features by Class:",t.featuresByClass),console.log("Traits by Race:",t.traitsByRace);const i=q.validateCharacterData(e);console.log("Feature Data Validation:",{isValid:i.isValid,errorCount:i.errors.length}),i.errors.length>0&&console.error("Feature Data Errors:",i.errors)}return console.log("🎭 Generated features XML: ".concat(t.totalFeatures," total features")),r}catch(t){return console.error("Failed to generate features XML:",t),"<!-- Feature processing failed -->"}else return console.log("🎭 Using legacy feature processing (placeholder)"),"<!-- Legacy feature processing not yet implemented -->"}generateTraitsXML(e){if(h.isEnabled("feature_processor"))try{console.log("🎭 Using modern FeatureProcessor service for racial traits"),h.isEnabled("feature_processor_debug")&&q.setDebugMode(!0);const t=this.featureProcessor.processCharacterFeatures(e),r=this.featureProcessor.generateTraitsXML(t);return q.setDebugMode(!1),h.isEnabled("feature_processor_debug")&&(console.log("Racial Traits Breakdown:",t.debugInfo.raceBreakdown),console.log("Processing Method: ".concat(t.debugInfo.processingMethod)),console.log("Traits by Race:",t.traitsByRace)),console.log("🎭 Generated traits XML: ".concat(t.debugInfo.raceBreakdown.traitCount," total traits")),r}catch(t){return console.error("Failed to generate traits XML:",t),"<!-- Trait processing failed -->"}else return console.log("🎭 Using legacy trait processing (placeholder)"),"<!-- Legacy trait processing not yet implemented -->"}generateWeaponsXML(e){var t,r,i,s,o,a;try{if(console.log("⚔️ Generating weapons XML"),!h.isEnabled("inventory_processor"))return console.log("⚔️ Inventory processor disabled by feature flag"),"<!-- Inventory processor disabled -->";console.log("⚔️ Character inventory data:",{hasInventory:!!e.inventory,inventoryLength:((t=e.inventory)==null?void 0:t.length)||0,inventoryType:Array.isArray(e.inventory)?"array":typeof e.inventory});const l=this.inventoryProcessor.processInventory(e.inventory||[],e.id,{includeZeroQuantityItems:!1,respectContainerHierarchy:!0,generateDetailedXML:!0,sanitizeOutput:!0,includeCostInformation:!1,markItemsAsIdentified:!0});console.log("⚔️ Inventory processing result:",{hasResult:!!l,hasNestedStructure:!!(l!=null&&l.nestedStructure),hasRootItems:!!((r=l==null?void 0:l.nestedStructure)!=null&&r.rootItems),rootItemsType:Array.isArray((i=l==null?void 0:l.nestedStructure)==null?void 0:i.rootItems)?"array":typeof((s=l==null?void 0:l.nestedStructure)==null?void 0:s.rootItems),rootItemsLength:((a=(o=l==null?void 0:l.nestedStructure)==null?void 0:o.rootItems)==null?void 0:a.length)||0});const c=[];let u=0;if(!l||!l.nestedStructure||!l.nestedStructure.rootItems)return console.log("⚔️ No inventory items found or invalid inventory structure"),"<!-- No inventory items found -->";const d=l.nestedStructure.rootItems,f=l.nestedStructure.containers,m=d.length;h.isEnabled("weaponlist_debug")&&console.log("⚔️ Processing ".concat(m," root items + ").concat(f.size," containers for weapons"));for(const p of d)if(h.isEnabled("weaponlist_debug")&&console.log("⚔️ Checking item: ".concat(p.definition.name),{filterType:p.definition.filterType,isWeapon:p.definition.filterType==="Weapon",itemType:p.definition.type,equipped:p.equipped,hasWeaponBehaviors:!!p.definition.weaponBehaviors}),this.isWeapon(p)){h.isEnabled("weaponlist_debug")&&console.log("⚔️ Found weapon: ".concat(p.definition.name));const y=this.extractWeaponData(p,u);if(y&&(c.push(y),u++,this.isThrown(p))){const v=this.extractThrownWeaponData(p,u);v&&(c.push(v),u++)}}h.isEnabled("weaponlist_debug")&&console.log("⚔️ Checking ".concat(f.size," containers for weapons")),f.forEach((p,y)=>{h.isEnabled("weaponlist_debug")&&console.log("⚔️ Checking container: ".concat(p.definition.name," with ").concat(p.contents.length," items"));for(const v of p.contents)if(h.isEnabled("weaponlist_debug")&&console.log("⚔️ Checking container item: ".concat(v.definition.name),{filterType:v.definition.filterType,isWeapon:v.definition.filterType==="Weapon",containerName:p.definition.name}),this.isWeapon(v)){h.isEnabled("weaponlist_debug")&&console.log("⚔️ Found weapon in container: ".concat(v.definition.name));const C=this.extractWeaponData(v,u);if(C&&(c.push(C),u++,this.isThrown(v))){const S=this.extractThrownWeaponData(v,u);S&&(c.push(S),u++)}}}),this.linkAmmoToWeapons(c,l.nestedStructure),this.isCharacterMonk(e)&&c.push(this.getMonkUnarmedStrike(u)),console.log("⚔️ Final weapons array length: ".concat(c.length),c);let _="";return c.forEach((p,y)=>{const v=String(y+1).padStart(5,"0");_+="      <id-".concat(v,'>\n        <attackbonus type="number">').concat(p.attackBonus,'</attackbonus>\n        <attackstat type="string">').concat(p.attackStat,'</attackstat>\n        <carried type="number">1</carried>\n        <damagelist>\n          <id-00001>\n            <bonus type="number">').concat(p.damage.bonus,'</bonus>\n            <dice type="dice">').concat(p.damage.dice,'</dice>\n            <stat type="string">').concat(p.attackStat,'</stat>\n            <type type="string">').concat(p.damage.type,'</type>\n          </id-00001>\n        </damagelist>\n        <handling type="number">0</handling>\n        <isidentified type="number">1</isidentified>\n        <name type="string">').concat(this.sanitizeString(p.name),'</name>\n        <properties type="string">').concat(this.sanitizeString(p.properties),'</properties>\n        <shortcut type="windowreference">\n          <class>item</class>\n          <recordname>').concat(p.shortcut,'</recordname>\n        </shortcut>\n        <type type="number">').concat(p.weaponType,"</type>"),p.maxAmmo!==void 0&&(_+='\n        <maxammo type="number">'.concat(p.maxAmmo,"</maxammo>")),_+="\n      </id-".concat(v,">\n")}),console.log("⚔️ Generated weapons XML: ".concat(c.length," weapons")),_}catch(l){return console.error("Failed to generate weapons XML:",l),"<!-- Weapon processing failed -->"}}generateSpellsXML(e){var t,r;try{if(console.log("🪄 Generating spells XML"),!e.spells||!e.classSpells)return console.log("🪄 No spell data found"),"<!-- No spells found -->";const i=[];let s=0;h.isEnabled("spelllist_debug")&&console.log("🪄 Processing ".concat(((t=e.classSpells)==null?void 0:t.length)||0," class spell collections")),(r=e.classSpells)==null||r.forEach(l=>{var u,d;const c=this.getClassNameById(e,l.characterClassId);h.isEnabled("spelllist_debug")&&console.log("🪄 Processing ".concat(c," spells: ").concat(((u=l.spells)==null?void 0:u.length)||0," spells")),(d=l.spells)==null||d.forEach(f=>{const m=this.extractSpellData(f,c);m&&(h.isEnabled("spelllist_debug")&&console.log("🪄 Added ".concat(c," spell: ").concat(m.name," (Level ").concat(m.level,")")),i.push(m),s++)})}),e.spells.class&&e.spells.class.forEach(l=>{const c=this.extractSpellData(l,"Class");c&&(i.push(c),s++)}),e.spells.race&&e.spells.race.forEach(l=>{const c=this.extractSpellData(l,"Race");c&&(i.push(c),s++)}),e.spells.feat&&e.spells.feat.forEach(l=>{const c=this.extractSpellData(l,"Feat");c&&(i.push(c),s++)}),e.spells.item&&e.spells.item.forEach(l=>{const c=this.extractSpellData(l,"Item");c&&(i.push(c),s++)}),console.log("🪄 Found ".concat(i.length," spells total"));const o=this.extractActivePowers(e);h.isEnabled("spelllist_debug")&&(console.log("🪄 Found ".concat(o.length," active features/traits to add as powers")),o.forEach(l=>{console.log("🪄 Feature found: ".concat(l.name," (").concat(l.source,")"))})),o.forEach(l=>i.push(l)),console.log("🪄 Found ".concat(o.length," active features/traits to add as powers")),console.log("🪄 Total powers (spells + features): ".concat(i.length));let a="";return i.forEach((l,c)=>{const u=String(c+1).padStart(5,"0");a+="      <id-".concat(u,">");const d=this.generateSpellActions(l);d&&(a+="\n        <actions>\n".concat(d,"        </actions>")),l.powerType==="feature"?a+='\n        <cast type="number">0</cast>\n        <description type="formattedtext">\n          <p>'.concat(this.sanitizeString(l.description),'</p>\n        </description>\n        <group type="string">').concat(this.sanitizeString(l.group),'</group>\n        <level type="number">').concat(l.level,'</level>\n        <locked type="number">1</locked>\n        <name type="string">').concat(this.sanitizeString(l.name),'</name>\n        <prepared type="number">').concat(l.prepared,'</prepared>\n        <ritual type="number">').concat(l.ritual?1:0,'</ritual>\n        <source type="string">').concat(this.sanitizeString(l.source),"</source>"):a+='\n        <castingtime type="string">'.concat(this.sanitizeString(l.castingTime),'</castingtime>\n        <components type="string">').concat(this.sanitizeString(l.components),'</components>\n        <description type="formattedtext">\n          <p>').concat(this.sanitizeString(l.description),'</p>\n        </description>\n        <duration type="string">').concat(this.sanitizeString(l.duration),'</duration>\n        <group type="string">Spells</group>\n        <level type="number">').concat(l.level,'</level>\n        <name type="string">').concat(this.sanitizeString(l.name),'</name>\n        <prepared type="number">').concat(l.prepared?1:0,'</prepared>\n        <range type="string">').concat(this.sanitizeString(l.range),'</range>\n        <ritual type="number">').concat(l.ritual?1:0,'</ritual>\n        <school type="string">').concat(this.sanitizeString(l.school),'</school>\n        <source type="string">').concat(this.sanitizeString(l.source),"</source>"),a+="\n      </id-".concat(u,">\n")}),console.log("🪄 Generated spells XML: ".concat(i.length," spells")),a}catch(i){return console.error("Failed to generate spells XML:",i),"<!-- Spell processing failed -->"}}generateFeatsXML(e){try{console.log("📜 Generating feats XML");const t=e.feats||[];if(!Array.isArray(t))return console.log("📜 No feats array found in character data"),"<!-- No feats data found -->";if(t.length===0)return console.log("📜 Character has no feats"),"<!-- Character has no feats -->";let r="";return t.forEach((i,s)=>{var c,u;const o=String(s+1).padStart(5,"0"),a=((c=i.definition)==null?void 0:c.name)||i.name||"Unknown Feat",l=((u=i.definition)==null?void 0:u.description)||i.description||"";r+="      <id-".concat(o,'>\n        <locked type="number">1</locked>\n        <name type="string">').concat(this.sanitizeString(a),'</name>\n        <text type="formattedtext">\n          <p>').concat(this.sanitizeString(l),"</p>\n        </text>\n      </id-").concat(o,">\n"),a==="Medium Armor Master"?console.log("📜 Found Medium Armor Master feat"):a==="Alert"?console.log("📜 Found Alert feat"):a==="Mobile"?console.log("📜 Found Mobile feat"):a==="Observant"&&console.log("📜 Found Observant feat")}),console.log("📜 Generated feats XML: ".concat(t.length," feats")),r}catch(t){return console.error("Failed to generate feats XML:",t),"<!-- Feat processing failed -->"}}generateCoinsXML(e){try{console.log("💰 Generating coins XML");const t=e.currencies||{};Object.keys(t).length===0&&console.log("💰 No currency data found in character");const r=[{key:"pp",name:"PP",amount:t.pp||0},{key:"gp",name:"GP",amount:t.gp||0},{key:"ep",name:"EP",amount:t.ep||0},{key:"sp",name:"SP",amount:t.sp||0},{key:"cp",name:"CP",amount:t.cp||0}];let i="";return r.forEach((s,o)=>{const a=o+1;i+="      <slot".concat(a,'>\n        <amount type="number">').concat(s.amount,'</amount>\n        <name type="string">').concat(s.name,"</name>\n      </slot").concat(a,">\n")}),i+='      <slot6>\n        <amount type="number">0</amount>\n      </slot6>\n',console.log("💰 Generated coins XML:",r.map(s=>"".concat(s.name,": ").concat(s.amount)).join(", ")),i}catch(t){return console.error("Failed to generate coins XML:",t),"<!-- Coin processing failed -->"}}generateNotesText(e,t){try{console.log("📝 Generating character notes");let r="";if(r+="D&D Beyond Character ID: ".concat(t,"\\n"),e.notes&&typeof e.notes=="object"){const s=Object.entries(e.notes);s.length>0?(console.log("📝 Found ".concat(s.length," note categories")),s.forEach(([o,a])=>{if(a!=null&&a!==""){const l=o.charAt(0).toUpperCase()+o.substring(1),c=this.sanitizeString(a).trim();r+="".concat(l,": ").concat(c,"\\n"),console.log("📝 Added note: ".concat(l," (").concat(c.length," chars)"))}})):console.log("📝 Notes object exists but is empty")}else console.log("📝 No notes found in character data");const i=r.replace(/\\n$/,"");return console.log("📝 Generated notes text (".concat(i.length," chars total)")),this.sanitizeString(i)}catch(r){return console.error("Failed to generate notes text:",r),this.sanitizeString("Character converted from D&D Beyond (ID: ".concat(t,") using Modern Converter v2.0"))}}generateProficienciesXML(e){try{console.log("🛠️ Generating proficiencies XML");const t=new Set;e.modifiers&&Object.values(e.modifiers).forEach(s=>{Array.isArray(s)&&s.forEach(o=>{if(o.type==="proficiency"&&o.isGranted){const a=o.friendlySubtypeName||o.subType;!this.isSkillProficiency(o.subType)&&!this.isSavingThrowProficiency(o.subType)&&!this.isPlaceholderProficiency(a)&&t.add(a)}})});let r="",i=1;return t.forEach(s=>{const o=String(i).padStart(5,"0");r+="      <id-".concat(o,'>\n        <name type="string">').concat(s,"</name>\n      </id-").concat(o,">\n"),i++}),console.log("🛠️ Generated ".concat(t.size," proficiencies")),r}catch(t){return console.error("Error generating proficiencies XML:",t),"<!-- Error generating proficiencies -->"}}isSkillProficiency(e){return["acrobatics","animal-handling","arcana","athletics","deception","history","insight","intimidation","investigation","medicine","nature","perception","performance","persuasion","religion","sleight-of-hand","stealth","survival"].includes(e)}isSavingThrowProficiency(e){return e.includes("saving-throws")}isPlaceholderProficiency(e){return["Choose a Barbarian Skill","Choose a Sorcerer Skill Proficiency","Choose a Sorcerer Skill Proficiency "].includes(e)}processInventory(e){if(h.isEnabled("inventory_processor"))try{console.log("🎒 Using modern InventoryProcessor service");const t=this.convertToInventoryItems(e.inventory||[]),r=e.id,i={includeZeroQuantityItems:!1,respectContainerHierarchy:!0,generateDetailedXML:!1,sanitizeOutput:h.isEnabled("string_sanitizer_service"),includeCostInformation:!0,markItemsAsIdentified:!0};return this.inventoryProcessor.processInventory(t,r,i)}catch(t){console.warn("InventoryProcessor failed, falling back to legacy:",t)}return console.log("📦 Using legacy inventory processing"),{nestedStructure:{characterId:e.id,rootItems:[],containers:new Map,totalItems:0,totalWeight:0},xmlResult:{xml:"<!-- Legacy inventory processing not implemented -->",itemCount:0,totalWeight:0,containerCount:0,debugInfo:{processedItems:0,skippedItems:0,containerItems:0,magicContainers:[]}},statistics:{totalItems:0,containerCount:0,magicContainers:0,totalWeight:0}}}calculateEncumbrance(e){if(h.isEnabled("encumbrance_calculator"))try{console.log("⚖️ Using modern EncumbranceCalculator service");const t={id:e.id,strengthScore:this.getAbilityScore(e,1),hasPowerfulBuild:tn.hasPowerfulBuild(e)},r=this.convertToInventoryItems(e.inventory||[]),i={includeContainerWeights:!0,respectMagicContainers:!0,applyRacialTraits:!0};return this.encumbranceCalculator.calculateEncumbrance(t,r,i)}catch(t){console.warn("EncumbranceCalculator failed, falling back to legacy:",t)}return console.log("⚖️ Using legacy encumbrance calculation"),{totalWeight:0,carryingCapacity:{normal:0,push:0,lift:0,powerfulBuild:!1},encumbranceLevel:"unencumbered",speedPenalty:0,disadvantageOnChecks:!1}}convertToInventoryItems(e){return e.map(t=>({id:t.id,entityTypeId:t.entityTypeId,definition:{id:t.definition.id,name:t.definition.name,weight:t.definition.weight||0,bundleSize:t.definition.bundleSize||1,isContainer:t.definition.isContainer||!1,weightMultiplier:t.definition.weightMultiplier,filterType:t.definition.filterType,subType:t.definition.subType,description:t.definition.description,cost:t.definition.cost?{quantity:t.definition.cost.quantity,unit:t.definition.cost.unit}:void 0},quantity:t.quantity,isAttuned:t.isAttuned||!1,equipped:t.equipped||!1,containerEntityId:t.containerEntityId,charges:t.charges,customName:t.customName,customWeight:t.customWeight,customCost:t.customCost}))}getAbilityScore(e,t){var s,o;const r=(s=e.stats)==null?void 0:s.find(a=>a.id===t),i=(o=e.bonusStats)==null?void 0:o.find(a=>a.id===t);return((r==null?void 0:r.value)||10)+((i==null?void 0:i.value)||0)}generateSkillsXML(e){const t=["acrobatics","animal_handling","arcana","athletics","deception","history","insight","intimidation","investigation","medicine","nature","perception","performance","persuasion","religion","sleight_of_hand","stealth","survival"],r=["dexterity","wisdom","intelligence","strength","charisma","intelligence","wisdom","charisma","intelligence","wisdom","intelligence","wisdom","charisma","charisma","intelligence","dexterity","dexterity","wisdom"];let i="";return t.forEach((s,o)=>{const a=String(o+1).padStart(5,"0");let l=s;s.match(/^sleight/)?l="Sleight of Hand":s.includes("animal")?l="Animal Handling":l=s.split("_").map(m=>m.charAt(0).toUpperCase()+m.slice(1)).join(" ");let c=0;const u=z.find(e,"type","proficiency");u&&u.length>0&&u.some(g=>{var p;return((p=g.subType)==null?void 0:p.replace(/-/g,"_"))===s})&&(c=1);const d=z.find(e,"type","expertise");d&&d.length>0&&d.some(g=>{var p;return((p=g.subType)==null?void 0:p.replace(/-/g,"_"))===s})&&(c=2);const f=z.find(e,"type","half-proficiency");f&&f.length>0&&c===0&&f.some(g=>{var p;return((p=g.subType)==null?void 0:p.replace(/-/g,"_"))===s})&&(c=3),i+="      <id-".concat(a,">\n"),i+='        <misc type="number">0</misc>\n',i+='        <name type="string">'.concat(l,"</name>\n"),i+='        <stat type="string">'.concat(r[o],"</stat>\n"),i+='        <prof type="number">'.concat(c,"</prof>\n"),i+="      </id-".concat(a,">\n")}),i}generateLanguagesXML(e){var o;let t="";const r=new Set,i=z.find(e,"type","language");return i&&i.length>0&&i.forEach(a=>{const l=a.friendlySubtypeName||a.subType||"Unknown Language";r.add(l)}),(o=e.race)!=null&&o.racialTraits&&e.race.racialTraits.forEach(a=>{var l,c;if((c=(l=a.definition)==null?void 0:l.name)!=null&&c.toLowerCase().includes("language")){const u=a.definition.description||"";["Common","Elvish","Dwarvish","Halfling","Orcish","Gnomish","Giant","Draconic"].forEach(f=>{u.includes(f)&&r.add(f)})}}),Array.from(r).sort().forEach((a,l)=>{const c=String(l+1).padStart(5,"0");t+="      <id-".concat(c,">\n"),t+='        <name type="string">'.concat(this.sanitizeString(a),"</name>\n"),t+="      </id-".concat(c,">\n")}),t}getFeatureFlagStatus(){return{character_fetcher:h.isEnabled("character_fetcher"),modern_converter:h.isEnabled("modern_converter"),legacy_fallback:h.isEnabled("legacy_fallback"),debug_character_data:h.isEnabled("debug_character_data"),object_search_service:h.isEnabled("object_search_service"),string_sanitizer_service:h.isEnabled("string_sanitizer_service"),safe_access_service:h.isEnabled("safe_access_service"),ability_constants:h.isEnabled("ability_constants"),ability_score_processor:h.isEnabled("ability_score_processor"),debug_ability_score_processor:h.isEnabled("debug_ability_score_processor"),spell_slot_calculator:h.isEnabled("spell_slot_calculator"),debug_spell_slot_calculator:h.isEnabled("debug_spell_slot_calculator"),inventory_processor:h.isEnabled("inventory_processor"),encumbrance_calculator:h.isEnabled("encumbrance_calculator"),inventory_processor_debug:h.isEnabled("inventory_processor_debug"),encumbrance_calculator_debug:h.isEnabled("encumbrance_calculator_debug"),feature_processor_debug:h.isEnabled("feature_processor_debug"),weaponlist_debug:h.isEnabled("weaponlist_debug")}}isWeapon(e){return e.definition.filterType==="Weapon"}isThrown(e){var r,i;return(((i=(r=e.definition.weaponBehaviors)==null?void 0:r[0])==null?void 0:i.properties)||[]).some(s=>s.toLowerCase().includes("thrown"))}extractWeaponData(e,t){var _;h.isEnabled("weaponlist_debug")&&console.log("⚔️ Extracting weapon data for: ".concat(e.definition.name));const r=(_=e.definition.weaponBehaviors)==null?void 0:_[0];let s=(r==null?void 0:r.properties)||[];s.length===0&&(s=this.inferWeaponProperties(e));const o=s.some(p=>p.toLowerCase().includes("range"))||s.some(p=>p.toLowerCase().includes("ranged"))||this.isRangedWeapon(e.definition.name),a=s.some(p=>p.toLowerCase().includes("thrown")),l=this.getWeaponAttackStat(e,o),c=0,u=this.extractWeaponDamage(e);let d=0;a?d=2:o&&(d=1);const f=String(e.id).padStart(5,"0"),m="....inventorylist.id-".concat(f),g={id:e.id,name:e.definition.name,properties:s.join(", "),attackBonus:c,attackStat:l,damage:u,weaponType:d,shortcut:m};return h.isEnabled("weaponlist_debug")&&console.log("⚔️ Extracted weapon data:",g),g}extractThrownWeaponData(e,t){const r=this.extractWeaponData(e,t);return r?{...r,weaponType:0}:null}getWeaponAttackStat(e,t){return t?"dexterity":"strength"}isCharacterMonk(e){return e.classes?e.classes.some(t=>{var r,i;return((i=(r=t.definition)==null?void 0:r.name)==null?void 0:i.toLowerCase())==="monk"}):!1}getMonkUnarmedStrike(e){return{id:999999,name:"Unarmed Strike",properties:"Monk, Unarmed",attackBonus:0,attackStat:"dexterity",damage:{dice:"1d4",bonus:0,type:"bludgeoning"},weaponType:0,shortcut:""}}linkAmmoToWeapons(e,t){h.isEnabled("weaponlist_debug")&&console.log("⚔️ Linking ammunition to ".concat(e.length," weapons"));const r=[];t.rootItems.forEach(i=>{this.isAmmunition(i)&&r.push(i)}),t.containers.forEach(i=>{i.contents.forEach(s=>{this.isAmmunition(s)&&r.push(s)})}),h.isEnabled("weaponlist_debug")&&console.log("⚔️ Found ".concat(r.length," ammunition items:"),r.map(i=>({name:i.definition.name,quantity:i.quantity,subType:i.definition.subType}))),e.forEach((i,s)=>{if(i.weaponType===2)i.maxAmmo=this.getThrownWeaponQuantity(i,t),h.isEnabled("weaponlist_debug")&&console.log("⚔️ Set thrown weapon ".concat(i.name," maxAmmo to ").concat(i.maxAmmo," (using item quantity)"));else{const o=this.findCompatibleAmmo(i,r);o&&(i.maxAmmo=o.quantity,h.isEnabled("weaponlist_debug")&&console.log("⚔️ Linked ".concat(i.name," to ").concat(o.definition.name," (").concat(o.quantity,")")))}})}getThrownWeaponQuantity(e,t){const r=e.id;for(const i of t.rootItems)if(i.id===r)return i.quantity;for(const[i,s]of t.containers)for(const o of s.contents)if(o.id===r)return o.quantity;return 1}isAmmunition(e){return e.definition.subType==="Ammunition"||e.definition.isConsumable&&e.definition.filterType==="Other Gear"}findCompatibleAmmo(e,t){const r=e.name.toLowerCase();for(const i of t){const s=i.definition.name.toLowerCase();if(r.includes("crossbow")&&s.includes("bolt")||r.includes("bow")&&s.includes("arrow")||r.includes("sling")&&(s.includes("bullet")||s.includes("stone"))||r.includes("blowgun")&&s.includes("needle"))return i}return null}inferWeaponProperties(e){var l;const t=[],r=((l=e.definition.name)==null?void 0:l.toLowerCase())||"";return this.isRangedWeapon(r)&&t.push("Ranged"),["greatsword","maul","pike","glaive","halberd","longbow","heavy crossbow"].some(c=>r.includes(c))&&t.push("Two-handed"),["dagger","dart","javelin","light hammer","sickle","scimitar","shortsword","handaxe"].some(c=>r.includes(c))&&t.push("Light"),["dagger","dart","rapier","scimitar","shortsword","whip"].some(c=>r.includes(c))&&t.push("Finesse"),["dart","javelin","light hammer","handaxe","spear","trident"].some(c=>r.includes(c))&&t.push("Thrown"),t}isRangedWeapon(e){return["bow","crossbow","dart","javelin","sling","blowgun"].some(r=>e.toLowerCase().includes(r))}extractWeaponDamage(e){var i,s;const t=(i=e.definition.weaponBehaviors)==null?void 0:i[0];if(t!=null&&t.damage)return{dice:t.damage.diceString||"1d6",bonus:t.damage.fixedValue||0,type:t.damage.damageTypeId?this.getDamageTypeName(t.damage.damageTypeId):"slashing"};if(e.definition.damage)return{dice:e.definition.damage.diceString||"1d6",bonus:e.definition.damage.fixedValue||0,type:e.definition.damage.damageTypeId?this.getDamageTypeName(e.definition.damage.damageTypeId):"slashing"};const r=((s=e.definition.name)==null?void 0:s.toLowerCase())||"";return r.includes("dagger")?{dice:"1d4",bonus:0,type:"piercing"}:r.includes("shortsword")?{dice:"1d6",bonus:0,type:"piercing"}:r.includes("longsword")?{dice:"1d8",bonus:0,type:"slashing"}:r.includes("greatsword")?{dice:"2d6",bonus:0,type:"slashing"}:r.includes("mace")?{dice:"1d6",bonus:0,type:"bludgeoning"}:r.includes("warhammer")?{dice:"1d8",bonus:0,type:"bludgeoning"}:{dice:"1d6",bonus:0,type:"slashing"}}getDamageTypeName(e){return{1:"bludgeoning",2:"piercing",3:"slashing",4:"necrotic",5:"acid",6:"cold",7:"fire",8:"lightning",9:"thunder",10:"poison",11:"psychic",12:"radiant",13:"force"}[e]||"slashing"}getClassNameById(e,t){var i,s;const r=(i=e.classes)==null?void 0:i.find(o=>o.id===t);return((s=r==null?void 0:r.definition)==null?void 0:s.name)||"Unknown"}extractSpellData(e,t){try{const r=e.definition;if(!r)return null;const i=this.formatSpellComponents(r.components||[]),s=this.formatCastingTime(r.activation),o=this.formatSpellRange(r.range),a=this.formatSpellDuration(r.duration),l=this.stripHTML(r.description||"");return{id:r.id,name:r.name,level:r.level,school:r.school||"Divination",source:t,prepared:e.prepared||!1,description:l,components:i,castingTime:s,range:o,duration:a,concentration:r.concentration||!1,ritual:r.ritual||!1,saveDc:e.overrideSaveDc||null,attackRoll:r.requiresAttackRoll||!1,requiresSavingThrow:r.requiresSavingThrow||!1,definition:r}}catch(r){return console.error("Failed to extract spell data:",r),null}}formatSpellComponents(e){const t=[];return e.includes(1)&&t.push("V"),e.includes(2)&&t.push("S"),e.includes(3)&&t.push("M"),t.join(", ")}formatCastingTime(e){if(!e)return"1 action";const t=e.activationTime||1,r=e.activationType,s={1:"action",2:"bonus action",3:"reaction",4:"minute",5:"hour",6:"no action"}[r]||"action";return t===1?"1 ".concat(s):"".concat(t," ").concat(s,"s")}formatSpellRange(e){return e?e.origin==="Self"?e.aoeType&&e.aoeValue?"Self (".concat(e.aoeValue,"-foot ").concat(e.aoeType.toLowerCase(),")"):"Self":e.rangeValue?"".concat(e.rangeValue," feet"):e.origin||"Touch":"Touch"}formatSpellDuration(e){var o;if(!e)return"Instantaneous";const t=e.durationInterval||1,r=((o=e.durationUnit)==null?void 0:o.toLowerCase())||"round",i=e.durationType;let s=t===1?"1 ".concat(r):"".concat(t," ").concat(r,"s");return i==="Concentration"&&(s="Concentration, up to ".concat(s)),s}stripHTML(e){return e.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim()}generateSpellActions(e){let t="",r=1;if(e.powerType==="feature")t+=this.generateFeatureAction(e,r);else{if(t+="          <id-".concat(String(r).padStart(5,"0"),'>\n            <order type="number">').concat(r,'</order>\n            <type type="string">cast</type>'),e.requiresSavingThrow||e.saveDc){t+='\n            <savemagic type="number">1</savemagic>';const a=this.determineSaveType(e);a&&(t+='\n            <savetype type="string">'.concat(a,"</savetype>"))}t+="\n          </id-".concat(String(r).padStart(5,"0"),">\n"),r++;const s=this.extractSpellDamageInfo(e);s&&(t+="          <id-".concat(String(r).padStart(5,"0"),'>\n            <damagelist>\n              <id-00001>\n                <bonus type="number">').concat(s.bonus,'</bonus>\n                <dice type="dice">').concat(s.dice,'</dice>\n                <type type="string">').concat(s.type,'</type>\n              </id-00001>\n            </damagelist>\n            <order type="number">').concat(r,'</order>\n            <type type="string">damage</type>\n          </id-').concat(String(r).padStart(5,"0"),">\n"),r++);const o=this.extractSpellHealingInfo(e);o&&(t+="          <id-".concat(String(r).padStart(5,"0"),'>\n            <order type="number">').concat(r,'</order>\n            <type type="string">heal</type>\n            <heallist>\n              <id-00001>\n                <bonus type="number">').concat(o.bonus,'</bonus>\n                <dice type="dice">').concat(o.dice,"</dice>\n              </id-00001>\n            </heallist>\n          </id-").concat(String(r).padStart(5,"0"),">\n"),r++)}return t}generateFeatureAction(e,t){var o,a;const r=((o=e.name)==null?void 0:o.toLowerCase())||"";let i="          <id-".concat(String(t).padStart(5,"0"),">");if(e.duration&&e.duration!=="Instantaneous"&&e.duration.includes("minute")){const l=((a=e.duration.match(/(\d+)/))==null?void 0:a[1])||"1";i+='\n            <durmod type="number">'.concat(l,'</durmod>\n            <durunit type="string">minute</durunit>')}let s="";return r.includes("rage")?s="Rage; ADVCHK: strength; ADVSAV: strength; DMG: 2, melee; RESIST: bludgeoning, piercing, slashing":r.includes("stone's endurance")?s="Stone's Endurance; Reduce damage by 1d12 + CON modifier":s=e.name,i+='\n            <label type="string">'.concat(s,'</label>\n            <order type="number">').concat(t,'</order>\n            <targeting type="string">self</targeting>\n            <type type="string">effect</type>\n          </id-').concat(String(t).padStart(5,"0"),">\n"),i}determineSaveType(e){var r,i;const t=((r=e.description)==null?void 0:r.toLowerCase())||"";return t.includes("dexterity saving throw")?"dexterity":t.includes("constitution saving throw")?"constitution":t.includes("wisdom saving throw")?"wisdom":t.includes("intelligence saving throw")?"intelligence":t.includes("charisma saving throw")?"charisma":t.includes("strength saving throw")?"strength":(i=e.definition)!=null&&i.saveDcAbilityId&&{1:"strength",2:"dexterity",3:"constitution",4:"intelligence",5:"wisdom",6:"charisma"}[e.definition.saveDcAbilityId]||null}extractSpellDamageInfo(e){var s,o;const t=((s=e.description)==null?void 0:s.toLowerCase())||"",r=/(\d+d\d+).*?(acid|cold|fire|lightning|thunder|poison|psychic|radiant|necrotic|force|bludgeoning|piercing|slashing)/i,i=t.match(r);return i?{dice:this.formatDiceForFantasyGrounds(i[1]),bonus:0,type:i[2].toLowerCase()}:(o=e.definition)!=null&&o.damage?{dice:this.formatDiceForFantasyGrounds(e.definition.damage.diceString||"1d6"),bonus:e.definition.damage.fixedValue||0,type:this.getDamageTypeName(e.definition.damage.damageTypeId)||"force"}:null}extractSpellHealingInfo(e){var o,a;const t=((o=e.description)==null?void 0:o.toLowerCase())||"",r=/(\d+d\d+).*?hit points/i,i=t.match(r);if(i)return{dice:this.formatDiceForFantasyGrounds(i[1]),bonus:0};const s=((a=e.name)==null?void 0:a.toLowerCase())||"";return s.includes("cure")||s.includes("heal")||s.includes("vitality")?{dice:this.formatDiceForFantasyGrounds("1d8"),bonus:0}:null}formatDiceForFantasyGrounds(e){return e.replace(/^1d/,"d")}extractActivePowers(e){var r,i,s,o,a;const t=[];return h.isEnabled("spelllist_debug")&&(console.log("🪄 Extracting active class features and racial traits as powers"),console.log("🪄 Character classes:",((r=e.classes)==null?void 0:r.length)||0),console.log("🪄 Character race:",(i=e.race)==null?void 0:i.fullName)),(s=e.classes)==null||s.forEach(l=>{var u,d,f,m;const c=((u=l.definition)==null?void 0:u.name)||"Unknown";h.isEnabled("spelllist_debug")&&console.log("🪄 Checking ".concat(c,": ").concat(((d=l.classFeatures)==null?void 0:d.length)||0," class features")),(f=l.classFeatures)==null||f.forEach(g=>{var _,p,y,v;if(h.isEnabled("spelllist_debug")&&(console.log("🪄 Checking class feature: ".concat((_=g.definition)==null?void 0:_.name," - isActivePower: ").concat(this.isActivePower(g))),(y=(p=g.definition)==null?void 0:p.name)!=null&&y.toLowerCase().includes("rage")&&(console.log("🪄 Raw Rage feature data:",g),console.log("🪄 Rage feature.levelScales:",g.levelScales))),this.isActivePower(g)){const C=this.extractFeaturePowerData(g,c,e);C?(t.push(C),h.isEnabled("spelllist_debug")&&console.log("🪄 Added ".concat(c," feature: ").concat(C.name))):h.isEnabled("spelllist_debug")&&console.log("🪄 Failed to extract power data for: ".concat((v=g.definition)==null?void 0:v.name))}}),(m=l.subclassFeatures)==null||m.forEach(g=>{var _;if(this.isActivePower(g)){const p=((_=g.definition)==null?void 0:_.name)||c,y=this.extractFeaturePowerData(g,"".concat(c," (").concat(p,")"),e);y&&(t.push(y),h.isEnabled("spelllist_debug")&&console.log("🪄 Added ".concat(c," subclass feature: ").concat(y.name)))}})}),(a=(o=e.race)==null?void 0:o.racialTraits)==null||a.forEach(l=>{var c;if(this.isActivePower(l)){const u=this.extractFeaturePowerData(l,"".concat(((c=e.race)==null?void 0:c.fullName)||"Racial"," Traits"),e);u&&(t.push(u),h.isEnabled("spelllist_debug")&&console.log("🪄 Added racial trait: ".concat(u.name)))}}),t}isActivePower(e){var i;if(!(e!=null&&e.definition))return!1;if(e.limitedUse)return!0;const t=((i=e.definition.name)==null?void 0:i.toLowerCase())||"";return["rage","reckless attack","stone's endurance","form of the beast","action surge","second wind","bardic inspiration","channel divinity","wild shape","lay on hands","divine smite","sneak attack"].some(s=>t.includes(s))}extractFeaturePowerData(e,t,r){var i,s,o;try{const a=e.definition;if(!a)return null;const l=this.stripHTML(a.description||"");let c=0,u="long rest",d="action";return e.limitedUse&&(c=e.limitedUse.maxUses||1,u=e.limitedUse.resetType===1?"short rest":"long rest",e.limitedUse.actionType===3&&(d=this.determineActionTypeFromDescription(l)),h.isEnabled("spelllist_debug")&&((i=a.name)!=null&&i.toLowerCase().includes("rage"))&&console.log("🪄 Rage limitedUse data:",e.limitedUse)),c=this.calculateScaledFeatureUses(e,r,c),h.isEnabled("spelllist_debug")&&((s=a.name)!=null&&s.toLowerCase().includes("rage"))&&console.log("🪄 Final Rage debug:",{featureName:a.name,characterLevel:this.getCharacterLevelForFeature(e,r),originalMaxUses:((o=e.limitedUse)==null?void 0:o.maxUses)||0,finalUsesMax:c,hasLevelScales:!!e.levelScales,levelScalesData:e.levelScales}),{id:a.id,name:a.name,level:0,school:"",source:t,prepared:c,description:l,components:"",castingTime:d,range:this.determineRangeFromDescription(l),duration:this.determineDurationFromDescription(l),concentration:!1,ritual:!1,group:t,powerType:"feature",resetType:u,definition:a}}catch(a){return console.error("Failed to extract feature power data:",a),null}}determineActionTypeFromDescription(e){const t=e.toLowerCase();return t.includes("bonus action")?"bonus action":t.includes("reaction")?"reaction":t.includes("no action")?"no action":"action"}determineRangeFromDescription(e){const t=e.toLowerCase();if(t.includes("self")||t.includes("yourself"))return"Self";if(t.includes("touch"))return"Touch";const r=/(\d+)\s*feet/i,i=t.match(r);return i?"".concat(i[1]," feet"):"Self"}determineDurationFromDescription(e){const t=e.toLowerCase();return t.includes("1 minute")?"1 minute":t.includes("10 minutes")?"10 minutes":t.includes("1 hour")?"1 hour":t.includes("until")?"Until condition met":(t.includes("instantaneous"),"Instantaneous")}calculateScaledFeatureUses(e,t,r){var u,d,f;const i=this.getCharacterLevelForFeature(e,t),s=this.findClassFeatureLevelScales(e,t);if(!s||!Array.isArray(s))return h.isEnabled("spelllist_debug")&&console.log("🪄 No level scales found for ".concat((u=e.definition)==null?void 0:u.name,", using default: ").concat(r)),r;h.isEnabled("spelllist_debug")&&(console.log("🪄 Calculating scaled uses for ".concat((d=e.definition)==null?void 0:d.name,": character level ").concat(i)),console.log("🪄 Level scales available:",s));const o=s.filter(m=>m.description&&!m.description.toLowerCase().includes("damage")&&!m.description.toLowerCase().includes("+")),a=o.length>0?o:s;h.isEnabled("spelllist_debug")&&o.length>0&&console.log("🪄 Found ".concat(o.length," usage-specific level scales (filtering out damage scaling)"));const l=a.sort((m,g)=>m.level-g.level);let c=r;for(const m of l)i>=m.level&&m.fixedValue!==void 0&&m.fixedValue!==null?(c=m.fixedValue,h.isEnabled("spelllist_debug")&&console.log("🪄 Applied level scale at level ".concat(m.level,": ").concat(c," uses (").concat(m.description||"no description",")"))):h.isEnabled("spelllist_debug")&&(i<m.level?console.log("🪄 Skipping level ".concat(m.level," (character level ").concat(i," too low)")):(m.fixedValue===void 0||m.fixedValue===null)&&console.log("🪄 Skipping level ".concat(m.level," (no fixedValue: ").concat(m.fixedValue,")")));return h.isEnabled("spelllist_debug")&&console.log("🪄 Final scaled uses for ".concat((f=e.definition)==null?void 0:f.name,": ").concat(c)),c}findClassFeatureLevelScales(e,t){var r,i,s,o,a,l,c,u,d,f,m,g,_,p,y;if(!((r=e.definition)!=null&&r.id))return null;for(const v of t.classes||[]){const C=(i=v.classFeatures)==null?void 0:i.some(b=>{var w;return((w=b.definition)==null?void 0:w.id)===e.definition.id}),S=(s=v.subclassFeatures)==null?void 0:s.some(b=>{var w;return((w=b.definition)==null?void 0:w.id)===e.definition.id});if(C||S){h.isEnabled("spelllist_debug")&&console.log("🪄 Found class ".concat((o=v.definition)==null?void 0:o.name," containing feature ").concat(e.definition.name));for(const b of v.classFeatures||[])if(((a=b.definition)==null?void 0:a.id)===e.definition.id){if(h.isEnabled("spelllist_debug")&&console.log("🪄 Examining class feature ".concat((l=b.definition)==null?void 0:l.name,":"),{hasLevelScales:!!b.levelScales,levelScalesLength:((c=b.levelScales)==null?void 0:c.length)||0,levelScales:b.levelScales,hasDefinitionLevelScales:!!((u=b.definition)!=null&&u.levelScales),definitionLevelScales:(d=b.definition)==null?void 0:d.levelScales}),b.levelScales&&b.levelScales.length>0)return b.levelScales;if((f=b.definition)!=null&&f.levelScales&&b.definition.levelScales.length>0)return b.definition.levelScales}for(const b of v.subclassFeatures||[])if(((m=b.definition)==null?void 0:m.id)===e.definition.id){if(h.isEnabled("spelllist_debug")&&console.log("🪄 Examining subclass feature ".concat((g=b.definition)==null?void 0:g.name,":"),{hasLevelScales:!!b.levelScales,levelScales:b.levelScales,hasDefinitionLevelScales:!!((_=b.definition)!=null&&_.levelScales),definitionLevelScales:(p=b.definition)==null?void 0:p.levelScales}),b.levelScales&&b.levelScales.length>0)return b.levelScales;if((y=b.definition)!=null&&y.levelScales&&b.definition.levelScales.length>0)return b.definition.levelScales}return h.isEnabled("spelllist_debug")&&console.log("🪄 Found class for ".concat(e.definition.name," but no levelScales found anywhere")),null}}return h.isEnabled("spelllist_debug")&&console.log("🪄 Could not find class containing feature ".concat(e.definition.name)),null}getCharacterLevelForFeature(e,t){var r,i,s;for(const o of t.classes||[])if((r=o.classFeatures)!=null&&r.some(a=>{var l,c;return((l=a.definition)==null?void 0:l.id)===((c=e.definition)==null?void 0:c.id)})||(i=o.subclassFeatures)!=null&&i.some(a=>{var l,c;return((l=a.definition)==null?void 0:l.id)===((c=e.definition)==null?void 0:c.id)}))return o.level||1;return((s=t.classes)==null?void 0:s.reduce((o,a)=>o+(a.level||0),0))||1}}const Ws=new js;M.store("conversionResults",{result:null,filename:"",characterName:"",convertedAt:null,get hasResult(){return this.result!==null&&this.result.trim().length>0},get resultSize(){if(!this.result)return"0 KB";const n=new Blob([this.result]).size,e=Math.round(n/1024*100)/100;return"".concat(e," KB")},setResult(n,e="Unknown Character"){this.result=n,this.characterName=e,this.convertedAt=new Date,this.filename="".concat(e.replace(/[^a-zA-Z0-9]/g,"_"),"_character.xml"),console.log("Conversion result set:",{characterName:e,size:this.resultSize})},clearResult(){this.result=null,this.filename="",this.characterName="",this.convertedAt=null,console.log("Conversion result cleared")},downloadXML(){if(!this.hasResult)return console.warn("No conversion result to download"),!1;try{const n=new Blob([this.result],{type:"application/xml"}),e=URL.createObjectURL(n),t=document.createElement("a");return t.href=e,t.download=this.filename||"character.xml",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e),console.log("XML file downloaded:",this.filename),!0}catch(n){return console.error("Failed to download XML:",n),!1}}});M.store("notifications",{items:[],get hasNotifications(){return this.items.length>0},add(n,e,t=!0){const r={id:Math.random().toString(36).substr(2,9),message:n,type:e,timestamp:new Date,autoDismiss:t};if(this.items.push(r),console.log("Notification added:",r),t){const i=e==="error"?0:e==="warning"?8e3:5e3;i>0&&setTimeout(()=>{this.remove(r.id)},i)}return r},addSuccess(n,e=!0){return this.add(n,"success",e)},addError(n,e=!1){return this.add(n,"error",e)},addWarning(n,e=!0){return this.add(n,"warning",e)},addInfo(n,e=!0){return this.add(n,"info",e)},remove(n){const e=this.items.findIndex(t=>t.id===n);e!==-1&&(this.items.splice(e,1),console.log("Notification removed:",n))},clear(){this.items=[],console.log("All notifications cleared")}});M.data("characterConverter",()=>({characterId:"",fgVersion:"unity",isConverting:!1,progress:0,currentStep:"",isValidId:!0,showCharacterPreview:h.isEnabled("character_preview"),showPerformanceMetrics:h.isEnabled("performance_metrics"),enableBulkConversion:h.isEnabled("bulk_conversion"),init(){window.addEventListener("featureFlagsChanged",()=>{this.updateFeatureFlags()})},validateCharacterId(){const n=this.characterId.trim();if(!n){this.isValidId=!0;return}const e=/(?:dndbeyond\.com\/characters\/|\/characters\/)(\d+)/i,t=n.match(e);if(t&&t[1]){this.characterId=t[1],this.isValidId=!0;return}const r=/^\d+$/;this.isValidId=r.test(n),this.isValidId||M.store("notifications").addError("Please enter a valid character ID or D&D Beyond character URL")},async convertCharacter(){var e,t,r;if(!this.characterId.trim()){M.store("notifications").addError("Please enter a character ID");return}if(this.validateCharacterId(),!this.isValidId)return;M.store("conversionResults").clearResult(),this.isConverting=!0,this.progress=0,this.currentStep="Initializing...";try{this.currentStep="Validating character ID...",this.progress=10,await this.delay(200);const i=this.characterId.trim();console.log("Converting character:",i),((e=window.featureFlags)==null?void 0:e.isEnabled("debug_character_data"))&&console.log("🔍 Debug mode enabled - detailed character data will be logged");const o=window.characterConverterFacade;if(!o)throw new Error("CharacterConverterFacade not available");o.onProgress=(m,g)=>{this.currentStep=m,this.progress=g};const a=await o.convertFromDNDBeyond(i);if(!a.success)throw new Error(a.error||"Conversion failed");this.currentStep="Complete!",this.progress=100;const l=((t=a.characterData)==null?void 0:t.name)||"Unknown Character";M.store("conversionResults").setResult(a.xml,l);const u=M.store("notifications"),d=(r=window.featureFlags)==null?void 0:r.isEnabled("debug_character_data");this.validateWarlockPactMagic(a,u);const f=d?'Character "'.concat(l,'" converted successfully! Check console for detailed data.'):'Character "'.concat(l,'" converted successfully!');u.addSuccess(f)}catch(i){console.error("Conversion error:",i);const s=i instanceof Error?i.message:"Unknown error occurred";M.store("notifications").addError("Conversion failed: ".concat(s)),this.currentStep="Error occurred",this.progress=0}finally{this.isConverting=!1}},resetForm(){this.characterId="",this.fgVersion="unity",this.isConverting=!1,this.progress=0,this.currentStep="",this.isValidId=!0,M.store("conversionResults").clearResult(),M.store("notifications").clear(),console.log("Character converter form reset")},downloadResult(){const e=M.store("conversionResults").downloadXML(),t=M.store("notifications");e?t.addSuccess("XML file downloaded successfully!"):t.addError("Failed to download XML file")},updateFeatureFlags(){this.showCharacterPreview=h.isEnabled("character_preview"),this.showPerformanceMetrics=h.isEnabled("performance_metrics"),this.enableBulkConversion=h.isEnabled("bulk_conversion")},delay(n){return new Promise(e=>setTimeout(e,n))},validateWarlockPactMagic(n,e){if(!n.success||!n.characterData||!n.xml)return;const r=(n.characterData.classes||[]).find(f=>{var m,g;return((g=(m=f.definition)==null?void 0:m.name)==null?void 0:g.toLowerCase())==="warlock"});if(!r)return;const i=r.level,s=n.characterData.name||"Unknown",o=n.xml;let a={};i>=17?a={level5:4}:i>=15?a={level5:3}:i>=11?a={level5:2}:i>=9?a={level5:2}:i>=7?a={level4:2}:i>=5?a={level3:2}:i>=3?a={level2:2}:i>=2?a={level1:2}:i>=1&&(a={level1:1});const l=/<pactmagicslots(\d+)><max type="number">(\d+)<\/max>/g,c=[...o.matchAll(l)];let u=[],d=!1;if(c.length>0)if(c.forEach(f=>{const m=f[1],g=f[2];if(g!=="0"){u.push("L".concat(m,": ").concat(g));const _="level".concat(m);a[_]&&parseInt(g)===a[_]&&(d=!0)}}),d)e.addInfo("🎭 Warlock validated: Level ".concat(i," ").concat(s," correctly has pact magic slots (").concat(u.join(", "),")"));else{const f=Object.entries(a).map(([m,g])=>"L".concat(m.replace("level",""),": ").concat(g)).join(", ");e.addWarning("⚠️ Warlock issue: Level ".concat(i," ").concat(s," has unexpected pact magic slots. Found: ").concat(u.join(", "),", Expected: ").concat(f))}else{const f=/<spellslots(\d+)><max type="number">(\d+)<\/max>/g,g=[...o.matchAll(f)].filter(_=>_[2]!=="0").map(_=>"L".concat(_[1],": ").concat(_[2]));g.length>0?e.addError("❌ Warlock error: Level ".concat(i," ").concat(s," has regular spell slots instead of pact magic (").concat(g.join(", "),")")):e.addError("❌ Warlock error: Level ".concat(i," ").concat(s," has no spell slots generated"))}}}));M.data("modernizationStatus",()=>({showStatus:!1,features:[{name:"Build System",status:"completed",description:"TypeScript + Vite + Tailwind CSS"},{name:"Feature Flags",status:"completed",description:"Runtime feature toggles with admin panel"},{name:"Alpine.js Framework",status:"completed",description:"Modern reactive UI components"},{name:"Character Converter",status:"in_progress",description:"Modern replacement for legacy converter"},{name:"Dependency Injection",status:"completed",description:"Decoupled service architecture with IoC container"},{name:"Character Parser",status:"completed",description:"Modernized parsing with services and level scaling"},{name:"Error Handling",status:"completed",description:"Comprehensive error management and validation"},{name:"Performance Metrics",status:"completed",description:"Conversion performance tracking and optimization"}],getOverallProgress(){const n=this.features.filter(i=>i.status==="completed").length,e=this.features.filter(i=>i.status==="in_progress").length,t=n+e*.5;return Math.round(t/this.features.length*100)},getStatusColor(n){switch(n){case"completed":return"text-green-400";case"in_progress":return"text-yellow-400";case"pending":return"text-red-400";default:return"text-gray-400"}},getStatusIcon(n){switch(n){case"completed":return"fas fa-check";case"in_progress":return"fas fa-clock";case"pending":return"fas fa-times";default:return"fas fa-question"}}}));document.addEventListener("keydown",n=>{if(n.ctrlKey&&n.shiftKey&&n.key==="M"){n.preventDefault();const e=document.querySelector('[x-data*="modernizationStatus"]');if(e){const t=M.$data(e);t.showStatus=!t.showStatus}}});M.data("featureFlagAdmin",()=>({flags:{},overrides:{},showAdmin:!1,init(){this.refreshFlags(),document.addEventListener("keydown",n=>{n.ctrlKey&&n.shiftKey&&n.key==="F"&&(n.preventDefault(),this.showAdmin=!this.showAdmin)})},toggleFlag(n){const e=this.getFlagStatus(n);e==="overridden"?h.clearOverride(n):e==="enabled"?h.disable(n):h.enable(n),this.refreshFlags(),window.dispatchEvent(new CustomEvent("featureFlagsChanged",{detail:{flagKey:n,newStatus:this.getFlagStatus(n)}}))},clearOverride(n){h.clearOverride(n),this.refreshFlags(),window.dispatchEvent(new CustomEvent("featureFlagsChanged",{detail:{flagKey:n,newStatus:this.getFlagStatus(n)}}))},clearAllOverrides(){h.clearAllOverrides(),this.refreshFlags(),window.dispatchEvent(new CustomEvent("featureFlagsChanged",{detail:{action:"clearAll"}}))},refreshFlags(){this.flags=h.getAllFlags(),this.overrides=h.getOverrides()},getFlagStatus(n){return this.overrides.hasOwnProperty(n)?"overridden":h.isEnabled(n)?"enabled":"disabled"},getFlagDisplayClass(n){const e=this.getFlagStatus(n),t="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium";switch(e){case"enabled":return"".concat(t," bg-green-800 text-green-200");case"disabled":return"".concat(t," bg-red-800 text-red-200");case"overridden":return"".concat(t," bg-yellow-800 text-yellow-200");default:return"".concat(t," bg-gray-800 text-gray-200")}}}));console.log("D&D Beyond to Fantasy Grounds Converter v2.0 - Development Build");console.log("Modern refactor in progress...");typeof window<"u"&&(window.featureFlags=h,window.characterFetcher=Ms,window.characterConverterFacade=Ws,window.gameConfigService=F,window.ObjectSearch=z,window.StringSanitizer=N,window.SafeAccess=se,window.AbilityScoreUtils=k,window.AbilityScoreProcessor=P,window.SpellSlotCalculator=j);document.addEventListener("DOMContentLoaded",async()=>{console.log("Modern converter initialized"),console.log("Feature flags loaded:",Object.keys(h.getAllFlags()));try{await F.loadConfigs(),console.log("Game configuration loaded successfully")}catch(n){console.warn("Failed to load game configuration, using fallbacks:",n)}M.start(),console.log("Alpine.js started"),h.isEnabled("performance_metrics")&&(console.log("Performance metrics enabled"),console.log("Active feature flags:",Object.entries(h.getAllFlags()).filter(([n])=>h.isEnabled(n)).map(([n])=>n)))});
