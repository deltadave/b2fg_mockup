System.register([],function(e,t){"use strict";return{execute:function(){var e=document.createElement("style");e.textContent=':root{--color-primary-50: #FDF2F5;--color-primary-100: #FAE5EB;--color-primary-200: #F2CCD7;--color-primary-300: #E9A8B8;--color-primary-400: #DD7A94;--color-primary-500: #8B1538;--color-primary-600: #6B1028;--color-primary-700: #5A0E23;--color-primary-800: #4A0C1D;--color-primary-900: #3D0A18;--color-gold-50: #FEFBF0;--color-gold-100: #FDF7E1;--color-gold-200: #FAEFC3;--color-gold-300: #F6E7A5;--color-gold-400: #F1DE87;--color-gold-500: #D4AF37;--color-gold-600: #B8941F;--color-gold-700: #9C7A18;--color-gold-800: #806010;--color-gold-900: #644609;--color-secondary-50: #EFF6FF;--color-secondary-100: #DBEAFE;--color-secondary-200: #BFDBFE;--color-secondary-300: #93C5FD;--color-secondary-400: #60A5FA;--color-secondary-500: #1E40AF;--color-secondary-600: #1E3A8A;--color-secondary-700: #1D4ED8;--color-secondary-800: #1E3A8A;--color-secondary-900: #1E3A8A;--color-success: #059669;--color-warning: #D97706;--color-error: #DC2626;--color-info: #0EA5E9;--color-neutral-50: #FAFAFA;--color-neutral-100: #F5F5F5;--color-neutral-200: #E5E5E5;--color-neutral-300: #D4D4D4;--color-neutral-400: #A3A3A3;--color-neutral-500: #737373;--color-neutral-600: #525252;--color-neutral-700: #404040;--color-neutral-800: #262626;--color-neutral-900: #171717;--color-dark-600: #475569;--color-dark-700: #334155;--color-dark-800: #1E293B;--color-dark-900: #0F172A;--font-family-primary: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;--font-family-display: "Cinzel", serif;--font-family-mono: "JetBrains Mono", Consolas, "Courier New", monospace;--font-size-h1: 3.5rem;--font-size-h2: 2.5rem;--font-size-h3: 2rem;--font-size-h4: 1.5rem;--font-size-h5: 1.25rem;--font-size-bodyLarge: 1.125rem;--font-size-body: 1rem;--font-size-bodySmall: .875rem;--font-size-caption: .75rem;--font-size-label: .875rem;--font-size-code: .875rem;--font-size-button: 1rem;--font-weight-light: 300;--font-weight-regular: 400;--font-weight-medium: 500;--font-weight-semibold: 600;--font-weight-bold: 700;--line-height-h1: 1.2;--line-height-h2: 1.3;--line-height-h3: 1.4;--line-height-h4: 1.5;--line-height-h5: 1.6;--line-height-bodyLarge: 1.7;--line-height-body: 1.6;--line-height-bodySmall: 1.5;--line-height-caption: 1.4;--line-height-label: 1.3;--line-height-code: 1.6;--line-height-button: 1.2;--letter-spacing-h1: -.025em;--letter-spacing-h2: -.02em;--letter-spacing-h3: -.015em;--letter-spacing-h4: -.01em;--letter-spacing-h5: normal;--letter-spacing-label: .05em;--space-xs: .25rem;--space-sm: .5rem;--space-md: 1rem;--space-lg: 1.5rem;--space-xl: 2rem;--space-2xl: 3rem;--space-3xl: 4rem;--duration-micro: .15s;--duration-local: .25s;--duration-page: .35s;--duration-complex: .6s;--easing-easeOut: cubic-bezier(0, 0, .2, 1);--easing-easeInOut: cubic-bezier(.4, 0, .6, 1);--easing-sharp: cubic-bezier(.4, 0, .6, 1);--easing-spring-gentle: cubic-bezier(.16, 1, .3, 1);--easing-spring-bouncy: cubic-bezier(.68, -.55, .265, 1.55);--easing-spring-firm: cubic-bezier(.2, 0, .38, .9);--shadow-sm: 0 2px 8px rgba(0, 0, 0, .05);--shadow-md: 0 4px 12px rgba(139, 21, 56, .2);--shadow-lg: 0 8px 24px rgba(139, 21, 56, .1);--shadow-xl: 0 20px 60px rgba(0, 0, 0, .3);--radius-sm: .5rem;--radius-md: .75rem;--radius-lg: 1rem;--radius-xl: 1.5rem;--breakpoint-mobile: 320px;--breakpoint-tablet: 768px;--breakpoint-desktop: 1024px;--breakpoint-wide: 1440px;--button-height: 3rem;--input-height: 3rem;--modal-backdrop: rgba(0, 0, 0, .6);--modal-backdrop-blur: 4px;--container-max-width: 1200px;--grid-gutter: 2rem;--grid-gutter-mobile: 1rem;--grid-gutter-tablet: 1.5rem}@media (max-width: 767px){:root{--font-size-h1: 2.5rem;--font-size-h2: 2rem;--font-size-h3: 1.75rem;--grid-gutter: var(--grid-gutter-mobile)}}@media (min-width: 768px) and (max-width: 1023px){:root{--font-size-h1: 3rem;--font-size-h2: 2.25rem;--grid-gutter: var(--grid-gutter-tablet)}}@media (prefers-color-scheme: dark){:root{--color-text-primary: var(--color-neutral-100);--color-text-secondary: var(--color-neutral-300);--color-background-primary: var(--color-dark-900);--color-background-secondary: var(--color-dark-800);--color-surface: var(--color-dark-700)}}@media (prefers-contrast: high){:root{--color-primary-500: #000000;--color-gold-500: #FFD700;--shadow-md: 0 4px 12px rgba(0, 0, 0, .8);--shadow-lg: 0 8px 24px rgba(0, 0, 0, .6)}}@media (prefers-reduced-motion: reduce){:root{--duration-micro: 0ms;--duration-local: 0ms;--duration-page: 0ms;--duration-complex: 0ms}}.btn{display:inline-flex;align-items:center;justify-content:center;height:var(--button-height);padding:0 var(--space-xl);border-radius:var(--radius-sm);font-family:var(--font-family-primary);font-size:var(--font-size-button);font-weight:var(--font-weight-semibold);line-height:var(--line-height-button);text-decoration:none;border:none;cursor:pointer;transition:all var(--duration-local) var(--easing-easeOut);min-width:44px;position:relative;overflow:hidden}.btn:disabled{opacity:.5;cursor:not-allowed;pointer-events:none}.btn:focus-visible{outline:2px solid var(--color-gold-500);outline-offset:2px}.btn-primary{background:linear-gradient(45deg,var(--color-primary-500),var(--color-primary-400));color:#fff;box-shadow:var(--shadow-md)}.btn-primary:hover:not(:disabled){transform:translateY(-2px);box-shadow:var(--shadow-lg)}.btn-primary:active:not(:disabled){transform:translateY(0);box-shadow:var(--shadow-sm)}.btn-secondary{background:transparent;color:var(--color-primary-500);border:2px solid var(--color-primary-500);box-shadow:var(--shadow-sm)}.btn-secondary:hover:not(:disabled){background:var(--color-primary-500);color:#fff;transform:translateY(-1px)}.btn-tertiary{background:transparent;color:var(--color-neutral-500);border:none;box-shadow:none}.btn-tertiary:hover:not(:disabled){background:var(--color-neutral-100);color:var(--color-neutral-700)}.btn-gold{background:linear-gradient(45deg,var(--color-gold-500),var(--color-gold-400));color:var(--color-neutral-900);box-shadow:var(--shadow-md)}.btn-gold:hover:not(:disabled){transform:translateY(-2px);box-shadow:var(--shadow-lg)}.btn-loading{color:transparent}.btn-loading:after{content:"";position:absolute;width:20px;height:20px;border:2px solid transparent;border-top-color:currentColor;border-radius:50%;animation:button-spinner .8s linear infinite}@keyframes button-spinner{to{transform:rotate(360deg)}}.form-group{margin-bottom:var(--space-lg)}.form-label{display:block;font-size:var(--font-size-label);font-weight:var(--font-weight-medium);line-height:var(--line-height-label);letter-spacing:var(--letter-spacing-label);color:var(--color-neutral-700);margin-bottom:var(--space-sm);text-transform:uppercase}.form-input,.form-select,.form-textarea{width:100%;height:var(--input-height);padding:0 var(--space-md);border:1px solid var(--color-neutral-300);border-radius:var(--radius-sm);background:var(--color-neutral-50);font-family:var(--font-family-primary);font-size:var(--font-size-body);line-height:var(--line-height-body);color:var(--color-neutral-700);transition:all var(--duration-local) var(--easing-easeOut)}.form-textarea{height:auto;min-height:8rem;padding:var(--space-md);resize:vertical;font-family:var(--font-family-mono);font-size:var(--font-size-code);line-height:var(--line-height-code)}.form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:var(--color-primary-500);border-width:2px;background:#fff;box-shadow:0 0 0 2px rgba(139,21,56,.1)}.form-input:focus-visible,.form-select:focus-visible,.form-textarea:focus-visible{outline:2px solid var(--color-gold-500);outline-offset:2px}.form-input.error,.form-select.error,.form-textarea.error{border-color:var(--color-error);background:rgba(220,38,38,.05)}.form-input.success,.form-select.success,.form-textarea.success{border-color:var(--color-success);background:rgba(5,150,105,.05)}.form-input:disabled,.form-select:disabled,.form-textarea:disabled{background:var(--color-neutral-200);color:var(--color-neutral-400);cursor:not-allowed}.form-help{display:block;font-size:var(--font-size-caption);line-height:var(--line-height-caption);margin-top:var(--space-xs);color:var(--color-neutral-500)}.form-error{display:block;font-size:var(--font-size-caption);line-height:var(--line-height-caption);margin-top:var(--space-xs);color:var(--color-error)}.card{background:var(--color-neutral-50);border:1px solid var(--color-neutral-200);border-radius:var(--radius-md);padding:var(--space-lg);box-shadow:var(--shadow-sm);transition:all var(--duration-local) var(--easing-easeOut)}.card-header{margin-bottom:var(--space-md);padding-bottom:var(--space-md);border-bottom:1px solid var(--color-neutral-200)}.card-title{font-family:var(--font-family-display);font-size:var(--font-size-h4);font-weight:var(--font-weight-semibold);line-height:var(--line-height-h4);color:var(--color-neutral-700);margin:0}.card-subtitle{font-size:var(--font-size-bodySmall);line-height:var(--line-height-bodySmall);color:var(--color-neutral-500);margin:var(--space-xs) 0 0 0}.card-body{margin-bottom:var(--space-md)}.card-footer{margin-top:var(--space-md);padding-top:var(--space-md);border-top:1px solid var(--color-neutral-200);display:flex;gap:var(--space-sm);justify-content:flex-end}.card-hero{background:linear-gradient(135deg,var(--color-neutral-50),var(--color-neutral-100));border:2px solid var(--color-gold-500);box-shadow:var(--shadow-lg)}.card-interactive{cursor:pointer}.card-interactive:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);border-color:var(--color-primary-300)}.card-interactive:focus-visible{outline:2px solid var(--color-gold-500);outline-offset:2px}.modal-backdrop{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--modal-backdrop);backdrop-filter:blur(var(--modal-backdrop-blur));z-index:1000;display:flex;align-items:center;justify-content:center;padding:var(--space-xl)}.modal-content{background:#fff;border-radius:var(--radius-lg);max-width:90vw;max-height:90vh;width:100%;max-width:600px;box-shadow:var(--shadow-xl);overflow:hidden;position:relative}.modal-header{padding:var(--space-xl);border-bottom:1px solid var(--color-neutral-200);display:flex;align-items:center;justify-content:space-between}.modal-title{font-family:var(--font-family-display);font-size:var(--font-size-h3);font-weight:var(--font-weight-semibold);line-height:var(--line-height-h3);color:var(--color-neutral-700);margin:0}.modal-close{background:none;border:none;font-size:var(--font-size-h4);cursor:pointer;color:var(--color-neutral-400);padding:var(--space-xs);border-radius:var(--radius-sm);transition:all var(--duration-micro) var(--easing-easeOut);min-width:44px;min-height:44px;display:flex;align-items:center;justify-content:center}.modal-close:hover{background:var(--color-neutral-100);color:var(--color-neutral-600)}.modal-body{padding:var(--space-xl);overflow-y:auto;max-height:calc(90vh - 200px)}.modal-footer{padding:var(--space-xl);border-top:1px solid var(--color-neutral-200);display:flex;gap:var(--space-sm);justify-content:flex-end}.disclosure{border:1px solid var(--color-neutral-200);border-radius:var(--radius-md);margin-bottom:var(--space-md);background:var(--color-neutral-50);box-shadow:var(--shadow-sm);overflow:hidden;transition:all var(--duration-local) var(--easing-easeOut)}.disclosure:hover{border-color:var(--color-neutral-300);box-shadow:var(--shadow-md)}.disclosure.expanded{border-color:var(--color-primary-200);box-shadow:var(--shadow-lg)}.disclosure-trigger{width:100%;background:none;border:none;padding:var(--space-lg);text-align:left;cursor:pointer;font-family:var(--font-family-primary);font-size:var(--font-size-body);font-weight:var(--font-weight-semibold);color:var(--color-neutral-700);display:flex;align-items:center;justify-content:space-between;gap:var(--space-md);transition:all var(--duration-local) var(--easing-easeOut);position:relative;min-height:44px}.disclosure-trigger:hover{background:var(--color-neutral-100);color:var(--color-neutral-800)}.disclosure-trigger:focus-visible{outline:2px solid var(--color-gold-500);outline-offset:-2px;background:var(--color-neutral-100);z-index:1}.disclosure-trigger:active{transform:translateY(1px)}.disclosure-trigger-content{display:flex;align-items:center;gap:var(--space-md);flex-grow:1;min-width:0}.disclosure-trigger-icon{flex-shrink:0;width:20px;height:20px;color:var(--color-primary-500);font-size:var(--font-size-bodyLarge)}.disclosure-trigger-title{font-weight:var(--font-weight-semibold);flex-grow:1;min-width:0}.disclosure-trigger-subtitle{font-size:var(--font-size-bodySmall);color:var(--color-neutral-500);margin-top:var(--space-xs)}.disclosure-trigger-badge{background:var(--color-gold-100);color:var(--color-gold-700);padding:var(--space-xs) var(--space-sm);border-radius:var(--radius-sm);font-size:var(--font-size-caption);font-weight:var(--font-weight-medium);flex-shrink:0}.disclosure-chevron{flex-shrink:0;width:24px;height:24px;color:var(--color-neutral-400);transition:all var(--duration-local) var(--easing-spring-gentle);transform-origin:center center;display:flex;align-items:center;justify-content:center;font-weight:var(--font-weight-bold)}.disclosure-chevron:before{content:"›";font-size:18px;line-height:1}.disclosure-trigger:hover .disclosure-chevron{color:var(--color-neutral-600)}.disclosure-trigger[aria-expanded=true] .disclosure-chevron{transform:rotate(90deg);color:var(--color-primary-500)}.disclosure-chevron.plus-minus:before{content:"+";font-size:16px}.disclosure-trigger[aria-expanded=true] .disclosure-chevron.plus-minus{transform:rotate(45deg)}.disclosure-content{border-top:1px solid var(--color-neutral-200);background:#fff;overflow:hidden;opacity:0;transform:translateY(-8px);transition:all var(--duration-page) var(--easing-spring-gentle)}.disclosure-content.expanded{opacity:1;transform:translateY(0)}.disclosure-content-inner{padding:var(--space-lg)}.disclosure-skills .disclosure-content-inner{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:var(--space-md)}.skill-group{background:var(--color-neutral-50);border:1px solid var(--color-neutral-200);border-radius:var(--radius-sm);padding:var(--space-md)}.skill-group-title{font-weight:var(--font-weight-semibold);color:var(--color-neutral-700);margin-bottom:var(--space-sm);font-size:var(--font-size-bodySmall);text-transform:uppercase;letter-spacing:var(--letter-spacing-label)}.skill-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:var(--space-xs)}.skill-item{display:flex;justify-content:space-between;align-items:center;font-size:var(--font-size-bodySmall)}.skill-name{color:var(--color-neutral-600)}.skill-modifier{font-weight:var(--font-weight-semibold);color:var(--color-primary-600);background:var(--color-primary-50);padding:var(--space-xs) var(--space-sm);border-radius:var(--radius-sm);font-size:var(--font-size-caption)}.skill-proficient{color:var(--color-gold-600)}.disclosure-equipment .disclosure-content-inner{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:var(--space-lg)}.equipment-category{background:var(--color-neutral-50);border:1px solid var(--color-neutral-200);border-radius:var(--radius-sm);padding:var(--space-md)}.equipment-category-title{font-weight:var(--font-weight-semibold);color:var(--color-neutral-700);margin-bottom:var(--space-md);display:flex;align-items:center;gap:var(--space-sm)}.equipment-category-icon{color:var(--color-primary-500);font-size:var(--font-size-bodyLarge)}.equipment-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:var(--space-sm)}.equipment-item{padding:var(--space-sm);background:#fff;border:1px solid var(--color-neutral-200);border-radius:var(--radius-sm)}.equipment-item-name{font-weight:var(--font-weight-medium);color:var(--color-neutral-700)}.equipment-item-details{font-size:var(--font-size-bodySmall);color:var(--color-neutral-500);margin-top:var(--space-xs)}.disclosure-spells .disclosure-content-inner{display:flex;flex-direction:column;gap:var(--space-lg)}.spell-level-group{background:var(--color-neutral-50);border:1px solid var(--color-neutral-200);border-radius:var(--radius-sm);padding:var(--space-md)}.spell-level-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-md)}.spell-level-title{font-weight:var(--font-weight-semibold);color:var(--color-neutral-700)}.spell-slots{display:flex;gap:var(--space-xs);align-items:center}.spell-slot{width:12px;height:12px;border:2px solid var(--color-primary-300);border-radius:50%;background:var(--color-primary-500)}.spell-slot.used{background:transparent}.spell-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:var(--space-sm);list-style:none;margin:0;padding:0}.spell-item{padding:var(--space-sm);background:#fff;border:1px solid var(--color-neutral-200);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--duration-local) var(--easing-easeOut)}.spell-item:hover{border-color:var(--color-primary-300);transform:translateY(-1px);box-shadow:var(--shadow-sm)}.spell-name{font-weight:var(--font-weight-medium);color:var(--color-neutral-700)}.spell-details{font-size:var(--font-size-bodySmall);color:var(--color-neutral-500);margin-top:var(--space-xs)}.disclosure-features .disclosure-content-inner{display:flex;flex-direction:column;gap:var(--space-md)}.feature-item{background:var(--color-neutral-50);border:1px solid var(--color-neutral-200);border-radius:var(--radius-sm);padding:var(--space-md)}.feature-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:var(--space-sm);gap:var(--space-md)}.feature-name{font-weight:var(--font-weight-semibold);color:var(--color-neutral-700);flex-grow:1}.feature-source{font-size:var(--font-size-caption);color:var(--color-neutral-500);background:var(--color-neutral-200);padding:var(--space-xs) var(--space-sm);border-radius:var(--radius-sm);flex-shrink:0}.feature-description{color:var(--color-neutral-600);line-height:var(--line-height-body)}.disclosure-loading{opacity:.7;pointer-events:none}.disclosure-content-loading{display:flex;align-items:center;justify-content:center;padding:var(--space-xl);color:var(--color-neutral-500);font-size:var(--font-size-bodySmall)}.disclosure-loading-spinner{width:20px;height:20px;border:2px solid var(--color-neutral-200);border-top-color:var(--color-primary-500);border-radius:50%;animation:disclosure-spinner .8s linear infinite;margin-right:var(--space-sm)}@keyframes disclosure-spinner{to{transform:rotate(360deg)}}.disclosure-error .disclosure-trigger{border-left:4px solid var(--color-error)}.disclosure-content-error{padding:var(--space-lg);color:var(--color-error);background:rgba(220,38,38,.05);border:1px solid var(--color-error);border-radius:var(--radius-sm);margin:var(--space-md)}.disclosure-group{border:1px solid var(--color-neutral-200);border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-sm)}.disclosure-group .disclosure{margin-bottom:0;border-radius:0;border-width:0 0 1px 0;box-shadow:none}.disclosure-group .disclosure:last-child{border-bottom:none}.disclosure-group-header{background:var(--color-primary-50);padding:var(--space-md) var(--space-lg);border-bottom:1px solid var(--color-primary-200);display:flex;justify-content:space-between;align-items:center}.disclosure-group-title{font-family:var(--font-family-display);font-size:var(--font-size-h5);font-weight:var(--font-weight-semibold);color:var(--color-neutral-700);margin:0}.disclosure-group-action{background:none;border:1px solid var(--color-primary-300);color:var(--color-primary-600);padding:var(--space-xs) var(--space-sm);border-radius:var(--radius-sm);font-size:var(--font-size-bodySmall);cursor:pointer;transition:all var(--duration-local) var(--easing-easeOut)}.disclosure-group-action:hover{background:var(--color-primary-100);border-color:var(--color-primary-400)}@media (max-width: 768px){.disclosure-trigger,.disclosure-content-inner{padding:var(--space-md)}.disclosure-skills .disclosure-content-inner,.disclosure-equipment .disclosure-content-inner,.spell-list{grid-template-columns:1fr}.disclosure-group-header{flex-direction:column;gap:var(--space-sm);align-items:flex-start}.disclosure-group-actions{width:100%;justify-content:stretch}.disclosure-group-action{flex:1;text-align:center}}@media (pointer: coarse){.disclosure-trigger{min-height:48px;padding:var(--space-lg)}.disclosure-chevron{width:32px;height:32px}.spell-item,.equipment-item{padding:var(--space-md)}}.progress-container{width:100%;height:8px;background:var(--color-neutral-200);border-radius:var(--radius-sm);overflow:hidden;position:relative}.progress-bar{height:100%;background:linear-gradient(90deg,var(--color-primary-500),var(--color-primary-400));border-radius:var(--radius-sm);transition:width var(--duration-complex) var(--easing-easeOut);position:relative;overflow:hidden}.progress-shimmer{position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);animation:progress-shimmer 2s ease-in-out infinite}@keyframes progress-shimmer{0%{transform:translate(-100%)}to{transform:translate(400%)}}.alert{padding:var(--space-md);border-radius:var(--radius-sm);margin-bottom:var(--space-md);border-left:4px solid;display:flex;align-items:flex-start;gap:var(--space-sm)}.alert-success{background:rgba(5,150,105,.1);border-left-color:var(--color-success);color:var(--color-success)}.alert-warning{background:rgba(217,119,6,.1);border-left-color:var(--color-warning);color:var(--color-warning)}.alert-error{background:rgba(220,38,38,.1);border-left-color:var(--color-error);color:var(--color-error)}.alert-info{background:rgba(14,165,233,.1);border-left-color:var(--color-info);color:var(--color-info)}.alert-icon{flex-shrink:0;width:20px;height:20px;margin-top:2px}.alert-content{flex-grow:1}.alert-title{font-weight:var(--font-weight-semibold);margin:0 0 var(--space-xs) 0}.alert-message{font-size:var(--font-size-bodySmall);line-height:var(--line-height-bodySmall);margin:0}.format-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:var(--space-lg);margin:var(--space-lg) 0}.format-card{border:2px solid var(--color-neutral-200);border-radius:var(--radius-md);padding:var(--space-lg);cursor:pointer;transition:all var(--duration-local) var(--easing-easeOut);position:relative;background:#fff;tabindex:0}.format-card:hover{border-color:var(--color-primary-300);transform:translateY(-2px);box-shadow:var(--shadow-md)}.format-card:focus-visible{outline:2px solid var(--color-gold-500);outline-offset:2px}.format-card.selected{border-color:var(--color-primary-500);background:var(--color-primary-50);box-shadow:var(--shadow-lg)}.format-card.selected:before{content:"✓";position:absolute;top:var(--space-sm);right:var(--space-sm);background:var(--color-primary-500);color:#fff;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700}.format-card-icon{font-size:var(--font-size-h3);margin-bottom:var(--space-sm);color:var(--color-primary-500)}.format-card-title{font-family:var(--font-family-display);font-size:var(--font-size-h5);font-weight:var(--font-weight-semibold);color:var(--color-neutral-700);margin:0 0 var(--space-xs) 0}.format-card-description{font-size:var(--font-size-bodySmall);color:var(--color-neutral-500);margin:0 0 var(--space-md) 0}.format-card-features{font-size:var(--font-size-caption);color:var(--color-neutral-400);margin:0}.nav-primary{height:4rem;background:var(--color-primary-500);color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 var(--space-xl)}.nav-brand{font-family:var(--font-family-display);font-size:var(--font-size-h4);font-weight:var(--font-weight-bold);color:var(--color-gold-500);text-decoration:none}.nav-links{display:flex;gap:var(--space-lg);list-style:none;margin:0;padding:0}.nav-link{color:#fff;text-decoration:none;font-weight:var(--font-weight-medium);padding:var(--space-sm) var(--space-md);border-radius:var(--radius-sm);transition:background-color var(--duration-micro) var(--easing-easeOut)}.nav-link:hover{background:rgba(255,255,255,.1)}.nav-link.active{color:var(--color-gold-500);background:rgba(255,255,255,.05)}.sr-only{position:absolute!important;width:1px!important;height:1px!important;padding:0!important;margin:-1px!important;overflow:hidden!important;clip:rect(0,0,0,0)!important;white-space:nowrap!important;border:0!important}.skip-link{position:absolute;top:-40px;left:6px;background:var(--color-primary-500);color:#fff;padding:8px;text-decoration:none;border-radius:var(--radius-sm);z-index:10000;transition:top var(--duration-local) var(--easing-easeOut)}.skip-link:focus{top:6px}@media (prefers-contrast: high){.btn{border:2px solid}.btn-primary,.btn-secondary{border-color:var(--color-primary-500)}.card,.form-input,.form-select,.form-textarea{border-width:2px}}@media (prefers-color-scheme: dark){.card,.form-input,.form-select,.form-textarea{background:var(--color-dark-700);border-color:var(--color-dark-600);color:var(--color-neutral-100)}.modal-content{background:var(--color-dark-800);color:var(--color-neutral-100)}.modal-header,.modal-footer{border-color:var(--color-dark-600)}}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:JetBrains Mono,Consolas,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}html{scroll-behavior:smooth}body{font-family:var(--font-family-primary);font-size:var(--font-size-body);line-height:var(--line-height-body);color:var(--color-neutral-700);background-color:var(--color-neutral-50);margin:0;padding:0;min-height:100vh}h1,h2,h3,h4,h5,h6{font-family:var(--font-family-display);color:var(--color-neutral-800);margin:0;font-weight:var(--font-weight-semibold)}h1{font-size:var(--font-size-h1);line-height:var(--line-height-h1);letter-spacing:var(--letter-spacing-h1)}h2{font-size:var(--font-size-h2);line-height:var(--line-height-h2);letter-spacing:var(--letter-spacing-h2)}h3{font-size:var(--font-size-h3);line-height:var(--line-height-h3);letter-spacing:var(--letter-spacing-h3)}h4{font-size:var(--font-size-h4);line-height:var(--line-height-h4);letter-spacing:var(--letter-spacing-h4)}h5{font-size:var(--font-size-h5);line-height:var(--line-height-h5);letter-spacing:var(--letter-spacing-h5)}p{margin:0 0 var(--space-md) 0;line-height:var(--line-height-body)}a{color:var(--color-primary-500);text-decoration:none;transition:color var(--duration-micro) var(--easing-easeOut)}a:hover{color:var(--color-primary-600);text-decoration:underline}a:focus-visible{outline:2px solid var(--color-gold-500);outline-offset:2px;border-radius:2px}button,a,input,select,textarea,[role=button],[tabindex]{min-height:44px;min-width:44px}main,#main,[role=main]{outline:none}[tabindex="-1"]:focus{outline:none}.container{width:100%}@media (min-width: 320px){.container{max-width:320px}}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1440px){.container{max-width:1440px}}@media (min-width: 1536px){.container{max-width:1536px}}.container{max-width:var(--container-max-width);margin:0 auto;padding:0 var(--grid-gutter)}.grid{display:grid;gap:var(--grid-gutter)}.stack{display:flex;flex-direction:column;gap:var(--space-md)}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.pointer-events-none{pointer-events:none}.pointer-events-auto{pointer-events:auto}.visible{visibility:visible}.collapse{visibility:collapse}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{top:0;right:0;bottom:0;left:0}.bottom-full{bottom:100%}.left-1\\/2{left:50%}.left-full{left:100%}.right-full{right:100%}.top-1\\/2{top:50%}.top-full{top:100%}.z-50{z-index:50}.col-span-full{grid-column:1 / -1}.mx-2{margin-left:.5rem;margin-right:.5rem}.mx-4{margin-left:1rem;margin-right:1rem}.mx-auto{margin-left:auto;margin-right:auto}.my-6{margin-top:1.5rem;margin-bottom:1.5rem}.mb-1{margin-bottom:.25rem}.mb-12{margin-bottom:3rem}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-1{margin-left:.25rem}.ml-2{margin-left:.5rem}.mr-1{margin-right:.25rem}.mr-2{margin-right:.5rem}.mr-3{margin-right:.75rem}.mt-0\\.5{margin-top:.125rem}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-3{margin-top:.75rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.grid{display:grid}.contents{display:contents}.hidden{display:none}.h-12{height:3rem}.h-16{height:4rem}.h-2{height:.5rem}.h-24{height:6rem}.h-3{height:.75rem}.h-32{height:8rem}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-8{height:2rem}.max-h-96{max-height:24rem}.max-h-\\[80vh\\]{max-height:80vh}.max-h-\\[calc\\(80vh-80px\\)\\]{max-height:calc(80vh - 80px)}.min-h-screen{min-height:100vh}.w-12{width:3rem}.w-16{width:4rem}.w-24{width:6rem}.w-3{width:.75rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-8{width:2rem}.w-full{width:100%}.min-w-0{min-width:0px}.max-w-2xl{max-width:42rem}.max-w-4xl{max-width:56rem}.max-w-6xl{max-width:72rem}.max-w-md{max-width:28rem}.flex-1{flex:1 1 0%}.flex-shrink-0{flex-shrink:0}.border-collapse{border-collapse:collapse}.-translate-x-1\\/2{--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-1\\/2{--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-0{--tw-translate-y: 0px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-2{--tw-translate-y: .5rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-rotate-90{--tw-rotate: -90deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-180{--tw-rotate: 180deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-100{--tw-scale-x: 1;--tw-scale-y: 1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-95{--tw-scale-x: .95;--tw-scale-y: .95;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes spin{to{transform:rotate(360deg)}}.animate-spin{animation:spin 1s linear infinite}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.cursor-wait{cursor:wait}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.resize-none{resize:none}.list-inside{list-style-position:inside}.list-disc{list-style-type:disc}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.space-x-1>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.25rem * var(--tw-space-x-reverse));margin-left:calc(.25rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.5rem * var(--tw-space-x-reverse));margin-left:calc(.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-3>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.75rem * var(--tw-space-x-reverse));margin-left:calc(.75rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-6>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(1.5rem * var(--tw-space-x-reverse));margin-left:calc(1.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-3>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.75rem * var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-y-6>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.whitespace-nowrap{white-space:nowrap}.break-all{word-break:break-all}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:1rem}.rounded-md{border-radius:.75rem}.rounded-xl{border-radius:1.5rem}.border{border-width:1px}.border-2{border-width:2px}.border-4{border-width:4px}.border-b{border-bottom-width:1px}.border-b-2{border-bottom-width:2px}.border-l-4{border-left-width:4px}.border-t{border-top-width:1px}.border-dashed{border-style:dashed}.border-blue-200{--tw-border-opacity: 1;border-color:rgb(191 219 254 / var(--tw-border-opacity, 1))}.border-blue-300{--tw-border-opacity: 1;border-color:rgb(147 197 253 / var(--tw-border-opacity, 1))}.border-blue-400{--tw-border-opacity: 1;border-color:rgb(96 165 250 / var(--tw-border-opacity, 1))}.border-blue-500{--tw-border-opacity: 1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.border-blue-600{--tw-border-opacity: 1;border-color:rgb(37 99 235 / var(--tw-border-opacity, 1))}.border-dnd-gold{--tw-border-opacity: 1;border-color:rgb(212 175 55 / var(--tw-border-opacity, 1))}.border-dnd-red{--tw-border-opacity: 1;border-color:rgb(139 21 56 / var(--tw-border-opacity, 1))}.border-error{--tw-border-opacity: 1;border-color:rgb(220 38 38 / var(--tw-border-opacity, 1))}.border-error\\/20{border-color:rgba(220,38,38,.2)}.border-error\\/30{border-color:rgba(220,38,38,.3)}.border-gray-200{--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-gray-300{--tw-border-opacity: 1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.border-gray-400{--tw-border-opacity: 1;border-color:rgb(156 163 175 / var(--tw-border-opacity, 1))}.border-gray-500{--tw-border-opacity: 1;border-color:rgb(107 114 128 / var(--tw-border-opacity, 1))}.border-gray-600{--tw-border-opacity: 1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1))}.border-green-200{--tw-border-opacity: 1;border-color:rgb(187 247 208 / var(--tw-border-opacity, 1))}.border-green-300{--tw-border-opacity: 1;border-color:rgb(134 239 172 / var(--tw-border-opacity, 1))}.border-green-500{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.border-green-600{--tw-border-opacity: 1;border-color:rgb(22 163 74 / var(--tw-border-opacity, 1))}.border-info{--tw-border-opacity: 1;border-color:rgb(14 165 233 / var(--tw-border-opacity, 1))}.border-neutral-200{--tw-border-opacity: 1;border-color:rgb(229 229 229 / var(--tw-border-opacity, 1))}.border-neutral-300{--tw-border-opacity: 1;border-color:rgb(212 212 212 / var(--tw-border-opacity, 1))}.border-neutral-400{--tw-border-opacity: 1;border-color:rgb(163 163 163 / var(--tw-border-opacity, 1))}.border-red-200{--tw-border-opacity: 1;border-color:rgb(254 202 202 / var(--tw-border-opacity, 1))}.border-red-300{--tw-border-opacity: 1;border-color:rgb(252 165 165 / var(--tw-border-opacity, 1))}.border-red-500{--tw-border-opacity: 1;border-color:rgb(239 68 68 / var(--tw-border-opacity, 1))}.border-red-600{--tw-border-opacity: 1;border-color:rgb(220 38 38 / var(--tw-border-opacity, 1))}.border-secondary-200{--tw-border-opacity: 1;border-color:rgb(191 219 254 / var(--tw-border-opacity, 1))}.border-success{--tw-border-opacity: 1;border-color:rgb(5 150 105 / var(--tw-border-opacity, 1))}.border-success\\/20{border-color:rgba(5,150,105,.2)}.border-success\\/30{border-color:rgba(5,150,105,.3)}.border-warning{--tw-border-opacity: 1;border-color:rgb(217 119 6 / var(--tw-border-opacity, 1))}.border-warning\\/20{border-color:rgba(217,119,6,.2)}.border-warning\\/30{border-color:rgba(217,119,6,.3)}.border-white{--tw-border-opacity: 1;border-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.border-yellow-200{--tw-border-opacity: 1;border-color:rgb(254 240 138 / var(--tw-border-opacity, 1))}.border-yellow-300{--tw-border-opacity: 1;border-color:rgb(253 224 71 / var(--tw-border-opacity, 1))}.border-yellow-500{--tw-border-opacity: 1;border-color:rgb(234 179 8 / var(--tw-border-opacity, 1))}.border-yellow-600{--tw-border-opacity: 1;border-color:rgb(202 138 4 / var(--tw-border-opacity, 1))}.border-opacity-30{--tw-border-opacity: .3}.bg-black{--tw-bg-opacity: 1;background-color:rgb(0 0 0 / var(--tw-bg-opacity, 1))}.bg-blue-100{--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-blue-50{--tw-bg-opacity: 1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.bg-blue-500{--tw-bg-opacity: 1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.bg-blue-600{--tw-bg-opacity: 1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-blue-800{--tw-bg-opacity: 1;background-color:rgb(30 64 175 / var(--tw-bg-opacity, 1))}.bg-blue-900{--tw-bg-opacity: 1;background-color:rgb(30 58 138 / var(--tw-bg-opacity, 1))}.bg-dark-800{--tw-bg-opacity: 1;background-color:rgb(30 41 59 / var(--tw-bg-opacity, 1))}.bg-dnd-dark{--tw-bg-opacity: 1;background-color:rgb(26 26 26 / var(--tw-bg-opacity, 1))}.bg-dnd-gold{--tw-bg-opacity: 1;background-color:rgb(212 175 55 / var(--tw-bg-opacity, 1))}.bg-dnd-red{--tw-bg-opacity: 1;background-color:rgb(139 21 56 / var(--tw-bg-opacity, 1))}.bg-error{--tw-bg-opacity: 1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.bg-error\\/10{background-color:rgba(220,38,38,.1)}.bg-error\\/5{background-color:rgba(220,38,38,.05)}.bg-gray-100{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.bg-gray-200{--tw-bg-opacity: 1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.bg-gray-300{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-gray-500{--tw-bg-opacity: 1;background-color:rgb(107 114 128 / var(--tw-bg-opacity, 1))}.bg-gray-600{--tw-bg-opacity: 1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.bg-gray-700{--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.bg-gray-800{--tw-bg-opacity: 1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bg-gray-900{--tw-bg-opacity: 1;background-color:rgb(17 24 39 / var(--tw-bg-opacity, 1))}.bg-green-100{--tw-bg-opacity: 1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.bg-green-50{--tw-bg-opacity: 1;background-color:rgb(240 253 244 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity: 1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-green-600{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-green-800{--tw-bg-opacity: 1;background-color:rgb(22 101 52 / var(--tw-bg-opacity, 1))}.bg-green-900{--tw-bg-opacity: 1;background-color:rgb(20 83 45 / var(--tw-bg-opacity, 1))}.bg-info\\/10{background-color:rgba(14,165,233,.1)}.bg-neutral-100{--tw-bg-opacity: 1;background-color:rgb(245 245 245 / var(--tw-bg-opacity, 1))}.bg-neutral-200{--tw-bg-opacity: 1;background-color:rgb(229 229 229 / var(--tw-bg-opacity, 1))}.bg-neutral-50{--tw-bg-opacity: 1;background-color:rgb(250 250 250 / var(--tw-bg-opacity, 1))}.bg-primary-500{--tw-bg-opacity: 1;background-color:rgb(139 21 56 / var(--tw-bg-opacity, 1))}.bg-red-100{--tw-bg-opacity: 1;background-color:rgb(254 226 226 / var(--tw-bg-opacity, 1))}.bg-red-50{--tw-bg-opacity: 1;background-color:rgb(254 242 242 / var(--tw-bg-opacity, 1))}.bg-red-500{--tw-bg-opacity: 1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-red-800{--tw-bg-opacity: 1;background-color:rgb(153 27 27 / var(--tw-bg-opacity, 1))}.bg-red-900{--tw-bg-opacity: 1;background-color:rgb(127 29 29 / var(--tw-bg-opacity, 1))}.bg-secondary-50{--tw-bg-opacity: 1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.bg-secondary-500{--tw-bg-opacity: 1;background-color:rgb(30 64 175 / var(--tw-bg-opacity, 1))}.bg-success{--tw-bg-opacity: 1;background-color:rgb(5 150 105 / var(--tw-bg-opacity, 1))}.bg-success\\/10{background-color:rgba(5,150,105,.1)}.bg-success\\/5{background-color:rgba(5,150,105,.05)}.bg-warning{--tw-bg-opacity: 1;background-color:rgb(217 119 6 / var(--tw-bg-opacity, 1))}.bg-warning\\/10{background-color:rgba(217,119,6,.1)}.bg-warning\\/5{background-color:rgba(217,119,6,.05)}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-yellow-100{--tw-bg-opacity: 1;background-color:rgb(254 249 195 / var(--tw-bg-opacity, 1))}.bg-yellow-50{--tw-bg-opacity: 1;background-color:rgb(254 252 232 / var(--tw-bg-opacity, 1))}.bg-yellow-500{--tw-bg-opacity: 1;background-color:rgb(234 179 8 / var(--tw-bg-opacity, 1))}.bg-yellow-800{--tw-bg-opacity: 1;background-color:rgb(133 77 14 / var(--tw-bg-opacity, 1))}.bg-yellow-900{--tw-bg-opacity: 1;background-color:rgb(113 63 18 / var(--tw-bg-opacity, 1))}.bg-opacity-10{--tw-bg-opacity: .1}.bg-opacity-20{--tw-bg-opacity: .2}.bg-opacity-50{--tw-bg-opacity: .5}.bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.from-error\\/80{--tw-gradient-from: rgb(220 38 38 / .8) var(--tw-gradient-from-position);--tw-gradient-to: rgb(220 38 38 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-neutral-400{--tw-gradient-from: #A3A3A3 var(--tw-gradient-from-position);--tw-gradient-to: rgb(163 163 163 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-secondary-400{--tw-gradient-from: #60A5FA var(--tw-gradient-from-position);--tw-gradient-to: rgb(96 165 250 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-success\\/80{--tw-gradient-from: rgb(5 150 105 / .8) var(--tw-gradient-from-position);--tw-gradient-to: rgb(5 150 105 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-warning\\/80{--tw-gradient-from: rgb(217 119 6 / .8) var(--tw-gradient-from-position);--tw-gradient-to: rgb(217 119 6 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.to-error{--tw-gradient-to: #DC2626 var(--tw-gradient-to-position)}.to-neutral-500{--tw-gradient-to: #737373 var(--tw-gradient-to-position)}.to-secondary-500{--tw-gradient-to: #1E40AF var(--tw-gradient-to-position)}.to-success{--tw-gradient-to: #059669 var(--tw-gradient-to-position)}.to-warning{--tw-gradient-to: #D97706 var(--tw-gradient-to-position)}.stroke-gray-200{stroke:#e5e7eb}.p-2{padding:.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-2\\.5{padding-left:.625rem;padding-right:.625rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-0\\.5{padding-top:.125rem;padding-bottom:.125rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\\.5{padding-top:.375rem;padding-bottom:.375rem}.py-12{padding-top:3rem;padding-bottom:3rem}.py-16{padding-top:4rem;padding-bottom:4rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-8{padding-top:2rem;padding-bottom:2rem}.pt-6{padding-top:1.5rem}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.font-cinzel{font-family:Cinzel,serif}.font-mono{font-family:JetBrains Mono,Consolas,Courier New,monospace}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.lowercase{text-transform:lowercase}.italic{font-style:italic}.leading-relaxed{line-height:1.625}.text-blue-200{--tw-text-opacity: 1;color:rgb(191 219 254 / var(--tw-text-opacity, 1))}.text-blue-400{--tw-text-opacity: 1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.text-blue-500{--tw-text-opacity: 1;color:rgb(59 130 246 / var(--tw-text-opacity, 1))}.text-blue-600{--tw-text-opacity: 1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-blue-700{--tw-text-opacity: 1;color:rgb(29 78 216 / var(--tw-text-opacity, 1))}.text-blue-800{--tw-text-opacity: 1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.text-dnd-gold{--tw-text-opacity: 1;color:rgb(212 175 55 / var(--tw-text-opacity, 1))}.text-error{--tw-text-opacity: 1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.text-gray-200{--tw-text-opacity: 1;color:rgb(229 231 235 / var(--tw-text-opacity, 1))}.text-gray-300{--tw-text-opacity: 1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity: 1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity: 1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity: 1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity: 1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity: 1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-gray-900{--tw-text-opacity: 1;color:rgb(17 24 39 / var(--tw-text-opacity, 1))}.text-green-200{--tw-text-opacity: 1;color:rgb(187 247 208 / var(--tw-text-opacity, 1))}.text-green-400{--tw-text-opacity: 1;color:rgb(74 222 128 / var(--tw-text-opacity, 1))}.text-green-500{--tw-text-opacity: 1;color:rgb(34 197 94 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity: 1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.text-green-700{--tw-text-opacity: 1;color:rgb(21 128 61 / var(--tw-text-opacity, 1))}.text-green-800{--tw-text-opacity: 1;color:rgb(22 101 52 / var(--tw-text-opacity, 1))}.text-info{--tw-text-opacity: 1;color:rgb(14 165 233 / var(--tw-text-opacity, 1))}.text-neutral-500{--tw-text-opacity: 1;color:rgb(115 115 115 / var(--tw-text-opacity, 1))}.text-neutral-600{--tw-text-opacity: 1;color:rgb(82 82 82 / var(--tw-text-opacity, 1))}.text-neutral-700{--tw-text-opacity: 1;color:rgb(64 64 64 / var(--tw-text-opacity, 1))}.text-orange-400{--tw-text-opacity: 1;color:rgb(251 146 60 / var(--tw-text-opacity, 1))}.text-orange-500{--tw-text-opacity: 1;color:rgb(249 115 22 / var(--tw-text-opacity, 1))}.text-red-200{--tw-text-opacity: 1;color:rgb(254 202 202 / var(--tw-text-opacity, 1))}.text-red-400{--tw-text-opacity: 1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.text-red-500{--tw-text-opacity: 1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.text-red-600{--tw-text-opacity: 1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.text-red-700{--tw-text-opacity: 1;color:rgb(185 28 28 / var(--tw-text-opacity, 1))}.text-red-800{--tw-text-opacity: 1;color:rgb(153 27 27 / var(--tw-text-opacity, 1))}.text-secondary-500{--tw-text-opacity: 1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.text-secondary-600{--tw-text-opacity: 1;color:rgb(30 58 138 / var(--tw-text-opacity, 1))}.text-success{--tw-text-opacity: 1;color:rgb(5 150 105 / var(--tw-text-opacity, 1))}.text-warning{--tw-text-opacity: 1;color:rgb(217 119 6 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-yellow-200{--tw-text-opacity: 1;color:rgb(254 240 138 / var(--tw-text-opacity, 1))}.text-yellow-400{--tw-text-opacity: 1;color:rgb(250 204 21 / var(--tw-text-opacity, 1))}.text-yellow-500{--tw-text-opacity: 1;color:rgb(234 179 8 / var(--tw-text-opacity, 1))}.text-yellow-600{--tw-text-opacity: 1;color:rgb(202 138 4 / var(--tw-text-opacity, 1))}.text-yellow-700{--tw-text-opacity: 1;color:rgb(161 98 7 / var(--tw-text-opacity, 1))}.text-yellow-800{--tw-text-opacity: 1;color:rgb(133 77 14 / var(--tw-text-opacity, 1))}.underline{text-decoration-line:underline}.no-underline{text-decoration-line:none}.placeholder-gray-400::-moz-placeholder{--tw-placeholder-opacity: 1;color:rgb(156 163 175 / var(--tw-placeholder-opacity, 1))}.placeholder-gray-400::placeholder{--tw-placeholder-opacity: 1;color:rgb(156 163 175 / var(--tw-placeholder-opacity, 1))}.opacity-0{opacity:0}.opacity-100{opacity:1}.opacity-50{opacity:.5}.opacity-75{opacity:.75}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow: 0 8px 24px rgba(139, 21, 56, .1);--tw-shadow-colored: 0 8px 24px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow: 0 2px 8px rgba(0, 0, 0, .05);--tw-shadow-colored: 0 2px 8px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-xl{--tw-shadow: 0 20px 60px rgba(0, 0, 0, .3);--tw-shadow-colored: 0 20px 60px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.outline{outline-style:solid}.blur{--tw-blur: blur(8px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-filter{backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-150{transition-duration:.15s}.duration-200{transition-duration:.2s}.duration-300{transition-duration:.3s}.duration-500{transition-duration:.5s}.ease-in{transition-timing-function:cubic-bezier(.4,0,1,1)}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.ease-out{transition-timing-function:cubic-bezier(0,0,.2,1)}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.hardware-accelerated{transform:translateZ(0);will-change:transform}@keyframes fade-in{0%{opacity:0}to{opacity:1}}@keyframes slide-up{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes scale-in{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:var(--color-neutral-100);border-radius:var(--radius-sm)}::-webkit-scrollbar-thumb{background:var(--color-neutral-400);border-radius:var(--radius-sm);-webkit-transition:background-color var(--duration-micro) var(--easing-easeOut);transition:background-color var(--duration-micro) var(--easing-easeOut)}::-webkit-scrollbar-thumb:hover{background:var(--color-neutral-500)}*{scrollbar-width:thin;scrollbar-color:var(--color-neutral-400) var(--color-neutral-100)}.character-converter{padding:var(--space-xl)}.character-preview{background:#fff;border:1px solid var(--color-neutral-200);border-radius:var(--radius-md);padding:var(--space-lg);margin-top:var(--space-lg)}.character-preview-header{display:flex;align-items:center;justify-content:between;margin-bottom:var(--space-lg);padding-bottom:var(--space-md);border-bottom:1px solid var(--color-neutral-200)}.character-preview-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:var(--space-md);margin-bottom:var(--space-lg)}.stat-item{background:var(--color-neutral-50);padding:var(--space-md);border-radius:var(--radius-sm);border-left:4px solid var(--color-primary-500)}.stat-label{font-size:var(--font-size-label);font-weight:var(--font-weight-medium);color:var(--color-neutral-500);margin-bottom:var(--space-xs);text-transform:uppercase;letter-spacing:var(--letter-spacing-label)}.stat-value{font-size:var(--font-size-h4);font-weight:var(--font-weight-semibold);color:var(--color-neutral-700)}.performance-dashboard{position:fixed;bottom:var(--space-md);right:var(--space-md);background:var(--color-dark-800);color:#fff;padding:var(--space-sm);border-radius:var(--radius-sm);font-family:var(--font-family-mono);font-size:var(--font-size-caption);z-index:999;opacity:.8;transition:opacity var(--duration-micro) var(--easing-easeOut)}.performance-dashboard:hover{opacity:1}.performance-metrics{display:flex;gap:var(--space-sm)}.metric-item{text-align:center}.metric-good{color:var(--color-success)}.metric-warning{color:var(--color-warning)}.metric-error{color:var(--color-error)}.btn-primary{background:#3b82f6;color:#fff;border:1px solid #3b82f6;padding:.5rem 1rem;border-radius:.375rem;font-weight:500;cursor:pointer;transition:all .15s ease;display:inline-flex;align-items:center;gap:.25rem}.btn-primary:hover{background:#2563eb;border-color:#2563eb}.btn-secondary{background:#f3f4f6;color:#374151;border:1px solid #d1d5db;padding:.5rem 1rem;border-radius:.375rem;font-weight:500;cursor:pointer;transition:all .15s ease;display:inline-flex;align-items:center;gap:.25rem}.btn-secondary:hover{background:#e5e7eb;border-color:#9ca3af}.btn-success{background:#10b981;color:#fff;border:1px solid #10b981;padding:.5rem 1rem;border-radius:.375rem;font-weight:500;cursor:pointer;transition:all .15s ease;display:inline-flex;align-items:center;gap:.25rem}.btn-success:hover{background:#059669;border-color:#059669}@media (max-width: 767px){.container{padding:0 var(--grid-gutter-mobile)}.character-preview-stats,.format-cards{grid-template-columns:1fr}.nav-links{flex-direction:column;gap:var(--space-sm)}.modal-content{margin:var(--space-sm);max-width:calc(100vw - var(--space-lg))}}@media (min-width: 768px) and (max-width: 1023px){.container{padding:0 var(--grid-gutter-tablet)}.format-cards{grid-template-columns:repeat(2,1fr)}}@media print{.performance-dashboard,.modal-backdrop,button,.btn{display:none!important}.character-preview{border:2px solid var(--color-neutral-800);box-shadow:none}a{color:var(--color-neutral-800)!important;text-decoration:underline}}.disclosure{border:1px solid var(--color-neutral-200);border-radius:var(--radius-md);overflow:hidden;transition:all var(--duration-local) var(--easing-easeOut)}.disclosure.expanded{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.disclosure-trigger{width:100%;padding:var(--space-md);background:var(--color-neutral-50);border:none;cursor:pointer;text-align:left;transition:background-color var(--duration-micro) var(--easing-easeOut);display:flex;align-items:center;justify-content:space-between}.disclosure-trigger:hover{background:var(--color-neutral-100)}.disclosure-trigger:focus{outline:2px solid var(--color-gold-500);outline-offset:-2px;background:var(--color-neutral-100)}.disclosure-trigger-content{display:flex;align-items:center;gap:var(--space-sm);flex:1}.disclosure-trigger-icon{font-size:var(--font-size-h4);min-width:2rem}.disclosure-trigger-title{font-size:var(--font-size-h5);font-weight:var(--font-weight-semibold);color:var(--color-neutral-800)}.disclosure-trigger-subtitle{font-size:var(--font-size-caption);color:var(--color-neutral-500);margin-top:var(--space-xs)}.disclosure-trigger-badge{background:var(--color-primary-100);color:var(--color-primary-700);padding:var(--space-xs) var(--space-sm);border-radius:var(--radius-full);font-size:var(--font-size-caption);font-weight:var(--font-weight-medium)}.disclosure-chevron{transition:transform var(--duration-local) var(--easing-easeOut);color:var(--color-neutral-500)}.disclosure.expanded .disclosure-chevron{transform:rotate(180deg)}.disclosure-chevron.plus-minus:before{content:"+";font-weight:700}.disclosure.expanded .disclosure-chevron.plus-minus:before{content:"−"}.disclosure-content{border-top:1px solid var(--color-neutral-200);background:#fff}.disclosure-content-inner{padding:var(--space-md)}.disclosure-content-loading{padding:var(--space-xl);text-align:center;color:var(--color-neutral-500)}.disclosure-content-error{padding:var(--space-md);background:var(--color-error-50);color:var(--color-error-700);border-left:4px solid var(--color-error-500)}.disclosure-loading-spinner{display:inline-block;width:1rem;height:1rem;border:2px solid var(--color-neutral-300);border-top:2px solid var(--color-primary-500);border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.character-preview-container{max-width:100%}.disclosure-group{display:flex;flex-direction:column;gap:var(--space-sm)}.disclosure-group-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--space-md);padding-bottom:var(--space-sm);border-bottom:1px solid var(--color-neutral-200)}.disclosure-group-title{font-size:var(--font-size-h4);font-weight:var(--font-weight-semibold);color:var(--color-neutral-800)}.disclosure-group-actions{display:flex;gap:var(--space-sm)}.disclosure-group-action{padding:var(--space-xs) var(--space-sm);background:var(--color-neutral-100);border:1px solid var(--color-neutral-300);border-radius:var(--radius-sm);font-size:var(--font-size-caption);cursor:pointer;transition:all var(--duration-micro) var(--easing-easeOut)}.disclosure-group-action:hover{background:var(--color-neutral-200)}.disclosure-group-action:disabled{opacity:.5;cursor:not-allowed}.format-card{border:1px solid var(--color-neutral-200);border-radius:var(--radius-md);padding:var(--space-md);cursor:pointer;transition:all var(--duration-local) var(--easing-easeOut);background:#fff}.format-card:hover{transform:translateY(-2px);box-shadow:0 8px 25px -8px rgba(0,0,0,.15);border-color:var(--color-neutral-300)}.format-card.selected{border-color:var(--color-primary-500);background:var(--color-primary-50);box-shadow:0 4px 6px -1px rgba(0,0,0,.1)}.compatibility-bar{height:4px;background:linear-gradient(90deg,#ef4444,#f59e0b,#10b981);border-radius:var(--radius-sm);overflow:hidden}.format-recommendation-badge{padding:var(--space-xs) var(--space-sm);border-radius:var(--radius-full);font-size:var(--font-size-caption);font-weight:var(--font-weight-medium);border:1px solid}.format-recommendation-badge.excellent{background:var(--color-success-50);color:var(--color-success-700);border-color:var(--color-success-300)}.format-recommendation-badge.good{background:var(--color-primary-50);color:var(--color-primary-700);border-color:var(--color-primary-300)}.format-recommendation-badge.fair{background:var(--color-warning-50);color:var(--color-warning-700);border-color:var(--color-warning-300)}.format-recommendation-badge.poor{background:var(--color-error-50);color:var(--color-error-700);border-color:var(--color-error-300)}.validation-indicator{display:inline-flex;align-items:center;gap:var(--space-xs);padding:var(--space-xs) var(--space-sm);border-radius:var(--radius-sm);font-size:var(--font-size-caption);font-weight:var(--font-weight-medium)}.validation-indicator.success{background:var(--color-success-50);color:var(--color-success-700);border:1px solid var(--color-success-300)}.validation-indicator.warning{background:var(--color-warning-50);color:var(--color-warning-700);border:1px solid var(--color-warning-300)}.validation-indicator.error{background:var(--color-error-50);color:var(--color-error-700);border:1px solid var(--color-error-300)}.validation-progress{width:100%;height:8px;background:var(--color-neutral-200);border-radius:var(--radius-full);overflow:hidden}.validation-progress-bar{height:100%;transition:width var(--duration-page) var(--easing-easeOut);border-radius:var(--radius-full)}.validation-progress-bar.success{background:linear-gradient(90deg,var(--color-success-400),var(--color-success-500))}.validation-progress-bar.warning{background:linear-gradient(90deg,var(--color-warning-400),var(--color-warning-500))}.validation-progress-bar.error{background:linear-gradient(90deg,var(--color-error-400),var(--color-error-500))}.disclosure-enter{opacity:0;transform:translateY(-10px)}.disclosure-enter-active{opacity:1;transform:translateY(0);transition:all var(--duration-local) var(--easing-spring-gentle)}.disclosure-leave{opacity:1;transform:translateY(0)}.disclosure-leave-active{opacity:0;transform:translateY(-10px);transition:all var(--duration-micro) var(--easing-easeIn)}.modal-enter{opacity:0;transform:scale(.95)}.modal-enter-active{opacity:1;transform:scale(1);transition:all var(--duration-local) var(--easing-spring-gentle)}.modal-leave{opacity:1;transform:scale(1)}.modal-leave-active{opacity:0;transform:scale(.95);transition:all var(--duration-micro) var(--easing-easeIn)}@media (prefers-color-scheme: dark){body{background-color:var(--color-dark-900);color:var(--color-neutral-100)}.app-header{background:var(--color-dark-800);border-bottom:1px solid var(--color-dark-700)}.app-footer{background:var(--color-dark-800);color:var(--color-neutral-300)}.character-preview{background:var(--color-dark-800);border-color:var(--color-dark-600);color:var(--color-neutral-100)}.stat-item{background:var(--color-dark-700);border-left-color:var(--color-gold-500)}.disclosure{border-color:var(--color-dark-600)}.disclosure-trigger{background:var(--color-dark-700);color:var(--color-neutral-100)}.disclosure-trigger:hover{background:var(--color-dark-600)}.disclosure-content,.format-card{background:var(--color-dark-800);border-color:var(--color-dark-600);color:var(--color-neutral-100)}.format-card.selected{background:var(--color-dark-700);border-color:var(--color-gold-500)}::-webkit-scrollbar-track{background:var(--color-dark-700)}::-webkit-scrollbar-thumb{background:var(--color-dark-600)}::-webkit-scrollbar-thumb:hover{background:var(--color-dark-500)}}.last\\:mb-0:last-child{margin-bottom:0}.hover\\:border-gray-300:hover{--tw-border-opacity: 1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.hover\\:border-gray-400:hover{--tw-border-opacity: 1;border-color:rgb(156 163 175 / var(--tw-border-opacity, 1))}.hover\\:bg-blue-100:hover{--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.hover\\:bg-blue-600:hover{--tw-bg-opacity: 1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.hover\\:bg-blue-700:hover{--tw-bg-opacity: 1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\\:bg-error\\/10:hover{background-color:rgba(220,38,38,.1)}.hover\\:bg-gray-100:hover{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.hover\\:bg-gray-50:hover{--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.hover\\:bg-gray-600:hover{--tw-bg-opacity: 1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\\:bg-gray-700:hover{--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.hover\\:bg-green-100:hover{--tw-bg-opacity: 1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.hover\\:bg-green-600:hover{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.hover\\:bg-green-700:hover{--tw-bg-opacity: 1;background-color:rgb(21 128 61 / var(--tw-bg-opacity, 1))}.hover\\:bg-neutral-100:hover{--tw-bg-opacity: 1;background-color:rgb(245 245 245 / var(--tw-bg-opacity, 1))}.hover\\:bg-neutral-200:hover{--tw-bg-opacity: 1;background-color:rgb(229 229 229 / var(--tw-bg-opacity, 1))}.hover\\:bg-neutral-50:hover{--tw-bg-opacity: 1;background-color:rgb(250 250 250 / var(--tw-bg-opacity, 1))}.hover\\:bg-primary-600:hover{--tw-bg-opacity: 1;background-color:rgb(107 16 40 / var(--tw-bg-opacity, 1))}.hover\\:bg-red-100:hover{--tw-bg-opacity: 1;background-color:rgb(254 226 226 / var(--tw-bg-opacity, 1))}.hover\\:bg-red-700:hover{--tw-bg-opacity: 1;background-color:rgb(185 28 28 / var(--tw-bg-opacity, 1))}.hover\\:bg-secondary-600:hover{--tw-bg-opacity: 1;background-color:rgb(30 58 138 / var(--tw-bg-opacity, 1))}.hover\\:bg-success\\/10:hover{background-color:rgba(5,150,105,.1)}.hover\\:bg-warning\\/10:hover{background-color:rgba(217,119,6,.1)}.hover\\:bg-yellow-100:hover{--tw-bg-opacity: 1;background-color:rgb(254 249 195 / var(--tw-bg-opacity, 1))}.hover\\:bg-yellow-500:hover{--tw-bg-opacity: 1;background-color:rgb(234 179 8 / var(--tw-bg-opacity, 1))}.hover\\:text-blue-800:hover{--tw-text-opacity: 1;color:rgb(30 64 175 / var(--tw-text-opacity, 1))}.hover\\:text-dnd-gold:hover{--tw-text-opacity: 1;color:rgb(212 175 55 / var(--tw-text-opacity, 1))}.hover\\:text-red-300:hover{--tw-text-opacity: 1;color:rgb(252 165 165 / var(--tw-text-opacity, 1))}.hover\\:text-white:hover{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.hover\\:text-yellow-300:hover{--tw-text-opacity: 1;color:rgb(253 224 71 / var(--tw-text-opacity, 1))}.hover\\:opacity-80:hover{opacity:.8}.hover\\:opacity-90:hover{opacity:.9}.focus\\:border-transparent:focus{border-color:transparent}.focus\\:ring-2:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\\:ring-4:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(4px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\\:ring-blue-500:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(59 130 246 / var(--tw-ring-opacity, 1))}.focus\\:ring-dnd-gold:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(212 175 55 / var(--tw-ring-opacity, 1))}.focus\\:ring-error\\/20:focus{--tw-ring-color: rgb(220 38 38 / .2)}.focus\\:ring-neutral-200:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(229 229 229 / var(--tw-ring-opacity, 1))}.focus\\:ring-primary-200:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(242 204 215 / var(--tw-ring-opacity, 1))}.focus\\:ring-secondary-200:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(191 219 254 / var(--tw-ring-opacity, 1))}.focus\\:ring-success\\/20:focus{--tw-ring-color: rgb(5 150 105 / .2)}.focus\\:ring-warning\\/20:focus{--tw-ring-color: rgb(217 119 6 / .2)}.disabled\\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\\:bg-gray-300:disabled{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity, 1))}.disabled\\:opacity-50:disabled{opacity:.5}@media (min-width: 768px){.md\\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.md\\:grid-cols-6{grid-template-columns:repeat(6,minmax(0,1fr))}}@media (min-width: 1024px){.lg\\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.lg\\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.lg\\:flex-row{flex-direction:row}}\n/*$vite$:1*/',document.head.appendChild(e);var r,a,o,n,i=!1,s=!1,l=[],c=-1;function d(e){var t;t=e,l.includes(t)||l.push(t),s||i||(i=!0,queueMicrotask(p))}function u(e){let t=l.indexOf(e);-1!==t&&t>c&&l.splice(t,1)}function p(){i=!1,s=!0;for(let e=0;e<l.length;e++)l[e](),c=e;l.length=0,c=-1,s=!1}var g=!0;function m(e){a=e}function h(e,t){let r,n=!0,i=a(()=>{let a=e();JSON.stringify(a),n?r=a:queueMicrotask(()=>{t(a,r),r=a}),n=!1});return()=>o(i)}var f=[],b=[],v=[];function y(e,t){"function"==typeof t?(e._x_cleanups||(e._x_cleanups=[]),e._x_cleanups.push(t)):(t=e,b.push(t))}function w(e){f.push(e)}function x(e,t,r){e._x_attributeCleanups||(e._x_attributeCleanups={}),e._x_attributeCleanups[t]||(e._x_attributeCleanups[t]=[]),e._x_attributeCleanups[t].push(r)}function S(e,t){e._x_attributeCleanups&&Object.entries(e._x_attributeCleanups).forEach(([r,a])=>{(void 0===t||t.includes(r))&&(a.forEach(e=>e()),delete e._x_attributeCleanups[r])})}var k=new MutationObserver(L),C=!1;function _(){k.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),C=!0}function E(){!function(){let e=k.takeRecords();F.push(()=>e.length>0&&L(e));let t=F.length;queueMicrotask(()=>{if(F.length===t)for(;F.length>0;)F.shift()()})}(),k.disconnect(),C=!1}var F=[];function $(e){if(!C)return e();E();let t=e();return _(),t}var A=!1,D=[];function L(e){if(A)return void(D=D.concat(e));let t=[],r=new Set,a=new Map,o=new Map;for(let n=0;n<e.length;n++)if(!e[n].target._x_ignoreMutationObserver&&("childList"===e[n].type&&(e[n].removedNodes.forEach(e=>{1===e.nodeType&&e._x_marker&&r.add(e)}),e[n].addedNodes.forEach(e=>{1===e.nodeType&&(r.has(e)?r.delete(e):e._x_marker||t.push(e))})),"attributes"===e[n].type)){let t=e[n].target,r=e[n].attributeName,i=e[n].oldValue,s=()=>{a.has(t)||a.set(t,[]),a.get(t).push({name:r,value:t.getAttribute(r)})},l=()=>{o.has(t)||o.set(t,[]),o.get(t).push(r)};t.hasAttribute(r)&&null===i?s():t.hasAttribute(r)?(l(),s()):l()}o.forEach((e,t)=>{S(t,e)}),a.forEach((e,t)=>{f.forEach(r=>r(t,e))});for(let n of r)t.some(e=>e.contains(n))||b.forEach(e=>e(n));for(let n of t)n.isConnected&&v.forEach(e=>e(n));t=null,r=null,a=null,o=null}function M(e){return z(T(e))}function I(e,t,r){return e._x_dataStack=[t,...T(r||e)],()=>{e._x_dataStack=e._x_dataStack.filter(e=>e!==t)}}function T(e){return e._x_dataStack?e._x_dataStack:"function"==typeof ShadowRoot&&e instanceof ShadowRoot?T(e.host):e.parentNode?T(e.parentNode):[]}function z(e){return new Proxy({objects:e},P)}var P={ownKeys:({objects:e})=>Array.from(new Set(e.flatMap(e=>Object.keys(e)))),has:({objects:e},t)=>t!=Symbol.unscopables&&e.some(e=>Object.prototype.hasOwnProperty.call(e,t)||Reflect.has(e,t)),get:({objects:e},t,r)=>"toJSON"==t?R:Reflect.get(e.find(e=>Reflect.has(e,t))||{},t,r),set({objects:e},t,r,a){const o=e.find(e=>Object.prototype.hasOwnProperty.call(e,t))||e[e.length-1],n=Object.getOwnPropertyDescriptor(o,t);return n?.set&&n?.get?n.set.call(a,r)||!0:Reflect.set(o,t,r)}};function R(){return Reflect.ownKeys(this).reduce((e,t)=>(e[t]=Reflect.get(this,t),e),{})}function N(e){let t=(r,a="")=>{Object.entries(Object.getOwnPropertyDescriptors(r)).forEach(([o,{value:n,enumerable:i}])=>{if(!1===i||void 0===n)return;if("object"==typeof n&&null!==n&&n.__v_skip)return;let s=""===a?o:`${a}.${o}`;var l;"object"==typeof n&&null!==n&&n._x_interceptor?r[o]=n.initialize(e,s,o):"object"!=typeof(l=n)||Array.isArray(l)||null===l||n===r||n instanceof Element||t(n,s)})};return t(e)}function O(e,t=()=>{}){let r={initialValue:void 0,_x_interceptor:!0,initialize(t,r,a){return e(this.initialValue,()=>function(e,t){return t.split(".").reduce((e,t)=>e[t],e)}(t,r),e=>j(t,r,e),r,a)}};return t(r),e=>{if("object"==typeof e&&null!==e&&e._x_interceptor){let t=r.initialize.bind(r);r.initialize=(a,o,n)=>{let i=e.initialize(a,o,n);return r.initialValue=i,t(a,o,n)}}else r.initialValue=e;return r}}function j(e,t,r){if("string"==typeof t&&(t=t.split(".")),1!==t.length){if(0===t.length)throw error;return e[t[0]]||(e[t[0]]={}),j(e[t[0]],t.slice(1),r)}e[t[0]]=r}var B={};function X(e,t){B[e]=t}function U(e,t){let r=function(e){let[t,r]=ce(e),a={interceptor:O,...t};return y(e,r),a}(t);return Object.entries(B).forEach(([a,o])=>{Object.defineProperty(e,`$${a}`,{get:()=>o(t,r),enumerable:!1})}),e}function W(e,t,r,...a){try{return r(...a)}catch(o){q(o,e,t)}}function q(e,t,r=void 0){e=Object.assign(e??{message:"No error message given."},{el:t,expression:r}),console.warn(`Alpine Expression Error: ${e.message}\n\n${r?'Expression: "'+r+'"\n\n':""}`,t),setTimeout(()=>{throw e},0)}var V=!0;function H(e){let t=V;V=!1;let r=e();return V=t,r}function G(e,t,r={}){let a;return Y(e,t)(e=>a=e,r),a}function Y(...e){return K(...e)}var K=J;function J(e,t){let r={};U(r,e);let a=[r,...T(e)],o="function"==typeof t?function(e,t){return(r=()=>{},{scope:a={},params:o=[]}={})=>{Z(r,t.apply(z([a,...e]),o))}}(a,t):function(e,t,r){let a=function(e,t){if(Q[e])return Q[e];let r=Object.getPrototypeOf(async function(){}).constructor,a=/^[\n\s]*if.*\(.*\)/.test(e.trim())||/^(let|const)\s/.test(e.trim())?`(async()=>{ ${e} })()`:e;const o=()=>{try{let t=new r(["__self","scope"],`with (scope) { __self.result = ${a} }; __self.finished = true; return __self.result;`);return Object.defineProperty(t,"name",{value:`[Alpine] ${e}`}),t}catch(o){return q(o,t,e),Promise.resolve()}};let n=o();return Q[e]=n,n}(t,r);return(o=()=>{},{scope:n={},params:i=[]}={})=>{a.result=void 0,a.finished=!1;let s=z([n,...e]);if("function"==typeof a){let e=a(a,s).catch(e=>q(e,r,t));a.finished?(Z(o,a.result,s,i,r),a.result=void 0):e.then(e=>{Z(o,e,s,i,r)}).catch(e=>q(e,r,t)).finally(()=>a.result=void 0)}}}(a,t,e);return W.bind(null,e,t,o)}var Q={};function Z(e,t,r,a,o){if(V&&"function"==typeof t){let n=t.apply(r,a);n instanceof Promise?n.then(t=>Z(e,t,r,a)).catch(e=>q(e,o,t)):e(n)}else"object"==typeof t&&t instanceof Promise?t.then(t=>e(t)):e(t)}var ee="x-";function te(e=""){return ee+e}var re={};function ae(e,t){return re[e]=t,{before(t){if(!re[t])return void console.warn(String.raw`Cannot find directive \`${t}\`. \`${e}\` will use the default order of execution`);const r=be.indexOf(t);be.splice(r>=0?r:be.indexOf("DEFAULT"),0,e)}}}function oe(e,t,r){if(t=Array.from(t),e._x_virtualDirectives){let r=Object.entries(e._x_virtualDirectives).map(([e,t])=>({name:e,value:t})),a=ne(r);r=r.map(e=>a.find(t=>t.name===e.name)?{name:`x-bind:${e.name}`,value:`"${e.value}"`}:e),t=t.concat(r)}let a={},o=t.map(ue((e,t)=>a[e]=t)).filter(me).map(function(e,t){return({name:r,value:a})=>{let o=r.match(he()),n=r.match(/:([a-zA-Z0-9\-_:]+)/),i=r.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],s=t||e[r]||r;return{type:o?o[1]:null,value:n?n[1]:null,modifiers:i.map(e=>e.replace(".","")),expression:a,original:s}}}(a,r)).sort(ve);return o.map(t=>function(e,t){let r=()=>{},a=re[t.type]||r,[o,n]=ce(e);x(e,t.original,n);let i=()=>{e._x_ignore||e._x_ignoreSelf||(a.inline&&a.inline(e,t,o),a=a.bind(a,e,t,o),ie?se.get(le).push(a):a())};return i.runCleanups=n,i}(e,t))}function ne(e){return Array.from(e).map(ue()).filter(e=>!me(e))}var ie=!1,se=new Map,le=Symbol();function ce(e){let t=[],[r,n]=function(e){let t=()=>{};return[r=>{let n=a(r);return e._x_effects||(e._x_effects=new Set,e._x_runEffects=()=>{e._x_effects.forEach(e=>e())}),e._x_effects.add(n),t=()=>{void 0!==n&&(e._x_effects.delete(n),o(n))},n},()=>{t()}]}(e);return t.push(n),[{Alpine:bt,effect:r,cleanup:e=>t.push(e),evaluateLater:Y.bind(Y,e),evaluate:G.bind(G,e)},()=>t.forEach(e=>e())]}var de=(e,t)=>({name:r,value:a})=>(r.startsWith(e)&&(r=r.replace(e,t)),{name:r,value:a});function ue(e=()=>{}){return({name:t,value:r})=>{let{name:a,value:o}=pe.reduce((e,t)=>t(e),{name:t,value:r});return a!==t&&e(a,t),{name:a,value:o}}}var pe=[];function ge(e){pe.push(e)}function me({name:e}){return he().test(e)}var he=()=>new RegExp(`^${ee}([^:^.]+)\\b`),fe="DEFAULT",be=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",fe,"teleport"];function ve(e,t){let r=-1===be.indexOf(e.type)?fe:e.type,a=-1===be.indexOf(t.type)?fe:t.type;return be.indexOf(r)-be.indexOf(a)}function ye(e,t,r={}){e.dispatchEvent(new CustomEvent(t,{detail:r,bubbles:!0,composed:!0,cancelable:!0}))}function we(e,t){if("function"==typeof ShadowRoot&&e instanceof ShadowRoot)return void Array.from(e.children).forEach(e=>we(e,t));let r=!1;if(t(e,()=>r=!0),r)return;let a=e.firstElementChild;for(;a;)we(a,t),a=a.nextElementSibling}function xe(e,...t){console.warn(`Alpine Warning: ${e}`,...t)}var Se=!1,ke=[],Ce=[];function _e(){return ke.map(e=>e())}function Ee(){return ke.concat(Ce).map(e=>e())}function Fe(e){ke.push(e)}function $e(e){Ce.push(e)}function Ae(e,t=!1){return De(e,e=>{if((t?Ee():_e()).some(t=>e.matches(t)))return!0})}function De(e,t){if(e){if(t(e))return e;if(e._x_teleportBack&&(e=e._x_teleportBack),e.parentElement)return De(e.parentElement,t)}}var Le=[],Me=1;function Ie(e,t=we,r=()=>{}){De(e,e=>e._x_ignore)||function(e){ie=!0;let t=Symbol();le=t,se.set(t,[]);let r=()=>{for(;se.get(t).length;)se.get(t).shift()();se.delete(t)};e(r),ie=!1,r()}(()=>{t(e,(e,t)=>{e._x_marker||(r(e,t),Le.forEach(r=>r(e,t)),oe(e,e.attributes).forEach(e=>e()),e._x_ignore||(e._x_marker=Me++),e._x_ignore&&t())})})}function Te(e,t=we){t(e,e=>{!function(e){for(e._x_effects?.forEach(u);e._x_cleanups?.length;)e._x_cleanups.pop()()}(e),S(e),delete e._x_marker})}var ze=[],Pe=!1;function Re(e=()=>{}){return queueMicrotask(()=>{Pe||setTimeout(()=>{Ne()})}),new Promise(t=>{ze.push(()=>{e(),t()})})}function Ne(){for(Pe=!1;ze.length;)ze.shift()()}function Oe(e,t){return Array.isArray(t)?je(e,t.join(" ")):"object"==typeof t&&null!==t?function(e,t){let r=e=>e.split(" ").filter(Boolean),a=Object.entries(t).flatMap(([e,t])=>!!t&&r(e)).filter(Boolean),o=Object.entries(t).flatMap(([e,t])=>!t&&r(e)).filter(Boolean),n=[],i=[];return o.forEach(t=>{e.classList.contains(t)&&(e.classList.remove(t),i.push(t))}),a.forEach(t=>{e.classList.contains(t)||(e.classList.add(t),n.push(t))}),()=>{i.forEach(t=>e.classList.add(t)),n.forEach(t=>e.classList.remove(t))}}(e,t):"function"==typeof t?Oe(e,t()):je(e,t)}function je(e,t){return t=!0===t?t="":t||"",r=t.split(" ").filter(t=>!e.classList.contains(t)).filter(Boolean),e.classList.add(...r),()=>{e.classList.remove(...r)};var r}function Be(e,t){return"object"==typeof t&&null!==t?function(e,t){let r={};return Object.entries(t).forEach(([t,a])=>{r[t]=e.style[t],t.startsWith("--")||(t=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()),e.style.setProperty(t,a)}),setTimeout(()=>{0===e.style.length&&e.removeAttribute("style")}),()=>{Be(e,r)}}(e,t):function(e,t){let r=e.getAttribute("style",t);return e.setAttribute("style",t),()=>{e.setAttribute("style",r||"")}}(e,t)}function Xe(e,t=()=>{}){let r=!1;return function(){r?t.apply(this,arguments):(r=!0,e.apply(this,arguments))}}function Ue(e,t,r={}){e._x_transition||(e._x_transition={enter:{during:r,start:r,end:r},leave:{during:r,start:r,end:r},in(r=()=>{},a=()=>{}){qe(e,t,{during:this.enter.during,start:this.enter.start,end:this.enter.end},r,a)},out(r=()=>{},a=()=>{}){qe(e,t,{during:this.leave.during,start:this.leave.start,end:this.leave.end},r,a)}})}function We(e){let t=e.parentNode;if(t)return t._x_hidePromise?t:We(t)}function qe(e,t,{during:r,start:a,end:o}={},n=()=>{},i=()=>{}){if(e._x_transitioning&&e._x_transitioning.cancel(),0===Object.keys(r).length&&0===Object.keys(a).length&&0===Object.keys(o).length)return n(),void i();let s,l,c;!function(e,t){let r,a,o,n=Xe(()=>{$(()=>{r=!0,a||t.before(),o||(t.end(),Ne()),t.after(),e.isConnected&&t.cleanup(),delete e._x_transitioning})});e._x_transitioning={beforeCancels:[],beforeCancel(e){this.beforeCancels.push(e)},cancel:Xe(function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();n()}),finish:n},$(()=>{t.start(),t.during()}),Pe=!0,requestAnimationFrame(()=>{if(r)return;let n=1e3*Number(getComputedStyle(e).transitionDuration.replace(/,.*/,"").replace("s","")),i=1e3*Number(getComputedStyle(e).transitionDelay.replace(/,.*/,"").replace("s",""));0===n&&(n=1e3*Number(getComputedStyle(e).animationDuration.replace("s",""))),$(()=>{t.before()}),a=!0,requestAnimationFrame(()=>{r||($(()=>{t.end()}),Ne(),setTimeout(e._x_transitioning.finish,n+i),o=!0)})})}(e,{start(){s=t(e,a)},during(){l=t(e,r)},before:n,end(){s(),c=t(e,o)},after:i,cleanup(){l(),c()}})}function Ve(e,t,r){if(-1===e.indexOf(t))return r;const a=e[e.indexOf(t)+1];if(!a)return r;if("scale"===t&&isNaN(a))return r;if("duration"===t||"delay"===t){let e=a.match(/([0-9]+)ms/);if(e)return e[1]}return"origin"===t&&["top","right","left","center","bottom"].includes(e[e.indexOf(t)+2])?[a,e[e.indexOf(t)+2]].join(" "):a}ae("transition",(e,{value:t,modifiers:r,expression:a},{evaluate:o})=>{"function"==typeof a&&(a=o(a)),!1!==a&&(a&&"boolean"!=typeof a?function(e,t,r){Ue(e,Oe,"");let a={enter:t=>{e._x_transition.enter.during=t},"enter-start":t=>{e._x_transition.enter.start=t},"enter-end":t=>{e._x_transition.enter.end=t},leave:t=>{e._x_transition.leave.during=t},"leave-start":t=>{e._x_transition.leave.start=t},"leave-end":t=>{e._x_transition.leave.end=t}};a[r](t)}(e,a,t):function(e,t,r){Ue(e,Be);let a=!t.includes("in")&&!t.includes("out")&&!r,o=a||t.includes("in")||["enter"].includes(r),n=a||t.includes("out")||["leave"].includes(r);t.includes("in")&&!a&&(t=t.filter((e,r)=>r<t.indexOf("out"))),t.includes("out")&&!a&&(t=t.filter((e,r)=>r>t.indexOf("out")));let i=!t.includes("opacity")&&!t.includes("scale"),s=i||t.includes("opacity"),l=i||t.includes("scale"),c=s?0:1,d=l?Ve(t,"scale",95)/100:1,u=Ve(t,"delay",0)/1e3,p=Ve(t,"origin","center"),g="opacity, transform",m=Ve(t,"duration",150)/1e3,h=Ve(t,"duration",75)/1e3,f="cubic-bezier(0.4, 0.0, 0.2, 1)";o&&(e._x_transition.enter.during={transformOrigin:p,transitionDelay:`${u}s`,transitionProperty:g,transitionDuration:`${m}s`,transitionTimingFunction:f},e._x_transition.enter.start={opacity:c,transform:`scale(${d})`},e._x_transition.enter.end={opacity:1,transform:"scale(1)"}),n&&(e._x_transition.leave.during={transformOrigin:p,transitionDelay:`${u}s`,transitionProperty:g,transitionDuration:`${h}s`,transitionTimingFunction:f},e._x_transition.leave.start={opacity:1,transform:"scale(1)"},e._x_transition.leave.end={opacity:c,transform:`scale(${d})`})}(e,r,t))}),window.Element.prototype._x_toggleAndCascadeWithTransitions=function(e,t,r,a){const o="visible"===document.visibilityState?requestAnimationFrame:setTimeout;let n=()=>o(r);t?e._x_transition&&(e._x_transition.enter||e._x_transition.leave)?e._x_transition.enter&&(Object.entries(e._x_transition.enter.during).length||Object.entries(e._x_transition.enter.start).length||Object.entries(e._x_transition.enter.end).length)?e._x_transition.in(r):n():e._x_transition?e._x_transition.in(r):n():(e._x_hidePromise=e._x_transition?new Promise((t,r)=>{e._x_transition.out(()=>{},()=>t(a)),e._x_transitioning&&e._x_transitioning.beforeCancel(()=>r({isFromCancelledTransition:!0}))}):Promise.resolve(a),queueMicrotask(()=>{let t=We(e);t?(t._x_hideChildren||(t._x_hideChildren=[]),t._x_hideChildren.push(e)):o(()=>{let t=e=>{let r=Promise.all([e._x_hidePromise,...(e._x_hideChildren||[]).map(t)]).then(([e])=>e?.());return delete e._x_hidePromise,delete e._x_hideChildren,r};t(e).catch(e=>{if(!e.isFromCancelledTransition)throw e})})}))};var He=!1;function Ge(e,t=()=>{}){return(...r)=>He?t(...r):e(...r)}var Ye=[];function Ke(e){Ye.push(e)}var Je=!1;function Qe(e){let t=a;m((e,r)=>{let a=t(e);return o(a),()=>{}}),e(),m(t)}function Ze(e,t,a,o=[]){switch(e._x_bindings||(e._x_bindings=r({})),e._x_bindings[t]=a,t=o.includes("camel")?t.toLowerCase().replace(/-(\w)/g,(e,t)=>t.toUpperCase()):t){case"value":!function(e,t){if(st(e))void 0===e.attributes.value&&(e.value=t),window.fromModel&&(e.checked="boolean"==typeof t?rt(e.value)===t:tt(e.value,t));else if(it(e))Number.isInteger(t)?e.value=t:Array.isArray(t)||"boolean"==typeof t||[null,void 0].includes(t)?Array.isArray(t)?e.checked=t.some(t=>tt(t,e.value)):e.checked=!!t:e.value=String(t);else if("SELECT"===e.tagName)!function(e,t){const r=[].concat(t).map(e=>e+"");Array.from(e.options).forEach(e=>{e.selected=r.includes(e.value)})}(e,t);else{if(e.value===t)return;e.value=void 0===t?"":t}}(e,a);break;case"style":!function(e,t){e._x_undoAddedStyles&&e._x_undoAddedStyles(),e._x_undoAddedStyles=Be(e,t)}(e,a);break;case"class":!function(e,t){e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedClasses=Oe(e,t)}(e,a);break;case"selected":case"checked":!function(e,t,r){et(e,t,r),function(e,t,r){e[t]!==r&&(e[t]=r)}(e,t,r)}(e,t,a);break;default:et(e,t,a)}}function et(e,t,r){[null,void 0,!1].includes(r)&&function(e){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(e)}(t)?e.removeAttribute(t):(ot(t)&&(r=t),function(e,t,r){e.getAttribute(t)!=r&&e.setAttribute(t,r)}(e,t,r))}function tt(e,t){return e==t}function rt(e){return!![1,"1","true","on","yes",!0].includes(e)||![0,"0","false","off","no",!1].includes(e)&&(e?Boolean(e):null)}var at=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","shadowrootclonable","shadowrootdelegatesfocus","shadowrootserializable"]);function ot(e){return at.has(e)}function nt(e,t,r){let a=e.getAttribute(t);return null===a?"function"==typeof r?r():r:""===a||(ot(t)?!![t,"true"].includes(a):a)}function it(e){return"checkbox"===e.type||"ui-checkbox"===e.localName||"ui-switch"===e.localName}function st(e){return"radio"===e.type||"ui-radio"===e.localName}function lt(e,t){var r;return function(){var a=this,o=arguments;clearTimeout(r),r=setTimeout(function(){r=null,e.apply(a,o)},t)}}function ct(e,t){let r;return function(){let a=this,o=arguments;r||(e.apply(a,o),r=!0,setTimeout(()=>r=!1,t))}}function dt({get:e,set:t},{get:r,set:n}){let i,s=!0,l=a(()=>{let a=e(),o=r();if(s)n(ut(a)),s=!1;else{let e=JSON.stringify(a),r=JSON.stringify(o);e!==i?n(ut(a)):e!==r&&t(ut(o))}i=JSON.stringify(e()),JSON.stringify(r())});return()=>{o(l)}}function ut(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e}var pt={},gt=!1,mt={};function ht(e,t,r){let a=[];for(;a.length;)a.pop()();let o=Object.entries(t).map(([e,t])=>({name:e,value:t})),n=ne(o);return o=o.map(e=>n.find(t=>t.name===e.name)?{name:`x-bind:${e.name}`,value:`"${e.value}"`}:e),oe(e,o,r).map(e=>{a.push(e.runCleanups),e()}),()=>{for(;a.length;)a.pop()()}}var ft={},bt={get reactive(){return r},get release(){return o},get effect(){return a},get raw(){return n},version:"3.14.9",flushAndStopDeferringMutations:function(){A=!1,L(D),D=[]},dontAutoEvaluateFunctions:H,disableEffectScheduling:function(e){g=!1,e(),g=!0},startObservingMutations:_,stopObservingMutations:E,setReactivityEngine:function(e){r=e.reactive,o=e.release,a=t=>e.effect(t,{scheduler:e=>{g?d(e):e()}}),n=e.raw},onAttributeRemoved:x,onAttributesAdded:w,closestDataStack:T,skipDuringClone:Ge,onlyDuringClone:function(e){return(...t)=>He&&e(...t)},addRootSelector:Fe,addInitSelector:$e,interceptClone:Ke,addScopeToNode:I,deferMutations:function(){A=!0},mapAttributes:ge,evaluateLater:Y,interceptInit:function(e){Le.push(e)},setEvaluator:function(e){K=e},mergeProxies:z,extractProp:function(e,t,r,a=!0){if(e._x_bindings&&void 0!==e._x_bindings[t])return e._x_bindings[t];if(e._x_inlineBindings&&void 0!==e._x_inlineBindings[t]){let r=e._x_inlineBindings[t];return r.extract=a,H(()=>G(e,r.expression))}return nt(e,t,r)},findClosest:De,onElRemoved:y,closestRoot:Ae,destroyTree:Te,interceptor:O,transition:qe,setStyles:Be,mutateDom:$,directive:ae,entangle:dt,throttle:ct,debounce:lt,evaluate:G,initTree:Ie,nextTick:Re,prefixed:te,prefix:function(e){ee=e},plugin:function(e){(Array.isArray(e)?e:[e]).forEach(e=>e(bt))},magic:X,store:function(e,t){if(gt||(pt=r(pt),gt=!0),void 0===t)return pt[e];pt[e]=t,N(pt[e]),"object"==typeof t&&null!==t&&t.hasOwnProperty("init")&&"function"==typeof t.init&&pt[e].init()},start:function(){var e;Se&&xe("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),Se=!0,document.body||xe("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),ye(document,"alpine:init"),ye(document,"alpine:initializing"),_(),e=e=>Ie(e,we),v.push(e),y(e=>Te(e)),w((e,t)=>{oe(e,t).forEach(e=>e())}),Array.from(document.querySelectorAll(Ee().join(","))).filter(e=>!Ae(e.parentElement,!0)).forEach(e=>{Ie(e)}),ye(document,"alpine:initialized"),setTimeout(()=>{[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach(([e,t,r])=>{var a;a=t,Object.keys(re).includes(a)||r.some(t=>{if(document.querySelector(t))return xe(`found "${t}", but missing ${e} plugin`),!0})})})},clone:function(e,t){t._x_dataStack||(t._x_dataStack=e._x_dataStack),He=!0,Je=!0,Qe(()=>{!function(e){let t=!1;Ie(e,(e,r)=>{we(e,(e,a)=>{if(t&&function(e){return _e().some(t=>e.matches(t))}(e))return a();t=!0,r(e,a)})})}(t)}),He=!1,Je=!1},cloneNode:function(e,t){Ye.forEach(r=>r(e,t)),He=!0,Qe(()=>{Ie(t,(e,t)=>{t(e,()=>{})})}),He=!1},bound:function(e,t,r){return e._x_bindings&&void 0!==e._x_bindings[t]?e._x_bindings[t]:nt(e,t,r)},$data:M,watch:h,walk:we,data:function(e,t){ft[e]=t},bind:function(e,t){let r="function"!=typeof t?()=>t:t;return e instanceof Element?ht(e,r()):(mt[e]=r,()=>{})}};function vt(e,t){const r=Object.create(null),a=e.split(",");for(let o=0;o<a.length;o++)r[a[o]]=!0;return e=>!!r[e]}var yt,wt=Object.freeze({}),xt=Object.prototype.hasOwnProperty,St=(e,t)=>xt.call(e,t),kt=Array.isArray,Ct=e=>"[object Map]"===$t(e),_t=e=>"symbol"==typeof e,Et=e=>null!==e&&"object"==typeof e,Ft=Object.prototype.toString,$t=e=>Ft.call(e),At=e=>$t(e).slice(8,-1),Dt=e=>"string"==typeof e&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,Lt=(e=>{const t=Object.create(null);return r=>t[r]||(t[r]=e(r))})(e=>e.charAt(0).toUpperCase()+e.slice(1)),Mt=(e,t)=>e!==t&&(e==e||t==t),It=new WeakMap,Tt=[],zt=Symbol("iterate"),Pt=Symbol("Map key iterate"),Rt=0;function Nt(e){const{deps:t}=e;if(t.length){for(let r=0;r<t.length;r++)t[r].delete(e);t.length=0}}var Ot=!0,jt=[];function Bt(){const e=jt.pop();Ot=void 0===e||e}function Xt(e,t,r){if(!Ot||void 0===yt)return;let a=It.get(e);a||It.set(e,a=new Map);let o=a.get(r);o||a.set(r,o=new Set),o.has(yt)||(o.add(yt),yt.deps.push(o),yt.options.onTrack&&yt.options.onTrack({effect:yt,target:e,type:t,key:r}))}function Ut(e,t,r,a,o,n){const i=It.get(e);if(!i)return;const s=new Set,l=e=>{e&&e.forEach(e=>{(e!==yt||e.allowRecurse)&&s.add(e)})};if("clear"===t)i.forEach(l);else if("length"===r&&kt(e))i.forEach((e,t)=>{("length"===t||t>=a)&&l(e)});else switch(void 0!==r&&l(i.get(r)),t){case"add":kt(e)?Dt(r)&&l(i.get("length")):(l(i.get(zt)),Ct(e)&&l(i.get(Pt)));break;case"delete":kt(e)||(l(i.get(zt)),Ct(e)&&l(i.get(Pt)));break;case"set":Ct(e)&&l(i.get(zt))}s.forEach(i=>{i.options.onTrigger&&i.options.onTrigger({effect:i,target:e,key:r,type:t,newValue:a,oldValue:o,oldTarget:n}),i.options.scheduler?i.options.scheduler(i):i()})}var Wt=vt("__proto__,__v_isRef,__isVue"),qt=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(_t)),Vt=Kt(),Ht=Kt(!0),Gt=Yt();function Yt(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...e){const r=Dr(this);for(let t=0,o=this.length;t<o;t++)Xt(r,"get",t+"");const a=r[t](...e);return-1===a||!1===a?r[t](...e.map(Dr)):a}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...e){jt.push(Ot),Ot=!1;const r=Dr(this)[t].apply(this,e);return Bt(),r}}),e}function Kt(e=!1,t=!1){return function(r,a,o){if("__v_isReactive"===a)return!e;if("__v_isReadonly"===a)return e;if("__v_raw"===a&&o===(e?t?Er:_r:t?Cr:kr).get(r))return r;const n=kt(r);if(!e&&n&&St(Gt,a))return Reflect.get(Gt,a,o);const i=Reflect.get(r,a,o);return(_t(a)?qt.has(a):Wt(a))?i:(e||Xt(r,"get",a),t?i:Lr(i)?n&&Dt(a)?i:i.value:Et(i)?e?$r(i):Fr(i):i)}}function Jt(e=!1){return function(t,r,a,o){let n=t[r];if(!e&&(a=Dr(a),n=Dr(n),!kt(t)&&Lr(n)&&!Lr(a)))return n.value=a,!0;const i=kt(t)&&Dt(r)?Number(r)<t.length:St(t,r),s=Reflect.set(t,r,a,o);return t===Dr(o)&&(i?Mt(a,n)&&Ut(t,"set",r,a,n):Ut(t,"add",r,a)),s}}var Qt={get:Vt,set:Jt(),deleteProperty:function(e,t){const r=St(e,t),a=e[t],o=Reflect.deleteProperty(e,t);return o&&r&&Ut(e,"delete",t,void 0,a),o},has:function(e,t){const r=Reflect.has(e,t);return _t(t)&&qt.has(t)||Xt(e,"has",t),r},ownKeys:function(e){return Xt(e,"iterate",kt(e)?"length":zt),Reflect.ownKeys(e)}},Zt={get:Ht,set:(e,t)=>(console.warn(`Set operation on key "${String(t)}" failed: target is readonly.`,e),!0),deleteProperty:(e,t)=>(console.warn(`Delete operation on key "${String(t)}" failed: target is readonly.`,e),!0)},er=e=>Et(e)?Fr(e):e,tr=e=>Et(e)?$r(e):e,rr=e=>e,ar=e=>Reflect.getPrototypeOf(e);function or(e,t,r=!1,a=!1){const o=Dr(e=e.__v_raw),n=Dr(t);t!==n&&!r&&Xt(o,"get",t),!r&&Xt(o,"get",n);const{has:i}=ar(o),s=a?rr:r?tr:er;return i.call(o,t)?s(e.get(t)):i.call(o,n)?s(e.get(n)):void(e!==o&&e.get(t))}function nr(e,t=!1){const r=this.__v_raw,a=Dr(r),o=Dr(e);return e!==o&&!t&&Xt(a,"has",e),!t&&Xt(a,"has",o),e===o?r.has(e):r.has(e)||r.has(o)}function ir(e,t=!1){return e=e.__v_raw,!t&&Xt(Dr(e),"iterate",zt),Reflect.get(e,"size",e)}function sr(e){e=Dr(e);const t=Dr(this);return ar(t).has.call(t,e)||(t.add(e),Ut(t,"add",e,e)),this}function lr(e,t){t=Dr(t);const r=Dr(this),{has:a,get:o}=ar(r);let n=a.call(r,e);n?Sr(r,a,e):(e=Dr(e),n=a.call(r,e));const i=o.call(r,e);return r.set(e,t),n?Mt(t,i)&&Ut(r,"set",e,t,i):Ut(r,"add",e,t),this}function cr(e){const t=Dr(this),{has:r,get:a}=ar(t);let o=r.call(t,e);o?Sr(t,r,e):(e=Dr(e),o=r.call(t,e));const n=a?a.call(t,e):void 0,i=t.delete(e);return o&&Ut(t,"delete",e,void 0,n),i}function dr(){const e=Dr(this),t=0!==e.size,r=Ct(e)?new Map(e):new Set(e),a=e.clear();return t&&Ut(e,"clear",void 0,void 0,r),a}function ur(e,t){return function(r,a){const o=this,n=o.__v_raw,i=Dr(n),s=t?rr:e?tr:er;return!e&&Xt(i,"iterate",zt),n.forEach((e,t)=>r.call(a,s(e),s(t),o))}}function pr(e,t,r){return function(...a){const o=this.__v_raw,n=Dr(o),i=Ct(n),s="entries"===e||e===Symbol.iterator&&i,l="keys"===e&&i,c=o[e](...a),d=r?rr:t?tr:er;return!t&&Xt(n,"iterate",l?Pt:zt),{next(){const{value:e,done:t}=c.next();return t?{value:e,done:t}:{value:s?[d(e[0]),d(e[1])]:d(e),done:t}},[Symbol.iterator](){return this}}}}function gr(e){return function(...t){{const r=t[0]?`on key "${t[0]}" `:"";console.warn(`${Lt(e)} operation ${r}failed: target is readonly.`,Dr(this))}return"delete"!==e&&this}}function mr(){const e={get(e){return or(this,e)},get size(){return ir(this)},has:nr,add:sr,set:lr,delete:cr,clear:dr,forEach:ur(!1,!1)},t={get(e){return or(this,e,!1,!0)},get size(){return ir(this)},has:nr,add:sr,set:lr,delete:cr,clear:dr,forEach:ur(!1,!0)},r={get(e){return or(this,e,!0)},get size(){return ir(this,!0)},has(e){return nr.call(this,e,!0)},add:gr("add"),set:gr("set"),delete:gr("delete"),clear:gr("clear"),forEach:ur(!0,!1)},a={get(e){return or(this,e,!0,!0)},get size(){return ir(this,!0)},has(e){return nr.call(this,e,!0)},add:gr("add"),set:gr("set"),delete:gr("delete"),clear:gr("clear"),forEach:ur(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(o=>{e[o]=pr(o,!1,!1),r[o]=pr(o,!0,!1),t[o]=pr(o,!1,!0),a[o]=pr(o,!0,!0)}),[e,r,t,a]}var[hr,fr,br,vr]=mr();function yr(e,t){const r=e?fr:hr;return(t,a,o)=>"__v_isReactive"===a?!e:"__v_isReadonly"===a?e:"__v_raw"===a?t:Reflect.get(St(r,a)&&a in t?r:t,a,o)}var wr={get:yr(!1)},xr={get:yr(!0)};function Sr(e,t,r){const a=Dr(r);if(a!==r&&t.call(e,a)){const t=At(e);console.warn(`Reactive ${t} contains both the raw and reactive versions of the same object${"Map"===t?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var kr=new WeakMap,Cr=new WeakMap,_r=new WeakMap,Er=new WeakMap;function Fr(e){return e&&e.__v_isReadonly?e:Ar(e,!1,Qt,wr,kr)}function $r(e){return Ar(e,!0,Zt,xr,_r)}function Ar(e,t,r,a,o){if(!Et(e))return console.warn(`value cannot be made reactive: ${String(e)}`),e;if(e.__v_raw&&(!t||!e.__v_isReactive))return e;const n=o.get(e);if(n)return n;const i=(s=e).__v_skip||!Object.isExtensible(s)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(At(s));var s;if(0===i)return e;const l=new Proxy(e,2===i?a:r);return o.set(e,l),l}function Dr(e){return e&&Dr(e.__v_raw)||e}function Lr(e){return Boolean(e&&!0===e.__v_isRef)}X("nextTick",()=>Re),X("dispatch",e=>ye.bind(ye,e)),X("watch",(e,{evaluateLater:t,cleanup:r})=>(e,a)=>{let o=t(e),n=h(()=>{let e;return o(t=>e=t),e},a);r(n)}),X("store",function(){return pt}),X("data",e=>M(e)),X("root",e=>Ae(e)),X("refs",e=>(e._x_refs_proxy||(e._x_refs_proxy=z(function(e){let t=[];return De(e,e=>{e._x_refs&&t.push(e._x_refs)}),t}(e))),e._x_refs_proxy));var Mr={};function Ir(e){return Mr[e]||(Mr[e]=0),++Mr[e]}function Tr(e,t,r){X(t,a=>xe(`You can't use [$${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${r}`,a))}X("id",(e,{cleanup:t})=>(r,a=null)=>function(e,t,r,a){if(e._x_id||(e._x_id={}),e._x_id[t])return e._x_id[t];let o=a();return e._x_id[t]=o,r(()=>{delete e._x_id[t]}),o}(e,`${r}${a?`-${a}`:""}`,t,()=>{let t=function(e,t){return De(e,e=>{if(e._x_ids&&e._x_ids[t])return!0})}(e,r),o=t?t._x_ids[r]:Ir(r);return a?`${r}-${o}-${a}`:`${r}-${o}`})),Ke((e,t)=>{e._x_id&&(t._x_id=e._x_id)}),X("el",e=>e),Tr("Focus","focus","focus"),Tr("Persist","persist","persist"),ae("modelable",(e,{expression:t},{effect:r,evaluateLater:a,cleanup:o})=>{let n=a(t),i=()=>{let e;return n(t=>e=t),e},s=a(`${t} = __placeholder`),l=e=>s(()=>{},{scope:{__placeholder:e}}),c=i();l(c),queueMicrotask(()=>{if(!e._x_model)return;e._x_removeModelListeners.default();let t=e._x_model.get,r=e._x_model.set,a=dt({get:()=>t(),set(e){r(e)}},{get:()=>i(),set(e){l(e)}});o(a)})}),ae("teleport",(e,{modifiers:t,expression:r},{cleanup:a})=>{"template"!==e.tagName.toLowerCase()&&xe("x-teleport can only be used on a <template> tag",e);let o=Pr(r),n=e.content.cloneNode(!0).firstElementChild;e._x_teleport=n,n._x_teleportBack=e,e.setAttribute("data-teleport-template",!0),n.setAttribute("data-teleport-target",!0),e._x_forwardEvents&&e._x_forwardEvents.forEach(t=>{n.addEventListener(t,t=>{t.stopPropagation(),e.dispatchEvent(new t.constructor(t.type,t))})}),I(n,{},e);let i=(e,t,r)=>{r.includes("prepend")?t.parentNode.insertBefore(e,t):r.includes("append")?t.parentNode.insertBefore(e,t.nextSibling):t.appendChild(e)};$(()=>{i(n,o,t),Ge(()=>{Ie(n)})()}),e._x_teleportPutBack=()=>{let a=Pr(r);$(()=>{i(e._x_teleport,a,t)})},a(()=>$(()=>{n.remove(),Te(n)}))});var zr=document.createElement("div");function Pr(e){let t=Ge(()=>document.querySelector(e),()=>zr)();return t||xe(`Cannot find x-teleport element for selector: "${e}"`),t}var Rr=()=>{};function Nr(e,t,r,a){let o=e,n=e=>a(e),i={},s=(e,t)=>r=>t(e,r);if(r.includes("dot")&&(t=t.replace(/-/g,".")),r.includes("camel")&&(t=function(e){return e.toLowerCase().replace(/-(\w)/g,(e,t)=>t.toUpperCase())}(t)),r.includes("passive")&&(i.passive=!0),r.includes("capture")&&(i.capture=!0),r.includes("window")&&(o=window),r.includes("document")&&(o=document),r.includes("debounce")){let e=r[r.indexOf("debounce")+1]||"invalid-wait",t=Or(e.split("ms")[0])?Number(e.split("ms")[0]):250;n=lt(n,t)}if(r.includes("throttle")){let e=r[r.indexOf("throttle")+1]||"invalid-wait",t=Or(e.split("ms")[0])?Number(e.split("ms")[0]):250;n=ct(n,t)}return r.includes("prevent")&&(n=s(n,(e,t)=>{t.preventDefault(),e(t)})),r.includes("stop")&&(n=s(n,(e,t)=>{t.stopPropagation(),e(t)})),r.includes("once")&&(n=s(n,(e,r)=>{e(r),o.removeEventListener(t,n,i)})),(r.includes("away")||r.includes("outside"))&&(o=document,n=s(n,(t,r)=>{e.contains(r.target)||!1!==r.target.isConnected&&(e.offsetWidth<1&&e.offsetHeight<1||!1!==e._x_isShown&&t(r))})),r.includes("self")&&(n=s(n,(t,r)=>{r.target===e&&t(r)})),(function(e){return["keydown","keyup"].includes(e)}(t)||jr(t))&&(n=s(n,(e,t)=>{(function(e,t){let r=t.filter(e=>!["window","document","prevent","stop","once","capture","self","away","outside","passive"].includes(e));if(r.includes("debounce")){let e=r.indexOf("debounce");r.splice(e,Or((r[e+1]||"invalid-wait").split("ms")[0])?2:1)}if(r.includes("throttle")){let e=r.indexOf("throttle");r.splice(e,Or((r[e+1]||"invalid-wait").split("ms")[0])?2:1)}if(0===r.length)return!1;if(1===r.length&&Br(e.key).includes(r[0]))return!1;const a=["ctrl","shift","alt","meta","cmd","super"].filter(e=>r.includes(e));if(r=r.filter(e=>!a.includes(e)),a.length>0&&a.filter(t=>("cmd"!==t&&"super"!==t||(t="meta"),e[`${t}Key`])).length===a.length){if(jr(e.type))return!1;if(Br(e.key).includes(r[0]))return!1}return!0})(t,r)||e(t)})),o.addEventListener(t,n,i),()=>{o.removeEventListener(t,n,i)}}function Or(e){return!Array.isArray(e)&&!isNaN(e)}function jr(e){return["contextmenu","click","mouse"].some(t=>e.includes(t))}function Br(e){if(!e)return[];var t;e=[" ","_"].includes(t=e)?t:t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase();let r={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return r[e]=e,Object.keys(r).map(t=>{if(r[t]===e)return t}).filter(e=>e)}function Xr(e,t,r,a){return $(()=>{if(r instanceof CustomEvent&&void 0!==r.detail)return null!==r.detail&&void 0!==r.detail?r.detail:r.target.value;if(it(e)){if(Array.isArray(a)){let e=null;return e=t.includes("number")?Ur(r.target.value):t.includes("boolean")?rt(r.target.value):r.target.value,r.target.checked?a.includes(e)?a:a.concat([e]):a.filter(t=>!(t==e))}return r.target.checked}if("select"===e.tagName.toLowerCase()&&e.multiple)return t.includes("number")?Array.from(r.target.selectedOptions).map(e=>Ur(e.value||e.text)):t.includes("boolean")?Array.from(r.target.selectedOptions).map(e=>rt(e.value||e.text)):Array.from(r.target.selectedOptions).map(e=>e.value||e.text);{let o;return o=st(e)?r.target.checked?r.target.value:a:r.target.value,t.includes("number")?Ur(o):t.includes("boolean")?rt(o):t.includes("trim")?o.trim():o}})}function Ur(e){let t=e?parseFloat(e):null;return r=t,Array.isArray(r)||isNaN(r)?e:t;var r}function Wr(e){return null!==e&&"object"==typeof e&&"function"==typeof e.get&&"function"==typeof e.set}Rr.inline=(e,{modifiers:t},{cleanup:r})=>{t.includes("self")?e._x_ignoreSelf=!0:e._x_ignore=!0,r(()=>{t.includes("self")?delete e._x_ignoreSelf:delete e._x_ignore})},ae("ignore",Rr),ae("effect",Ge((e,{expression:t},{effect:r})=>{r(Y(e,t))})),ae("model",(e,{modifiers:t,expression:r},{effect:a,cleanup:o})=>{let n=e;t.includes("parent")&&(n=e.parentNode);let i,s=Y(n,r);i="string"==typeof r?Y(n,`${r} = __placeholder`):"function"==typeof r&&"string"==typeof r()?Y(n,`${r()} = __placeholder`):()=>{};let l=()=>{let e;return s(t=>e=t),Wr(e)?e.get():e},c=e=>{let t;s(e=>t=e),Wr(t)?t.set(e):i(()=>{},{scope:{__placeholder:e}})};"string"==typeof r&&"radio"===e.type&&$(()=>{e.hasAttribute("name")||e.setAttribute("name",r)});var d="select"===e.tagName.toLowerCase()||["checkbox","radio"].includes(e.type)||t.includes("lazy")?"change":"input";let u=He?()=>{}:Nr(e,d,t,r=>{c(Xr(e,t,r,l()))});if(t.includes("fill")&&([void 0,null,""].includes(l())||it(e)&&Array.isArray(l())||"select"===e.tagName.toLowerCase()&&e.multiple)&&c(Xr(e,t,{target:e},l())),e._x_removeModelListeners||(e._x_removeModelListeners={}),e._x_removeModelListeners.default=u,o(()=>e._x_removeModelListeners.default()),e.form){let r=Nr(e.form,"reset",[],r=>{Re(()=>e._x_model&&e._x_model.set(Xr(e,t,{target:e},l())))});o(()=>r())}e._x_model={get:()=>l(),set(e){c(e)}},e._x_forceModelUpdate=t=>{void 0===t&&"string"==typeof r&&r.match(/\./)&&(t=""),window.fromModel=!0,$(()=>Ze(e,"value",t)),delete window.fromModel},a(()=>{let r=l();t.includes("unintrusive")&&document.activeElement.isSameNode(e)||e._x_forceModelUpdate(r)})}),ae("cloak",e=>queueMicrotask(()=>$(()=>e.removeAttribute(te("cloak"))))),$e(()=>`[${te("init")}]`),ae("init",Ge((e,{expression:t},{evaluate:r})=>"string"==typeof t?!!t.trim()&&r(t,{},!1):r(t,{},!1))),ae("text",(e,{expression:t},{effect:r,evaluateLater:a})=>{let o=a(t);r(()=>{o(t=>{$(()=>{e.textContent=t})})})}),ae("html",(e,{expression:t},{effect:r,evaluateLater:a})=>{let o=a(t);r(()=>{o(t=>{$(()=>{e.innerHTML=t,e._x_ignoreSelf=!0,Ie(e),delete e._x_ignoreSelf})})})}),ge(de(":",te("bind:")));var qr=(e,{value:t,modifiers:r,expression:a,original:o},{effect:n,cleanup:i})=>{if(!t){let t={};return s=t,Object.entries(mt).forEach(([e,t])=>{Object.defineProperty(s,e,{get:()=>(...e)=>t(...e)})}),void Y(e,a)(t=>{ht(e,t,o)},{scope:t})}var s;if("key"===t)return function(e,t){e._x_keyExpression=t}(e,a);if(e._x_inlineBindings&&e._x_inlineBindings[t]&&e._x_inlineBindings[t].extract)return;let l=Y(e,a);n(()=>l(o=>{void 0===o&&"string"==typeof a&&a.match(/\./)&&(o=""),$(()=>Ze(e,t,o,r))})),i(()=>{e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedStyles&&e._x_undoAddedStyles()})};function Vr(e,t,r,a){let o={};return/^\[.*\]$/.test(e.item)&&Array.isArray(t)?e.item.replace("[","").replace("]","").split(",").map(e=>e.trim()).forEach((e,r)=>{o[e]=t[r]}):/^\{.*\}$/.test(e.item)&&!Array.isArray(t)&&"object"==typeof t?e.item.replace("{","").replace("}","").split(",").map(e=>e.trim()).forEach(e=>{o[e]=t[e]}):o[e.item]=t,e.index&&(o[e.index]=r),e.collection&&(o[e.collection]=a),o}function Hr(){}function Gr(e,t,r){ae(t,a=>xe(`You can't use [x-${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${r}`,a))}qr.inline=(e,{value:t,modifiers:r,expression:a})=>{t&&(e._x_inlineBindings||(e._x_inlineBindings={}),e._x_inlineBindings[t]={expression:a,extract:!1})},ae("bind",qr),Fe(()=>`[${te("data")}]`),ae("data",(e,{expression:t},{cleanup:a})=>{if(function(e){return!!He&&(!!Je||e.hasAttribute("data-has-alpine-state"))}(e))return;t=""===t?"{}":t;let o={};U(o,e);let n={};var i,s;i=n,s=o,Object.entries(ft).forEach(([e,t])=>{Object.defineProperty(i,e,{get:()=>(...e)=>t.bind(s)(...e),enumerable:!1})});let l=G(e,t,{scope:n});void 0!==l&&!0!==l||(l={}),U(l,e);let c=r(l);N(c);let d=I(e,c);c.init&&G(e,c.init),a(()=>{c.destroy&&G(e,c.destroy),d()})}),Ke((e,t)=>{e._x_dataStack&&(t._x_dataStack=e._x_dataStack,t.setAttribute("data-has-alpine-state",!0))}),ae("show",(e,{modifiers:t,expression:r},{effect:a})=>{let o=Y(e,r);e._x_doHide||(e._x_doHide=()=>{$(()=>{e.style.setProperty("display","none",t.includes("important")?"important":void 0)})}),e._x_doShow||(e._x_doShow=()=>{$(()=>{1===e.style.length&&"none"===e.style.display?e.removeAttribute("style"):e.style.removeProperty("display")})});let n,i=()=>{e._x_doHide(),e._x_isShown=!1},s=()=>{e._x_doShow(),e._x_isShown=!0},l=()=>setTimeout(s),c=Xe(e=>e?s():i(),t=>{"function"==typeof e._x_toggleAndCascadeWithTransitions?e._x_toggleAndCascadeWithTransitions(e,t,s,i):t?l():i()}),d=!0;a(()=>o(e=>{(d||e!==n)&&(t.includes("immediate")&&(e?l():i()),c(e),n=e,d=!1)}))}),ae("for",(e,{expression:t},{effect:a,cleanup:o})=>{let n=function(e){let t=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,r=/^\s*\(|\)\s*$/g,a=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,o=e.match(a);if(!o)return;let n={};n.items=o[2].trim();let i=o[1].replace(r,"").trim(),s=i.match(t);return s?(n.item=i.replace(t,"").trim(),n.index=s[1].trim(),s[2]&&(n.collection=s[2].trim())):n.item=i,n}(t),i=Y(e,n.items),s=Y(e,e._x_keyExpression||"index");e._x_prevKeys=[],e._x_lookup={},a(()=>function(e,t,a,o){let n=e=>"object"==typeof e&&!Array.isArray(e),i=e;a(a=>{var s;s=a,!Array.isArray(s)&&!isNaN(s)&&a>=0&&(a=Array.from(Array(a).keys(),e=>e+1)),void 0===a&&(a=[]);let l=e._x_lookup,c=e._x_prevKeys,d=[],u=[];if(n(a))a=Object.entries(a).map(([r,n])=>{let i=Vr(t,n,r,a);o(t=>{u.includes(t)&&xe("Duplicate key on x-for",e),u.push(t)},{scope:{index:r,...i}}),d.push(i)});else for(let r=0;r<a.length;r++){let n=Vr(t,a[r],r,a);o(t=>{u.includes(t)&&xe("Duplicate key on x-for",e),u.push(t)},{scope:{index:r,...n}}),d.push(n)}let p=[],g=[],m=[],h=[];for(let e=0;e<c.length;e++){let t=c[e];-1===u.indexOf(t)&&m.push(t)}c=c.filter(e=>!m.includes(e));let f="template";for(let e=0;e<u.length;e++){let t=u[e],r=c.indexOf(t);if(-1===r)c.splice(e,0,t),p.push([f,e]);else if(r!==e){let t=c.splice(e,1)[0],a=c.splice(r-1,1)[0];c.splice(e,0,a),c.splice(r,0,t),g.push([t,a])}else h.push(t);f=t}for(let e=0;e<m.length;e++){let t=m[e];t in l&&($(()=>{Te(l[t]),l[t].remove()}),delete l[t])}for(let e=0;e<g.length;e++){let[t,r]=g[e],a=l[t],o=l[r],n=document.createElement("div");$(()=>{o||xe('x-for ":key" is undefined or invalid',i,r,l),o.after(n),a.after(o),o._x_currentIfEl&&o.after(o._x_currentIfEl),n.before(a),a._x_currentIfEl&&a.after(a._x_currentIfEl),n.remove()}),o._x_refreshXForScope(d[u.indexOf(r)])}for(let e=0;e<p.length;e++){let[t,a]=p[e],o="template"===t?i:l[t];o._x_currentIfEl&&(o=o._x_currentIfEl);let n=d[a],s=u[a],c=document.importNode(i.content,!0).firstElementChild,g=r(n);I(c,g,i),c._x_refreshXForScope=e=>{Object.entries(e).forEach(([e,t])=>{g[e]=t})},$(()=>{o.after(c),Ge(()=>Ie(c))()}),"object"==typeof s&&xe("x-for key cannot be an object, it must be a string or an integer",i),l[s]=c}for(let e=0;e<h.length;e++)l[h[e]]._x_refreshXForScope(d[u.indexOf(h[e])]);i._x_prevKeys=u})}(e,n,i,s)),o(()=>{Object.values(e._x_lookup).forEach(e=>$(()=>{Te(e),e.remove()})),delete e._x_prevKeys,delete e._x_lookup})}),Hr.inline=(e,{expression:t},{cleanup:r})=>{let a=Ae(e);a._x_refs||(a._x_refs={}),a._x_refs[t]=e,r(()=>delete a._x_refs[t])},ae("ref",Hr),ae("if",(e,{expression:t},{effect:r,cleanup:a})=>{"template"!==e.tagName.toLowerCase()&&xe("x-if can only be used on a <template> tag",e);let o=Y(e,t);r(()=>o(t=>{t?(()=>{if(e._x_currentIfEl)return e._x_currentIfEl;let t=e.content.cloneNode(!0).firstElementChild;I(t,{},e),$(()=>{e.after(t),Ge(()=>Ie(t))()}),e._x_currentIfEl=t,e._x_undoIf=()=>{$(()=>{Te(t),t.remove()}),delete e._x_currentIfEl}})():e._x_undoIf&&(e._x_undoIf(),delete e._x_undoIf)})),a(()=>e._x_undoIf&&e._x_undoIf())}),ae("id",(e,{expression:t},{evaluate:r})=>{r(t).forEach(t=>function(e,t){e._x_ids||(e._x_ids={}),e._x_ids[t]||(e._x_ids[t]=Ir(t))}(e,t))}),Ke((e,t)=>{e._x_ids&&(t._x_ids=e._x_ids)}),ge(de("@",te("on:"))),ae("on",Ge((e,{value:t,modifiers:r,expression:a},{cleanup:o})=>{let n=a?Y(e,a):()=>{};"template"===e.tagName.toLowerCase()&&(e._x_forwardEvents||(e._x_forwardEvents=[]),e._x_forwardEvents.includes(t)||e._x_forwardEvents.push(t));let i=Nr(e,t,r,e=>{n(()=>{},{scope:{$event:e},params:[e]})});o(()=>i())})),Gr("Collapse","collapse","collapse"),Gr("Intersect","intersect","intersect"),Gr("Focus","trap","focus"),Gr("Mask","mask","mask"),bt.setEvaluator(J),bt.setReactivityEngine({reactive:Fr,effect:function(e,t=wt){(function(e){return e&&!0===e._isEffect})(e)&&(e=e.raw);const r=function(e,t){const r=function(){if(!r.active)return e();if(!Tt.includes(r)){Nt(r);try{return jt.push(Ot),Ot=!0,Tt.push(r),yt=r,e()}finally{Tt.pop(),Bt(),yt=Tt[Tt.length-1]}}};return r.id=Rt++,r.allowRecurse=!!t.allowRecurse,r._isEffect=!0,r.active=!0,r.raw=e,r.deps=[],r.options=t,r}(e,t);return t.lazy||r(),r},release:function(e){e.active&&(Nt(e),e.options.onStop&&e.options.onStop(),e.active=!1)},raw:Dr});var Yr=bt;const Kr=new class{constructor(e){this.overrides=new Map,this.config=e,this.loadLocalOverrides()}isEnabled(e){if(this.overrides.has(e))return this.overrides.get(e);const t=this.config.flags[e];return t?!!t.enabled&&(void 0!==t.rolloutPercentage?this.checkRolloutPercentage(e,t.rolloutPercentage):t.conditions?this.evaluateConditions(t.conditions):t.enabled):(console.warn(`Feature flag '${e}' not found. Defaulting to false.`),!1)}enable(e){this.overrides.set(e,!0),this.saveLocalOverrides()}disable(e){this.overrides.set(e,!1),this.saveLocalOverrides()}clearOverride(e){this.overrides.delete(e),this.saveLocalOverrides()}clearAllOverrides(){this.overrides.clear(),this.saveLocalOverrides()}getFlag(e){return this.config.flags[e]||null}getAllFlags(){return{...this.config.flags}}getOverrides(){return Object.fromEntries(this.overrides)}checkRolloutPercentage(e,t){if(t<=0)return!1;if(t>=100)return!0;const r=this.config.userId||this.config.sessionId||"anonymous";return this.simpleHash(`${e}:${r}`)%100<t}evaluateConditions(e){return e.environment?e.environment===this.config.environment:!e.userId||!this.config.userId||(Array.isArray(e.userId)?e.userId:[e.userId]).includes(this.config.userId)}simpleHash(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return Math.abs(t)}loadLocalOverrides(){if("undefined"!=typeof window)try{const e=localStorage.getItem("featureFlags_overrides");if(e){const t=JSON.parse(e);this.overrides=new Map(Object.entries(t))}}catch(error){console.warn("Failed to load feature flag overrides from localStorage:",error)}}saveLocalOverrides(){if("undefined"!=typeof window)try{const e=Object.fromEntries(this.overrides);localStorage.setItem("featureFlags_overrides",JSON.stringify(e))}catch(error){console.warn("Failed to save feature flag overrides to localStorage:",error)}}}({environment:"development",flags:{character_fetcher:{key:"character_fetcher",enabled:!0,description:"Use new CharacterFetcher service for D&D Beyond API calls",rolloutPercentage:100},modern_converter:{key:"modern_converter",enabled:!0,description:"Enable the new Alpine.js-based character converter",rolloutPercentage:100},legacy_fallback:{key:"legacy_fallback",enabled:!0,description:"Show fallback option to legacy converter"},bulk_conversion:{key:"bulk_conversion",enabled:!0,description:"Enable bulk character conversion feature",rolloutPercentage:100},advanced_mapping:{key:"advanced_mapping",enabled:!0,description:"Enable advanced field mapping configuration"},character_preview:{key:"character_preview",enabled:!0,description:"Show character preview before conversion",rolloutPercentage:100},export_formats:{key:"export_formats",enabled:!0,description:"Enable multiple export format options (JSON, PDF, etc.)",rolloutPercentage:100},multi_format_export:{key:"multi_format_export",enabled:!0,description:"Enable multi-format export with compatibility analysis",rolloutPercentage:100},performance_metrics:{key:"performance_metrics",enabled:!0,description:"Collect and display performance metrics",conditions:{environment:"development"}},debug_character_data:{key:"debug_character_data",enabled:!0,description:"Log detailed character data to console for debugging",rolloutPercentage:100},object_search_service:{key:"object_search_service",enabled:!0,description:"Use new ObjectSearch service instead of legacy getObjects() function",rolloutPercentage:100},string_sanitizer_service:{key:"string_sanitizer_service",enabled:!0,description:"Use new StringSanitizer service instead of legacy fixQuote() function",rolloutPercentage:100},safe_access_service:{key:"safe_access_service",enabled:!0,description:"Use new SafeAccess service instead of legacy safeAccess() function",rolloutPercentage:100},ability_constants:{key:"ability_constants",enabled:!0,description:"Use new AbilityConstants instead of legacy justAbilities array",rolloutPercentage:100},ability_score_processor:{key:"ability_score_processor",enabled:!0,description:"Use new AbilityScoreProcessor service instead of legacy processAbilityScoreBonuses() function",rolloutPercentage:100},debug_ability_score_processor:{key:"debug_ability_score_processor",enabled:!1,description:"Enable detailed debugging output for ability score modifier sources",conditions:{environment:"development"}},spell_slot_calculator:{key:"spell_slot_calculator",enabled:!0,description:"Use new SpellSlotCalculator service instead of legacy getSpellSlots() function",rolloutPercentage:100},debug_spell_slot_calculator:{key:"debug_spell_slot_calculator",enabled:!1,description:"Enable detailed debugging output for spell slot calculations",conditions:{environment:"development"}},inventory_processor:{key:"inventory_processor",enabled:!0,description:"Use new InventoryProcessor service instead of legacy inventory functions",rolloutPercentage:100},encumbrance_calculator:{key:"encumbrance_calculator",enabled:!0,description:"Use new EncumbranceCalculator service instead of legacy calculateEncumbrance() function",rolloutPercentage:100},inventory_processor_debug:{key:"inventory_processor_debug",enabled:!0,description:"Enable detailed debugging output for inventory processing",conditions:{environment:"development"}},encumbrance_calculator_debug:{key:"encumbrance_calculator_debug",enabled:!1,description:"Enable detailed debugging output for encumbrance calculations",conditions:{environment:"development"}},feature_processor:{key:"feature_processor",enabled:!0,description:"Use new FeatureProcessor service instead of legacy feature processing",rolloutPercentage:100},feature_processor_debug:{key:"feature_processor_debug",enabled:!1,description:"Enable detailed debugging output for feature processing",conditions:{environment:"development"}},weaponlist_debug:{key:"weaponlist_debug",enabled:!0,description:"Enable detailed debugging output for weaponlist XML generation",conditions:{environment:"development"}},spelllist_debug:{key:"spelllist_debug",enabled:!0,description:"Enable detailed debugging output for spelllist XML generation",conditions:{environment:"development"}}}}),Jr={colors:{primary:{50:"#FDF2F5",100:"#FAE5EB",200:"#F2CCD7",300:"#E9A8B8",400:"#DD7A94",500:"#8B1538",600:"#6B1028",700:"#5A0E23",800:"#4A0C1D",900:"#3D0A18"},gold:{50:"#FEFBF0",100:"#FDF7E1",200:"#FAEFC3",300:"#F6E7A5",400:"#F1DE87",500:"#D4AF37",600:"#B8941F",700:"#9C7A18",800:"#806010",900:"#644609"},secondary:{50:"#EFF6FF",100:"#DBEAFE",200:"#BFDBFE",300:"#93C5FD",400:"#60A5FA",500:"#1E40AF",600:"#1E3A8A",700:"#1D4ED8",800:"#1E3A8A",900:"#1E3A8A"},semantic:{success:"#059669",warning:"#D97706",error:"#DC2626",info:"#0EA5E9"},neutral:{50:"#FAFAFA",100:"#F5F5F5",200:"#E5E5E5",300:"#D4D4D4",400:"#A3A3A3",500:"#737373",600:"#525252",700:"#404040",800:"#262626",900:"#171717"},dark:{600:"#475569",700:"#334155",800:"#1E293B",900:"#0F172A"}},typography:{fontFamily:{primary:"'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",display:"'Cinzel', serif",mono:"'JetBrains Mono', Consolas, 'Courier New', monospace"},fontSize:{h1:"3.5rem",h2:"2.5rem",h3:"2rem",h4:"1.5rem",h5:"1.25rem",bodyLarge:"1.125rem",body:"1rem",bodySmall:"0.875rem",caption:"0.75rem",label:"0.875rem",code:"0.875rem",button:"1rem"},fontWeight:{light:300,regular:400,medium:500,semibold:600,bold:700},lineHeight:{h1:1.2,h2:1.3,h3:1.4,h4:1.5,h5:1.6,bodyLarge:1.7,body:1.6,bodySmall:1.5,caption:1.4,label:1.3,code:1.6,button:1.2},letterSpacing:{h1:"-0.025em",h2:"-0.02em",h3:"-0.015em",h4:"-0.01em",h5:"normal",label:"0.05em"}},spacing:{xs:"0.25rem",sm:"0.5rem",md:"1rem",lg:"1.5rem",xl:"2rem","2xl":"3rem","3xl":"4rem"},animation:{duration:{micro:"150ms",local:"250ms",page:"350ms",complex:"600ms"},easing:{easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeInOut:"cubic-bezier(0.4, 0, 0.6, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)",spring:{gentle:"cubic-bezier(0.16, 1, 0.3, 1)",bouncy:"cubic-bezier(0.68, -0.55, 0.265, 1.55)",firm:"cubic-bezier(0.2, 0, 0.38, 0.9)"}}},shadows:{sm:"0 2px 8px rgba(0, 0, 0, 0.05)",md:"0 4px 12px rgba(139, 21, 56, 0.2)",lg:"0 8px 24px rgba(139, 21, 56, 0.1)",xl:"0 20px 60px rgba(0, 0, 0, 0.3)"},borderRadius:{sm:"0.5rem",md:"0.75rem",lg:"1rem",xl:"1.5rem"},breakpoints:{mobile:"320px",tablet:"768px",desktop:"1024px",wide:"1440px"}};class Qr{static generateCustomProperties(e=Jr){const t=[];return this.addColorTokens(t,"primary",e.colors.primary),this.addColorTokens(t,"gold",e.colors.gold),this.addColorTokens(t,"secondary",e.colors.secondary),this.addColorTokens(t,"neutral",e.colors.neutral),this.addColorTokens(t,"dark",e.colors.dark),Object.entries(e.colors.semantic).forEach(([e,r])=>{t.push(`--color-${e}: ${r};`)}),Object.entries(e.typography.fontFamily).forEach(([e,r])=>{t.push(`--font-family-${e}: ${r};`)}),Object.entries(e.typography.fontSize).forEach(([e,r])=>{t.push(`--font-size-${e}: ${r};`)}),Object.entries(e.typography.fontWeight).forEach(([e,r])=>{t.push(`--font-weight-${e}: ${r};`)}),Object.entries(e.typography.lineHeight).forEach(([e,r])=>{t.push(`--line-height-${e}: ${r};`)}),Object.entries(e.typography.letterSpacing).forEach(([e,r])=>{t.push(`--letter-spacing-${e}: ${r};`)}),Object.entries(e.spacing).forEach(([e,r])=>{t.push(`--space-${e}: ${r};`)}),Object.entries(e.animation.duration).forEach(([e,r])=>{t.push(`--duration-${e}: ${r};`)}),Object.entries(e.animation.easing).forEach(([e,r])=>{"string"==typeof r?t.push(`--easing-${e}: ${r};`):Object.entries(r).forEach(([r,a])=>{t.push(`--easing-${e}-${r}: ${a};`)})}),Object.entries(e.shadows).forEach(([e,r])=>{t.push(`--shadow-${e}: ${r};`)}),Object.entries(e.borderRadius).forEach(([e,r])=>{t.push(`--radius-${e}: ${r};`)}),Object.entries(e.breakpoints).forEach(([e,r])=>{t.push(`--breakpoint-${e}: ${r};`)}),`:root {\n  ${t.join("\n  ")}\n}`}static addColorTokens(e,t,r){Object.entries(r).forEach(([r,a])=>{e.push(`--color-${t}-${r}: ${a};`)})}static generateTailwindTokens(e=Jr){return{colors:{primary:e.colors.primary,gold:e.colors.gold,secondary:e.colors.secondary,neutral:e.colors.neutral,dark:e.colors.dark,success:e.colors.semantic.success,warning:e.colors.semantic.warning,error:e.colors.semantic.error,info:e.colors.semantic.info},fontFamily:e.typography.fontFamily,fontSize:e.typography.fontSize,fontWeight:e.typography.fontWeight,lineHeight:e.typography.lineHeight,letterSpacing:e.typography.letterSpacing,spacing:e.spacing,transitionDuration:e.animation.duration,transitionTimingFunction:{"ease-out":e.animation.easing.easeOut,"ease-in-out":e.animation.easing.easeInOut,sharp:e.animation.easing.sharp,"spring-gentle":e.animation.easing.spring.gentle,"spring-bouncy":e.animation.easing.spring.bouncy,"spring-firm":e.animation.easing.spring.firm},boxShadow:e.shadows,borderRadius:e.borderRadius,screens:e.breakpoints}}}class Zr{constructor(e,t){this.id=e,this.animation=t}play(){this.animation.play()}pause(){this.animation.pause()}cancel(){this.animation.cancel()}finish(){this.animation.finish()}get finished(){return this.animation.finished}get playState(){return this.animation.playState}}class ea{constructor(e){this.animations=e}async playAll(){const e=this.animations.map(e=>(e.play(),e.finished));await Promise.all(e)}pauseAll(){this.animations.forEach(e=>e.pause())}cancelAll(){this.animations.forEach(e=>e.cancel())}finishAll(){this.animations.forEach(e=>e.finish())}}class ta{constructor(e,t={}){this.element=e,this.options={duration:600,easing:"var(--easing-easeOut, ease-out)",shimmer:!0,onProgress:()=>{},onComplete:()=>{},...t},this.initializeProgressBar(),this.options.shimmer&&this.createShimmerEffect()}initializeProgressBar(){this.progressBar=this.element.querySelector(".progress-bar"),this.progressBar||(this.progressBar=document.createElement("div"),this.progressBar.className="progress-bar",this.element.appendChild(this.progressBar)),this.progressBar.style.width="0%",this.progressBar.style.height="100%",this.progressBar.style.background="var(--color-primary-500, #8B1538)",this.progressBar.style.borderRadius="inherit",this.progressBar.style.transformOrigin="left center",this.progressBar.style.willChange="width, transform"}createShimmerEffect(){this.shimmerElement=document.createElement("div"),this.shimmerElement.className="progress-shimmer",this.shimmerElement.style.position="absolute",this.shimmerElement.style.top="0",this.shimmerElement.style.left="-100%",this.shimmerElement.style.width="100%",this.shimmerElement.style.height="100%",this.shimmerElement.style.background="linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",this.shimmerElement.style.willChange="transform",this.progressBar.style.position="relative",this.progressBar.style.overflow="hidden",this.progressBar.appendChild(this.shimmerElement)}animateToProgress(e){return new Promise(t=>{this.currentAnimation&&this.currentAnimation.cancel();const r=parseFloat(this.progressBar.style.width)||0,a=e-r;this.currentAnimation=this.progressBar.animate([{width:`${r}%`},{width:`${e}%`}],{duration:this.options.duration,easing:this.options.easing,fill:"forwards"}),this.shimmerElement&&this.shimmerElement.animate([{transform:"translateX(-100%)"},{transform:"translateX(400%)"}],{duration:1.5*this.options.duration,easing:this.options.easing,iterations:1});let o=0;const n=setInterval(()=>{o+=16.67;const t=r+a*(o/this.options.duration);this.options.onProgress(Math.min(t,e)),o>=this.options.duration&&clearInterval(n)},16);this.currentAnimation.addEventListener("finish",()=>{clearInterval(n),this.options.onComplete(),t()})})}reset(){this.currentAnimation&&this.currentAnimation.cancel(),this.progressBar.style.width="0%"}}class ra{constructor(){this.runningAnimations=new Map,this.frameCount=0,this.lastFrameTime=0,this.fpsHistory=[],this.performanceMetrics={activeAnimations:0,droppedFrames:0,averageFPS:60,memoryUsage:0},this.startPerformanceMonitoring()}static getInstance(){return ra.instance||(ra.instance=new ra),ra.instance}startPerformanceMonitoring(){const e=t=>{if(this.lastFrameTime>0){const e=1e3/(t-this.lastFrameTime);this.fpsHistory.push(e),this.fpsHistory.length>60&&this.fpsHistory.shift(),this.performanceMetrics.averageFPS=this.fpsHistory.reduce((e,t)=>e+t,0)/this.fpsHistory.length,e<55&&this.performanceMetrics.droppedFrames++}this.lastFrameTime=t,this.frameCount++,requestAnimationFrame(e)};requestAnimationFrame(e)}createButtonHover(e){const t=`button-hover-${Date.now()}-${Math.random()}`;e.style.willChange="transform, box-shadow";const r=e.animate([{transform:"translateY(0px)",boxShadow:"var(--shadow-md, 0 4px 12px rgba(139, 21, 56, 0.2))"},{transform:"translateY(-2px)",boxShadow:"var(--shadow-lg, 0 8px 24px rgba(139, 21, 56, 0.1))"}],{duration:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--duration-local").replace("ms",""))||250,easing:getComputedStyle(document.documentElement).getPropertyValue("--easing-easeOut")||"cubic-bezier(0.0, 0, 0.2, 1)",fill:"both"}),a=new Zr(t,r);return this.runningAnimations.set(t,a),r.addEventListener("finish",()=>{this.runningAnimations.delete(t),e.style.willChange="auto"}),r.addEventListener("cancel",()=>{this.runningAnimations.delete(t),e.style.willChange="auto"}),a}createButtonHoverReverse(e){const t=`button-hover-reverse-${Date.now()}-${Math.random()}`;e.style.willChange="transform, box-shadow";const r=e.animate([{transform:"translateY(-2px)",boxShadow:"var(--shadow-lg, 0 8px 24px rgba(139, 21, 56, 0.1))"},{transform:"translateY(0px)",boxShadow:"var(--shadow-md, 0 4px 12px rgba(139, 21, 56, 0.2))"}],{duration:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--duration-local").replace("ms",""))||250,easing:getComputedStyle(document.documentElement).getPropertyValue("--easing-easeInOut")||"cubic-bezier(0.4, 0, 0.6, 1)",fill:"both"}),a=new Zr(t,r);return this.runningAnimations.set(t,a),r.addEventListener("finish",()=>{this.runningAnimations.delete(t),e.style.willChange="auto"}),a}createProgressAnimation(e,t={}){return new ta(e,t)}createModalEntrance(e){const t=e.querySelector(".modal-backdrop"),r=e.querySelector(".modal-content");if(!t||!r)throw new Error("Modal must contain .modal-backdrop and .modal-content elements");t.style.willChange="opacity, backdrop-filter",r.style.willChange="transform, opacity";const a=t.animate([{opacity:"0",backdropFilter:"blur(0px)"},{opacity:"1",backdropFilter:"blur(4px)"}],{duration:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--duration-page").replace("ms",""))||350,easing:getComputedStyle(document.documentElement).getPropertyValue("--easing-easeOut")||"cubic-bezier(0.0, 0, 0.2, 1)",fill:"forwards"}),o=r.animate([{opacity:"0",transform:"scale(0.95) translateY(-20px)"},{opacity:"1",transform:"scale(1) translateY(0px)"}],{duration:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--duration-page").replace("ms",""))||350,easing:getComputedStyle(document.documentElement).getPropertyValue("--easing-spring-gentle")||"cubic-bezier(0.16, 1, 0.3, 1)",fill:"forwards"}),n=()=>{t.style.willChange="auto",r.style.willChange="auto"};return Promise.all([a.finished,o.finished]).then(n).catch(n),new ea([a,o])}createModalExit(e){const t=e.querySelector(".modal-backdrop"),r=e.querySelector(".modal-content");if(!t||!r)throw new Error("Modal must contain .modal-backdrop and .modal-content elements");t.style.willChange="opacity, backdrop-filter",r.style.willChange="transform, opacity";const a=r.animate([{opacity:"1",transform:"scale(1) translateY(0px)"},{opacity:"0",transform:"scale(0.95) translateY(-10px)"}],{duration:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--duration-local").replace("ms",""))||250,easing:getComputedStyle(document.documentElement).getPropertyValue("--easing-sharp")||"cubic-bezier(0.4, 0, 0.6, 1)",fill:"forwards"}),o=t.animate([{opacity:"1",backdropFilter:"blur(4px)"},{opacity:"0",backdropFilter:"blur(0px)"}],{duration:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--duration-local").replace("ms",""))||250,easing:getComputedStyle(document.documentElement).getPropertyValue("--easing-sharp")||"cubic-bezier(0.4, 0, 0.6, 1)",delay:50,fill:"forwards"}),n=()=>{t.style.willChange="auto",r.style.willChange="auto"};return Promise.all([o.finished,a.finished]).then(n).catch(n),new ea([a,o])}createCardHover(e,t=!0){const r=`card-hover-${Date.now()}-${Math.random()}`;e.style.willChange="transform, box-shadow";const a=t?[{transform:"translateY(0px) scale(1)",boxShadow:"var(--shadow-sm, 0 2px 8px rgba(0, 0, 0, 0.05))"},{transform:"translateY(-4px) scale(1.02)",boxShadow:"var(--shadow-lg, 0 8px 24px rgba(139, 21, 56, 0.1))"}]:[{transform:"translateY(-4px) scale(1.02)",boxShadow:"var(--shadow-lg, 0 8px 24px rgba(139, 21, 56, 0.1))"},{transform:"translateY(0px) scale(1)",boxShadow:"var(--shadow-sm, 0 2px 8px rgba(0, 0, 0, 0.05))"}],o=e.animate(a,{duration:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--duration-local").replace("ms",""))||250,easing:getComputedStyle(document.documentElement).getPropertyValue("--easing-easeOut")||"cubic-bezier(0.0, 0, 0.2, 1)",fill:"both"}),n=new Zr(r,o);return this.runningAnimations.set(r,n),o.addEventListener("finish",()=>{this.runningAnimations.delete(r),e.style.willChange="auto"}),n}shouldAnimate(){try{return!window.matchMedia("(prefers-reduced-motion: reduce)").matches}catch{return!0}}getPerformanceMetrics(){return this.performanceMetrics.activeAnimations=this.runningAnimations.size,this.performanceMetrics.memoryUsage=1024*this.runningAnimations.size,{...this.performanceMetrics}}cancelAllAnimations(){this.runningAnimations.forEach(e=>{e.cancel()}),this.runningAnimations.clear()}pauseAllAnimations(){this.runningAnimations.forEach(e=>{e.pause()})}resumeAllAnimations(){this.runningAnimations.forEach(e=>{e.play()})}}let aa,oa;function na(){return aa||(aa=ra.getInstance()),aa}"undefined"!=typeof window&&(window.animationEngine=na());class ia{constructor(e){this.options=e,this.announceQueue=[],this.isAnnouncing=!1,this.createLiveRegions()}createLiveRegions(){this.politeRegion=document.createElement("div"),this.politeRegion.setAttribute("aria-live","polite"),this.politeRegion.setAttribute("aria-atomic","true"),this.politeRegion.setAttribute("class","sr-only"),this.politeRegion.style.cssText="\n      position: absolute !important;\n      width: 1px !important;\n      height: 1px !important;\n      padding: 0 !important;\n      margin: -1px !important;\n      overflow: hidden !important;\n      clip: rect(0, 0, 0, 0) !important;\n      white-space: nowrap !important;\n      border: 0 !important;\n    ",this.assertiveRegion=document.createElement("div"),this.assertiveRegion.setAttribute("aria-live","assertive"),this.assertiveRegion.setAttribute("aria-atomic","true"),this.assertiveRegion.setAttribute("class","sr-only"),this.assertiveRegion.style.cssText=this.politeRegion.style.cssText,document.body.appendChild(this.politeRegion),document.body.appendChild(this.assertiveRegion)}announce(e,t="polite"){const r=this.options.announceDelays?.[t]||("polite"===t?100:0);this.announceQueue.push({text:e,priority:t,delay:r}),this.processQueue()}async processQueue(){if(!this.isAnnouncing&&0!==this.announceQueue.length){for(this.isAnnouncing=!0;this.announceQueue.length>0;){const{text:e,priority:t,delay:r}=this.announceQueue.shift();r>0&&await new Promise(e=>setTimeout(e,r));const a="polite"===t?this.politeRegion:this.assertiveRegion;a.textContent="",await new Promise(e=>setTimeout(e,10)),a.textContent=e,await new Promise(e=>setTimeout(e,"polite"===t?500:200))}this.isAnnouncing=!1}}clear(){this.politeRegion.textContent="",this.assertiveRegion.textContent="",this.announceQueue=[],this.isAnnouncing=!1}}class sa{constructor(){this.focusStack=[],this.focusTrappingEnabled=!1,this.focusableSelector="\n    a[href]:not([tabindex='-1']),\n    area[href]:not([tabindex='-1']),\n    input:not([disabled]):not([tabindex='-1']),\n    select:not([disabled]):not([tabindex='-1']),\n    textarea:not([disabled]):not([tabindex='-1']),\n    button:not([disabled]):not([tabindex='-1']),\n    iframe:not([tabindex='-1']),\n    [tabindex]:not([tabindex='-1']),\n    [contentEditable=true]:not([tabindex='-1']),\n    details > summary:not([tabindex='-1'])\n  ".trim().replace(/\s+/g," "),this.handleFocusTrap=e=>{if(this.focusTrappingEnabled&&this.currentTrapContainer){if("Escape"===e.key){const e=this.currentTrapContainer._escapeKeyAction;return void(e&&e())}"Tab"===e.key&&(e.shiftKey?document.activeElement===this.firstFocusableElement&&(e.preventDefault(),this.lastFocusableElement?.focus()):document.activeElement===this.lastFocusableElement&&(e.preventDefault(),this.firstFocusableElement?.focus()))}},this.handleFocusIn=e=>{if(!this.focusTrappingEnabled||!this.currentTrapContainer)return;const t=e.target;this.currentTrapContainer.contains(t)||(e.preventDefault(),e.stopPropagation(),this.firstFocusableElement?.focus())}}saveFocus(){const e=document.activeElement;e&&e!==document.body&&this.focusStack.push(e)}restoreFocus(){const e=this.focusStack.pop();if(e)try{e.focus()}catch(error){console.warn("Could not restore focus:",error)}}trapFocus(e,t={}){this.saveFocus(),this.focusTrappingEnabled=!0,this.currentTrapContainer=e;const r=this.getFocusableElements(e);if(0===r.length)return void console.warn("No focusable elements found in focus trap container");this.firstFocusableElement=r[0],this.lastFocusableElement=r[r.length-1];const a=t.initialFocus?"string"==typeof t.initialFocus?e.querySelector(t.initialFocus):t.initialFocus:this.firstFocusableElement;a&&setTimeout(()=>{a.focus({preventScroll:t.preventScroll})},0),document.addEventListener("keydown",this.handleFocusTrap),document.addEventListener("focusin",this.handleFocusIn),t.escapeKeyAction&&(e._escapeKeyAction=t.escapeKeyAction)}releaseFocusTrap(){this.focusTrappingEnabled=!1,this.currentTrapContainer=void 0,this.firstFocusableElement=void 0,this.lastFocusableElement=void 0,document.removeEventListener("keydown",this.handleFocusTrap),document.removeEventListener("focusin",this.handleFocusIn),this.restoreFocus()}getFocusableElements(e){return Array.from(e.querySelectorAll(this.focusableSelector)).filter(e=>{const t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&!e.hasAttribute("disabled")&&-1!==e.tabIndex})}setFocus(e,t={}){try{e.focus({preventScroll:t.preventScroll}),t.enhanceVisualFocus&&this.enhanceVisualFocus(e)}catch(error){console.warn("Could not set focus:",error)}}enhanceVisualFocus(e){const t=e.style.outline,r=e.style.outlineOffset;e.style.outline="3px solid var(--color-gold-500, #D4AF37)",e.style.outlineOffset="2px",setTimeout(()=>{e.style.outline=t,e.style.outlineOffset=r},2e3)}}class la{static checkColorContrast(e,t){const r=e=>{const t=e.replace("#",""),r=parseInt(t.substr(0,2),16)/255,a=parseInt(t.substr(2,2),16)/255,o=parseInt(t.substr(4,2),16)/255,n=e=>e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4);return.2126*n(r)+.7152*n(a)+.0722*n(o)},a=r(e),o=r(t);return(Math.max(a,o)+.05)/(Math.min(a,o)+.05)}static hasAccessibleName(e){return!!(e.getAttribute("aria-label")||e.getAttribute("aria-labelledby")||e.textContent?.trim()||e.placeholder||e.getAttribute("title")||"IMG"===e.tagName&&e.alt||"INPUT"===e.tagName&&this.getLabelForInput(e))}static getLabelForInput(e){if(e.id){const t=document.querySelector(`label[for="${e.id}"]`);if(t?.textContent?.trim())return t.textContent.trim()}const t=e.closest("label");return t?.textContent?.trim()?t.textContent.trim():null}static isKeyboardAccessible(e){const t=e.tagName.toLowerCase();if(["a","button","input","select","textarea"].includes(t))return-1!==e.tabIndex&&!e.hasAttribute("disabled");const r=e.getAttribute("role");return!(!r||!["button","link","menuitem","option","radio","checkbox","tab"].includes(r))&&e.tabIndex>=0}static auditDocument(){const e=Array.from(document.querySelectorAll("*")),t=e.filter(e=>this.isInteractiveElement(e));let r=0,a=0,o=0;t.forEach(e=>{this.hasAccessibleName(e)||r++,this.isKeyboardAccessible(e)||o++;const t=window.getComputedStyle(e),n=t.color,i=t.backgroundColor;if("rgba(0, 0, 0, 0)"!==n&&"rgba(0, 0, 0, 0)"!==i)try{this.checkColorContrast(this.rgbToHex(n),this.rgbToHex(i))<4.5&&a++}catch{}});const n=t.length-r-o,i=Math.round(n/Math.max(t.length,1)*100);return{totalElements:e.length,accessibleElements:n,missingLabels:r,insufficientContrast:a,keyboardInaccessible:o,complianceScore:i}}static isInteractiveElement(e){return["a","button","input","select","textarea"].includes(e.tagName.toLowerCase())||e.getAttribute("role")&&["button","link","menuitem","option","radio","checkbox","tab"].includes(e.getAttribute("role"))||e.tabIndex>=0}static rgbToHex(e){if(e.startsWith("#"))return e;const t=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(!t)throw new Error("Invalid RGB color");const[,r,a,o]=t;return"#"+[r,a,o].map(e=>parseInt(e).toString(16).padStart(2,"0")).join("")}}class ca{constructor(e={}){this.initialized=!1,this.handleGlobalKeydown=e=>{if("Escape"===e.key){const e=document.querySelector('.modal.open, .modal[aria-hidden="false"]');if(e){const t=e.querySelector(".modal-close, [data-modal-close]");t&&t.click()}}if(e.altKey&&"1"===e.key){e.preventDefault();const t=document.querySelector('#main, main, [role="main"]');t&&this.focusManager.setFocus(t,{enhanceVisualFocus:!0})}},this.options={announceDelays:{polite:100,assertive:0},keyboardNavigation:!0,focusManagement:!0,screenReaderOptimization:!0,highContrastSupport:!0,...e},this.focusManager=new sa,this.liveRegionManager=new ia(this.options),this.initialize()}initialize(){this.initialized||(this.addSkipLinks(),this.options.keyboardNavigation&&this.initializeKeyboardNavigation(),this.options.highContrastSupport&&this.initializeHighContrastSupport(),document.addEventListener("keydown",this.handleGlobalKeydown),this.initialized=!0)}addSkipLinks(){if(document.querySelector(".skip-link"))return;const e=document.createElement("a");e.href="#main",e.className="skip-link",e.textContent="Skip to main content",e.style.cssText="\n      position: absolute;\n      top: -40px;\n      left: 6px;\n      background: var(--color-primary-500, #8B1538);\n      color: white;\n      padding: 8px;\n      text-decoration: none;\n      border-radius: 4px;\n      z-index: 10000;\n      transition: top 0.2s ease;\n    ",e.addEventListener("focus",()=>{e.style.top="6px"}),e.addEventListener("blur",()=>{e.style.top="-40px"}),document.body.insertBefore(e,document.body.firstChild)}initializeKeyboardNavigation(){const e=document.createElement("style");e.textContent='\n      .enhanced-focus {\n        outline: 3px solid var(--color-gold-500, #D4AF37) !important;\n        outline-offset: 2px !important;\n      }\n      \n      /* Ensure focus is visible on all interactive elements */\n      button:focus-visible,\n      a:focus-visible,\n      input:focus-visible,\n      select:focus-visible,\n      textarea:focus-visible,\n      [role="button"]:focus-visible,\n      [tabindex]:focus-visible {\n        outline: 2px solid var(--color-gold-500, #D4AF37) !important;\n        outline-offset: 2px !important;\n      }\n    ',document.head.appendChild(e)}initializeHighContrastSupport(){const e=window.matchMedia("(prefers-contrast: high)"),t=e=>{document.documentElement.classList.toggle("high-contrast",e)};t(e.matches),e.addEventListener("change",e=>t(e.matches))}announce(e,t="polite"){this.liveRegionManager.announce(e,t)}trapFocus(e,t={}){this.focusManager.trapFocus(e,t)}releaseFocusTrap(){this.focusManager.releaseFocusTrap()}setFocus(e,t={}){this.focusManager.setFocus(e,t)}saveFocus(){this.focusManager.saveFocus()}restoreFocus(){this.focusManager.restoreFocus()}getAccessibilityMetrics(){return la.auditDocument()}validateElement(e){const t=[],r=la.hasAccessibleName(e),a=la.isKeyboardAccessible(e);return r||t.push("Missing accessible name (aria-label, aria-labelledby, or visible text)"),a||t.push("Not keyboard accessible (missing tabindex or disabled)"),{hasAccessibleName:r,isKeyboardAccessible:a,issues:t}}destroy(){this.liveRegionManager.clear(),this.focusManager.releaseFocusTrap(),document.removeEventListener("keydown",this.handleGlobalKeydown),this.initialized=!1}}function da(){return oa||(oa=new ca),oa}"undefined"!=typeof window&&(window.accessibilityManager=da());class ua{constructor(){this.PROXY_URL="https://uakari-indigo.fly.dev/",this.DNDBEYOND_API_BASE="https://character-service.dndbeyond.com/character/v5/character/",this.REQUEST_TIMEOUT=3e4,this.MAX_RETRIES=3}validateCharacterID(e){if(!e||"string"!=typeof e)return{valid:!1,error:"Character ID is required"};const t=e.trim(),r=t.match(/dndbeyond\.com\/characters\/(\d+)/);return r?{valid:!0,sanitized:r[1]}:t.match(/^\d+$/)?{valid:!0,sanitized:t}:{valid:!1,error:"Invalid format. Use character ID or D&D Beyond character URL"}}async fetchCharacter(e){const t=this.validateCharacterID(e);if(!t.valid)return{success:!1,error:t.error};const r=t.sanitized;console.log("Fetching character data for ID:",r);const a=`${this.PROXY_URL}${this.DNDBEYOND_API_BASE}${r}`;console.log("Fetch URL:",a);let o=null;for(let i=1;i<=this.MAX_RETRIES;i++)try{console.log(`Fetch attempt ${i}/${this.MAX_RETRIES}`);const e=new AbortController,t=setTimeout(()=>e.abort(),this.REQUEST_TIMEOUT),r=await fetch(a,{method:"GET",headers:{Accept:"application/json","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Origin:"https://www.dndbeyond.com","X-Requested-With":"XMLHttpRequest"},signal:e.signal});if(clearTimeout(t),!r.ok)return{success:!1,error:this.getErrorMessage(r.status),statusCode:r.status};let o,s;try{o=await r.json()}catch(n){return{success:!1,error:`JSON parsing error: ${n.message}`}}if(o.success&&o.data)s=o.data;else{if(!o.id||!o.name)return{success:!1,error:"Invalid response format from D&D Beyond API"};s=o}return this.isValidCharacterData(s)?(console.log("Character data fetched successfully:",s.name),{success:!0,data:s}):{success:!1,error:"Invalid character data received from D&D Beyond"}}catch(error){if(o=error,console.warn(`Fetch attempt ${i} failed:`,error),this.isNonRetryableError(error))break;if(i<this.MAX_RETRIES){const e=1e3*Math.pow(2,i);await new Promise(t=>setTimeout(t,e))}}return{success:!1,error:this.formatFinalError(o)}}getErrorMessage(e){switch(e){case 401:return"Character not found or not public. Ensure character visibility is set to Public.";case 403:return"Access denied. Character must be set to Public visibility.";case 404:return"Character not found. Please check the character ID.";case 429:return"Rate limit exceeded. Please wait before trying again.";case 500:case 502:case 503:return"D&D Beyond server error. Please try again later.";default:return`Unable to fetch character data (Error ${e}). Please try again.`}}isValidCharacterData(e){return e&&"object"==typeof e&&"number"==typeof e.id&&"string"==typeof e.name&&e.name.length>0}isNonRetryableError(e){return"AbortError"===e.name||e.message.includes("401")||e.message.includes("403")||e.message.includes("404")}formatFinalError(e){return e?"AbortError"===e.name?"Request timed out. Please check your connection and try again.":e.message.includes("Failed to fetch")||e.message.includes("NetworkError")?"Network error. Please check your internet connection and try again.":e.message.includes("CORS")?"CORS error. The proxy service may be temporarily unavailable.":`Network error: ${e.message}. Please try again.`:"Unknown error occurred while fetching character data"}async checkServiceHealth(){try{return(await fetch(this.PROXY_URL,{method:"HEAD",timeout:5e3})).ok}catch(error){return console.warn("Proxy service health check failed:",error),!1}}}const pa=new ua;class ga{constructor(){this.alignmentConfig=null,this.abilityConfig=null,this.currencyConfig=null,this.gameRulesConfig=null}static getInstance(){return ga.instance||(ga.instance=new ga),ga.instance}async loadConfigs(){try{const[e,t,r,a]=await Promise.all([this.loadConfig("/src/config/dnd5e/alignments.json"),this.loadConfig("/src/config/dnd5e/abilities.json"),this.loadConfig("/src/config/dnd5e/currencies.json"),this.loadConfig("/src/config/dnd5e/game-rules.json")]);this.alignmentConfig=e,this.abilityConfig=t,this.currencyConfig=r,this.gameRulesConfig=a,console.log("✅ Game configuration loaded successfully")}catch(error){throw console.error("❌ Failed to load game configuration:",error),error}}async loadConfig(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to load config from ${e}: ${t.statusText}`);return await t.json()}getAlignmentName(e){if(!this.alignmentConfig)return console.warn("Alignment config not loaded, using fallback"),"True Neutral";const t=e?.toString()||"5";return this.alignmentConfig.mappings[t]||this.alignmentConfig.default}getAbilities(){return this.abilityConfig?this.abilityConfig.abilities:(console.warn("Ability config not loaded, using fallback"),[{id:1,name:"strength",displayName:"Strength",abbreviation:"STR"},{id:2,name:"dexterity",displayName:"Dexterity",abbreviation:"DEX"},{id:3,name:"constitution",displayName:"Constitution",abbreviation:"CON"},{id:4,name:"intelligence",displayName:"Intelligence",abbreviation:"INT"},{id:5,name:"wisdom",displayName:"Wisdom",abbreviation:"WIS"},{id:6,name:"charisma",displayName:"Charisma",abbreviation:"CHA"}])}calculateAbilityModifier(e){return Math.floor((e-10)/2)}getDefaultAbilityScore(){return this.abilityConfig?.calculations.defaultScore||10}getCurrencies(){return this.currencyConfig?this.currencyConfig.currencies:[{name:"PP",displayName:"Platinum Pieces",value:10},{name:"GP",displayName:"Gold Pieces",value:1},{name:"EP",displayName:"Electrum Pieces",value:.5},{name:"SP",displayName:"Silver Pieces",value:.1},{name:"CP",displayName:"Copper Pieces",value:.01}]}calculateProficiencyBonus(e){return this.gameRulesConfig?e>=17?6:e>=13?5:e>=9?4:e>=5?3:2:Math.ceil(e/4)+1}getBaseArmorClass(){return this.gameRulesConfig?.armorClass.baseAC||10}getDefaultSize(){return this.gameRulesConfig?.sizes.default||"Medium"}getHitDiceTypes(){return this.gameRulesConfig?.hitDice.types||["d6","d8","d10","d12"]}getDefaultHitDie(){return this.gameRulesConfig?.hitDice.default||"d8"}isLoaded(){return!!(this.alignmentConfig&&this.abilityConfig&&this.currencyConfig&&this.gameRulesConfig)}}const ma=ga.getInstance();class ha{static find(e,t="",r=""){if(!e||"object"!=typeof e)return[];const a=[],o=[e],n=new WeakSet;for(;o.length>0;){const e=o.pop();if(e&&"object"==typeof e&&!n.has(e)){n.add(e);for(const[n,i]of Object.entries(e))"object"==typeof i&&null!==i&&o.push(i),((""===t||n===t)&&(""===r||i===r)||t===n&&""===r||r===i&&""===t)&&(a.includes(e)||a.push(e))}}return a}static findAdvanced(e,t,r={}){if(!e||"object"!=typeof e)return[];const{maxDepth:a=50,includeArrays:o=!0,caseSensitive:n=!0,excludeKeys:i=[]}=r,s=[],l=[{obj:e,depth:0}],c=new WeakSet;for(;l.length>0;){const{obj:e,depth:r}=l.pop();if(!(!e||"object"!=typeof e||c.has(e)||r>a)){c.add(e);for(const[a,c]of Object.entries(e))i.includes(a)||("object"==typeof c&&null!==c&&(!o&&Array.isArray(c)||l.push({obj:c,depth:r+1})),this.matchesCriteria(a,c,t,n)&&(s.includes(e)||s.push(e)))}}return s}static findByEntityType(e,t){return this.find(e,"entityTypeId",t.toString())}static findByType(e,t){return this.find(e,"type",t)}static findByValue(e,t){return this.find(e,"",t)}static findByKey(e,t){return this.find(e,t,"")}static matchesCriteria(e,t,r,a){const{key:o,value:n,matchMode:i="exact"}=r;let s=!0;if(void 0!==o){const t=a?e:e.toLowerCase(),r=a?o:o.toLowerCase();switch(i){case"partial":s=t.includes(r);break;case"regex":s=new RegExp(r,a?"g":"gi").test(t);break;default:s=t===r}}let l=!0;if(void 0!==n)if("string"==typeof t&&"string"==typeof n){const e=a?t:t.toLowerCase(),r=a?n:n.toLowerCase();switch(i){case"partial":l=e.includes(r);break;case"regex":l=new RegExp(r,a?"g":"gi").test(e);break;default:l=e===r}}else l=t===n;return s&&l}static getAllKeys(e,t=10){const r=new Set,a=[{obj:e,depth:0}],o=new WeakSet;for(;a.length>0;){const{obj:e,depth:n}=a.pop();if(!(!e||"object"!=typeof e||o.has(e)||n>t)){o.add(e);for(const[t,o]of Object.entries(e))r.add(t),"object"==typeof o&&null!==o&&a.push({obj:o,depth:n+1})}}return Array.from(r).sort()}}class fa{static sanitizeForXML(e,t={}){if(null==e||""===e)return"";const r=String(e),{maxLength:a=1e3,allowNewlines:o=!1,allowTabs:n=!1,preserveSpaces:i=!0,removeEventHandlers:s=!0,removeDangerousProtocols:l=!0}=t;let c=r;return l&&(c=c.replace(/javascript:/gi,"").replace(/vbscript:/gi,"").replace(/data:/gi,"")),s&&(c=c.replace(/on\w+\s*=/gi,"")),o||(c=c.replace(/\n/g," "),c=c.replace(/\r/g," ")),n||(c=c.replace(/\t/g," ")),c=o&&n?c.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""):o?c.replace(/[\x00-\x08\x0B-\x0C\x0E-\x1F\x7F]/g,""):n?c.replace(/[\x00-\x08\x0A\x0B\x0C\x0D\x0E-\x1F\x7F]/g,""):c.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""),c=c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/=/g,"&#x3D;").replace(/\//g,"&#x2F;"),c=c.substring(0,a),i?c.trim():c.replace(/\s+/g," ").trim()}static sanitizeWithReport(e,t={}){if(null==e||""===e)return{sanitized:"",wasModified:!1,originalLength:0,finalLength:0,removedPatterns:[]};const r=String(e),a=r.length,o=[];let n=r;/javascript:/gi.test(n)&&o.push("javascript: protocol"),/vbscript:/gi.test(n)&&o.push("vbscript: protocol"),/data:/gi.test(n)&&o.push("data: protocol"),/on\w+\s*=/gi.test(n)&&o.push("event handlers"),/[\x00-\x1F\x7F]/.test(n)&&o.push("control characters");const i=this.sanitizeForXML(e,t);return{sanitized:i,wasModified:i!==r,originalLength:a,finalLength:i.length,removedPatterns:o}}static sanitizeHTML(e,t={}){if(null==e||""===e)return"";const{maxLength:r=1e4,allowNewlines:a=!0,allowTabs:o=!1}=t;let n=String(e).substring(0,r).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x2F;/g,"/");return n=n.replace(/&rsquo;/g,"'").replace(/&lsquo;/g,"'").replace(/&rdquo;/g,'"').replace(/&ldquo;/g,'"').replace(/&ndash;/g,"-").replace(/&mdash;/g,"-").replace(/&#34;/g,'"').replace(/&nbsp;/g," "),n=n.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/\s*on\w+\s*=\s*[^>\s]*/gi,"").replace(/javascript:/gi,"").replace(/vbscript:/gi,""),a||(n=n.replace(/\n/g," ").replace(/\r/g," ")),o||(n=n.replace(/\t/g," ")),a||o||(n=n.replace(/\s+/g," ")),n.trim().substring(0,r)}static sanitizeText(e,t={}){if(null==e||""===e)return"";const{maxLength:r=1e3,allowNewlines:a=!1,allowTabs:o=!1}=t;let n=String(e);return a||(n=n.replace(/[\n\r]/g," ")),o||(n=n.replace(/\t/g," ")),n=a&&o?n.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""):a?n.replace(/[\x00-\x08\x0B-\x0C\x0E-\x1F\x7F]/g,""):o?n.replace(/[\x00-\x08\x0A\x0B\x0C\x0D\x0E-\x1F\x7F]/g,""):n.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""),n=n.substring(0,r),a||o||(n=n.replace(/\s+/g," ")),n.trim()}static escapeXMLAttribute(e){return null==e||""===e?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}static isXMLSafe(e){return!e||"string"!=typeof e||![/javascript:/gi,/vbscript:/gi,/on\w+\s*=/gi,/<script/gi,/<iframe/gi,/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/].some(t=>t.test(e))}static normalizeToASCII(e){return null==e||""===e?"":String(e).replace(/[\u2018\u2019]/g,"'").replace(/[\u201c\u201d]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/[\u2026]/g,"...").replace(/[àáâãäå]/g,"a").replace(/[ÀÁÂÃÄÅ]/g,"A").replace(/[èéêë]/g,"e").replace(/[ÈÉÊË]/g,"E").replace(/[ìíîï]/g,"i").replace(/[ÌÍÎÏ]/g,"I").replace(/[òóôõö]/g,"o").replace(/[ÒÓÔÕÖ]/g,"O").replace(/[ùúûü]/g,"u").replace(/[ÙÚÛÜ]/g,"U").replace(/[ñ]/g,"n").replace(/[Ñ]/g,"N").replace(/[ç]/g,"c").replace(/[Ç]/g,"C")}}class ba{static get(e,t,r=null,a={}){const{throwOnError:o=!1,logWarnings:n=!0,maxDepth:i=50,caseSensitive:s=!0}=a;try{if(!e||"object"!=typeof e)return r;if(!t||"string"!=typeof t)return r;const a=t.split(".");if(a.length>i){const e=`Path depth exceeds maximum (${i}): ${t}`;if(n&&console.warn(e),o)throw new Error(e);return r}let l=e,c="";for(let e=0;e<a.length;e++){const t=a[e];if(c+=(e>0?".":"")+t,null==l)return r;if("object"!=typeof l)return r;let o=t;if(!s&&!(t in l)){const e=Object.keys(l).find(e=>e.toLowerCase()===t.toLowerCase());e&&(o=e)}if(!(o in l))return r;l=l[o]}return null!=l?l:r}catch(error){const a=`Safe access failed for path: ${t}`;if(n&&console.warn(a,error),o)throw new Error(`${a}: ${error instanceof Error?error.message:String(error)}`);return r}}static getWithResult(e,t,r={}){const{maxDepth:a=50,caseSensitive:o=!0}=r;if(!e||"object"!=typeof e)return{value:null,found:!1,path:t,depth:0,error:"Invalid object provided"};if(!t||"string"!=typeof t)return{value:null,found:!1,path:t,depth:0,error:"Invalid path provided"};try{const r=t.split(".");if(r.length>a)return{value:null,found:!1,path:t,depth:r.length,error:`Path depth exceeds maximum (${a})`};let n=e,i=0;for(const e of r){if(i++,null==n||"object"!=typeof n)return{value:null,found:!1,path:t,depth:i,error:`Cannot access property '${e}' on ${typeof n}`};let r=e;if(!o&&!(e in n)){const t=Object.keys(n).find(t=>t.toLowerCase()===e.toLowerCase());t&&(r=t)}if(!(r in n))return{value:null,found:!1,path:t,depth:i,error:`Property '${e}' not found`};n=n[r]}return{value:n,found:!0,path:t,depth:i,error:void 0}}catch(error){return{value:null,found:!1,path:t,depth:0,error:error instanceof Error?error.message:String(error)}}}static has(e,t,r={}){const a=this.getWithResult(e,t,r);return a.found&&null!==a.value&&void 0!==a.value}static getMultiple(e,t,r={}){const a={};for(const o of t)a[o]=this.get(e,o,null,r);return a}static set(e,t,r,a={}){const{maxDepth:o=50,caseSensitive:n=!0}=a;try{if(!e||"object"!=typeof e)return!1;if(!t||"string"!=typeof t)return!1;const a=t.split(".");if(a.length>o)return!1;let n=e;for(let e=0;e<a.length-1;e++){const t=a[e];t in n&&"object"==typeof n[t]&&null!==n[t]||(n[t]={}),n=n[t]}return n[a[a.length-1]]=r,!0}catch(error){return a.logWarnings&&console.warn(`Safe set failed for path: ${t}`,error),!1}}static delete(e,t,r={}){try{if(!e||"object"!=typeof e)return!1;const a=t.split("."),o=a.slice(0,-1).join("."),n=a[a.length-1];if(1===a.length)return n in e&&(delete e[n],!0);const i=this.get(e,o,null,r);return!(!i||"object"!=typeof i||!(n in i)||(delete i[n],0))}catch(error){return r.logWarnings&&console.warn(`Safe delete failed for path: ${t}`,error),!1}}static getAllPaths(e,t=10,r=""){const a=[];if(!e||"object"!=typeof e||t<=0)return a;for(const[o,n]of Object.entries(e)){const e=r?`${r}.${o}`:o;if(a.push(e),"object"==typeof n&&null!==n&&t>1){const r=this.getAllPaths(n,t-1,e);a.push(...r)}}return a.sort()}}const va=["strength","dexterity","constitution","intelligence","wisdom","charisma"],ya=[{id:1,name:"strength",abbreviation:"STR",description:"Measures physical power and carrying capacity"},{id:2,name:"dexterity",abbreviation:"DEX",description:"Measures agility, reflexes, and balance"},{id:3,name:"constitution",abbreviation:"CON",description:"Measures health, stamina, and vital force"},{id:4,name:"intelligence",abbreviation:"INT",description:"Measures reasoning ability, memory, and analytical thinking"},{id:5,name:"wisdom",abbreviation:"WIS",description:"Measures awareness, intuition, and insight"},{id:6,name:"charisma",abbreviation:"CHA",description:"Measures force of personality, leadership, and confidence"}];class wa{static calculateModifier(e){return Math.floor((e-10)/2)}static getAbilityById(e){return ya.find(t=>t.id===e)||null}static getAbilityByName(e){return ya.find(t=>t.name.toLowerCase()===e.toLowerCase())||null}static getAbilityIdByName(e){const t=va.indexOf(e.toLowerCase());return t>=0?t+1:0}static getAbilityNameById(e){return va[e-1]||null}static getAbbreviation(e){const t=this.getAbilityByName(e);return t?t.abbreviation:null}static isValidScore(e,t=!0){return e>=1&&e<=(t?30:20)}static calculateAllModifiers(e){return e.map((e,t)=>({score:e,modifier:this.calculateModifier(e)}))}static calculateSaveBonus(e,t,r){return this.calculateModifier(e)+(r?t:0)}static calculateCarryingCapacity(e,t=!1){const r=t?2:1,a=15*e*r;return{normal:5*e*r,encumbered:10*e*r,heavilyEncumbered:a,maximum:a,liftPushDrag:30*e*r}}static convertLegacyAbilities(e,t,r){const a={};return va.forEach((o,n)=>{const i=e?.[n]?.value||10,s=t?.[n]?.value||0,l=r?.[n]?.value;a[o]=null!=l?l:i+s}),a}}class xa{static{this.debugEnabled=!1}static setDebugMode(e){this.debugEnabled=e}static debugAbilityModifierSources(e){if(!this.debugEnabled)return;if(console.group("🔍 Detailed Ability Score Modifier Analysis"),console.log("📊 Base Ability Scores:"),e.stats&&Array.isArray(e.stats)?e.stats.forEach((e,t)=>{const r=va[t];console.log(`  ${r}: ${e.value||10} (base)`)}):console.log("  No base stats found - using defaults (10)"),console.log("\n💪 Existing Bonus Stats (from D&D Beyond):"),e.bonusStats&&Array.isArray(e.bonusStats)){let t=!1;e.bonusStats.forEach((e,r)=>{const a=va[r];e.value&&e.value>0&&(console.log(`  ${a}: +${e.value} (pre-calculated by D&D Beyond)`),t=!0)}),t||console.log("  No existing bonus stats from D&D Beyond")}else console.log("  No existing bonus stats from D&D Beyond");if(console.log("\n🔄 Override Stats:"),e.overrideStats&&Array.isArray(e.overrideStats)){let t=!1;e.overrideStats.forEach((e,r)=>{const a=va[r];null!==e.value&&void 0!==e.value&&(console.log(`  ${a}: ${e.value} (OVERRIDE - replaces base + bonuses)`),t=!0)}),t||console.log("  No overrides found")}else console.log("  No override stats found");const t=["race","class","background","item","feat"];t.forEach(t=>{if(console.log(`\n🎯 ${t.toUpperCase()} Modifiers:`),!e.modifiers||!e.modifiers[t])return void console.log(`  No ${t} modifiers found`);const r=e.modifiers[t];let a=0,o=0;r.forEach((e,t)=>{if("bonus"===e.type&&e.subType&&e.subType.endsWith("-score")){const t=e.subType.replace("-score",""),r=e.fixedValue||0;console.log(`    ✅ ${t}-score: +${r} ${e.friendlyTypeName?`(${e.friendlyTypeName})`:""}`),(e.componentId||e.componentTypeId)&&console.log(`       🔗 Component: ${e.componentId||"N/A"} (Type: ${e.componentTypeId||"N/A"})`),(e.entityId||e.entityTypeId)&&console.log(`       🎲 Entity: ${e.entityId||"N/A"} (Type: ${e.entityTypeId||"N/A"})`),a++}else console.log(`    ⚙️  ${e.subType||"unknown"}: ${e.fixedValue||0} (${e.type||"unknown"})`),o++}),console.log(`  📈 Summary: ${a} ability modifiers, ${o} other modifiers`)}),console.log("\n🎯 Final Ability Score Breakdown:"),console.log("  [Comparing D&D Beyond pre-calculated vs manually calculated bonuses]"),va.forEach((r,a)=>{const o=e.stats?.[a]?.value||10,n=e.bonusStats?.[a]?.value||0,i=e.overrideStats?.[a]?.value;let s=0;t.forEach(t=>{e.modifiers?.[t]&&e.modifiers[t].forEach(e=>{if("bonus"===e.type&&e.subType===`${r}-score`){const t=parseInt(String(e.fixedValue))||0;t>0&&(s+=t)}})});const l=null!=i?i:o+n,c=null!=i?i:o+s,d=wa.calculateModifier(l),u=wa.calculateModifier(c),p=n!==s?" ⚠️  MISMATCH!":"";console.log(`  ${r.padEnd(12)} ${o.toString().padStart(2)} (base) + ${n.toString().padStart(2)} (D&DB) = ${l.toString().padStart(2)} [${d>=0?"+":""}${d}]`),console.log(`  ${" ".padEnd(12)} ${o.toString().padStart(2)} (base) + ${s.toString().padStart(2)} (calc) = ${c.toString().padStart(2)} [${u>=0?"+":""}${u}]${p}`),console.log("")}),console.groupEnd()}static processAbilityScoreBonuses(e){console.log("AbilityScoreProcessor: Processing ability score bonuses from all sources..."),this.debugAbilityModifierSources(e);const t=[];!e.bonusStats||e.bonusStats;let r=[];for(let n=1;n<=6;n++)r.push({id:n,name:null,value:0});["race","class","background","item","feat"].forEach(a=>{e.modifiers&&e.modifiers[a]&&e.modifiers[a].forEach(e=>{if("bonus"===e.type&&e.subType&&e.subType.endsWith("-score")){const o=e.subType.replace("-score",""),n=wa.getAbilityIdByName(o);if(n>0&&null!==e.fixedValue&&void 0!==e.fixedValue){const i=parseInt(String(e.fixedValue))||0;i>0&&r[n-1]&&(r[n-1].value+=i,t.push({source:a,ability:o,bonus:i}),console.log(`Applied ${a} bonus: +${i} to ${o} (ID: ${n})`))}}})});const a={};va.forEach((t,o)=>{const n=o+1,i=this.getTotalAbilityScore(e,n,r),s=e.stats?.find(e=>e.id===n),l=s?.value||10,c=r[o]?.value||0,d=e.overrideStats?.find(e=>e.id===n),u=d?.value||null;a[t]={base:l,bonus:c,override:u,total:i,modifier:wa.calculateModifier(i)}});const o=va.map((e,t)=>({ability:e,bonus:r[t]?.value||0})).filter(e=>e.bonus>0);return console.log("Final ability score bonuses:"),o.forEach(({ability:e,bonus:t})=>{console.log(`  ${e}: +${t}`)}),{processedBonuses:r,totalScores:a,debugInfo:{appliedBonuses:t,finalBonusSummary:o}}}static getTotalAbilityScore(e,t,r){let a=10;e.stats&&e.stats.length>=t&&(a=e.stats[t-1]?.value||10);let o=0;const n=r||e.bonusStats;n&&n.length>=t&&(o=n[t-1]?.value||0);let i=null;return e.overrideStats&&e.overrideStats.length>=t&&(i=e.overrideStats[t-1]?.value),null!==i?i:a+o}static processLegacyFormat(e){const t=this.processAbilityScoreBonuses(e);return va.map((e,r)=>{const a=r+1,o=t.totalScores[e],n=t.debugInfo.appliedBonuses.filter(t=>t.ability===e),i=n.filter(e=>"race"===e.source).reduce((e,t)=>e+t.bonus,0),s=n.filter(e=>"feat"===e.source).reduce((e,t)=>e+t.bonus,0),l=n.filter(e=>"item"===e.source).reduce((e,t)=>e+t.bonus,0);return{id:a,name:e,base:o?.base||10,racial:i,feat:s,item:l,total:o?.total||10,modifier:o?.modifier||0}})}static validateCharacterData(e){const t=[],r=[];return e?(e.stats&&Array.isArray(e.stats)?e.stats.length<6&&r.push(`Character stats array has ${e.stats.length} entries, expected 6`):r.push("Character stats array is missing or invalid - will use defaults"),e.bonusStats&&!Array.isArray(e.bonusStats)&&r.push("Character bonusStats is not an array - will initialize"),e.overrideStats&&!Array.isArray(e.overrideStats)&&r.push("Character overrideStats is not an array"),e.modifiers&&"object"!=typeof e.modifiers&&r.push("Character modifiers is not an object"),e.modifiers&&["race","class","background","item","feat"].forEach(t=>{e.modifiers[t]&&!Array.isArray(e.modifiers[t])&&r.push(`Character modifiers.${t} is not an array`)}),{isValid:0===t.length,issues:t,warnings:r}):(t.push("Character data is null or undefined"),{isValid:!1,issues:t,warnings:r})}}const Sa={1:{1:2,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},2:{1:3,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},3:{1:4,2:2,3:0,4:0,5:0,6:0,7:0,8:0,9:0},4:{1:4,2:3,3:0,4:0,5:0,6:0,7:0,8:0,9:0},5:{1:4,2:3,3:2,4:0,5:0,6:0,7:0,8:0,9:0},6:{1:4,2:3,3:3,4:0,5:0,6:0,7:0,8:0,9:0},7:{1:4,2:3,3:3,4:1,5:0,6:0,7:0,8:0,9:0},8:{1:4,2:3,3:3,4:2,5:0,6:0,7:0,8:0,9:0},9:{1:4,2:3,3:3,4:3,5:1,6:0,7:0,8:0,9:0},10:{1:4,2:3,3:3,4:3,5:2,6:0,7:0,8:0,9:0},11:{1:4,2:3,3:3,4:3,5:2,6:1,7:0,8:0,9:0},12:{1:4,2:3,3:3,4:3,5:2,6:1,7:0,8:0,9:0},13:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:0,9:0},14:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:0,9:0},15:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:1,9:0},16:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:1,9:0},17:{1:4,2:3,3:3,4:3,5:2,6:1,7:1,8:1,9:1},18:{1:4,2:3,3:3,4:3,5:3,6:1,7:1,8:1,9:1},19:{1:4,2:3,3:3,4:3,5:3,6:2,7:1,8:1,9:1},20:{1:4,2:3,3:3,4:3,5:3,6:2,7:2,8:1,9:1}},ka={1:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},2:{1:2,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},3:{1:3,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},4:{1:3,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},5:{1:4,2:2,3:0,4:0,5:0,6:0,7:0,8:0,9:0},6:{1:4,2:2,3:0,4:0,5:0,6:0,7:0,8:0,9:0},7:{1:4,2:3,3:0,4:0,5:0,6:0,7:0,8:0,9:0},8:{1:4,2:3,3:0,4:0,5:0,6:0,7:0,8:0,9:0},9:{1:4,2:3,3:2,4:0,5:0,6:0,7:0,8:0,9:0},10:{1:4,2:3,3:2,4:0,5:0,6:0,7:0,8:0,9:0},11:{1:4,2:3,3:3,4:0,5:0,6:0,7:0,8:0,9:0},12:{1:4,2:3,3:3,4:0,5:0,6:0,7:0,8:0,9:0},13:{1:4,2:3,3:3,4:1,5:0,6:0,7:0,8:0,9:0},14:{1:4,2:3,3:3,4:1,5:0,6:0,7:0,8:0,9:0},15:{1:4,2:3,3:3,4:2,5:0,6:0,7:0,8:0,9:0},16:{1:4,2:3,3:3,4:2,5:0,6:0,7:0,8:0,9:0},17:{1:4,2:3,3:3,4:3,5:1,6:0,7:0,8:0,9:0},18:{1:4,2:3,3:3,4:3,5:1,6:0,7:0,8:0,9:0},19:{1:4,2:3,3:3,4:3,5:2,6:0,7:0,8:0,9:0},20:{1:4,2:3,3:3,4:3,5:2,6:0,7:0,8:0,9:0}},Ca={1:{1:2,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},2:{1:2,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},3:{1:2,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},4:{1:3,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},5:{1:3,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},6:{1:3,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},7:{1:4,2:2,3:0,4:0,5:0,6:0,7:0,8:0,9:0},8:{1:4,2:2,3:0,4:0,5:0,6:0,7:0,8:0,9:0},9:{1:4,2:2,3:0,4:0,5:0,6:0,7:0,8:0,9:0},10:{1:4,2:3,3:0,4:0,5:0,6:0,7:0,8:0,9:0},11:{1:4,2:3,3:0,4:0,5:0,6:0,7:0,8:0,9:0},12:{1:4,2:3,3:0,4:0,5:0,6:0,7:0,8:0,9:0},13:{1:4,2:3,3:2,4:0,5:0,6:0,7:0,8:0,9:0},14:{1:4,2:3,3:2,4:0,5:0,6:0,7:0,8:0,9:0},15:{1:4,2:3,3:2,4:0,5:0,6:0,7:0,8:0,9:0},16:{1:4,2:3,3:3,4:0,5:0,6:0,7:0,8:0,9:0},17:{1:4,2:3,3:3,4:0,5:0,6:0,7:0,8:0,9:0},18:{1:4,2:3,3:3,4:0,5:0,6:0,7:0,8:0,9:0},19:{1:4,2:3,3:3,4:1,5:0,6:0,7:0,8:0,9:0},20:{1:4,2:3,3:3,4:1,5:0,6:0,7:0,8:0,9:0}},_a={1:{warlockLevel:1,slotLevel:1,slotCount:1,shortRestRecharge:!0},2:{warlockLevel:2,slotLevel:1,slotCount:2,shortRestRecharge:!0},3:{warlockLevel:3,slotLevel:2,slotCount:2,shortRestRecharge:!0},4:{warlockLevel:4,slotLevel:2,slotCount:2,shortRestRecharge:!0},5:{warlockLevel:5,slotLevel:3,slotCount:2,shortRestRecharge:!0},6:{warlockLevel:6,slotLevel:3,slotCount:2,shortRestRecharge:!0},7:{warlockLevel:7,slotLevel:4,slotCount:2,shortRestRecharge:!0},8:{warlockLevel:8,slotLevel:4,slotCount:2,shortRestRecharge:!0},9:{warlockLevel:9,slotLevel:5,slotCount:2,shortRestRecharge:!0},10:{warlockLevel:10,slotLevel:5,slotCount:2,shortRestRecharge:!0},11:{warlockLevel:11,slotLevel:5,slotCount:3,shortRestRecharge:!0},12:{warlockLevel:12,slotLevel:5,slotCount:3,shortRestRecharge:!0},13:{warlockLevel:13,slotLevel:5,slotCount:3,shortRestRecharge:!0},14:{warlockLevel:14,slotLevel:5,slotCount:3,shortRestRecharge:!0},15:{warlockLevel:15,slotLevel:5,slotCount:3,shortRestRecharge:!0},16:{warlockLevel:16,slotLevel:5,slotCount:3,shortRestRecharge:!0},17:{warlockLevel:17,slotLevel:5,slotCount:4,shortRestRecharge:!0},18:{warlockLevel:18,slotLevel:5,slotCount:4,shortRestRecharge:!0},19:{warlockLevel:19,slotLevel:5,slotCount:4,shortRestRecharge:!0},20:{warlockLevel:20,slotLevel:5,slotCount:4,shortRestRecharge:!0}},Ea={bard:"full",cleric:"full",druid:"full",sorcerer:"full",wizard:"full",paladin:"half",ranger:"half",artificer:"third",fighter:"third",rogue:"third",warlock:"pact"},Fa={fighter:["eldritch_knight"],rogue:["arcane_trickster"],ranger:[]};class $a{static{this.debugEnabled=!1}static setDebugMode(e){this.debugEnabled=e}calculateSpellSlots(e,t=this.getDefaultOptions()){($a.debugEnabled||Kr.isEnabled("spell_slot_calculator_debug"))&&console.log("🔮 SpellSlotCalculator: Calculating spell slots",{classCount:e.length,classes:e.map(e=>`${e.classDefinition.name}${e.level}`),options:t});const r=this.analyzeSpellcastingClasses(e,t),a=r.filter(e=>"none"!==e.casterType),o=a.some(e=>e.isPactMagic),n=a.some(e=>!e.isPactMagic&&"none"!==e.casterType);let i,s,l,c;if(o&&!n)i="pact_magic_only",s=this.getEmptySpellSlots(),l=this.calculatePactMagicSlots(r),c=0;else if(1===a.length)i="single_class",s=this.calculateSingleClassSpellSlots(a[0]),l=this.getEmptySpellSlots(),c=a[0].casterLevel;else if(a.length>1){i="multiclass";const e=this.calculateMulticlassSpellSlots(r,t);s=e.regularSpellSlots,l=e.pactMagicSlots,c=e.totalCasterLevel}else i="single_class",s=this.getEmptySpellSlots(),l=this.getEmptySpellSlots(),c=0;const d={spellSlots:s,pactMagicSlots:l,multiclassCasterLevel:c,totalCasterClasses:a.length,debugInfo:{classBreakdown:r,calculationMethod:i,casterLevelCalculation:this.buildCasterLevelCalculation(r)}};return($a.debugEnabled||Kr.isEnabled("spell_slot_calculator_debug"))&&console.log("🔮 SpellSlotCalculator: Result",{method:i,multiclassCasterLevel:c,totalCasterClasses:a.length,spellSlots:this.summarizeSpellSlots(s),pactMagic:this.summarizeSpellSlots(l)}),d}generateSpellSlotsXML(e){const t=this.generateRegularSpellSlotsXML(e.spellSlots),r=this.generatePactMagicSlotsXML(e.pactMagicSlots);return{spellSlotsXML:t,pactMagicXML:r,combinedXML:this.combineSpellSlotXML(t,r)}}analyzeSpellcastingClasses(e,t){return e.map(e=>{const r=e.classDefinition.name.toLowerCase(),a=Ea[r]||"none";let o=a;if("third"!==a&&"none"!==a||this.checkSpellcastingSubclass(e)||(o="none"),"ranger"===r&&t.handleSpelllessRanger){const t=e.subclassDefinition?.name.toLowerCase().replace(/\s+/g,"_");"spellless"!==t&&"beast_master_spellless"!==t||(o="none")}const n="warlock"===r;return{className:r,casterType:o,casterLevel:this.calculateClassCasterLevel(e,o),spellSlots:this.getSpellSlotsForProgression(o,e.level,r),isPactMagic:n,spellcastingAbility:this.getSpellcastingAbility(r),actualClassLevel:e.level}})}checkSpellcastingSubclass(e){const t=e.classDefinition.name.toLowerCase(),r=e.subclassDefinition?.name.toLowerCase().replace(/\s+/g,"_");if(!r)return!1;const a=Fa[t];return!!a&&(0===a.length||a.includes(r))}calculateClassCasterLevel(e,t){switch(t){case"full":return e.level;case"half":return Math.floor(e.level/2);case"third":return Math.floor(e.level/3);default:return 0}}getSpellSlotsForProgression(e,t,r){if("none"===e)return this.getEmptySpellSlots();switch(e){case"full":return Sa[t]||this.getEmptySpellSlots();case"half":return ka[t]||this.getEmptySpellSlots();case"third":return"artificer"===r?Ca[t]||this.getEmptySpellSlots():t<3?this.getEmptySpellSlots():Ca[t]||this.getEmptySpellSlots();case"pact":return this.convertPactMagicToSpellSlots(t);default:return this.getEmptySpellSlots()}}calculateSingleClassSpellSlots(e){return e.spellSlots}calculateMulticlassSpellSlots(e,t){const r=e.filter(e=>!e.isPactMagic&&"none"!==e.casterType),a=e.filter(e=>e.isPactMagic),o=r.reduce((e,t)=>e+t.casterLevel,0);return{regularSpellSlots:Sa[o]||this.getEmptySpellSlots(),pactMagicSlots:a.length>0?this.calculatePactMagicSlots(a):this.getEmptySpellSlots(),totalCasterLevel:o}}calculatePactMagicSlots(e){const t=e.find(e=>"warlock"===e.className);return t&&t.actualClassLevel?this.convertPactMagicToSpellSlots(t.actualClassLevel):this.getEmptySpellSlots()}convertPactMagicToSpellSlots(e){const t=_a[e];if(!t)return this.getEmptySpellSlots();const r=this.getEmptySpellSlots();return r[t.slotLevel]=t.slotCount,r}generateRegularSpellSlotsXML(e){let t="";for(let r=1;r<=9;r++)t+=`\t\t\t<spellslots${r}>\n`,t+=`\t\t\t\t<max type="number">${e[r]}</max>\n`,t+=`\t\t\t</spellslots${r}>\n`;return t}generatePactMagicSlotsXML(e){let t="";for(let r=1;r<=9;r++)t+=`\t\t\t<pactmagicslots${r}>\n`,t+=`\t\t\t\t<max type="number">${e[r]}</max>\n`,t+=`\t\t\t</pactmagicslots${r}>\n`;return t}combineSpellSlotXML(e,t){let r="\t\t<powermeta>\n";return r+=t,r+=e,r+="\t\t</powermeta>",r}getSpellcastingAbility(e){return{wizard:"INT",artificer:"INT",fighter:"INT",rogue:"INT",cleric:"WIS",druid:"WIS",ranger:"WIS",bard:"CHA",sorcerer:"CHA",warlock:"CHA",paladin:"CHA"}[e]}buildCasterLevelCalculation(e){return e.map(e=>({className:e.className,level:e.casterLevel,casterType:e.casterType,contributesToCasterLevel:e.isPactMagic?0:e.casterLevel}))}getEmptySpellSlots(){return{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0}}summarizeSpellSlots(e){return Object.entries(e).filter(([e,t])=>t>0).map(([e,t])=>`${e}:${t}`).join(", ")||"none"}getDefaultOptions(){return{includeDebugInfo:!0,strictMulticlassRules:!0,handleSpelllessRanger:!0,includePactMagicInMainSlots:!1}}static validateClassData(e){const t=[];return e.forEach((e,r)=>{e.classDefinition?.name||t.push(`Class at index ${r} missing name`),("number"!=typeof e.level||e.level<1||e.level>20)&&t.push(`Class ${e.classDefinition?.name||r} has invalid level: ${e.level}`)}),{isValid:0===t.length,errors:t}}static getSpellSlotsForClass(e,t,r){const a={id:1,level:t,classDefinition:{id:1,name:e,canCastSpells:!0},subclassDefinition:r?{id:1,name:r}:void 0};return(new $a).calculateSpellSlots([a]).spellSlots}static toLegacyFormat(e){return Object.entries(e).map(([e,t])=>({level:parseInt(e),slots:t}))}static validateClassInfo(e){const t=[];return e&&"object"==typeof e?(Array.isArray(e)||(e.classDefinition?.name||t.push("Class definition name is required"),("number"!=typeof e.level||e.level<1||e.level>20)&&t.push("Class level must be between 1 and 20")),{isValid:0===t.length,errors:t}):(t.push("Class info must be an object"),{isValid:!1,errors:t})}}class Aa{constructor(e){if(this.pounds=e,e<0)throw new Error("Weight cannot be negative")}add(e){return new Aa(this.pounds+e.pounds)}multiply(e){if(e<0)throw new Error("Weight multiplier cannot be negative");return new Aa(this.pounds*e)}isZero(){return 0===this.pounds}}class Da{constructor(e){if(this.amount=e,e<0)throw new Error("Quantity cannot be negative")}isZero(){return 0===this.amount}multiply(e){return e.multiply(this.amount)}}class La{padIndex(e){return String(e).padStart(5,"0")}generateItemXML(e,t,r=0){const a="\t".repeat(3),o="\t".repeat(4),n=this.padIndex(t);let i=`${a}<id-${n}>\n`;return i+=`${o}<count type="number">${e.count}</count>\n`,i+=`${o}<name type="string">${e.name}</name>\n`,i+=`${o}<weight type="number">${e.weight}</weight>\n`,i+=`${o}<locked type="number">${e.isLocked?1:0}</locked>\n`,i+=`${o}<isidentified type="number">${e.isIdentified?1:0}</isidentified>\n`,e.type&&(i+=`${o}<type type="string">${e.type}</type>\n`),e.cost&&(i+=`${o}<cost type="string">${e.cost.value} ${e.cost.denomination}</cost>\n`),e.description&&(i+=`${o}<description type="formattedtext">\n`,i+=`${o}\t<p>${e.description}</p>\n`,i+=`${o}</description>\n`),e.properties&&e.properties.length>0&&(i+=`${o}<properties type="string">${e.properties.join(", ")}</properties>\n`),e.location&&(i+=`${o}<location type="string">${e.location}</location>\n`),i+=`${a}</id-${n}>\n`,i}generateContainerXML(e,t,r,a=0){const o={id:e.id.toString(),name:e.definition.name,type:e.definition.subType||e.definition.filterType,weight:e.definition.weight,count:e.quantity,isIdentified:!0,isLocked:!1};return this.generateItemXML(o,r,a)}}class Ma{constructor(e){this.xml="",this.itemCount=0,this.strategy=e}reset(){return this.xml="",this.itemCount=0,this}addInventoryHeader(){return this.xml+="\t<inventorylist>\n",this}addInventoryFooter(){return this.xml+="\t</inventorylist>",this}addItem(e){return this.itemCount++,this.xml+=this.strategy.generateItemXML(e,this.itemCount,0),this}build(){return{xml:this.xml,itemCount:this.itemCount}}}class Ia{constructor(e=new La){this.xmlStrategy=e,this.xmlBuilder=new Ma(e)}processInventory(e,t,r=this.getDefaultOptions()){Kr.isEnabled("inventory_processor_debug")&&console.log("📦 InventoryProcessor: Processing inventory",{characterId:t,itemCount:e.length,options:r});const a=this.buildNestedStructure(e,t,r),o=this.generateInventoryXML(a,r),n=this.calculateStatistics(a),i={nestedStructure:a,xmlResult:o,statistics:n};return Kr.isEnabled("inventory_processor_debug")&&console.log("📦 InventoryProcessor: Processing complete",{totalItems:n.totalItems,containerCount:n.containerCount,xmlLength:o.xml.length}),i}buildNestedStructure(e,t,r){const a=new Map,o=new Map;e.forEach(e=>{const t=e.containerEntityId.toString();!r.includeZeroQuantityItems&&e.quantity<=0||(e.definition.isContainer&&o.set(e.id.toString(),{...e,definition:{...e.definition,isContainer:!0},contents:[],currentWeight:0}),a.has(t)||a.set(t,[]),a.get(t).push(e))});const n=t.toString(),i=a.get(n)||[];o.forEach((e,t)=>{const r=a.get(t)||[];e.contents=r,e.currentWeight=this.calculateContainerWeight(r)});const s=this.calculateTotalInventoryWeight(i,o);return{characterId:t,rootItems:i,containers:o,totalItems:e.length,totalWeight:s}}generateInventoryXML(e,t){this.xmlBuilder.reset().addInventoryHeader();let r=0,a=0,o=0;const n=[];e.rootItems.forEach(e=>{if(e.quantity<=0&&!t.includeZeroQuantityItems)return void a++;const i=this.convertItemToXMLFormat(e,t);this.xmlBuilder.addItem(i),r++,e.definition.isContainer&&(o++,0===e.definition.weightMultiplier&&n.push(e.definition.name))}),e.containers.forEach((e,o)=>{e.contents.forEach(o=>{if(o.quantity<=0&&!t.includeZeroQuantityItems)return void a++;const n=this.convertItemToXMLFormat(o,t);n.location=e.definition.name,this.xmlBuilder.addItem(n),r++})});const{xml:i,itemCount:s}=this.xmlBuilder.addInventoryFooter().build();return{xml:i,itemCount:s,totalWeight:e.totalWeight,containerCount:o,debugInfo:{processedItems:r,skippedItems:a,containerItems:o,magicContainers:n}}}convertItemToXMLFormat(e,t){const r=t.sanitizeOutput?fa.sanitizeForXML(e.customName||e.definition.name):e.customName||e.definition.name,a=t.sanitizeOutput?fa.sanitizeForXML(e.definition.subType||e.definition.filterType):e.definition.subType||e.definition.filterType,o={id:e.id.toString(),name:r,type:a,weight:(e.customWeight||e.definition.weight)/(e.definition.bundleSize||1),count:e.quantity,isIdentified:t.markItemsAsIdentified,isLocked:!0};return t.includeCostInformation&&e.definition.cost&&(o.cost={value:e.definition.cost.quantity,denomination:e.definition.cost.unit}),t.generateDetailedXML&&e.definition.description&&(o.description=t.sanitizeOutput?fa.sanitizeHTML(e.definition.description):e.definition.description),o}convertItemsToXMLFormat(e,t){return e.filter(e=>t.includeZeroQuantityItems||e.quantity>0).map(e=>this.convertItemToXMLFormat(e,t))}calculateContainerWeight(e){return e.reduce((e,t)=>{const r=new Aa(t.definition.weight||0);return e+new Da(t.quantity).multiply(r).pounds},0)}calculateTotalInventoryWeight(e,t){let r=0;return e.forEach(e=>{const t=new Aa(e.definition.weight||0),a=new Da(e.quantity);r+=a.multiply(t).pounds}),r}calculateStatistics(e){return{totalItems:e.totalItems,containerCount:e.containers.size,magicContainers:Array.from(e.containers.values()).filter(e=>0===e.definition.weightMultiplier).length,totalWeight:e.totalWeight}}getDefaultOptions(){return{includeZeroQuantityItems:!1,respectContainerHierarchy:!0,generateDetailedXML:!1,sanitizeOutput:!0,includeCostInformation:!0,markItemsAsIdentified:!0}}static validateInventoryData(e){const t=[];return e.forEach((e,r)=>{(!e.id||e.id<=0)&&t.push(`Item at index ${r} has invalid ID: ${e.id}`),e.definition||t.push(`Item at index ${r} missing definition`),e.definition.name||t.push(`Item at index ${r} missing name`),"number"!=typeof e.quantity&&t.push(`Item ${e.definition.name} has invalid quantity: ${e.quantity}`)}),{isValid:0===t.length,errors:t}}setXMLStrategy(e){this.xmlStrategy=e,this.xmlBuilder=new Ma(e)}}class Ta{constructor(){this.ENCUMBRANCE_MULTIPLIERS={ENCUMBERED_THRESHOLD:5,HEAVILY_THRESHOLD:10,MAXIMUM_CAPACITY:15,PUSH_DRAG_LIFT:30}}calculateEncumbrance(e,t,r={includeContainerWeights:!0,respectMagicContainers:!0,applyRacialTraits:!0}){Kr.isEnabled("encumbrance_calculator_debug")&&console.log("🎒 EncumbranceCalculator: Calculating encumbrance",{characterId:e.id,inventoryItems:t.length,options:r});const a=this.calculateTotalWeight(t,e.id,r),o=this.calculateCarryingCapacity(e,r),n=this.determineEncumbranceLevel(a.totalWeight,o),{speedPenalty:i,disadvantageOnChecks:s}=this.calculatePenalties(n),l={totalWeight:a.totalWeight,carryingCapacity:{normal:o.maximum,push:2*o.maximum,lift:2*o.maximum,powerfulBuild:e.hasPowerfulBuild&&r.applyRacialTraits},encumbranceLevel:n,speedPenalty:i,disadvantageOnChecks:s};return Kr.isEnabled("encumbrance_calculator_debug")&&console.log("🎒 EncumbranceCalculator: Result",{totalWeight:l.totalWeight,encumbranceLevel:l.encumbranceLevel,carryingCapacity:l.carryingCapacity,penalties:{speedPenalty:i,disadvantageOnChecks:s}}),l}calculateTotalWeight(e,t,r){let a=0;const o=[],n=this.buildContainerMultiplierMap(e);return e.forEach(i=>{if(i.quantity<=0)return;const s=new Da(i.quantity),l=new Aa(i.definition.weight||0),c=i.containerEntityId.toString(),d=t.toString();let u,p=l.multiply(s.amount),g=!1;if(r.respectMagicContainers&&c!==d&&n.has(c)){const t=n.get(c);u=this.findContainerName(e,c),0===t?(p=new Aa(0),g=!0):p=p.multiply(t)}a+=p.pounds,o.push({itemId:i.id,itemName:i.definition.name,weight:l.pounds,quantity:s.amount,totalWeight:p.pounds,containerName:u,magicContainer:g})}),{totalWeight:a,debugInfo:o}}buildContainerMultiplierMap(e){const t=new Map;return e.forEach(e=>{e.definition.isContainer&&void 0!==e.definition.weightMultiplier&&t.set(e.id.toString(),e.definition.weightMultiplier)}),t}findContainerName(e,t){const r=e.find(e=>e.id.toString()===t);return r?.definition.name||"Unknown Container"}calculateCarryingCapacity(e,t){let r=e.strengthScore;return e.hasPowerfulBuild&&t.applyRacialTraits&&(r=Math.min(2*r,29)),{normal:r*this.ENCUMBRANCE_MULTIPLIERS.ENCUMBERED_THRESHOLD,encumbered:r*this.ENCUMBRANCE_MULTIPLIERS.ENCUMBERED_THRESHOLD,heavilyEncumbered:r*this.ENCUMBRANCE_MULTIPLIERS.HEAVILY_THRESHOLD,maximum:r*this.ENCUMBRANCE_MULTIPLIERS.MAXIMUM_CAPACITY}}determineEncumbranceLevel(e,t){return e>t.maximum?"overloaded":e>t.heavilyEncumbered?"heavily_encumbered":e>t.encumbered?"encumbered":"unencumbered"}calculatePenalties(e){switch(e){case"heavily_encumbered":return{speedPenalty:20,disadvantageOnChecks:!0};case"encumbered":return{speedPenalty:10,disadvantageOnChecks:!1};case"overloaded":return{speedPenalty:0,disadvantageOnChecks:!0};default:return{speedPenalty:0,disadvantageOnChecks:!1}}}getEncumbranceDebugInfo(e,t,r={includeContainerWeights:!0,respectMagicContainers:!0,applyRacialTraits:!0}){const a=this.calculateTotalWeight(t,e.id,r),o=this.calculateCarryingCapacity(e,r);return{itemBreakdown:a.debugInfo,strengthCalculation:{baseStrength:e.strengthScore,modifiers:0,finalStrength:e.strengthScore,powerfulBuild:e.hasPowerfulBuild&&r.applyRacialTraits},carryingCapacityCalculation:o}}static hasPowerfulBuild(e){return!!e.race?.fullName?.toLowerCase().includes("goliath")||ha.find(e,"name","Powerful Build").length>0}static validateInventoryData(e){const t=[];return e.forEach((e,r)=>{(!e.id||e.id<=0)&&t.push(`Item at index ${r} has invalid ID: ${e.id}`),e.quantity<0&&t.push(`Item ${e.definition.name} has negative quantity: ${e.quantity}`),e.definition.weight<0&&t.push(`Item ${e.definition.name} has negative weight: ${e.definition.weight}`)}),{isValid:0===t.length,errors:t}}}const za={barbarian:{Rage:"resource","Unarmored Defense":"passive","Reckless Attack":"active","Danger Sense":"passive","Primal Path":"passive","Extra Attack":"passive","Fast Movement":"passive","Feral Instinct":"passive","Brutal Critical":"passive","Relentless Rage":"passive","Persistent Rage":"passive","Indomitable Might":"passive","Primal Champion":"passive"},fighter:{"Fighting Style":"passive","Second Wind":"resource","Action Surge":"resource","Martial Archetype":"passive","Extra Attack":"passive",Indomitable:"resource","Superior Critical":"passive",Survivor:"passive"},ranger:{"Favored Enemy":"passive","Natural Explorer":"passive","Fighting Style":"passive",Spellcasting:"spell","Ranger Archetype":"passive","Primeval Awareness":"active","Extra Attack":"passive","Lands Stride":"passive","Hide in Plain Sight":"active",Vanish:"active","Feral Senses":"passive","Foe Slayer":"passive"},rogue:{Expertise:"passive","Sneak Attack":"passive","Thieves Cant":"passive","Cunning Action":"active","Roguish Archetype":"passive","Uncanny Dodge":"passive",Evasion:"passive","Reliable Talent":"passive",Blindsense:"passive","Slippery Mind":"passive",Elusive:"passive","Stroke of Luck":"resource"}},Pa={human:{"Extra Language":"proficiency","Extra Skill":"proficiency",Versatile:"passive"},elf:{Darkvision:"passive","Keen Senses":"proficiency","Fey Ancestry":"passive",Trance:"passive","Elf Weapon Training":"proficiency"},dwarf:{Darkvision:"passive","Dwarven Resilience":"passive","Dwarven Combat Training":"proficiency",Stonecunning:"proficiency"},halfling:{Lucky:"passive",Brave:"passive","Halfling Nimbleness":"passive"},dragonborn:{"Draconic Ancestry":"passive","Breath Weapon":"active","Damage Resistance":"passive"},gnome:{Darkvision:"passive","Gnome Cunning":"passive"},"half-elf":{Darkvision:"passive","Fey Ancestry":"passive","Skill Versatility":"proficiency"},"half-orc":{Darkvision:"passive","Relentless Endurance":"resource","Savage Attacks":"passive"},tiefling:{Darkvision:"passive","Hellish Resistance":"passive","Infernal Legacy":"spell"}};class Ra{static validateClassFeature(e){const t=[];return e.name&&0!==e.name.trim().length||t.push("Feature name is required"),e.className&&0!==e.className.trim().length||t.push("Class name is required"),("number"!=typeof e.requiredLevel||e.requiredLevel<1||e.requiredLevel>20)&&t.push("Required level must be between 1 and 20"),e.type&&!["passive","active","resource","spell"].includes(e.type)&&t.push("Feature type must be passive, active, resource, or spell"),{isValid:0===t.length,errors:t}}static validateRacialTrait(e){const t=[];return e.name&&0!==e.name.trim().length||t.push("Trait name is required"),e.raceName&&0!==e.raceName.trim().length||t.push("Race name is required"),e.type&&!["passive","active","spell","proficiency"].includes(e.type)&&t.push("Trait type must be passive, active, spell, or proficiency"),{isValid:0===t.length,errors:t}}}class Na{static{this.debugEnabled=!1}constructor(){Kr.isEnabled("feature_processor_debug")&&(Na.debugEnabled=!0)}static setDebugMode(e){this.debugEnabled=e}processCharacterFeatures(e,t=this.getDefaultOptions()){(Na.debugEnabled||Kr.isEnabled("feature_processor_debug"))&&console.log("🎭 FeatureProcessor: Processing character features",{classCount:e.classes?.length||0,raceName:e.race?.fullName,options:t});const r=t.includeSubclassFeatures?this.processClassFeatures(e,t):[],a=t.includeRacialTraits?this.processRacialTraits(e,t):[],o=this.groupFeaturesByClass(r),n=this.groupTraitsByRace(a),i={classFeatures:r,racialTraits:a,totalFeatures:r.length+a.length,featuresByClass:o,traitsByRace:n,debugInfo:{processingMethod:e.classes.length>1?"multiclass":"single_class",classBreakdown:this.buildClassBreakdown(e,r),raceBreakdown:this.buildRaceBreakdown(e,a),warnings:[]}};return(Na.debugEnabled||Kr.isEnabled("feature_processor_debug"))&&console.log("🎭 FeatureProcessor: Result",{totalFeatures:i.totalFeatures,classFeatureCount:r.length,racialTraitCount:a.length,processingMethod:i.debugInfo.processingMethod}),i}processClassFeatures(e,t){const r=[],a=new Set;if(!e.classes||!Array.isArray(e.classes))return r;for(const o of e.classes){const e=o.definition?.name?.toLowerCase()||"unknown",n=o.level||1;if(Na.debugEnabled&&console.log(`🎭 Processing class: ${e} (level ${n})`,{hasClassFeatures:!!o.definition?.classFeatures,classFeatureCount:o.definition?.classFeatures?.length||0,hasSubclass:!!o.subclassDefinition,hasSubclassFeatures:!!o.subclassDefinition?.classFeatures,subclassFeatureCount:o.subclassDefinition?.classFeatures?.length||0,hasCustomFeatures:!!o.classFeatures,customFeatureCount:o.classFeatures?.length||0,hasGrantedFeatures:!!o.grantedClassFeatures,grantedFeatureCount:o.grantedClassFeatures?.length||0}),o.definition?.classFeatures){Na.debugEnabled&&console.log(`🔍 Processing ${o.definition.classFeatures.length} class features for ${e}`);const i=this.extractClassFeatures(o.definition.classFeatures,e,n,"class",t,void 0,a);r.push(...i)}if(o.subclassDefinition?.classFeatures){Na.debugEnabled&&console.log(`🔍 Processing ${o.subclassDefinition.classFeatures.length} subclass features for ${e}`);const i=o.subclassDefinition.name,s=this.extractClassFeatures(o.subclassDefinition.classFeatures,e,n,"subclass",t,i,a);r.push(...s)}if(o.classFeatures&&Array.isArray(o.classFeatures)){Na.debugEnabled&&console.log(`🔍 Processing additional classFeatures array (${o.classFeatures.length} features)`);const i=this.extractClassFeatures(o.classFeatures,e,n,"class",t,void 0,a);r.push(...i)}if(o.grantedClassFeatures&&Array.isArray(o.grantedClassFeatures)){Na.debugEnabled&&console.log(`🔍 Processing grantedClassFeatures array (${o.grantedClassFeatures.length} features)`);const i=this.extractClassFeatures(o.grantedClassFeatures,e,n,"class",t,void 0,a);r.push(...i)}}return r}processRacialTraits(e,t){const r=[],a=new Set;if(!e.race)return Na.debugEnabled&&console.log("No race data found in character"),r;const o=e.race.fullName||e.race.baseName||"Unknown Race";Na.debugEnabled&&(console.log(`🔍 Processing racial traits for: ${o}`),console.log("🔍 Full race data structure:",JSON.stringify(e.race,null,2)),console.log("🔍 Checking race.racialTraits:",!!e.race.racialTraits),console.log("🔍 Checking race.traits:",!!e.race.traits),console.log("🔍 Checking race.features:",!!e.race.features),console.log("🔍 Checking race.raceTraits:",!!e.race.raceTraits),console.log("🔍 Checking race.definition:",!!e.race.definition),e.race.definition&&(console.log("🔍 Checking race.definition.racialTraits:",!!e.race.definition.racialTraits),console.log("🔍 Checking race.definition.traits:",!!e.race.definition.traits)),console.log("🔍 Race object keys:",Object.keys(e.race)));let n=null,i="";if(e.race.racialTraits&&Array.isArray(e.race.racialTraits)?(n=e.race.racialTraits,i="race.racialTraits"):e.race.traits&&Array.isArray(e.race.traits)?(n=e.race.traits,i="race.traits"):e.race.features&&Array.isArray(e.race.features)?(n=e.race.features,i="race.features"):e.race.definition?.racialTraits&&Array.isArray(e.race.definition.racialTraits)?(n=e.race.definition.racialTraits,i="race.definition.racialTraits"):e.race.definition?.traits&&Array.isArray(e.race.definition.traits)&&(n=e.race.definition.traits,i="race.definition.traits"),n&&n.length>0){Na.debugEnabled&&(console.log(`🎯 Found ${n.length} racial traits in ${i}`),console.log("🎯 Sample trait structure:",JSON.stringify(n[0],null,2)));const e=this.extractRacialTraits(n,o,"race",t,void 0,a);r.push(...e)}else Na.debugEnabled&&console.log("❌ No racial traits array found in any expected location");if(e.race.subraceDefinition?.racialTraits&&Array.isArray(e.race.subraceDefinition.racialTraits)){const n=e.race.subraceDefinition.name;Na.debugEnabled&&console.log(`Found ${e.race.subraceDefinition.racialTraits.length} subrace traits for: ${n}`);const i=this.extractRacialTraits(e.race.subraceDefinition.racialTraits,o,"subrace",t,n,a);r.push(...i)}return Na.debugEnabled&&(console.log(`🏁 Final trait count: ${r.length}`),r.length>0&&console.log("🏁 Extracted traits:",r.map(e=>e.name))),r}generateFeaturesXML(e,t=this.getDefaultXMLOptions()){return e.classFeatures.length>0?this.generateClassFeaturesXML(e.classFeatures,t):""}generateTraitsXML(e,t=this.getDefaultXMLOptions()){return e.racialTraits.length>0?this.generateRacialTraitsXML(e.racialTraits,t):""}extractClassFeatures(e,t,r,a,o,n,i){const s=[];for(const l of e){const e=`id:${l.id}`;if(Na.debugEnabled&&console.log(`🔍 Processing feature: ${l.name}`,{id:l.id,key:e,className:t,source:a,level:l.requiredLevel,hasSeenBefore:i?.has(e)}),i&&i.has(e)){Na.debugEnabled&&console.log(`🔄 Skipping duplicate feature: ${l.name} (${e})`);continue}if(this.shouldSkipFeature(l.name)){Na.debugEnabled&&console.log(`🚫 Skipping excluded feature: ${l.name}`);continue}if(o.filterByLevel&&l.requiredLevel>r)continue;if(l.requiredLevel>o.maxLevel)continue;i&&i.add(e);const c=this.determineFeatureType(l.name,t),d=this.determineFeatureUsage(l.name,t),u={id:l.id,name:l.name,description:o.includeDescriptions?l.description:"",requiredLevel:l.requiredLevel,className:t,subclassName:n,source:a,type:c,uses:d,mechanics:this.extractFeatureMechanics(l.name,l.description)},p=Ra.validateClassFeature(u);p.isValid?s.push(u):console.warn(`Invalid class feature: ${u.name}`,p.errors)}return s}extractRacialTraits(e,t,r,a,o,n){const i=[];for(const s of e){let e,l,c;if(Na.debugEnabled&&console.log("🔍 Raw trait data:",JSON.stringify(s,null,2)),s.definition)e=s.id,l=s.definition.name,c=s.definition.description;else{if(!s.name){Na.debugEnabled&&console.log("🚫 Skipping trait with unrecognized structure:",s);continue}e=s.id||0,l=s.name,c=s.description||""}const d=e?`id:${e}`:`name:${l}`;if(Na.debugEnabled&&console.log(`🔍 Processing trait: ${l}`,{id:e,key:d,raceName:t,source:r,hasSeenBefore:n?.has(d)}),n&&n.has(d)){Na.debugEnabled&&console.log(`🔄 Skipping duplicate trait: ${l} (${d})`);continue}if(this.shouldSkipTrait(l)){Na.debugEnabled&&console.log(`🚫 Skipping excluded trait: ${l}`);continue}n&&n.add(d);const u=this.determineTraitType(l,t),p=this.extractTraitMechanics(l,c),g={id:e,name:l,description:a.includeDescriptions?c:"",raceName:t,suraceName:o,source:r,type:u,mechanics:p},m=Ra.validateRacialTrait(g);m.isValid?(i.push(g),Na.debugEnabled&&console.log(`✅ Added trait: ${l}`)):console.warn(`Invalid racial trait: ${g.name}`,m.errors)}return i}determineFeatureType(e,t){t&&"string"==typeof t||(t="unknown");const r=za[t.toLowerCase()];return r&&r[e]?r[e]:e&&"string"==typeof e?e.toLowerCase().includes("spellcasting")?"spell":e.toLowerCase().includes("rage")||e.toLowerCase().includes("action surge")?"resource":e.toLowerCase().includes("attack")||e.toLowerCase().includes("maneuver")?"active":"passive":"passive"}determineTraitType(e,t){t&&"string"==typeof t||(t="unknown");const r=Pa[t.toLowerCase()];return r&&r[e]?r[e]:e&&"string"==typeof e?e.toLowerCase().includes("proficiency")||e.toLowerCase().includes("training")?"proficiency":e.toLowerCase().includes("spell")||e.toLowerCase().includes("cantrip")?"spell":e.toLowerCase().includes("breath")||e.toLowerCase().includes("endurance")?"active":"passive":"passive"}determineFeatureUsage(e,t){if(!e||"string"!=typeof e)return;t&&"string"==typeof t||(t="unknown");const r=e.toLowerCase();return r.includes("rage")&&"barbarian"===t.toLowerCase()?{type:"long_rest",amount:1,rechargeOn:"long_rest"}:r.includes("action surge")&&"fighter"===t.toLowerCase()||r.includes("second wind")&&"fighter"===t.toLowerCase()?{type:"short_rest",amount:1,rechargeOn:"short_rest"}:void 0}extractFeatureMechanics(e,t){}extractTraitMechanics(e,t){const r={};if(e.toLowerCase().includes("darkvision")){const e=t.match(/(\d+)\s*feet/i);e&&(r.darkvisionRange=parseInt(e[1]))}return(e.toLowerCase().includes("fleet")||e.toLowerCase().includes("swift"))&&(r.speed=35),Object.keys(r).length>0?r:void 0}generateClassFeaturesXML(e,t){let r="";return e.forEach((e,a)=>{const o=String(a+1).padStart(5,"0"),n=t.sanitizeText?fa.sanitizeForXML(e.name):e.name,i=t.sanitizeText&&e.description?fa.sanitizeForXML(e.description):e.description||"";r+=`      <id-${o}>\n        <locked type="number">1</locked>\n        <name type="string">${n}</name>\n        <text type="formattedtext">\n          <p>${i}</p>\n        </text>\n        <source type="string">${e.className}${e.subclassName?` (${e.subclassName})`:""}</source>\n      </id-${o}>\n`}),r}generateRacialTraitsXML(e,t){let r="";return e.forEach((e,a)=>{const o=String(a+1e3).padStart(5,"0"),n=t.sanitizeText?fa.sanitizeForXML(e.name):e.name,i=t.sanitizeText&&e.description?fa.sanitizeForXML(e.description):e.description||"";r+=`      <id-${o}>\n        <locked type="number">1</locked>\n        <name type="string">${n}</name>\n        <text type="formattedtext">\n          <p>${i}</p>\n        </text>\n        <source type="string">${e.raceName}${e.suraceName?` (${e.suraceName})`:""}</source>\n      </id-${o}>\n`}),r}groupFeaturesByClass(e){return e.reduce((e,t)=>{const r=t.subclassName?`${t.className} (${t.subclassName.toLowerCase()})`:t.className;return e[r]||(e[r]=[]),e[r].push(t),e},{})}groupTraitsByRace(e){return e.reduce((e,t)=>{const r=t.suraceName?`${t.raceName.toLowerCase()} (${t.suraceName.toLowerCase()})`:t.raceName.toLowerCase();return e[r]||(e[r]=[]),e[r].push(t),e},{})}buildClassBreakdown(e,t){return e.classes.map(e=>({className:e.definition?.name||"Unknown",level:e.level||1,featureCount:t.filter(t=>t.className===e.definition?.name?.toLowerCase()).length,subclass:e.subclassDefinition?.name}))}buildRaceBreakdown(e,t){return{raceName:e.race?.fullName||"Unknown Race",subraceName:e.race?.subraceDefinition?.name,traitCount:t.length}}getDefaultOptions(){return{includeSubclassFeatures:!0,includeRacialTraits:!0,includeDescriptions:!0,filterByLevel:!0,maxLevel:20}}getDefaultXMLOptions(){return{includeDescriptions:!0,includeUsageLimits:!0,groupBySource:!0,sanitizeText:!0}}shouldSkipFeature(e){if(!e||"string"!=typeof e)return!1;const t=e.toLowerCase();return["Proficiencies","Ability Score Increase","Core Sorcerer Traits","Metamagic Options"].some(e=>t.includes(e.toLowerCase()))}shouldSkipTrait(e){if(!e||"string"!=typeof e)return!1;const t=e.toLowerCase();return["Proficiencies","Ability Score Increase","Languages","Age","Size","Speed","Core Sorcerer Traits","Metamagic Options"].some(e=>t.includes(e.toLowerCase()))}static validateCharacterData(e){const t=[];return e?(e.classes&&Array.isArray(e.classes)||t.push("Character classes must be an array"),e.race||t.push("Character race is required"),{isValid:0===t.length,errors:t}):(t.push("Character data is required"),{isValid:!1,errors:t})}}class Oa{constructor(){this.format="foundry-vtt-json",this.version="1.0",this.supportedFeatures=["abilities","skills","combat","spells","equipment","features","active-effects","embedded-items"]}async generateOutput(e,t){try{const r=e.characterData,a=[],o=[],n={_id:this.generateFoundryId(),name:fa.sanitizeText(r.name||"Unknown Character"),type:"character",img:this.getCharacterImage(r),system:this.buildSystemData(e),items:await this.buildItems(e,t),effects:this.buildActiveEffects(e),prototypeToken:this.buildTokenData(e),ownership:{default:0},flags:{dnd5e:{},"b2fg-converter":{sourceId:r.id,convertedAt:(new Date).toISOString(),converterVersion:"1.0"}}},i=fa.sanitizeText(r.name||"character").replace(/[^a-zA-Z0-9_-]/g,"_"),s=`${i}_${r.id||"unknown"}.json`;return{success:!0,output:JSON.stringify(n,null,2),filename:s,mimeType:"application/json",errors:a.length>0?a:void 0,warnings:o.length>0?o:void 0}}catch(error){return{success:!1,errors:[{type:"generation_error",message:error instanceof Error?error.message:"Unknown error occurred"}]}}}buildSystemData(e){const t=e.characterData,r=e.totalLevel||this.calculateTotalLevel(t),a=e.proficiencyBonus||ma.calculateProficiencyBonus(r);return{abilities:this.mapAbilities(t),attributes:this.mapAttributes(t,r,a),details:this.mapDetails(t,r),traits:this.mapTraits(t),currency:this.mapCurrency(t),skills:this.mapSkills(t,a),spells:this.mapSpellSlots(t),bonuses:this.mapBonuses(t),resources:this.mapResources(t)}}mapAbilities(e){const t={},r={1:"str",2:"dex",3:"con",4:"int",5:"wis",6:"cha"},a=ba.get(e,"stats")||[];for(const o of a){const a=r[o.id];if(a){const r=o.value||10;t[a]={value:r,proficient:this.isAbilitySaveProficient(e,a),max:null,bonuses:{check:"",save:""},check:{roll:{min:null,max:null,mode:0}},save:{roll:{min:null,max:null,mode:0}}}}}for(const o of["str","dex","con","int","wis","cha"])t[o]||(t[o]={value:10,proficient:!1,max:null,bonuses:{check:"",save:""},check:{roll:{min:null,max:null,mode:0}},save:{roll:{min:null,max:null,mode:0}}});return t}mapAttributes(e,t,r){const a=(ba.get(e,"stats")||[]).find(e=>3===e.id),o=a?.value||10,n=Math.floor((o-10)/2),i=this.calculateHitPoints(e,n,t);return{init:{ability:"",roll:{min:null,max:null,mode:0},bonus:""},movement:this.mapMovement(e),attunement:{max:3},senses:this.mapSenses(e),spellcasting:this.getPrimarySpellcastingAbility(e),hp:{value:i,max:i,temp:0,tempmax:0,bonuses:{level:"",overall:""}},ac:{flat:null,calc:"default",formula:"",min:0},prof:r,spelldc:this.calculateSpellDC(e,r)}}mapDetails(e,t){const r=ba.get(e,"background.definition.name")||ba.get(e,"background.name")||"";return{background:fa.sanitizeText(r),originalClass:this.getPrimaryClassName(e),class:this.formatClassString(e),level:t,race:fa.sanitizeText(e.race?.fullName||e.race?.name||""),alignment:ma.getAlignmentName(e.alignmentId)||"",xp:{value:0,max:this.calculateXPForLevel(t+1),pct:0}}}mapTraits(e){return{size:this.mapSize(e),di:{value:[],bypasses:[],custom:""},dr:{value:[],bypasses:[],custom:""},dv:{value:[],bypasses:[],custom:""},ci:{value:[],custom:""},languages:this.mapLanguages(e),weaponProf:{value:[],custom:""},armorProf:{value:[],custom:""},toolProf:{value:[],custom:""}}}mapCurrency(e){const t=e.currencies||{};return{pp:t.pp||0,gp:t.gp||0,ep:t.ep||0,sp:t.sp||0,cp:t.cp||0}}mapSkills(e,t){const r={},a=["acr","ani","arc","ath","dec","his","ins","inti","inv","med","nat","prc","prf","per","rel","slt","ste","sur"];for(const o of a)r[o]={ability:this.getSkillAbility(o),roll:{min:null,max:null,mode:0},value:this.getSkillProficiency(e,o),bonuses:{check:"",passive:""}};return r}mapSpellSlots(e){const t={};for(let r=1;r<=9;r++)t[`spell${r}`]={value:0,max:0,override:null};return t.pact={value:0,max:0,override:null,level:1},t}mapBonuses(e){return{mwak:{attack:"",damage:""},rwak:{attack:"",damage:""},msak:{attack:"",damage:""},rsak:{attack:"",damage:""},abilities:{check:"",save:"",skill:""},spell:{dc:""}}}mapResources(e){return{primary:{value:0,max:0,sr:!1,lr:!1,label:""},secondary:{value:0,max:0,sr:!1,lr:!1,label:""},tertiary:{value:0,max:0,sr:!1,lr:!1,label:""}}}async buildItems(e,t){const r=[],a=e.characterData.inventory||[];for(const i of a)i&&i.definition&&r.push(await this.convertEquipmentItem(i));const o=e.characterData.spells?.class||[];for(const i of o)i&&i.definition&&r.push(await this.convertSpellItem(i));const n=e.characterData.classFeatures||[];for(const i of n)i&&i.definition&&r.push(await this.convertFeatureItem(i));return r}buildActiveEffects(e){return[]}buildTokenData(e){const t=e.characterData;return{name:t.name||"Unknown Character",img:this.getCharacterImage(t),width:1,height:1,scale:1,lockRotation:!1,rotation:0,vision:!0,dimSight:0,brightSight:0,sightAngle:0,dimLight:0,brightLight:0,lightAngle:0,lightAlpha:.25,disposition:1,displayName:20,displayBars:20,bar1:{attribute:"attributes.hp"},bar2:{attribute:null},flags:{}}}generateFoundryId(){return Array.from({length:16},()=>Math.floor(16*Math.random()).toString(16)).join("")}getCharacterImage(e){return e.avatarUrl||e.decorations?.avatarUrl||"icons/svg/mystery-man.svg"}calculateTotalLevel(e){return(e.classes||[]).reduce((e,t)=>e+(t.level||0),0)}isAbilitySaveProficient(e,t){return(e.modifiers?.class||[]).find(e=>"proficiency"===e.type&&e.subType===`${t.toLowerCase()}-saving-throws`)?1:0}calculateHitPoints(e,t,r){const a=e.baseHitPoints||8*r,o=t*r;return Math.max(1,a+o)}mapMovement(e){const t=e.race;return{burrow:null,climb:null,fly:null,swim:null,walk:t?.weightSpeeds?.normal?.walk||30,units:"ft",hover:!1}}mapSenses(e){return{darkvision:null,blindsight:null,tremorsense:null,truesight:null,units:"ft",special:""}}getPrimarySpellcastingAbility(e){const t=e.classes||[];for(const r of t){const e=r.definition||r.classDefinition;if(e?.spellcastingAbilityId)return this.abilityIdToName(e.spellcastingAbilityId)}return"int"}abilityIdToName(e){return{1:"str",2:"dex",3:"con",4:"int",5:"wis",6:"cha"}[e]||"int"}calculateSpellDC(e,t){const r=this.getPrimarySpellcastingAbility(e),a=ba.get(e,`stats.${r}`)||10;return 8+t+Math.floor((a-10)/2)}getPrimaryClassName(e){const t=e.classes||[];if(0===t.length)return"";const r=t.reduce((e,t)=>(t.level||0)>(e.level||0)?t:e);return r.definition?.name||r.name||""}formatClassString(e){return(e.classes||[]).map(e=>`${e.definition?.name||e.name||"Unknown"} ${e.level||1}`).join(" / ")}mapSize(e){const t=e.race?.size;return t&&{Tiny:"tiny",Small:"sm",Medium:"med",Large:"lg",Huge:"huge",Gargantuan:"grg"}[t]||"med"}mapLanguages(e){return{value:[],custom:""}}getSkillAbility(e){return{acr:"dex",ani:"wis",arc:"int",ath:"str",dec:"cha",his:"int",ins:"wis",inti:"cha",inv:"int",med:"wis",nat:"int",prc:"wis",prf:"cha",per:"cha",rel:"int",slt:"dex",ste:"dex",sur:"wis"}[e]||"int"}getSkillProficiency(e,t){return(e.modifiers?.class||[]).find(e=>"proficiency"===e.type&&"skill"===e.subType&&e.friendlySubtypeName?.toLowerCase().includes(t))?1:0}async convertEquipmentItem(e){return{_id:this.generateFoundryId(),name:fa.sanitizeText(e.definition?.name||"Unknown Item"),type:this.getFoundryItemType(e),img:"icons/svg/item-bag.svg",system:{description:{value:fa.sanitizeText(e.definition?.description||""),chat:"",unidentified:""},quantity:e.quantity||1,weight:e.definition?.weight||0,price:{value:e.definition?.cost||0,denomination:"gp"},equipped:e.equipped||!1,rarity:"common",identified:!0},effects:[],flags:{"b2fg-converter":{sourceId:e.definition?.id,sourceType:"dndbeyond-equipment"}}}}async convertSpellItem(e){return{_id:this.generateFoundryId(),name:fa.sanitizeText(e.definition?.name||"Unknown Spell"),type:"spell",img:"icons/svg/book.svg",system:{description:{value:fa.sanitizeText(e.definition?.description||""),chat:"",unidentified:""},level:e.definition?.level||0,school:e.definition?.school||"evo",preparation:{mode:"prepared",prepared:e.prepared||!1},components:{vocal:e.definition?.components?.includes("V")||!1,somatic:e.definition?.components?.includes("S")||!1,material:e.definition?.components?.includes("M")||!1,ritual:e.definition?.ritual||!1,concentration:e.definition?.concentration||!1},duration:{value:null,units:"inst"},range:{value:null,long:null,units:"self"},target:{value:null,width:null,units:"",type:""},damage:{parts:[],versatile:""},save:{ability:"",dc:null,scaling:"spell"}},effects:[],flags:{"b2fg-converter":{sourceId:e.definition?.id,sourceType:"dndbeyond-spell"}}}}async convertFeatureItem(e){return{_id:this.generateFoundryId(),name:fa.sanitizeText(e.definition?.name||"Unknown Feature"),type:"feat",img:"icons/svg/upgrade.svg",system:{description:{value:fa.sanitizeText(e.definition?.description||""),chat:"",unidentified:""},requirements:"",recharge:{value:null,charged:!0},activation:{type:"",cost:null,condition:""},duration:{value:null,units:""},target:{value:null,width:null,units:"",type:""},uses:{value:null,max:"",per:null,recovery:""}},effects:[],flags:{"b2fg-converter":{sourceId:e.definition?.id,sourceType:"dndbeyond-feature"}}}}getFoundryItemType(e){const t=e.definition?.filterType;return"Weapon"===t?"weapon":"Armor"===t?"equipment":"loot"}async validateOutput(e){try{const t=JSON.parse(e),r=[];return t.name||r.push("Missing character name"),t.type&&"character"===t.type||r.push("Invalid character type"),t.system||r.push("Missing system data"),{isValid:0===r.length,errors:r.length>0?r:void 0}}catch(error){return{isValid:!1,errors:["Invalid JSON format"]}}}getDefaultOptions(){return{includeDescription:!0,includeNotes:!0,spellFormat:"individual",featureDetail:"full",imageHandling:"reference"}}async getSampleOutput(){return JSON.stringify({name:"Sample Character",type:"character",system:{abilities:{str:{value:10}},attributes:{hp:{value:8,max:8}}}},null,2)}calculateXPForLevel(e){const t=[0,300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3,1e5,12e4,14e4,165e3,195e3,225e3,265e3,305e3,355e3];return t[Math.min(e-1,t.length-1)]||0}}const ja=new class{constructor(){this.formatters=new Map,this.formatInfoCache=new Map,this.initializeDefaultFormatters()}initializeDefaultFormatters(){this.register(new Oa)}register(e){this.formatters.set(e.format,e),this.formatInfoCache.delete(e.format),console.log(`📋 Registered output formatter: ${e.format} v${e.version}`)}getFormatter(e){const t=this.formatters.get(e);if(!t)throw new Error(`Unknown output format: ${e}`);return t}isFormatSupported(e){return this.formatters.has(e)}getSupportedFormats(){return Array.from(this.formatters.values()).map(e=>this.getFormatInfo(e))}getFormatInfo(e){const t=this.formatInfoCache.get(e.format);if(t)return t;const r={format:e.format,name:this.getFormatDisplayName(e.format),description:this.getFormatDescription(e.format),version:e.version,supportedFeatures:e.supportedFeatures,fileExtension:this.getFileExtension(e.format),mimeType:this.getMimeType(e.format),icon:this.getFormatIcon(e.format)};return this.formatInfoCache.set(e.format,r),r}async generateOutput(e,t,r){const a=this.getFormatter(e);console.log(`🔄 Generating ${e} output for character: ${t.characterData.name}`);try{const o=await a.generateOutput(t,r);return o.success?console.log(`✅ Successfully generated ${e} output`):console.error(`❌ Failed to generate ${e} output:`,o.errors),o}catch(error){return console.error(`💥 Error generating ${e} output:`,error),{success:!1,errors:[{type:"generation_error",message:error instanceof Error?error.message:"Unknown error occurred"}]}}}validateFormatSupport(e,t){const r=this.formatters.get(e);return!!r&&t.every(e=>r.supportedFeatures.includes(e))}getFormatCompatibility(e){const t=new Map;for(const[r,a]of this.formatters){const o=this.analyzeCompatibility(e,a);t.set(r,o)}return t}analyzeCompatibility(e,t){const r=e.characterData,a=[];let o,n=100;return(r.classes||[]).length>1&&(t.supportedFeatures.includes("multiclass")||(a.push("Multiclass characters may not be fully supported"),n-=20)),(r.spells?.class?.length||0)>0&&!t.supportedFeatures.includes("spells")&&(a.push("Spells may not be included"),n-=15),(r.classFeatures?.length||0)>0&&!t.supportedFeatures.includes("features")&&(a.push("Class features may be simplified"),n-=10),o=n>=90?"excellent":n>=75?"good":n>=60?"fair":"poor",{score:n,recommendation:o,warnings:a,dataLoss:Math.max(0,100-n)}}getFormatDisplayName(e){return{"foundry-vtt-json":"Foundry VTT","fantasy-grounds-xml":"Fantasy Grounds","roll20-json":"Roll20","generic-json":"Generic JSON"}[e]||e}getFormatDescription(e){return{"foundry-vtt-json":"JSON format for Foundry Virtual Tabletop D&D 5e system","fantasy-grounds-xml":"XML format for Fantasy Grounds Unity and Classic","roll20-json":"JSON character sheet format for Roll20","generic-json":"Raw character data in JSON format"}[e]||"Character export format"}getFileExtension(e){return{"foundry-vtt-json":".json","fantasy-grounds-xml":".xml","roll20-json":".json","generic-json":".json"}[e]||".txt"}getMimeType(e){return{"foundry-vtt-json":"application/json","fantasy-grounds-xml":"application/xml","roll20-json":"application/json","generic-json":"application/json"}[e]||"text/plain"}getFormatIcon(e){return{"foundry-vtt-json":"⚒️","fantasy-grounds-xml":"🏰","roll20-json":"🎲","generic-json":"📄"}[e]||"📁"}getAvailableFormats(){return Array.from(this.formatters.keys())}getDefaultOptions(e){return this.getFormatter(e).getDefaultOptions()}async validateOutput(e,t){return this.getFormatter(e).validateOutput(t)}};console.log("📋 Format Registry initialized with formatters:",ja.getAvailableFormats());class Ba{constructor(){this.characterFetcher=new ua,this.inventoryProcessor=new Ia,this.encumbranceCalculator=new Ta,this.spellSlotCalculator=new $a,this.featureProcessor=new Na,this.initializeGameConfig()}async initializeGameConfig(){if(!ma.isLoaded())try{await ma.loadConfigs()}catch(error){console.warn("Failed to load game configuration, using fallback values:",error)}}async convertFromDNDBeyond(e){const t=performance.now();try{this.reportProgress("Validating character ID",10);const r=await this.fetchCharacterData(e);if(!r.success)return{success:!1,error:r.error};const a=r.data,o=performance.now()-t;if(Kr.isEnabled("debug_character_data")){if(console.group("🔍 Character Data Debug Info"),console.log("📋 Basic Info:",{id:a.id,name:a.name,level:this.calculateTotalLevel(a),race:a.race?.fullName||"Unknown",classes:a.classes?.map(e=>`${e.definition?.name} ${e.level}`).join(", ")||"None"}),console.log("📊 Stats & Bonuses:",{stats:a.stats,bonusStats:a.bonusStats,overrideStats:a.overrideStats}),console.log("🎒 Equipment & Inventory:",{inventoryCount:a.inventory?.length||0,inventory:a.inventory?.slice(0,5),hasMore:(a.inventory?.length||0)>5}),console.log("✨ Spells & Features:",{spellsKnown:a.spells?.length||0,classFeatures:a.classes?.reduce((e,t)=>e+(t.classFeatures?.length||0),0)||0,raceFeatures:a.race?.racialTraits?.length||0}),console.log("🔧 Modifiers & Bonuses:",{modifiers:a.modifiers?Object.keys(a.modifiers):[],bonuses:a.bonuses?Object.keys(a.bonuses):[]}),console.log("📄 Full Character Object:",a),Kr.isEnabled("object_search_service")){console.log("🔍 ObjectSearch Service Demo:");const e=ha.findByType(a,"proficiency");console.log(`Found ${e.length} proficiency modifiers:`,e);const t=ha.findByType(a,"feature");console.log(`Found ${t.length} class features:`,t.slice(0,3));const r=ha.findByEntityType(a,"1446578651");console.log(`Found ${r.length} classes via entityTypeId:`,r);const o=ha.getAllKeys(a,5);console.log(`Available keys (depth 5): ${o.length} total`,o.slice(0,20))}if(Kr.isEnabled("string_sanitizer_service")&&(console.log("🧹 StringSanitizer Service Demo:"),[a.name||"Unknown Character",'<script>alert("XSS")<\/script>Test Name','Character "The Bold" & Strong',"javascript:alert(1)","Text with\nnewlines\tand control\0chars"].forEach((e,t)=>{const r=this.sanitizeString(e),a=fa.sanitizeWithReport(e);console.log(`Test ${t+1}:`,{original:e,sanitized:r,wasModified:a.wasModified,removedPatterns:a.removedPatterns})})),Kr.isEnabled("safe_access_service")){console.log("🛡️ SafeAccess Service Demo:"),["name","race.fullName","race.definition.name","classes.0.definition.name","classes.0.level","stats.0.value","nonexistent.path","race.racialTraits.0.definition.name","preferences.privacy.showStats"].forEach(e=>{const t=this.safeAccess(a,e),r=ba.getWithResult(a,e);console.log(`Path: ${e}`,{value:t,found:r.found,type:typeof t,depth:r.depth})});const e=ba.getMultiple(a,["name","race.fullName","classes.0.level"]);console.log("Multiple path access:",e);const t=ba.getAllPaths(a,3);console.log(`Available paths (depth 3): ${t.length} total`,t.slice(0,15))}if(Kr.isEnabled("ability_constants")){console.log("💪 AbilityConstants Demo:");const e=this.getAbilityScores(a);console.log("Character Ability Scores:",e);const t={};if(va.forEach(r=>{const a=e[r]||10;t[r]=wa.calculateModifier(a)}),console.log("Ability Modifiers:",t),console.log("Ability Mappings:",{strengthId:wa.getAbilityIdByName("strength"),dexterityAbbr:wa.getAbbreviation("dexterity"),constitutionById:wa.getAbilityById(3)?.name,validScores:{normal:wa.isValidScore(18,!1),withMagic:wa.isValidScore(22,!0)}}),e.strength){const t=wa.calculateCarryingCapacity(e.strength);console.log(`Carrying Capacity (STR ${e.strength}):`,t)}}if(Kr.isEnabled("ability_score_processor")){console.log("⚡ AbilityScoreProcessor Service Demo:"),Kr.isEnabled("debug_ability_score_processor")&&(xa.setDebugMode(!0),console.log("🔍 Debug mode enabled for ability score processing"));const e=this.processAbilityBonuses(a);console.log("Processed Ability Scores:",e.totalScores),xa.setDebugMode(!1),e.debugInfo.appliedBonuses.length>0&&(console.log("Applied Bonuses:",e.debugInfo.appliedBonuses),console.log("Final Bonus Summary:",e.debugInfo.finalBonusSummary));const t=xa.processLegacyFormat(a);console.log("Legacy Format Output:",t.slice(0,3)),console.log("Individual Score Calculations:"),va.forEach((e,t)=>{const r=t+1,o=xa.getTotalAbilityScore(a,r);console.log(`  ${e} (ID ${r}): ${o} (modifier: ${wa.calculateModifier(o)})`)});const r=xa.validateCharacterData(a);console.log("Character Data Validation:",{isValid:r.isValid,issueCount:r.issues.length,warningCount:r.warnings.length}),r.warnings.length>0&&console.warn("Character Data Warnings:",r.warnings),r.issues.length>0&&console.error("Character Data Issues:",r.issues)}if(Kr.isEnabled("spell_slot_calculator")){console.log("🪄 SpellSlotCalculator Service Demo:"),Kr.isEnabled("debug_spell_slot_calculator")&&($a.setDebugMode(!0),console.log("🔍 Debug mode enabled for spell slot calculation"));const e=this.extractClassInfo(a);console.log("Extracted Classes:",e);const t=this.calculateSpellSlots(e);console.log("Calculated Spell Slots:",t.spellSlots),$a.setDebugMode(!1),console.log("Caster Level Breakdown:",t.debugInfo.casterLevelCalculation),console.log("Class Breakdown:",t.debugInfo.classBreakdown),console.log(`Calculation Method: ${t.debugInfo.calculationMethod}`);const r=$a.toLegacyFormat(t.spellSlots);console.log("Legacy Format Spell Slots:",r.filter(e=>e.slots>0));const o=$a.validateClassInfo(e);console.log("Class Data Validation:",{isValid:o.isValid,errorCount:o.errors.length}),o.errors.length>0&&console.error("Class Data Errors:",o.errors)}console.groupEnd()}if(this.reportProgress("Parsing character data",50),Kr.isEnabled("debug_character_data")){const e=a.traits||{};console.log("🎭 Personality Traits:",{personalityTraits:e.personalityTraits?`${e.personalityTraits.substring(0,50)}...`:"None",ideals:e.ideals?`${e.ideals.substring(0,50)}...`:"None",bonds:e.bonds?`${e.bonds.substring(0,50)}...`:"None",flaws:e.flaws?`${e.flaws.substring(0,50)}...`:"None"})}const n=performance.now(),i=await this.parseCharacterToXML(a),s=performance.now()-n;this.reportProgress("Generating XML",90);const l=performance.now()-t;return this.reportProgress("Conversion complete",100),{success:!0,xml:i,characterData:a,performance:{fetchTime:o,parseTime:s,totalTime:l}}}catch(error){return console.error("Conversion error:",error),{success:!1,error:error instanceof Error?error.message:"Unknown conversion error"}}}async convertCharacterData(e){const t=performance.now();try{console.log("Converting character data directly:",e.name),this.reportProgress("Initializing conversion",10),await this.initializeGameConfig(),this.reportProgress("Parsing character data",50);const r=performance.now(),a=await this.parseCharacterToXML(e),o=performance.now()-r;return this.reportProgress("Conversion complete",100),{success:!0,xml:a,characterData:e,performance:{fetchTime:0,parseTime:o,totalTime:performance.now()-t}}}catch(error){return console.error("Character data conversion error:",error),{success:!1,error:error instanceof Error?error.message:"Unknown conversion error"}}}async fetchCharacterData(e){return Kr.isEnabled("character_fetcher")?(console.log("Using new CharacterFetcher service"),this.reportProgress("Fetching from D&D Beyond (new)",25),await this.characterFetcher.fetchCharacter(e)):(console.log("Using legacy character fetching"),this.reportProgress("Fetching from D&D Beyond (legacy)",25),await this.fetchCharacterLegacy(e))}async fetchCharacterLegacy(e){try{const t=this.characterFetcher.validateCharacterID(e);if(!t.valid)return{success:!1,error:t.error};const r=t.sanitized,a=`https://uakari-indigo.fly.dev/https://character-service.dndbeyond.com/character/v5/character/${r}`,o=await fetch(a,{method:"GET",headers:{Accept:"application/json","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Origin:"https://www.dndbeyond.com","X-Requested-With":"XMLHttpRequest"}});if(!o.ok){let e;switch(o.status){case 401:case 403:e="Character not found or not public. Ensure character visibility is set to Public.";break;case 404:e="Character not found. Please check the character ID.";break;default:e=`Unable to fetch character data (Error ${o.status}). Please try again.`}return{success:!1,error:e,statusCode:o.status}}const n=await o.json();let i;if(n.success&&n.data)i=n.data;else{if(!n.id||!n.name)return{success:!1,error:"Invalid response format from D&D Beyond API"};i=n}return i&&"number"==typeof i.id&&i.name?{success:!0,data:i}:{success:!1,error:"Invalid character data received from D&D Beyond"}}catch(error){console.error("Legacy fetch error:",error);let t="Network error occurred while fetching character data";return error instanceof Error&&(t=error.message.includes("Failed to fetch")||error.message.includes("NetworkError")?"Network error. Please check your internet connection and try again.":error.message),{success:!1,error:t}}}async parseCharacterToXML(e){console.log("parseCharacterToXML called with:",{characterId:e.id,characterName:e.name,dataKeys:Object.keys(e)});const t=this.sanitizeString(e.name||"Unknown Character"),r=e.id||0,a=this.calculateTotalLevel(e),o=ma.calculateProficiencyBonus(a),n=`<?xml version="1.0" encoding="UTF-8"?>\n<root version="4.7" dataversion="20241002" release="8.1|CoreRPG:7">\n  <character>\n    <name type="string">${t}</name>\n    <gender type="string">${this.sanitizeString(e.gender||"")}</gender>\n    <deity type="string">${this.sanitizeString(e.faith||"")}</deity>\n    <age type="string">${this.sanitizeString(e.age||"")}</age>\n    <appearance type="string">${this.sanitizeString(e.hair?`Hair: ${e.hair}, Eyes: ${e.eyes||""}, Skin: ${e.skin||""}`:"")}</appearance>\n    <height type="string">${this.sanitizeString(e.height||"")}</height>\n    <weight type="string">${this.sanitizeString(e.weight?e.weight.toString():"")}</weight>\n    <size type="string">${ma.getDefaultSize()}</size>\n    <alignment type="string">${this.sanitizeString(ma.getAlignmentName(e.alignmentId))}</alignment>\n    <bonds type="string">${this.sanitizeString(e.traits?.bonds||"")}</bonds>\n    <flaws type="string">${this.sanitizeString(e.traits?.flaws||"")}</flaws>\n    <ideals type="string">${this.sanitizeString(e.traits?.ideals||"")}</ideals>\n    <personalitytraits type="string">${this.sanitizeString(e.traits?.personalityTraits||"")}</personalitytraits>\n    <race type="string">${this.sanitizeString(e.race?.fullName||"Unknown")}</race>\n    <racelink type="windowreference">\n      <class>reference_race</class>\n      <recordname>reference.race.${this.sanitizeString((e.race?.fullName||"unknown").toLowerCase().replace(/\s+/g,""))}@*</recordname>\n    </racelink>\n    <background type="string">${this.sanitizeString(e.background?.definition?.name||"")}</background>\n    <backgroundlink type="windowreference">\n      <class>reference_background</class>\n      <recordname>reference.background.${this.sanitizeString((e.background?.definition?.name||"unknown").toLowerCase().replace(/\s+/g,""))}@*</recordname>\n    </backgroundlink>\n    <level type="number">${a}</level>\n    <profbonus type="number">${o}</profbonus>\n    <notes type="string">${this.generateNotesText(e,r)}</notes>\n    <perception type="number">0</perception>\n    <perceptionmodifier type="number">0</perceptionmodifier>\n    <exp type="number">${e.currentXp||0}</exp>\n    <expneeded type="number">0</expneeded>\n    \n    \x3c!-- Abilities with proper template structure --\x3e\n    <abilities>\n      ${this.generateAbilitiesXML(e)}\n    </abilities>\n    \n    \x3c!-- Classes with template structure --\x3e\n    <classes>\n      ${e.classes?.map((e,t)=>`<id-${String(t+1).padStart(5,"0")}>\n        <casterpactmagic type="number">0</casterpactmagic>\n        <hddie type="dice">${e.definition?.hitDie?`d${e.definition.hitDie}`:ma.getDefaultHitDie()}</hddie>\n        <hdused type="number">0</hdused>\n        <level type="number">${e.level||1}</level>\n        <name type="string">${this.sanitizeString(e.definition?.name||"Unknown")}</name>\n        <shortcut type="windowreference">\n          <class>reference_class</class>\n          <recordname>reference.class.${this.sanitizeString((e.definition?.name||"unknown").toLowerCase())}@*</recordname>\n        </shortcut>\n      </id-${String(t+1).padStart(5,"0")}>`).join("\n      ")||""}\n    </classes>\n    \n    \x3c!-- Currency --\x3e\n    <coins>\n      ${this.generateCoinsXML(e)}\n    </coins>\n    \n    \x3c!-- Hit Points --\x3e\n    <hp>\n      <total type="number">${this.calculateHP(e)}</total>\n      <wounds type="number">0</wounds>\n      <temporary type="number">0</temporary>\n    </hp>\n\n    \x3c!-- Defenses --\x3e\n    <defenses>\n      <ac>\n        ${this.generateACComponents(e)}\n      </ac>\n    </defenses>\n    \n    ${this.generateEncumbranceXML(e)}\n    \n    \x3c!-- Placeholder sections for Phase 2 --\x3e\n    <featlist>\n      ${this.generateFeatsXML(e)}\n    </featlist>\n    \n    <featurelist>\n      ${this.generateFeaturesXML(e)}\n    </featurelist>\n    \n    ${this.generateInventoryXML(e)}\n    \n    <languagelist>\n      ${this.generateLanguagesXML(e)}\n    </languagelist>\n    \n    <powergrouplist>\n      ${this.generatePowerGroupXML(e)}\n    </powergrouplist>\n    \n    <skilllist>\n      ${this.generateSkillsXML(e)}\n    </skilllist>\n    \n    <proficiencylist>\n      ${this.generateProficienciesXML(e)}\n    </proficiencylist>\n    \n    <traitlist>\n      ${this.generateTraitsXML(e)}\n    </traitlist>\n    \n    <weaponlist>\n      ${this.generateWeaponsXML(e)}\n    </weaponlist>\n    \n    <powers>\n      ${this.generateSpellsXML(e)}\n    </powers>\n    \n    ${this.generatePowerMetaXML(e)}\n  </character>\n</root>`;return console.log("Generated mock XML for character:",t),n}reportProgress(e,t,r){this.onProgress&&this.onProgress(e,t),console.log(`Progress: ${e} (${t}%)${r?` - ${r}`:""}`)}async checkServiceAvailability(){const e=Kr.isEnabled("character_fetcher");return{proxyService:await this.characterFetcher.checkServiceHealth(),legacyParser:"undefined"!=typeof window&&!!window.parseCharacter,usingNewFetcher:e}}calculateTotalLevel(e){return e.classes&&Array.isArray(e.classes)&&e.classes.reduce((e,t)=>e+(t.level||0),0)||1}generatePowerGroupXML(e){if(!Kr.isEnabled("spell_slot_calculator"))return"\x3c!-- Spell slots disabled by feature flag --\x3e";try{const t=this.extractClassInfo(e),r=this.calculateSpellSlots(t);if(!r||!r.spellSlots)return"\x3c!-- No spell slots calculated --\x3e";r.spellSlots;const a=t.some(e=>"warlock"===e.classDefinition.name.toLowerCase()),o=Object.values(r.spellSlots).some(e=>e>0),n=Object.values(r.pactMagicSlots).some(e=>e>0);return o||n?a&&n?this.generatePactMagicPowerGroupXML(e,t):this.generateRegularSpellPowerGroupXML(r.spellSlots,r.debugInfo):"\x3c!-- Character has no spell slots --\x3e"}catch(error){return console.error("Error generating spell slots XML:",error),"\x3c!-- Error generating spell slots --\x3e"}}generateRegularSpellPowerGroupXML(e,t){let r="",a=1;return[{key:"level1",name:"1st Level"},{key:"level2",name:"2nd Level"},{key:"level3",name:"3rd Level"},{key:"level4",name:"4th Level"},{key:"level5",name:"5th Level"},{key:"level6",name:"6th Level"},{key:"level7",name:"7th Level"},{key:"level8",name:"8th Level"},{key:"level9",name:"9th Level"}].forEach(t=>{const o=e[t.key]||0;o>0&&(r+=`      <id-${String(a).padStart(5,"0")}>\n        <castertype type="string">memorized</castertype>\n        <name type="string">${this.sanitizeString(t.name+" Spells")}</name>\n        <stat type="string">charisma</stat>\n        <powers>\n          \x3c!-- Spell slots: ${o} --\x3e\n        </powers>\n      </id-${String(a).padStart(5,"0")}>\n`,a++)}),r||"\x3c!-- No spell slots available --\x3e"}generatePactMagicPowerGroupXML(e,t){const r=t.find(e=>"warlock"===e.name);return r?(this.getWarlockPactMagicSlots(r.level),'      <id-00001>\n        <castertype type="string">pact</castertype>\n        <name type="string">Pact Magic</name>\n        <stat type="string">charisma</stat>\n        <powers>\n          \x3c!-- Warlock spells --\x3e\n        </powers>\n      </id-00001>\n'):"\x3c!-- No warlock class found --\x3e"}getWarlockPactMagicSlots(e){return e>=17?{level5:4}:e>=15?{level5:3}:e>=11||e>=9?{level5:2}:e>=7?{level4:2}:e>=5?{level3:2}:e>=3?{level2:2}:e>=2?{level1:2}:e>=1?{level1:1}:{}}generatePowerMetaXML(e){if(!Kr.isEnabled("spell_slot_calculator"))return"\x3c!-- Spell slot meta disabled by feature flag --\x3e";try{const t=this.extractClassInfo(e),r=this.calculateSpellSlots(t);return r&&r.spellSlots?`    ${this.spellSlotCalculator.generateSpellSlotsXML(r).combinedXML}`:"\x3c!-- No spell slot meta calculated --\x3e"}catch(error){return console.error("Failed to generate spell slot meta XML:",error),"\x3c!-- Spell slot meta generation failed --\x3e"}}generateSpellSlotsXML(e){if(!Kr.isEnabled("spell_slot_calculator"))return"\x3c!-- Spell slots disabled by feature flag --\x3e";try{const t=this.extractClassInfo(e),r=this.calculateSpellSlots(t);if(!r||!r.spellSlots)return"\x3c!-- No spell slots calculated --\x3e";const a=this.spellSlotCalculator.generateSpellSlotsXML(r),o=Object.values(r.spellSlots).some(e=>e>0),n=Object.values(r.pactMagicSlots).some(e=>e>0);return o||n?a.spellSlotsXML||a.pactMagicXML:"\x3c!-- Character has no spell slots --\x3e"}catch(error){return console.error("Failed to generate spell slots XML:",error),"\x3c!-- Spell slots generation failed --\x3e"}}generateAbilitiesXML(e){const t=ma.getAbilities(),r=this.getAbilityScores(e);return t.map(e=>{const t=r[e.name]||ma.getDefaultAbilityScore(),a=ma.calculateAbilityModifier(t);return`<${e.name}>\n        <bonus type="number">${a}</bonus>\n        <save type="number">${a}</save>\n        <savemodifier type="number">0</savemodifier>\n        <saveprof type="number">0</saveprof>\n        <score type="number">${t}</score>\n      </${e.name}>`}).join("\n      ")}sanitizeString(e){return Kr.isEnabled("string_sanitizer_service"),fa.sanitizeForXML(e)}safeAccess(e,t,r=null){return Kr.isEnabled("safe_access_service"),ba.get(e,t,r)}processAbilityBonuses(e){return Kr.isEnabled("ability_score_processor"),xa.processAbilityScoreBonuses(e)}getAbilityScores(e){if(Kr.isEnabled("ability_score_processor")){const t=xa.processAbilityScoreBonuses(e),r={};return va.forEach(e=>{r[e]=t.totalScores[e]?.total||10}),r}if(Kr.isEnabled("ability_constants"))return wa.convertLegacyAbilities(e.stats||[],e.bonusStats,e.overrideStats);{const t={};return["strength","dexterity","constitution","intelligence","wisdom","charisma"].forEach((r,a)=>{const o=e.stats?.[a]?.value||10,n=e.bonusStats?.[a]?.value||0,i=e.overrideStats?.[a]?.value;t[r]=null!=i?i:o+n}),t}}enableAbilityScoreDebug(e=!0){xa.setDebugMode(e),console.log("🔍 Ability Score Processor debug mode "+(e?"enabled":"disabled"))}enableSpellSlotDebug(e=!0){$a.setDebugMode(e),console.log("🪄 Spell Slot Calculator debug mode "+(e?"enabled":"disabled"))}extractClassInfo(e){return e.classes&&Array.isArray(e.classes)?e.classes.map((e,t)=>{const r=e.definition?.name||"unknown",a=e.level||1,o=e.subclassDefinition?.name;return{id:e.definition?.id||t+1,level:a,classDefinition:{id:e.definition?.id||t+1,name:r,canCastSpells:e.definition?.canCastSpells||!1,spellCastingAbilityId:e.definition?.spellCastingAbilityId},subclassDefinition:o?{id:e.subclassDefinition?.id||0,name:o}:void 0}}):[]}calculateSpellSlots(e){return Kr.isEnabled("spell_slot_calculator"),this.spellSlotCalculator.calculateSpellSlots(e)}generateEncumbranceXML(e){try{const t=this.calculateEncumbrance(e);return t?(console.log(`⚖️ Generated encumbrance XML: ${t.totalWeight} lbs, ${t.encumbranceLevel}`),`\x3c!-- Encumbrance --\x3e\n    <encumbrance>\n      <encumbered type="number">${t.carryingCapacity.normal}</encumbered>\n      <encumberedheavy type="number">${2*t.carryingCapacity.normal}</encumberedheavy>\n      <liftpushdrag type="number">${t.carryingCapacity.push}</liftpushdrag>\n      <load type="number">${Math.round(t.totalWeight)}</load>\n      <max type="number">${t.carryingCapacity.normal}</max>\n    </encumbrance>`):(console.warn("No encumbrance data calculated"),'\x3c!-- Encumbrance --\x3e\n    <encumbrance>\n      <encumbered type="number">0</encumbered>\n      <encumberedheavy type="number">0</encumberedheavy>\n      <liftpushdrag type="number">0</liftpushdrag>\n      <load type="number">0</load>\n      <max type="number">0</max>\n    </encumbrance>')}catch(error){return console.error("Failed to generate encumbrance XML:",error),'\x3c!-- Encumbrance generation failed --\x3e\n    <encumbrance>\n      <encumbered type="number">0</encumbered>\n      <encumberedheavy type="number">0</encumberedheavy>\n      <liftpushdrag type="number">0</liftpushdrag>\n      <load type="number">0</load>\n      <max type="number">0</max>\n    </encumbrance>'}}generateInventoryXML(e){try{const t=this.processInventory(e);return t.xmlResult&&t.xmlResult.xml?(console.log(`📦 Generated inventory XML: ${t.statistics.totalItems} items`),t.xmlResult.xml):(console.warn("No inventory XML generated"),"<inventorylist>\n\t\t\t\x3c!-- No inventory items --\x3e\n\t\t</inventorylist>")}catch(error){return console.error("Failed to generate inventory XML:",error),"<inventorylist>\n\t\t\t\x3c!-- Inventory generation failed --\x3e\n\t\t</inventorylist>"}}generateFeaturesXML(e){if(!Kr.isEnabled("feature_processor"))return console.log("🎭 Using legacy feature processing (placeholder)"),"\x3c!-- Legacy feature processing not yet implemented --\x3e";try{console.log("🎭 Using modern FeatureProcessor service for class features"),Kr.isEnabled("feature_processor_debug")&&Na.setDebugMode(!0);const t=this.featureProcessor.processCharacterFeatures(e),r=this.featureProcessor.generateFeaturesXML(t);if(Na.setDebugMode(!1),Kr.isEnabled("feature_processor_debug")){console.log("Class Features Breakdown:",t.debugInfo.classBreakdown),console.log(`Processing Method: ${t.debugInfo.processingMethod}`),console.log("Features by Class:",t.featuresByClass),console.log("Traits by Race:",t.traitsByRace);const r=Na.validateCharacterData(e);console.log("Feature Data Validation:",{isValid:r.isValid,errorCount:r.errors.length}),r.errors.length>0&&console.error("Feature Data Errors:",r.errors)}return console.log(`🎭 Generated features XML: ${t.totalFeatures} total features`),r}catch(error){return console.error("Failed to generate features XML:",error),"\x3c!-- Feature processing failed --\x3e"}}generateTraitsXML(e){if(!Kr.isEnabled("feature_processor"))return console.log("🎭 Using legacy trait processing (placeholder)"),"\x3c!-- Legacy trait processing not yet implemented --\x3e";try{console.log("🎭 Using modern FeatureProcessor service for racial traits"),Kr.isEnabled("feature_processor_debug")&&Na.setDebugMode(!0);const t=this.featureProcessor.processCharacterFeatures(e),r=this.featureProcessor.generateTraitsXML(t);return Na.setDebugMode(!1),Kr.isEnabled("feature_processor_debug")&&(console.log("Racial Traits Breakdown:",t.debugInfo.raceBreakdown),console.log(`Processing Method: ${t.debugInfo.processingMethod}`),console.log("Traits by Race:",t.traitsByRace)),console.log(`🎭 Generated traits XML: ${t.debugInfo.raceBreakdown.traitCount} total traits`),r}catch(error){return console.error("Failed to generate traits XML:",error),"\x3c!-- Trait processing failed --\x3e"}}generateWeaponsXML(e){try{if(console.log("⚔️ Generating weapons XML"),!Kr.isEnabled("inventory_processor"))return console.log("⚔️ Inventory processor disabled by feature flag"),"\x3c!-- Inventory processor disabled --\x3e";console.log("⚔️ Character inventory data:",{hasInventory:!!e.inventory,inventoryLength:e.inventory?.length||0,inventoryType:Array.isArray(e.inventory)?"array":typeof e.inventory});const t=this.inventoryProcessor.processInventory(e.inventory||[],e.id,{includeZeroQuantityItems:!1,respectContainerHierarchy:!0,generateDetailedXML:!0,sanitizeOutput:!0,includeCostInformation:!1,markItemsAsIdentified:!0});console.log("⚔️ Inventory processing result:",{hasResult:!!t,hasNestedStructure:!!t?.nestedStructure,hasRootItems:!!t?.nestedStructure?.rootItems,rootItemsType:Array.isArray(t?.nestedStructure?.rootItems)?"array":typeof t?.nestedStructure?.rootItems,rootItemsLength:t?.nestedStructure?.rootItems?.length||0});const r=[];let a=0;if(!t||!t.nestedStructure||!t.nestedStructure.rootItems)return console.log("⚔️ No inventory items found or invalid inventory structure"),"\x3c!-- No inventory items found --\x3e";const o=t.nestedStructure.rootItems,n=t.nestedStructure.containers,i=o.length;Kr.isEnabled("weaponlist_debug")&&console.log(`⚔️ Processing ${i} root items + ${n.size} containers for weapons`);for(const e of o)if(Kr.isEnabled("weaponlist_debug")&&console.log(`⚔️ Checking item: ${e.definition.name}`,{filterType:e.definition.filterType,isWeapon:"Weapon"===e.definition.filterType,itemType:e.definition.type,equipped:e.equipped,hasWeaponBehaviors:!!e.definition.weaponBehaviors}),this.isWeapon(e)){Kr.isEnabled("weaponlist_debug")&&console.log(`⚔️ Found weapon: ${e.definition.name}`);const t=this.extractWeaponData(e,a);if(t&&(r.push(t),a++,this.isThrown(e))){const t=this.extractThrownWeaponData(e,a);t&&(r.push(t),a++)}}Kr.isEnabled("weaponlist_debug")&&console.log(`⚔️ Checking ${n.size} containers for weapons`),n.forEach((e,t)=>{Kr.isEnabled("weaponlist_debug")&&console.log(`⚔️ Checking container: ${e.definition.name} with ${e.contents.length} items`);for(const o of e.contents)if(Kr.isEnabled("weaponlist_debug")&&console.log(`⚔️ Checking container item: ${o.definition.name}`,{filterType:o.definition.filterType,isWeapon:"Weapon"===o.definition.filterType,containerName:e.definition.name}),this.isWeapon(o)){Kr.isEnabled("weaponlist_debug")&&console.log(`⚔️ Found weapon in container: ${o.definition.name}`);const e=this.extractWeaponData(o,a);if(e&&(r.push(e),a++,this.isThrown(o))){const e=this.extractThrownWeaponData(o,a);e&&(r.push(e),a++)}}}),this.linkAmmoToWeapons(r,t.nestedStructure),this.isCharacterMonk(e)&&r.push(this.getMonkUnarmedStrike(a)),console.log(`⚔️ Final weapons array length: ${r.length}`,r);let s="";return r.forEach((e,t)=>{const r=String(t+1).padStart(5,"0");s+=`      <id-${r}>\n        <attackbonus type="number">${e.attackBonus}</attackbonus>\n        <attackstat type="string">${e.attackStat}</attackstat>\n        <carried type="number">1</carried>\n        <damagelist>\n          <id-00001>\n            <bonus type="number">${e.damage.bonus}</bonus>\n            <dice type="dice">${e.damage.dice}</dice>\n            <stat type="string">${e.attackStat}</stat>\n            <type type="string">${e.damage.type}</type>\n          </id-00001>\n        </damagelist>\n        <handling type="number">0</handling>\n        <isidentified type="number">1</isidentified>\n        <name type="string">${this.sanitizeString(e.name)}</name>\n        <properties type="string">${this.sanitizeString(e.properties)}</properties>\n        <shortcut type="windowreference">\n          <class>item</class>\n          <recordname>${e.shortcut}</recordname>\n        </shortcut>\n        <type type="number">${e.weaponType}</type>`,void 0!==e.maxAmmo&&(s+=`\n        <maxammo type="number">${e.maxAmmo}</maxammo>`),s+=`\n      </id-${r}>\n`}),console.log(`⚔️ Generated weapons XML: ${r.length} weapons`),s}catch(error){return console.error("Failed to generate weapons XML:",error),"\x3c!-- Weapon processing failed --\x3e"}}generateSpellsXML(e){try{if(console.log("🪄 Generating spells XML"),!e.spells||!e.classSpells)return console.log("🪄 No spell data found"),"\x3c!-- No spells found --\x3e";const t=[];let r=0;Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Processing ${e.classSpells?.length||0} class spell collections`),e.classSpells?.forEach(a=>{const o=this.getClassNameById(e,a.characterClassId);Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Processing ${o} spells: ${a.spells?.length||0} spells`),a.spells?.forEach(e=>{const a=this.extractSpellData(e,o);a&&(Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Added ${o} spell: ${a.name} (Level ${a.level})`),t.push(a),r++)})}),e.spells.class&&e.spells.class.forEach(e=>{const a=this.extractSpellData(e,"Class");a&&(t.push(a),r++)}),e.spells.race&&e.spells.race.forEach(e=>{const a=this.extractSpellData(e,"Race");a&&(t.push(a),r++)}),e.spells.feat&&e.spells.feat.forEach(e=>{const a=this.extractSpellData(e,"Feat");a&&(t.push(a),r++)}),e.spells.item&&e.spells.item.forEach(e=>{const a=this.extractSpellData(e,"Item");a&&(t.push(a),r++)}),console.log(`🪄 Found ${t.length} spells total`);const a=this.extractActivePowers(e);Kr.isEnabled("spelllist_debug")&&(console.log(`🪄 Found ${a.length} active features/traits to add as powers`),a.forEach(e=>{console.log(`🪄 Feature found: ${e.name} (${e.source})`)})),a.forEach(e=>t.push(e)),console.log(`🪄 Found ${a.length} active features/traits to add as powers`),console.log(`🪄 Total powers (spells + features): ${t.length}`);let o="";return t.forEach((e,t)=>{const r=String(t+1).padStart(5,"0");o+=`      <id-${r}>`;const a=this.generateSpellActions(e);a&&(o+=`\n        <actions>\n${a}        </actions>`),"feature"===e.powerType?o+=`\n        <cast type="number">0</cast>\n        <description type="formattedtext">\n          <p>${this.sanitizeString(e.description)}</p>\n        </description>\n        <group type="string">${this.sanitizeString(e.group)}</group>\n        <level type="number">${e.level}</level>\n        <locked type="number">1</locked>\n        <name type="string">${this.sanitizeString(e.name)}</name>\n        <prepared type="number">${e.prepared}</prepared>\n        <ritual type="number">${e.ritual?1:0}</ritual>\n        <source type="string">${this.sanitizeString(e.source)}</source>`:o+=`\n        <castingtime type="string">${this.sanitizeString(e.castingTime)}</castingtime>\n        <components type="string">${this.sanitizeString(e.components)}</components>\n        <description type="formattedtext">\n          <p>${this.sanitizeString(e.description)}</p>\n        </description>\n        <duration type="string">${this.sanitizeString(e.duration)}</duration>\n        <group type="string">Spells</group>\n        <level type="number">${e.level}</level>\n        <name type="string">${this.sanitizeString(e.name)}</name>\n        <prepared type="number">${e.prepared?1:0}</prepared>\n        <range type="string">${this.sanitizeString(e.range)}</range>\n        <ritual type="number">${e.ritual?1:0}</ritual>\n        <school type="string">${this.sanitizeString(e.school)}</school>\n        <source type="string">${this.sanitizeString(e.source)}</source>`,o+=`\n      </id-${r}>\n`}),console.log(`🪄 Generated spells XML: ${t.length} spells`),o}catch(error){return console.error("Failed to generate spells XML:",error),"\x3c!-- Spell processing failed --\x3e"}}generateFeatsXML(e){try{console.log("📜 Generating feats XML");const t=e.feats||[];if(!Array.isArray(t))return console.log("📜 No feats array found in character data"),"\x3c!-- No feats data found --\x3e";if(0===t.length)return console.log("📜 Character has no feats"),"\x3c!-- Character has no feats --\x3e";let r="";return t.forEach((e,t)=>{const a=String(t+1).padStart(5,"0"),o=e.definition?.name||e.name||"Unknown Feat",n=e.definition?.description||e.description||"";r+=`      <id-${a}>\n        <locked type="number">1</locked>\n        <name type="string">${this.sanitizeString(o)}</name>\n        <text type="formattedtext">\n          <p>${this.sanitizeString(n)}</p>\n        </text>\n      </id-${a}>\n`,"Medium Armor Master"===o?console.log("📜 Found Medium Armor Master feat"):"Alert"===o?console.log("📜 Found Alert feat"):"Mobile"===o?console.log("📜 Found Mobile feat"):"Observant"===o&&console.log("📜 Found Observant feat")}),console.log(`📜 Generated feats XML: ${t.length} feats`),r}catch(error){return console.error("Failed to generate feats XML:",error),"\x3c!-- Feat processing failed --\x3e"}}generateCoinsXML(e){try{console.log("💰 Generating coins XML");const t=e.currencies||{};0===Object.keys(t).length&&console.log("💰 No currency data found in character");const r=[{key:"pp",name:"PP",amount:t.pp||0},{key:"gp",name:"GP",amount:t.gp||0},{key:"ep",name:"EP",amount:t.ep||0},{key:"sp",name:"SP",amount:t.sp||0},{key:"cp",name:"CP",amount:t.cp||0}];let a="";return r.forEach((e,t)=>{const r=t+1;a+=`      <slot${r}>\n        <amount type="number">${e.amount}</amount>\n        <name type="string">${e.name}</name>\n      </slot${r}>\n`}),a+='      <slot6>\n        <amount type="number">0</amount>\n      </slot6>\n',console.log("💰 Generated coins XML:",r.map(e=>`${e.name}: ${e.amount}`).join(", ")),a}catch(error){return console.error("Failed to generate coins XML:",error),"\x3c!-- Coin processing failed --\x3e"}}generateNotesText(e,t){try{console.log("📝 Generating character notes");let r="";if(r+=`D&D Beyond Character ID: ${t}\\n`,e.notes&&"object"==typeof e.notes){const t=Object.entries(e.notes);t.length>0?(console.log(`📝 Found ${t.length} note categories`),t.forEach(([e,t])=>{if(null!=t&&""!==t){const a=e.charAt(0).toUpperCase()+e.substring(1),o=this.sanitizeString(t).trim();r+=`${a}: ${o}\\n`,console.log(`📝 Added note: ${a} (${o.length} chars)`)}})):console.log("📝 Notes object exists but is empty")}else console.log("📝 No notes found in character data");const a=r.replace(/\\n$/,"");return console.log(`📝 Generated notes text (${a.length} chars total)`),this.sanitizeString(a)}catch(error){return console.error("Failed to generate notes text:",error),this.sanitizeString(`Character converted from D&D Beyond (ID: ${t}) using Modern Converter v2.0`)}}generateProficienciesXML(e){try{console.log("🛠️ Generating proficiencies XML");const t=new Set;e.modifiers&&Object.values(e.modifiers).forEach(e=>{Array.isArray(e)&&e.forEach(e=>{if("proficiency"===e.type&&e.isGranted){const r=e.friendlySubtypeName||e.subType;this.isSkillProficiency(e.subType)||this.isSavingThrowProficiency(e.subType)||this.isPlaceholderProficiency(r)||t.add(r)}})});let r="",a=1;return t.forEach(e=>{const t=String(a).padStart(5,"0");r+=`      <id-${t}>\n        <name type="string">${e}</name>\n      </id-${t}>\n`,a++}),console.log(`🛠️ Generated ${t.size} proficiencies`),r}catch(error){return console.error("Error generating proficiencies XML:",error),"\x3c!-- Error generating proficiencies --\x3e"}}isSkillProficiency(e){return["acrobatics","animal-handling","arcana","athletics","deception","history","insight","intimidation","investigation","medicine","nature","perception","performance","persuasion","religion","sleight-of-hand","stealth","survival"].includes(e)}isSavingThrowProficiency(e){return e.includes("saving-throws")}isPlaceholderProficiency(e){return["Choose a Barbarian Skill","Choose a Sorcerer Skill Proficiency","Choose a Sorcerer Skill Proficiency "].includes(e)}processInventory(e){if(Kr.isEnabled("inventory_processor"))try{console.log("🎒 Using modern InventoryProcessor service");const t=this.convertToInventoryItems(e.inventory||[]),r=e.id,a={includeZeroQuantityItems:!1,respectContainerHierarchy:!0,generateDetailedXML:!1,sanitizeOutput:Kr.isEnabled("string_sanitizer_service"),includeCostInformation:!0,markItemsAsIdentified:!0};return this.inventoryProcessor.processInventory(t,r,a)}catch(error){console.warn("InventoryProcessor failed, falling back to legacy:",error)}return console.log("📦 Using legacy inventory processing"),{nestedStructure:{characterId:e.id,rootItems:[],containers:new Map,totalItems:0,totalWeight:0},xmlResult:{xml:"\x3c!-- Legacy inventory processing not implemented --\x3e",itemCount:0,totalWeight:0,containerCount:0,debugInfo:{processedItems:0,skippedItems:0,containerItems:0,magicContainers:[]}},statistics:{totalItems:0,containerCount:0,magicContainers:0,totalWeight:0}}}calculateEncumbrance(e){if(Kr.isEnabled("encumbrance_calculator"))try{console.log("⚖️ Using modern EncumbranceCalculator service");const t={id:e.id,strengthScore:this.getAbilityScore(e,1),hasPowerfulBuild:Ta.hasPowerfulBuild(e)},r=this.convertToInventoryItems(e.inventory||[]),a={includeContainerWeights:!0,respectMagicContainers:!0,applyRacialTraits:!0};return this.encumbranceCalculator.calculateEncumbrance(t,r,a)}catch(error){console.warn("EncumbranceCalculator failed, falling back to legacy:",error)}return console.log("⚖️ Using legacy encumbrance calculation"),{totalWeight:0,carryingCapacity:{normal:0,push:0,lift:0,powerfulBuild:!1},encumbranceLevel:"unencumbered",speedPenalty:0,disadvantageOnChecks:!1}}convertToInventoryItems(e){return e.map(e=>({id:e.id,entityTypeId:e.entityTypeId,definition:{id:e.definition.id,name:e.definition.name,weight:e.definition.weight||0,bundleSize:e.definition.bundleSize||1,isContainer:e.definition.isContainer||!1,weightMultiplier:e.definition.weightMultiplier,filterType:e.definition.filterType,subType:e.definition.subType,description:e.definition.description,cost:e.definition.cost?{quantity:e.definition.cost.quantity,unit:e.definition.cost.unit}:void 0},quantity:e.quantity,isAttuned:e.isAttuned||!1,equipped:e.equipped||!1,containerEntityId:e.containerEntityId,charges:e.charges,customName:e.customName,customWeight:e.customWeight,customCost:e.customCost}))}getAbilityScore(e,t){const r=e.stats?.find(e=>e.id===t),a=e.bonusStats?.find(e=>e.id===t);return(r?.value||10)+(a?.value||0)}generateSkillsXML(e){const t=["dexterity","wisdom","intelligence","strength","charisma","intelligence","wisdom","charisma","intelligence","wisdom","intelligence","wisdom","charisma","charisma","intelligence","dexterity","dexterity","wisdom"];let r="";return["acrobatics","animal_handling","arcana","athletics","deception","history","insight","intimidation","investigation","medicine","nature","perception","performance","persuasion","religion","sleight_of_hand","stealth","survival"].forEach((a,o)=>{const n=String(o+1).padStart(5,"0");let i=a;i=a.match(/^sleight/)?"Sleight of Hand":a.includes("animal")?"Animal Handling":a.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");let s=0;const l=ha.find(e,"type","proficiency");l&&l.length>0&&l.some(e=>{const t=e.subType?.replace(/-/g,"_");return t===a})&&(s=1);const c=ha.find(e,"type","expertise");c&&c.length>0&&c.some(e=>{const t=e.subType?.replace(/-/g,"_");return t===a})&&(s=2);const d=ha.find(e,"type","half-proficiency");d&&d.length>0&&0===s&&d.some(e=>{const t=e.subType?.replace(/-/g,"_");return t===a})&&(s=3),r+=`      <id-${n}>\n`,r+='        <misc type="number">0</misc>\n',r+=`        <name type="string">${i}</name>\n`,r+=`        <stat type="string">${t[o]}</stat>\n`,r+=`        <prof type="number">${s}</prof>\n`,r+=`      </id-${n}>\n`}),r}generateLanguagesXML(e){let t="";const r=new Set,a=ha.find(e,"type","language");return a&&a.length>0&&a.forEach(e=>{const t=e.friendlySubtypeName||e.subType||"Unknown Language";r.add(t)}),e.race?.racialTraits&&e.race.racialTraits.forEach(e=>{if(e.definition?.name?.toLowerCase().includes("language")){const t=e.definition.description||"";["Common","Elvish","Dwarvish","Halfling","Orcish","Gnomish","Giant","Draconic"].forEach(e=>{t.includes(e)&&r.add(e)})}}),Array.from(r).sort().forEach((e,r)=>{const a=String(r+1).padStart(5,"0");t+=`      <id-${a}>\n`,t+=`        <name type="string">${this.sanitizeString(e)}</name>\n`,t+=`      </id-${a}>\n`}),t}async generateMultiFormatOutput(e,t,r){console.log(`🔄 Generating multi-format output for character: ${e.name}`),console.log(`📋 Requested formats: ${t.join(", ")}`);const a=await this.prepareProcessedCharacterData(e),o=new Map;for(const n of t)try{console.log(`🔄 Generating ${n} output...`);const e=await ja.generateOutput(n,a,r);o.set(n,e),e.success?console.log(`✅ Successfully generated ${n} output`):console.error(`❌ Failed to generate ${n} output:`,e.errors)}catch(error){console.error(`💥 Error generating ${n} output:`,error),o.set(n,{success:!1,errors:[{type:"generation_error",message:error instanceof Error?error.message:"Unknown error occurred"}]})}return o}async generateFormatOutput(e,t,r){console.log(`🔄 Generating ${t} output for character: ${e.name}`);const a=await this.prepareProcessedCharacterData(e);return ja.generateOutput(t,a,r)}async prepareProcessedCharacterData(e){const t=e.classes?.reduce((e,t)=>e+(t.level||0),0)||1;return{characterData:e,totalLevel:t,proficiencyBonus:Math.ceil(t/4)+1,abilities:e.stats||null,spellSlots:null,inventory:null,features:null}}async getFormatCompatibility(e){const t=await this.prepareProcessedCharacterData(e);return ja.getFormatCompatibility(t)}getAvailableFormats(){return ja.getSupportedFormats()}isFormatSupported(e){return ja.isFormatSupported(e)}getFormatDefaultOptions(e){return ja.getDefaultOptions(e)}getFeatureFlagStatus(){return{character_fetcher:Kr.isEnabled("character_fetcher"),modern_converter:Kr.isEnabled("modern_converter"),legacy_fallback:Kr.isEnabled("legacy_fallback"),debug_character_data:Kr.isEnabled("debug_character_data"),object_search_service:Kr.isEnabled("object_search_service"),string_sanitizer_service:Kr.isEnabled("string_sanitizer_service"),safe_access_service:Kr.isEnabled("safe_access_service"),ability_constants:Kr.isEnabled("ability_constants"),ability_score_processor:Kr.isEnabled("ability_score_processor"),debug_ability_score_processor:Kr.isEnabled("debug_ability_score_processor"),spell_slot_calculator:Kr.isEnabled("spell_slot_calculator"),debug_spell_slot_calculator:Kr.isEnabled("debug_spell_slot_calculator"),inventory_processor:Kr.isEnabled("inventory_processor"),encumbrance_calculator:Kr.isEnabled("encumbrance_calculator"),inventory_processor_debug:Kr.isEnabled("inventory_processor_debug"),encumbrance_calculator_debug:Kr.isEnabled("encumbrance_calculator_debug"),feature_processor_debug:Kr.isEnabled("feature_processor_debug"),weaponlist_debug:Kr.isEnabled("weaponlist_debug")}}isWeapon(e){return"Weapon"===e.definition.filterType}isThrown(e){return(e.definition.weaponBehaviors?.[0]?.properties||[]).some(e=>e.toLowerCase().includes("thrown"))}extractWeaponData(e,t){Kr.isEnabled("weaponlist_debug")&&console.log(`⚔️ Extracting weapon data for: ${e.definition.name}`);const r=e.definition.weaponBehaviors?.[0];let a=r?.properties||[];0===a.length&&(a=this.inferWeaponProperties(e));const o=a.some(e=>e.toLowerCase().includes("range"))||a.some(e=>e.toLowerCase().includes("ranged"))||this.isRangedWeapon(e.definition.name),n=a.some(e=>e.toLowerCase().includes("thrown")),i=this.getWeaponAttackStat(e,o),s=this.extractWeaponDamage(e);let l=0;n?l=2:o&&(l=1);const c=`....inventorylist.id-${String(e.id).padStart(5,"0")}`,d={id:e.id,name:e.definition.name,properties:a.join(", "),attackBonus:0,attackStat:i,damage:s,weaponType:l,shortcut:c};return Kr.isEnabled("weaponlist_debug")&&console.log("⚔️ Extracted weapon data:",d),d}extractThrownWeaponData(e,t){const r=this.extractWeaponData(e,t);return r?{...r,weaponType:0}:null}getWeaponAttackStat(e,t){return t?"dexterity":"strength"}isCharacterMonk(e){return!!e.classes&&e.classes.some(e=>"monk"===e.definition?.name?.toLowerCase())}getMonkUnarmedStrike(e){return{id:999999,name:"Unarmed Strike",properties:"Monk, Unarmed",attackBonus:0,attackStat:"dexterity",damage:{dice:"1d4",bonus:0,type:"bludgeoning"},weaponType:0,shortcut:""}}linkAmmoToWeapons(e,t){Kr.isEnabled("weaponlist_debug")&&console.log(`⚔️ Linking ammunition to ${e.length} weapons`);const r=[];t.rootItems.forEach(e=>{this.isAmmunition(e)&&r.push(e)}),t.containers.forEach(e=>{e.contents.forEach(e=>{this.isAmmunition(e)&&r.push(e)})}),Kr.isEnabled("weaponlist_debug")&&console.log(`⚔️ Found ${r.length} ammunition items:`,r.map(e=>({name:e.definition.name,quantity:e.quantity,subType:e.definition.subType}))),e.forEach((e,a)=>{if(2===e.weaponType)e.maxAmmo=this.getThrownWeaponQuantity(e,t),Kr.isEnabled("weaponlist_debug")&&console.log(`⚔️ Set thrown weapon ${e.name} maxAmmo to ${e.maxAmmo} (using item quantity)`);else{const t=this.findCompatibleAmmo(e,r);t&&(e.maxAmmo=t.quantity,Kr.isEnabled("weaponlist_debug")&&console.log(`⚔️ Linked ${e.name} to ${t.definition.name} (${t.quantity})`))}})}getThrownWeaponQuantity(e,t){const r=e.id;for(const a of t.rootItems)if(a.id===r)return a.quantity;for(const[a,o]of t.containers)for(const e of o.contents)if(e.id===r)return e.quantity;return 1}isAmmunition(e){return"Ammunition"===e.definition.subType||e.definition.isConsumable&&"Other Gear"===e.definition.filterType}findCompatibleAmmo(e,t){const r=e.name.toLowerCase();for(const a of t){const e=a.definition.name.toLowerCase();if(r.includes("crossbow")&&e.includes("bolt"))return a;if(r.includes("bow")&&e.includes("arrow"))return a;if(r.includes("sling")&&(e.includes("bullet")||e.includes("stone")))return a;if(r.includes("blowgun")&&e.includes("needle"))return a}return null}inferWeaponProperties(e){const t=[],r=e.definition.name?.toLowerCase()||"";return this.isRangedWeapon(r)&&t.push("Ranged"),["greatsword","maul","pike","glaive","halberd","longbow","heavy crossbow"].some(e=>r.includes(e))&&t.push("Two-handed"),["dagger","dart","javelin","light hammer","sickle","scimitar","shortsword","handaxe"].some(e=>r.includes(e))&&t.push("Light"),["dagger","dart","rapier","scimitar","shortsword","whip"].some(e=>r.includes(e))&&t.push("Finesse"),["dart","javelin","light hammer","handaxe","spear","trident"].some(e=>r.includes(e))&&t.push("Thrown"),t}isRangedWeapon(e){return["bow","crossbow","dart","javelin","sling","blowgun"].some(t=>e.toLowerCase().includes(t))}extractWeaponDamage(e){const t=e.definition.weaponBehaviors?.[0];if(t?.damage)return{dice:t.damage.diceString||"1d6",bonus:t.damage.fixedValue||0,type:t.damage.damageTypeId?this.getDamageTypeName(t.damage.damageTypeId):"slashing"};if(e.definition.damage)return{dice:e.definition.damage.diceString||"1d6",bonus:e.definition.damage.fixedValue||0,type:e.definition.damage.damageTypeId?this.getDamageTypeName(e.definition.damage.damageTypeId):"slashing"};const r=e.definition.name?.toLowerCase()||"";return r.includes("dagger")?{dice:"1d4",bonus:0,type:"piercing"}:r.includes("shortsword")?{dice:"1d6",bonus:0,type:"piercing"}:r.includes("longsword")?{dice:"1d8",bonus:0,type:"slashing"}:r.includes("greatsword")?{dice:"2d6",bonus:0,type:"slashing"}:r.includes("mace")?{dice:"1d6",bonus:0,type:"bludgeoning"}:r.includes("warhammer")?{dice:"1d8",bonus:0,type:"bludgeoning"}:{dice:"1d6",bonus:0,type:"slashing"}}getDamageTypeName(e){return{1:"bludgeoning",2:"piercing",3:"slashing",4:"necrotic",5:"acid",6:"cold",7:"fire",8:"lightning",9:"thunder",10:"poison",11:"psychic",12:"radiant",13:"force"}[e]||"slashing"}getClassNameById(e,t){const r=e.classes?.find(e=>e.id===t);return r?.definition?.name||"Unknown"}extractSpellData(e,t){try{const r=e.definition;if(!r)return null;const a=this.formatSpellComponents(r.components||[]),o=this.formatCastingTime(r.activation),n=this.formatSpellRange(r.range),i=this.formatSpellDuration(r.duration),s=this.stripHTML(r.description||"");return{id:r.id,name:r.name,level:r.level,school:r.school||"Divination",source:t,prepared:e.prepared||!1,description:s,components:a,castingTime:o,range:n,duration:i,concentration:r.concentration||!1,ritual:r.ritual||!1,saveDc:e.overrideSaveDc||null,attackRoll:r.requiresAttackRoll||!1,requiresSavingThrow:r.requiresSavingThrow||!1,definition:r}}catch(error){return console.error("Failed to extract spell data:",error),null}}formatSpellComponents(e){const t=[];return e.includes(1)&&t.push("V"),e.includes(2)&&t.push("S"),e.includes(3)&&t.push("M"),t.join(", ")}formatCastingTime(e){if(!e)return"1 action";const t=e.activationTime||1,r={1:"action",2:"bonus action",3:"reaction",4:"minute",5:"hour",6:"no action"}[e.activationType]||"action";return 1===t?`1 ${r}`:`${t} ${r}s`}formatSpellRange(e){return e?"Self"===e.origin?e.aoeType&&e.aoeValue?`Self (${e.aoeValue}-foot ${e.aoeType.toLowerCase()})`:"Self":e.rangeValue?`${e.rangeValue} feet`:e.origin||"Touch":"Touch"}formatSpellDuration(e){if(!e)return"Instantaneous";const t=e.durationInterval||1,r=e.durationUnit?.toLowerCase()||"round";let a=1===t?`1 ${r}`:`${t} ${r}s`;return"Concentration"===e.durationType&&(a=`Concentration, up to ${a}`),a}stripHTML(e){return e.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim()}generateSpellActions(e){let t="",r=1;if("feature"===e.powerType)t+=this.generateFeatureAction(e,r);else{if(t+=`          <id-${String(r).padStart(5,"0")}>\n            <order type="number">${r}</order>\n            <type type="string">cast</type>`,e.requiresSavingThrow||e.saveDc){t+='\n            <savemagic type="number">1</savemagic>';const r=this.determineSaveType(e);r&&(t+=`\n            <savetype type="string">${r}</savetype>`)}t+=`\n          </id-${String(r).padStart(5,"0")}>\n`,r++;const a=this.extractSpellDamageInfo(e);a&&(t+=`          <id-${String(r).padStart(5,"0")}>\n            <damagelist>\n              <id-00001>\n                <bonus type="number">${a.bonus}</bonus>\n                <dice type="dice">${a.dice}</dice>\n                <type type="string">${a.type}</type>\n              </id-00001>\n            </damagelist>\n            <order type="number">${r}</order>\n            <type type="string">damage</type>\n          </id-${String(r).padStart(5,"0")}>\n`,r++);const o=this.extractSpellHealingInfo(e);o&&(t+=`          <id-${String(r).padStart(5,"0")}>\n            <order type="number">${r}</order>\n            <type type="string">heal</type>\n            <heallist>\n              <id-00001>\n                <bonus type="number">${o.bonus}</bonus>\n                <dice type="dice">${o.dice}</dice>\n              </id-00001>\n            </heallist>\n          </id-${String(r).padStart(5,"0")}>\n`,r++)}return t}generateFeatureAction(e,t){const r=e.name?.toLowerCase()||"";let a=`          <id-${String(t).padStart(5,"0")}>`;e.duration&&"Instantaneous"!==e.duration&&e.duration.includes("minute")&&(a+=`\n            <durmod type="number">${e.duration.match(/(\d+)/)?.[1]||"1"}</durmod>\n            <durunit type="string">minute</durunit>`);let o="";return o=r.includes("rage")?"Rage; ADVCHK: strength; ADVSAV: strength; DMG: 2, melee; RESIST: bludgeoning, piercing, slashing":r.includes("stone's endurance")?"Stone's Endurance; Reduce damage by 1d12 + CON modifier":e.name,a+=`\n            <label type="string">${o}</label>\n            <order type="number">${t}</order>\n            <targeting type="string">self</targeting>\n            <type type="string">effect</type>\n          </id-${String(t).padStart(5,"0")}>\n`,a}determineSaveType(e){const t=e.description?.toLowerCase()||"";return t.includes("dexterity saving throw")?"dexterity":t.includes("constitution saving throw")?"constitution":t.includes("wisdom saving throw")?"wisdom":t.includes("intelligence saving throw")?"intelligence":t.includes("charisma saving throw")?"charisma":t.includes("strength saving throw")?"strength":e.definition?.saveDcAbilityId&&{1:"strength",2:"dexterity",3:"constitution",4:"intelligence",5:"wisdom",6:"charisma"}[e.definition.saveDcAbilityId]||null}extractSpellDamageInfo(e){const t=(e.description?.toLowerCase()||"").match(/(\d+d\d+).*?(acid|cold|fire|lightning|thunder|poison|psychic|radiant|necrotic|force|bludgeoning|piercing|slashing)/i);return t?{dice:this.formatDiceForFantasyGrounds(t[1]),bonus:0,type:t[2].toLowerCase()}:e.definition?.damage?{dice:this.formatDiceForFantasyGrounds(e.definition.damage.diceString||"1d6"),bonus:e.definition.damage.fixedValue||0,type:this.getDamageTypeName(e.definition.damage.damageTypeId)||"force"}:null}extractSpellHealingInfo(e){const t=(e.description?.toLowerCase()||"").match(/(\d+d\d+).*?hit points/i);if(t)return{dice:this.formatDiceForFantasyGrounds(t[1]),bonus:0};const r=e.name?.toLowerCase()||"";return r.includes("cure")||r.includes("heal")||r.includes("vitality")?{dice:this.formatDiceForFantasyGrounds("1d8"),bonus:0}:null}formatDiceForFantasyGrounds(e){return e.replace(/^1d/,"d")}extractActivePowers(e){const t=[];return Kr.isEnabled("spelllist_debug")&&(console.log("🪄 Extracting active class features and racial traits as powers"),console.log("🪄 Character classes:",e.classes?.length||0),console.log("🪄 Character race:",e.race?.fullName)),e.classes?.forEach(r=>{const a=r.definition?.name||"Unknown";Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Checking ${a}: ${r.classFeatures?.length||0} class features`),r.classFeatures?.forEach(r=>{if(Kr.isEnabled("spelllist_debug")&&(console.log(`🪄 Checking class feature: ${r.definition?.name} - isActivePower: ${this.isActivePower(r)}`),r.definition?.name?.toLowerCase().includes("rage")&&(console.log("🪄 Raw Rage feature data:",r),console.log("🪄 Rage feature.levelScales:",r.levelScales))),this.isActivePower(r)){const o=this.extractFeaturePowerData(r,a,e);o?(t.push(o),Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Added ${a} feature: ${o.name}`)):Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Failed to extract power data for: ${r.definition?.name}`)}}),r.subclassFeatures?.forEach(r=>{if(this.isActivePower(r)){const o=r.definition?.name||a,n=this.extractFeaturePowerData(r,`${a} (${o})`,e);n&&(t.push(n),Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Added ${a} subclass feature: ${n.name}`))}})}),e.race?.racialTraits?.forEach(r=>{if(this.isActivePower(r)){const a=this.extractFeaturePowerData(r,`${e.race?.fullName||"Racial"} Traits`,e);a&&(t.push(a),Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Added racial trait: ${a.name}`))}}),t}isActivePower(e){if(!e?.definition)return!1;if(e.limitedUse)return!0;const t=e.definition.name?.toLowerCase()||"";return["rage","reckless attack","stone's endurance","form of the beast","action surge","second wind","bardic inspiration","channel divinity","wild shape","lay on hands","divine smite","sneak attack"].some(e=>t.includes(e))}extractFeaturePowerData(e,t,r){try{const a=e.definition;if(!a)return null;const o=this.stripHTML(a.description||"");let n=0,i="long rest",s="action";return e.limitedUse&&(n=e.limitedUse.maxUses||1,i=1===e.limitedUse.resetType?"short rest":"long rest",3===e.limitedUse.actionType&&(s=this.determineActionTypeFromDescription(o)),Kr.isEnabled("spelllist_debug")&&a.name?.toLowerCase().includes("rage")&&console.log("🪄 Rage limitedUse data:",e.limitedUse)),n=this.calculateScaledFeatureUses(e,r,n),Kr.isEnabled("spelllist_debug")&&a.name?.toLowerCase().includes("rage")&&console.log("🪄 Final Rage debug:",{featureName:a.name,characterLevel:this.getCharacterLevelForFeature(e,r),originalMaxUses:e.limitedUse?.maxUses||0,finalUsesMax:n,hasLevelScales:!!e.levelScales,levelScalesData:e.levelScales}),{id:a.id,name:a.name,level:0,school:"",source:t,prepared:n,description:o,components:"",castingTime:s,range:this.determineRangeFromDescription(o),duration:this.determineDurationFromDescription(o),concentration:!1,ritual:!1,group:t,powerType:"feature",resetType:i,definition:a}}catch(error){return console.error("Failed to extract feature power data:",error),null}}determineActionTypeFromDescription(e){const t=e.toLowerCase();return t.includes("bonus action")?"bonus action":t.includes("reaction")?"reaction":t.includes("no action")?"no action":"action"}determineRangeFromDescription(e){const t=e.toLowerCase();if(t.includes("self")||t.includes("yourself"))return"Self";if(t.includes("touch"))return"Touch";const r=t.match(/(\d+)\s*feet/i);return r?`${r[1]} feet`:"Self"}determineDurationFromDescription(e){const t=e.toLowerCase();return t.includes("1 minute")?"1 minute":t.includes("10 minutes")?"10 minutes":t.includes("1 hour")?"1 hour":t.includes("until")?"Until condition met":(t.includes("instantaneous"),"Instantaneous")}calculateScaledFeatureUses(e,t,r){const a=this.getCharacterLevelForFeature(e,t),o=this.findClassFeatureLevelScales(e,t);if(!o||!Array.isArray(o))return Kr.isEnabled("spelllist_debug")&&console.log(`🪄 No level scales found for ${e.definition?.name}, using default: ${r}`),r;Kr.isEnabled("spelllist_debug")&&(console.log(`🪄 Calculating scaled uses for ${e.definition?.name}: character level ${a}`),console.log("🪄 Level scales available:",o));const n=o.filter(e=>e.description&&!e.description.toLowerCase().includes("damage")&&!e.description.toLowerCase().includes("+")),i=n.length>0?n:o;Kr.isEnabled("spelllist_debug")&&n.length>0&&console.log(`🪄 Found ${n.length} usage-specific level scales (filtering out damage scaling)`);const s=i.sort((e,t)=>e.level-t.level);let l=r;for(const c of s)a>=c.level&&void 0!==c.fixedValue&&null!==c.fixedValue?(l=c.fixedValue,Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Applied level scale at level ${c.level}: ${l} uses (${c.description||"no description"})`)):Kr.isEnabled("spelllist_debug")&&(a<c.level?console.log(`🪄 Skipping level ${c.level} (character level ${a} too low)`):void 0!==c.fixedValue&&null!==c.fixedValue||console.log(`🪄 Skipping level ${c.level} (no fixedValue: ${c.fixedValue})`));return Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Final scaled uses for ${e.definition?.name}: ${l}`),l}findClassFeatureLevelScales(e,t){if(!e.definition?.id)return null;for(const r of t.classes||[]){const t=r.classFeatures?.some(t=>t.definition?.id===e.definition.id),a=r.subclassFeatures?.some(t=>t.definition?.id===e.definition.id);if(t||a){Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Found class ${r.definition?.name} containing feature ${e.definition.name}`);for(const t of r.classFeatures||[])if(t.definition?.id===e.definition.id){if(Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Examining class feature ${t.definition?.name}:`,{hasLevelScales:!!t.levelScales,levelScalesLength:t.levelScales?.length||0,levelScales:t.levelScales,hasDefinitionLevelScales:!!t.definition?.levelScales,definitionLevelScales:t.definition?.levelScales}),t.levelScales&&t.levelScales.length>0)return t.levelScales;if(t.definition?.levelScales&&t.definition.levelScales.length>0)return t.definition.levelScales}for(const t of r.subclassFeatures||[])if(t.definition?.id===e.definition.id){if(Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Examining subclass feature ${t.definition?.name}:`,{hasLevelScales:!!t.levelScales,levelScales:t.levelScales,hasDefinitionLevelScales:!!t.definition?.levelScales,definitionLevelScales:t.definition?.levelScales}),t.levelScales&&t.levelScales.length>0)return t.levelScales;if(t.definition?.levelScales&&t.definition.levelScales.length>0)return t.definition.levelScales}return Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Found class for ${e.definition.name} but no levelScales found anywhere`),null}}return Kr.isEnabled("spelllist_debug")&&console.log(`🪄 Could not find class containing feature ${e.definition.name}`),null}getCharacterLevelForFeature(e,t){for(const r of t.classes||[]){if(r.classFeatures?.some(t=>t.definition?.id===e.definition?.id))return r.level||1;if(r.subclassFeatures?.some(t=>t.definition?.id===e.definition?.id))return r.level||1}return t.classes?.reduce((e,t)=>e+(t.level||0),0)||1}calculateHP(e){const t=e.baseHitPoints||0,r=this.calculateTotalLevel(e);return t+this.getConstitutionModifier(e)*r}calculateAC(e){console.log("🛡️ Calculating AC for character:",e.name);const t=e.classes?.map(e=>e.definition?.name)||[];console.log("🏛️ Character classes:",t);const r=e.classes?.some(e=>"barbarian"===e.definition?.name?.toLowerCase()),a=e.classes?.some(e=>"monk"===e.definition?.name?.toLowerCase());if(console.log("🛡️ Unarmored Defense checks:",{barbarian:r,monk:a}),r)try{const t=this.getAbilityScores(e);console.log("⚡ Barbarian ability scores:",t);const r=Math.floor((t.dexterity-10)/2),a=Math.floor((t.constitution-10)/2),o=10+r+a;return console.log(`🛡️ Barbarian Unarmored Defense: 10 + ${r} (DEX) + ${a} (CON) = ${o}`),o}catch(error){console.error("Error calculating Barbarian Unarmored Defense AC:",error)}if(a)try{const t=this.getAbilityScores(e);console.log("⚡ Monk ability scores:",t);const r=Math.floor((t.dexterity-10)/2),a=Math.floor((t.wisdom-10)/2),o=10+r+a;return console.log(`🛡️ Monk Unarmored Defense: 10 + ${r} (DEX) + ${a} (WIS) = ${o}`),o}catch(error){console.error("Error calculating Monk Unarmored Defense AC:",error)}const o=e.armorClass||ma.getBaseArmorClass();return console.log("🛡️ Using fallback AC:",o,"(from characterData.armorClass:",e.armorClass,")"),o}getConstitutionModifier(e){try{const t=this.getAbilityScores(e);return Math.floor((t.constitution-10)/2)}catch(error){return console.error("Error calculating Constitution modifier:",error),0}}generateACComponents(e){console.log("🛡️ Generating AC components for Fantasy Grounds");const t=e.classes?.some(e=>"barbarian"===e.definition?.name?.toLowerCase()),r=e.classes?.some(e=>"monk"===e.definition?.name?.toLowerCase()),a=this.getAbilityScores(e),o=Math.floor((a.dexterity-10)/2);if(t){const e=Math.floor((a.constitution-10)/2),t=10+o+e;return console.log(`🛡️ Barbarian Unarmored Defense: 10 + DEX ${o} + CON ${e} = ${t}`),console.log("🛡️ Using Fantasy Grounds format: armor=0, stat2=constitution, total="+t),`\n        <armor type="number">0</armor>\n        <disstealth type="number">0</disstealth>\n        <misc type="number">0</misc>\n        <prof type="number">0</prof>\n        <shield type="number">0</shield>\n        <stat2 type="string">constitution</stat2>\n        <temporary type="number">0</temporary>\n        <total type="number">${t}</total>`}if(r){const e=Math.floor((a.wisdom-10)/2),t=10+o+e;return console.log(`🛡️ Monk AC Components: Base 10 + DEX ${o} + WIS ${e} = ${t}`),`\n        <armor type="number">10</armor>\n        <misc type="number">${e}</misc>\n        <prof type="number">0</prof>\n        <shield type="number">0</shield>\n        <stat type="number">${o}</stat>\n        <stat2 type="string">dexterity</stat2>\n        <temporary type="number">0</temporary>\n        <total type="number">${t}</total>`}const n=e.armorClass||ma.getBaseArmorClass();return console.log("🛡️ Standard AC Components, total:",n),`\n        <armor type="number">${Math.max(0,n-o)}</armor>\n        <misc type="number">0</misc>\n        <prof type="number">0</prof>\n        <shield type="number">0</shield>\n        <stat type="number">${o}</stat>\n        <stat2 type="string">dexterity</stat2>\n        <temporary type="number">0</temporary>\n        <total type="number">${n}</total>`}}const Xa=new Ba,Ua=Object.freeze(Object.defineProperty({__proto__:null,CharacterConverterFacade:Ba,characterConverterFacade:Xa},Symbol.toStringTag,{value:"Module"}));Yr.store("conversionResults",{result:null,filename:"",characterName:"",convertedAt:null,get hasResult(){return null!==this.result&&this.result.trim().length>0},get resultSize(){if(!this.result)return"0 KB";const e=new Blob([this.result]).size;return Math.round(e/1024*100)/100+" KB"},setResult(e,t="Unknown Character",r){this.result=e,this.characterName=t,this.convertedAt=new Date;const a=t.replace(/[^a-zA-Z0-9_-]/g,"_");this.filename=r?`${a}_${r}.xml`:`${a}_character.xml`,console.log("Conversion result set:",{characterName:t,characterId:r,filename:this.filename,size:this.resultSize})},clearResult(){this.result=null,this.filename="",this.characterName="",this.convertedAt=null,console.log("Conversion result cleared")},downloadXML(){if(!this.hasResult)return console.warn("No conversion result to download"),!1;try{const e=new Blob([this.result],{type:"application/xml"}),t=URL.createObjectURL(e),r=document.createElement("a");return r.href=t,r.download=this.filename||"character.xml",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t),console.log("XML file downloaded:",this.filename),!0}catch(error){return console.error("Failed to download XML:",error),!1}}}),Yr.store("notifications",{items:[],get hasNotifications(){return this.items.length>0},add(e,t,r=!0){const a={id:Math.random().toString(36).substr(2,9),message:e,type:t,timestamp:new Date,autoDismiss:r};if(this.items.push(a),console.log("Notification added:",a),r){const e="error"===t?0:"warning"===t?8e3:5e3;e>0&&setTimeout(()=>{this.remove(a.id)},e)}return a},addSuccess(e,t=!0){return this.add(e,"success",t)},addError(e,t=!1){return this.add(e,"error",t)},addWarning(e,t=!0){return this.add(e,"warning",t)},addInfo(e,t=!0){return this.add(e,"info",t)},remove(e){const t=this.items.findIndex(t=>t.id===e);-1!==t&&(this.items.splice(t,1),console.log("Notification removed:",e))},clear(){this.items=[],console.log("All notifications cleared")}}),Yr.data("characterConverter",()=>({characterId:"",fgVersion:"unity",isConverting:!1,progress:0,currentStep:"",isValidId:!0,showCharacterPreview:Kr.isEnabled("character_preview"),showPerformanceMetrics:Kr.isEnabled("performance_metrics"),enableBulkConversion:Kr.isEnabled("bulk_conversion"),init(){window.addEventListener("featureFlagsChanged",()=>{this.updateFeatureFlags()}),window.addEventListener("characterDataLoaded",e=>{if(e.detail&&e.detail.characterData&&e.detail.xml){console.log("📁 Character loaded from file, updating converter state"),this.characterId=`file_${e.detail.characterData.id||Date.now()}`,this.isValidId=!0,this.isConverting=!1,this.progress=100,this.currentStep="File conversion complete!";const t=Yr.store("conversionResults"),r=e.detail.characterData.id||"unknown";t.setResult(e.detail.xml,e.detail.characterName||e.detail.characterData.name,r),console.log("📁 Basic converter state updated after file upload:",{characterId:this.characterId,hasResult:t.hasResult})}})},validateCharacterId(){const e=this.characterId.trim();if(!e)return void(this.isValidId=!0);const t=e.match(/(?:dndbeyond\.com\/characters\/|\/characters\/)(\d+)/i);if(t&&t[1])return this.characterId=t[1],void(this.isValidId=!0);this.isValidId=/^\d+$/.test(e),this.isValidId||Yr.store("notifications").addError("Please enter a valid character ID or D&D Beyond character URL")},async convertCharacter(){if(this.characterId.trim()){if(this.validateCharacterId(),this.isValidId){Yr.store("conversionResults").clearResult(),this.isConverting=!0,this.progress=0,this.currentStep="Initializing...";try{this.currentStep="Validating character ID...",this.progress=10,await this.delay(200);const e=this.characterId.trim();console.log("Converting character:",e);const t=window.featureFlags?.isEnabled("debug_character_data");t&&console.log("🔍 Debug mode enabled - detailed character data will be logged");const r=window.characterConverterFacade;if(!r)throw new Error("CharacterConverterFacade not available");r.onProgress=(e,t)=>{this.currentStep=e,this.progress=t};const a=await r.convertFromDNDBeyond(e);if(!a.success)throw new Error(a.error||"Conversion failed");this.currentStep="Complete!",this.progress=100;const o=a.characterData?.name||"Unknown Character",n=a.characterData?.id||this.characterId;Yr.store("conversionResults").setResult(a.xml,o,n);const i=new CustomEvent("characterDataLoaded",{detail:{characterData:a.characterData,xml:a.xml,characterName:o}});document.dispatchEvent(i);const s=Yr.store("notifications"),l=window.featureFlags?.isEnabled("debug_character_data");this.validateWarlockPactMagic(a,s);const c=l?`Character "${o}" converted successfully! Check console for detailed data.`:`Character "${o}" converted successfully!`;s.addSuccess(c)}catch(error){console.error("Conversion error:",error);const t=error instanceof Error?error.message:"Unknown error occurred";Yr.store("notifications").addError(`Conversion failed: ${t}`),this.currentStep="Error occurred",this.progress=0}finally{this.isConverting=!1}}}else Yr.store("notifications").addError("Please enter a character ID")},resetForm(){this.characterId="",this.fgVersion="unity",this.isConverting=!1,this.progress=0,this.currentStep="",this.isValidId=!0,Yr.store("conversionResults").clearResult(),Yr.store("notifications").clear(),console.log("Character converter form reset")},downloadResult(){const e=Yr.store("conversionResults").downloadXML(),t=Yr.store("notifications");e?t.addSuccess("XML file downloaded successfully!"):t.addError("Failed to download XML file")},updateFeatureFlags(){this.showCharacterPreview=Kr.isEnabled("character_preview"),this.showPerformanceMetrics=Kr.isEnabled("performance_metrics"),this.enableBulkConversion=Kr.isEnabled("bulk_conversion")},delay:e=>new Promise(t=>setTimeout(t,e)),validateWarlockPactMagic(e,t){if(!e.success||!e.characterData||!e.xml)return;const r=(e.characterData.classes||[]).find(e=>"warlock"===e.definition?.name?.toLowerCase());if(!r)return;const a=r.level,o=e.characterData.name||"Unknown",n=e.xml;let i={};a>=17?i={level5:4}:a>=15?i={level5:3}:a>=11||a>=9?i={level5:2}:a>=7?i={level4:2}:a>=5?i={level3:2}:a>=3?i={level2:2}:a>=2?i={level1:2}:a>=1&&(i={level1:1});const s=[...n.matchAll(/<pactmagicslots(\d+)><max type="number">(\d+)<\/max>/g)];let l=[],c=!1;if(s.length>0)if(s.forEach(e=>{const t=e[1],r=e[2];if("0"!==r){l.push(`L${t}: ${r}`);const e=`level${t}`;i[e]&&parseInt(r)===i[e]&&(c=!0)}}),c)t.addInfo(`🎭 Warlock validated: Level ${a} ${o} correctly has pact magic slots (${l.join(", ")})`);else{const e=Object.entries(i).map(([e,t])=>`L${e.replace("level","")}: ${t}`).join(", ");t.addWarning(`⚠️ Warlock issue: Level ${a} ${o} has unexpected pact magic slots. Found: ${l.join(", ")}, Expected: ${e}`)}else{const e=/<spellslots(\d+)><max type="number">(\d+)<\/max>/g,r=[...n.matchAll(e)].filter(e=>"0"!==e[2]).map(e=>`L${e[1]}: ${e[2]}`);r.length>0?t.addError(`❌ Warlock error: Level ${a} ${o} has regular spell slots instead of pact magic (${r.join(", ")})`):t.addError(`❌ Warlock error: Level ${a} ${o} has no spell slots generated`)}},showFormatSelector(){window.dispatchEvent(new CustomEvent("showFormatSelector"))}})),Yr.data("enhancedCharacterConverter",()=>({characterId:"",fgVersion:"unity",isConverting:!1,progress:0,currentStep:"",characterData:null,isValidId:!0,showCharacterPreview:Kr.isEnabled("character_preview"),showPerformanceMetrics:Kr.isEnabled("performance_metrics"),enableBulkConversion:Kr.isEnabled("bulk_conversion"),enableMultiFormat:Kr.isEnabled("multi_format_export"),showFormatSelection:!1,formatSelectionAnalyzed:!1,init(){window.addEventListener("featureFlagsChanged",()=>{this.updateFeatureFlags()}),window.addEventListener("characterDataLoaded",e=>{if(e.detail&&e.detail.characterData&&(console.log("🎯 Enhanced converter: Character data loaded"),this.onCharacterDataLoaded(e.detail.characterData),e.detail.xml)){this.characterId=`file_${e.detail.characterData.id||Date.now()}`,this.isValidId=!0,this.isConverting=!1,this.progress=100,this.currentStep="File conversion complete!",this.characterData=e.detail.characterData;const t=Yr.store("conversionResults"),r=e.detail.characterData.id||"unknown";t.setResult(e.detail.xml,e.detail.characterName||e.detail.characterData.name,r),this.enableMultiFormat&&setTimeout(()=>{this.triggerFormatAnalysis()},100),console.log("📁 Enhanced converter state updated after file upload:",{characterId:this.characterId,hasCharacterData:!!this.characterData,hasResult:t.hasResult,enableMultiFormat:this.enableMultiFormat})}}),console.log("🎯 Enhanced Character Converter initialized"),console.log("Multi-format support:",this.enableMultiFormat?"enabled":"disabled")},validateCharacterId(){const e=this.characterId.trim();if(!e)return void(this.isValidId=!0);const t=e.match(/(?:dndbeyond\.com\/characters\/|\/characters\/)(\d+)/i);if(t&&t[1])return this.characterId=t[1],void(this.isValidId=!0);this.isValidId=/^\d+$/.test(e)||/^file_/.test(e),this.isValidId||Yr.store("notifications").addError("Please enter a valid character ID or D&D Beyond character URL")},async convertCharacter(){if(!this.characterId.trim())return void Yr.store("notifications").addError("Please enter a character ID");if(this.validateCharacterId(),!this.isValidId)return;const e=this.characterId.trim();if(e.startsWith("file_"))return void Yr.store("notifications").addInfo("Character from file is already converted! Use the download button or choose export formats.");const t=Yr.store("conversionResults");t.clearResult(),this.isConverting=!0,this.progress=0,this.currentStep="Initializing...";try{this.currentStep="Validating character ID...",this.progress=10,await this.delay(200),console.log("Converting character:",e);const r=window.featureFlags?.isEnabled("debug_character_data");r&&console.log("🔍 Debug mode enabled - detailed character data will be logged");const a=window.characterConverterFacade;if(!a)throw new Error("CharacterConverterFacade not available");a.onProgress=(e,t)=>{this.currentStep=e,this.progress=t};const o=await a.convertFromDNDBeyond(e);if(!o.success)throw new Error(o.error||"Conversion failed");this.characterData=o.characterData,this.onCharacterDataLoaded(o.characterData),this.currentStep="Complete!",this.progress=100;const n=o.characterData?.name||"Unknown Character",i=o.characterData?.id||this.characterId;t.setResult(o.xml,n,i);const s=Yr.store("notifications"),l=window.featureFlags?.isEnabled("debug_character_data");this.validateWarlockPactMagic(o,s);const c=l?`Character "${n}" converted successfully! Check console for detailed data.`:`Character "${n}" converted successfully!`;s.addSuccess(c),this.enableMultiFormat&&await this.triggerFormatAnalysis()}catch(error){console.error("Conversion error:",error);const t=error instanceof Error?error.message:"Unknown error occurred";Yr.store("notifications").addError(`Conversion failed: ${t}`),this.currentStep="Error occurred",this.progress=0}finally{this.isConverting=!1}},async triggerFormatAnalysis(){if(this.characterData&&this.enableMultiFormat)try{console.log("🔍 Triggering format compatibility analysis...");const e=new CustomEvent("characterDataLoaded",{detail:{characterData:this.characterData}});window.dispatchEvent(e),await this.delay(500),this.formatSelectionAnalyzed=!0,Yr.store("notifications").addInfo("Format compatibility analysis complete. You can now export to multiple formats.")}catch(error){console.error("Format analysis failed:",error)}},showFormatSelector(){this.enableMultiFormat?this.characterData?(window.dispatchEvent(new CustomEvent("showFormatSelector")),window.dispatchEvent(new CustomEvent("characterDataLoaded",{detail:{characterData:this.characterData}})),console.log("📋 Simple format selector triggered with character data:",this.characterData?.name)):Yr.store("notifications").addError("Please convert a character first before selecting export formats."):Yr.store("notifications").addInfo("Multi-format export is not enabled. Please enable the feature flag to access format selection.")},hideFormatSelector(){this.showFormatSelection=!1,console.log("📋 Format selector closed")},onCharacterDataLoaded(e){console.log("📊 Character data loaded for format analysis:",{name:e.name,level:this.calculateTotalLevel(e),classes:e.classes?.length||0,race:e.race?.fullName})},resetForm(){this.characterId="",this.fgVersion="unity",this.isConverting=!1,this.progress=0,this.currentStep="",this.isValidId=!0,this.characterData=null,this.showFormatSelection=!1,this.formatSelectionAnalyzed=!1,Yr.store("conversionResults").clearResult(),Yr.store("notifications").clear();const e=document.querySelector('[x-data*="formatSelector"]');e&&e.formatSelector&&e.formatSelector.reset(),console.log("🔄 Enhanced character converter form reset")},downloadResult(){const e=Yr.store("conversionResults").downloadXML(),t=Yr.store("notifications");e?t.addSuccess("Fantasy Grounds XML file downloaded successfully!"):t.addError("Failed to download Fantasy Grounds XML file")},updateFeatureFlags(){this.showCharacterPreview=Kr.isEnabled("character_preview"),this.showPerformanceMetrics=Kr.isEnabled("performance_metrics"),this.enableBulkConversion=Kr.isEnabled("bulk_conversion"),this.enableMultiFormat=Kr.isEnabled("multi_format_export"),console.log("🎛️ Feature flags updated:",{characterPreview:this.showCharacterPreview,performanceMetrics:this.showPerformanceMetrics,bulkConversion:this.enableBulkConversion,multiFormat:this.enableMultiFormat})},delay:e=>new Promise(t=>setTimeout(t,e)),calculateTotalLevel:e=>(e.classes||[]).reduce((e,t)=>e+(t.level||0),0),validateWarlockPactMagic(e,t){if(!e.success||!e.characterData||!e.xml)return;const r=(e.characterData.classes||[]).find(e=>"warlock"===e.definition?.name?.toLowerCase());if(!r)return;const a=r.level,o=e.characterData.name||"Unknown",n=e.xml;let i={};a>=17?i={level5:4}:a>=15?i={level5:3}:a>=11||a>=9?i={level5:2}:a>=7?i={level4:2}:a>=5?i={level3:2}:a>=3?i={level2:2}:a>=2?i={level1:2}:a>=1&&(i={level1:1});const s=[...n.matchAll(/<pactmagicslots(\d+)><max type="number">(\d+)<\/max>/g)];let l=[],c=!1;if(s.length>0)if(s.forEach(e=>{const t=e[1],r=e[2];if("0"!==r){l.push(`L${t}: ${r}`);const e=`level${t}`;i[e]&&parseInt(r)===i[e]&&(c=!0)}}),c)t.addInfo(`🎭 Warlock validated: Level ${a} ${o} correctly has pact magic slots (${l.join(", ")})`);else{const e=Object.entries(i).map(([e,t])=>`L${e.replace("level","")}: ${t}`).join(", ");t.addWarning(`⚠️ Warlock issue: Level ${a} ${o} has unexpected pact magic slots. Found: ${l.join(", ")}, Expected: ${e}`)}else{const e=/<spellslots(\d+)><max type="number">(\d+)<\/max>/g,r=[...n.matchAll(e)].filter(e=>"0"!==e[2]).map(e=>`L${e[1]}: ${e[2]}`);r.length>0?t.addError(`❌ Warlock error: Level ${a} ${o} has regular spell slots instead of pact magic (${r.join(", ")})`):t.addError(`❌ Warlock error: Level ${a} ${o} has no spell slots generated`)}}})),Yr.data("modernizationStatus",()=>({showStatus:!1,features:[{name:"Build System",status:"completed",description:"TypeScript + Vite + Tailwind CSS"},{name:"Feature Flags",status:"completed",description:"Runtime feature toggles with admin panel"},{name:"Alpine.js Framework",status:"completed",description:"Modern reactive UI components"},{name:"Character Converter",status:"in_progress",description:"Modern replacement for legacy converter"},{name:"Dependency Injection",status:"completed",description:"Decoupled service architecture with IoC container"},{name:"Character Parser",status:"completed",description:"Modernized parsing with services and level scaling"},{name:"Error Handling",status:"completed",description:"Comprehensive error management and validation"},{name:"Performance Metrics",status:"completed",description:"Conversion performance tracking and optimization"}],getOverallProgress(){const e=this.features.filter(e=>"completed"===e.status).length+.5*this.features.filter(e=>"in_progress"===e.status).length;return Math.round(e/this.features.length*100)},getStatusColor(e){switch(e){case"completed":return"text-green-400";case"in_progress":return"text-yellow-400";case"pending":return"text-red-400";default:return"text-gray-400"}},getStatusIcon(e){switch(e){case"completed":return"fas fa-check";case"in_progress":return"fas fa-clock";case"pending":return"fas fa-times";default:return"fas fa-question"}}})),document.addEventListener("keydown",e=>{if(e.ctrlKey&&e.shiftKey&&"M"===e.key){e.preventDefault();const t=document.querySelector('[x-data*="modernizationStatus"]');if(t){const e=Yr.$data(t);e.showStatus=!e.showStatus}}}),Yr.data("featureFlagAdmin",()=>({flags:{},overrides:{},showAdmin:!1,init(){this.refreshFlags(),document.addEventListener("keydown",e=>{e.ctrlKey&&e.shiftKey&&"F"===e.key&&(e.preventDefault(),this.showAdmin=!this.showAdmin)})},toggleFlag(e){const t=this.getFlagStatus(e);"overridden"===t?Kr.clearOverride(e):"enabled"===t?Kr.disable(e):Kr.enable(e),this.refreshFlags(),window.dispatchEvent(new CustomEvent("featureFlagsChanged",{detail:{flagKey:e,newStatus:this.getFlagStatus(e)}}))},clearOverride(e){Kr.clearOverride(e),this.refreshFlags(),window.dispatchEvent(new CustomEvent("featureFlagsChanged",{detail:{flagKey:e,newStatus:this.getFlagStatus(e)}}))},clearAllOverrides(){Kr.clearAllOverrides(),this.refreshFlags(),window.dispatchEvent(new CustomEvent("featureFlagsChanged",{detail:{action:"clearAll"}}))},refreshFlags(){this.flags=Kr.getAllFlags(),this.overrides=Kr.getOverrides()},getFlagStatus(e){return this.overrides.hasOwnProperty(e)?"overridden":Kr.isEnabled(e)?"enabled":"disabled"},getFlagDisplayClass(e){const t="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium";switch(this.getFlagStatus(e)){case"enabled":return`${t} bg-green-800 text-green-200`;case"disabled":return`${t} bg-red-800 text-red-200`;case"overridden":return`${t} bg-yellow-800 text-yellow-200`;default:return`${t} bg-gray-800 text-gray-200`}}})),Yr.data("simpleCharacterDisclosure",()=>({sections:[{id:"basic-info",title:"Basic Information",icon:"👤",expanded:!0,description:"Name, race, class, and level"},{id:"stats",title:"Ability Scores",icon:"📊",expanded:!1,description:"STR, DEX, CON, INT, WIS, CHA scores and modifiers"},{id:"skills",title:"Skills & Proficiencies",icon:"🎯",expanded:!1,description:"Skill bonuses and proficiency status"},{id:"features",title:"Features & Traits",icon:"⭐",expanded:!1,description:"Class features, racial traits, and special abilities"},{id:"equipment",title:"Equipment & Inventory",icon:"🎒",expanded:!1,description:"Weapons, armor, and carried items"},{id:"spells",title:"Spells & Magic",icon:"✨",expanded:!1,description:"Known spells and spell slots"}],init(){console.log("📋 Simple Character Disclosure initialized"),window.addEventListener("characterDataLoaded",e=>{e.detail?.characterData&&this.updateSectionsWithCharacterData(e.detail.characterData)})},toggleSection(e){const t=this.sections.find(t=>t.id===e);t&&(t.expanded=!t.expanded,console.log(`📂 Section ${t.expanded?"expanded":"collapsed"}: ${e}`))},updateSectionsWithCharacterData(e){const t=this.sections.map(t=>{switch(t.id){case"basic-info":return{...t,badge:e.name?"✓":"?",description:e.name?`${e.name} - Level ${this.calculateTotalLevel(e)}`:"Character basic information"};case"stats":return{...t,badge:e.stats?"6":"0",description:"Ability scores and modifiers"};case"skills":return{...t,badge:e.skills?Object.keys(e.skills).length.toString():"0",description:"Skills and proficiency bonuses"};case"features":return{...t,badge:e.features?e.features.length.toString():"0",description:"Class features and racial traits"};case"equipment":return{...t,badge:e.inventory?e.inventory.length.toString():"0",description:"Equipment and inventory items"};case"spells":const r=e.spells&&e.spells.length>0;return{...t,badge:r?e.spells.length.toString():"0",description:r?"Known spells and casting":"No spells available"};default:return t}});this.sections=t,console.log("📊 Character sections updated with data")},calculateTotalLevel:e=>e.classes&&Array.isArray(e.classes)?e.classes.reduce((e,t)=>e+(t.level||0),0):1,createCharacterSections:e=>[{id:"basic-info",title:"Basic Information",icon:"👤",expanded:!0,description:"Name, race, class, and level"},{id:"stats",title:"Ability Scores",icon:"📊",expanded:!1,description:"STR, DEX, CON, INT, WIS, CHA scores and modifiers"},{id:"skills",title:"Skills & Proficiencies",icon:"🎯",expanded:!1,description:"Skill bonuses and proficiency status"},{id:"features",title:"Features & Traits",icon:"⭐",expanded:!1,description:"Class features, racial traits, and special abilities"},{id:"equipment",title:"Equipment & Inventory",icon:"🎒",expanded:!1,description:"Weapons, armor, and carried items"},{id:"spells",title:"Spells & Magic",icon:"✨",expanded:!1,description:"Known spells and spell slots"}].map(t=>"basic-info"===t.id?{...t,badge:e.name?"✓":"?",expanded:!0}:t)})),console.log("📋 Simple Character Disclosure component registered"),Yr.data("simpleCharacterPreview",()=>({characterData:null,xmlData:null,validationStatus:{isValid:!1,completeness:0,issues:[],warnings:[]},showValidation:!0,init(){console.log("🔍 Simple Character Preview initialized"),window.addEventListener("characterDataLoaded",e=>{e.detail?.characterData&&(this.updateCharacterData(e.detail.characterData),this.xmlData=e.detail.xml||null)})},updateCharacterData(e){if(this.characterData=e,this.validationStatus=this.validateCharacter(e),!this.xmlData&&window.Alpine){const e=window.Alpine.store("conversionResults");e?.xmlContent&&(this.xmlData=e.xmlContent,console.log("📄 XML data retrieved from store:",this.xmlData.length+" characters"))}console.log("📊 Character preview updated:",{name:e.name,completeness:this.validationStatus.completeness+"%",valid:this.validationStatus.isValid,hasXml:!!this.xmlData}),console.log("🔍 Ability Score Data Structure:",{stats:e.stats,bonusStats:e.bonusStats,overrideStats:e.overrideStats,strStat:e.stats?.[0],strBonus:e.bonusStats?.[0],strOverride:e.overrideStats?.[0]}),console.log("🎯 Using XML data source values:",{hp:this.getCalculatedHP(),ac:this.getCalculatedAC(),classes:this.getFormattedClasses()});try{const t=xa.processAbilityScoreBonuses(e);console.log("🎯 AbilityScoreProcessor Results (XML source):",t),console.log("🎯 Strength from processor:",t.totalScores.strength?.total)}catch(t){console.log("Error with AbilityScoreProcessor:",t)}},validateCharacter:e=>e?function(e){const t=[],r=[];let a=0;e.name?a++:t.push("Character name is missing"),e.race?.fullName?a++:t.push("Character race is missing"),e.classes&&e.classes.length>0?a++:t.push("Character class is missing"),e.stats&&Object.keys(e.stats).length>=6?a++:t.push("Ability scores are incomplete"),e.hitPointsMax>0?a++:r.push("Hit points may be incorrect"),e.proficiencyBonus>0?a++:r.push("Proficiency bonus may be missing"),e.armorClass>0?a++:r.push("Armor class calculation may be missing"),e.savingThrows?a++:r.push("Saving throw information may be incomplete"),e.skills&&Object.keys(e.skills).length>0?a++:r.push("Skill information may be incomplete"),e.inventory&&e.inventory.length>0?a++:r.push("Equipment information may be incomplete");const o=Math.round(a/10*100);return{isValid:0===t.length&&o>=70,completeness:o,issues:t,warnings:r}}(e):{isValid:!1,completeness:0,issues:["No character data available"],warnings:[]},getCompletenessColor:e=>e>=90?"text-green-500":e>=70?"text-yellow-500":e>=50?"text-orange-500":"text-red-500",getValidationIcon:e=>e?"✅":"⚠️",formatCharacterLevel:e=>e&&e.classes&&Array.isArray(e.classes)?`Level ${e.classes.reduce((e,t)=>e+(t.level||0),0)}`:"Level 1",formatCharacterRace(e){if(!e||!e.race)return"Unknown Race";const t=e.race.fullName||e.race.baseName||"Unknown";return e.race.subRaceName&&e.race.subRaceName!==e.race.baseName?`${e.race.subRaceName} ${e.race.baseName}`:t},formatCharacterClasses(e){if(!e||!e.classes||!Array.isArray(e.classes))return"No Class";if(1===e.classes.length){const t=e.classes[0],r=t.definition?.name||"Unknown Class",a=t.subclassDefinition?.name;return a?`${r} (${a})`:r}return e.classes.map(e=>`${e.definition?.name||"Unknown"} ${e.level}`).join(" / ")},extractXmlStat(e,t){if(!e)return"0";const r=new RegExp(`<${t}><score type="number">(\\d+)</score>`,"i"),a=e.match(r);return a?a[1]:"0"},extractXmlValue(e,t,r){if(!e)return"0";const a=new RegExp(`<${t}><${r} type="number">(\\d+)</${r}>`,"i"),o=e.match(a);return o?o[1]:"0"},getCalculatedStat(e,t){if(!e||!this.characterData)return 0;try{const e=xa.processAbilityScoreBonuses(this.characterData),r=["strength","dexterity","constitution","intelligence","wisdom","charisma"][t];if(r&&e.totalScores[r])return e.totalScores[r].total}catch(error){console.error("Error using AbilityScoreProcessor:",error)}const r=e.value||10,a=this.characterData.bonusStats?.find(t=>t.id===e.id);return r+(a?.value||0)},getCalculatedHP(){if(!this.characterData)return 0;const e=this.characterData.baseHitPoints||0,t=this.calculateTotalLevel();return e+this.getConstitutionModifier()*t},calculateTotalLevel(){return this.characterData?.classes&&Array.isArray(this.characterData.classes)&&this.characterData.classes.reduce((e,t)=>e+(t.level||0),0)||1},getConstitutionModifier(){if(!this.characterData)return 0;try{const e=xa.processAbilityScoreBonuses(this.characterData),t=e.totalScores.constitution?.total||10;return Math.floor((t-10)/2)}catch(error){return console.error("Error calculating Constitution modifier:",error),0}},getCalculatedAC(){if(!this.characterData)return 10;const e=this.characterData.classes?.some(e=>"barbarian"===e.definition?.name?.toLowerCase());if(e)try{const e=xa.processAbilityScoreBonuses(this.characterData),t=Math.floor((e.totalScores.dexterity?.total-10)/2)||0;return 10+t+(Math.floor((e.totalScores.constitution?.total-10)/2)||0)}catch(error){console.error("Error calculating Unarmored Defense AC:",error)}return this.characterData.armorClass||10},getCalculatedSpeed(){if(!this.characterData)return 30;const e=this.characterData.race?.weightSpeeds?.normal?.walk||30;let t=0;return this.characterData.modifiers?.bonus&&this.characterData.modifiers.bonus.forEach(e=>{"speed"===e.subType&&e.value&&(t+=e.value)}),e+t},getCalculatedProficiencyBonus(){return this.characterData&&this.characterData.proficiencyBonus||2},getFormattedClasses(){return this.formatCharacterClasses(this.characterData)}})),console.log("🔍 Simple Character Preview component registered");const Wa=function(e,t,r){let a=Promise.resolve();function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)})};function qa(){const e=ja.getSupportedFormats().map(e=>{let t="good",r="Standard compatibility";return"foundry-vtt-json"===e.format?(t="good",r="Most features supported, some manual setup may be required"):(t="good",r="Compatible with standard character features"),{id:e.format,name:e.name,description:e.description,icon:e.icon,compatibility:t,available:!0,message:r,formatInfo:e}});return e.unshift({id:"fantasy-grounds-xml",name:"Fantasy Grounds",description:"Unity & Classic compatible XML format (primary)",icon:"🏰",compatibility:"excellent",available:!0,message:"Fully supported with complete feature set - our primary output format"}),e}Yr.data("simpleFormatSelector",()=>({characterData:null,availableFormats:qa(),selectedFormats:["fantasy-grounds-xml"],isAnalyzing:!1,showFormatModal:!1,conversionResults:{},init(){console.log("📋 Simple Format Selector initialized"),window.addEventListener("characterDataLoaded",e=>{e.detail?.characterData&&this.analyzeFormats(e.detail.characterData)}),window.addEventListener("showFormatSelector",()=>{this.showFormatModal=!0})},analyzeFormats(e){console.log("📊 analyzeFormats called with character data:",e?.name,e?.id),console.log("📊 Character data keys:",Object.keys(e||{})),this.characterData=e,this.isAnalyzing=!0,setTimeout(()=>{this.availableFormats=function(e,t){return e?t.map(t=>{let r=t.compatibility,a=t.message,o=t.available;if(t.formatInfo)try{const o={characterData:e,abilities:e.stats||{},totalLevel:e.classes?.reduce((e,t)=>e+(t.level||0),0)||1},n=ja.getFormatCompatibility(o).get(t.id);n&&(r=n.recommendation,n.warnings.length>0&&(a=n.warnings[0]))}catch(error){console.warn(`Failed to analyze compatibility for ${t.id}:`,error)}if(!t.formatInfo||r===t.compatibility){const o=e.classes?.reduce((e,t)=>e+(t.level||0),0)||1,n=e.spells&&e.spells.length>0,i=e.classes&&e.classes.length>1;switch(t.id){case"fantasy-grounds-xml":break;case"foundry-vtt-json":n&&o>10?(r="good",a="High-level spellcaster - may need manual spell setup"):i&&(r="good",a="Multiclass character - verify class features")}}return{...t,compatibility:r,available:o,message:a}}):t}(e,qa()),this.isAnalyzing=!1,console.log("📊 Format compatibility analysis complete:",{character:e.name,formats:this.availableFormats.length,availableFormatIds:this.availableFormats.map(e=>e.id)}),console.log("📊 Character data stored:",!!this.characterData)},300)},toggleFormat(e){const t=this.selectedFormats.indexOf(e);-1===t?this.selectedFormats.push(e):this.selectedFormats.splice(t,1),console.log("📋 Format selection updated:",this.selectedFormats)},selectRecommendedFormats(){this.selectedFormats=this.availableFormats.filter(e=>"excellent"===e.compatibility||"good"===e.compatibility).map(e=>e.id),console.log("✨ Recommended formats selected:",this.selectedFormats)},clearSelection(){this.selectedFormats=[],console.log("🗑️ Format selection cleared")},async convertToSelectedFormats(){if(0===this.selectedFormats.length)return void console.warn("No formats selected for conversion");if(!this.characterData)return console.error("❌ No character data available for conversion"),void Yr.store("notifications").addError("No character data available for conversion");const e=Yr.store("notifications");try{console.log("🔄 Converting to selected formats:",this.selectedFormats),console.log("📊 Character data available:",!!this.characterData),console.log("📊 Character data preview:",this.characterData?.name,this.characterData?.id),console.log("📦 Importing CharacterConverterFacade...");const{CharacterConverterFacade:a}=await Wa(async()=>{const{CharacterConverterFacade:e}=await Promise.resolve().then(()=>Ua);return{CharacterConverterFacade:e}},0,t.meta.url);console.log("✅ CharacterConverterFacade imported"),console.log("🏭 Creating converter instance...");const o=new a;console.log("✅ Converter created");const n=this.selectedFormats.filter(e=>"fantasy-grounds-xml"!==e),i=this.selectedFormats.includes("fantasy-grounds-xml");if(console.log("📋 Registry formats to process:",n),console.log("🏰 Include Fantasy Grounds:",i),n.length>0){console.log("🔄 Starting multi-format conversion for:",n);try{const t=await o.generateMultiFormatOutput(this.characterData,n);console.log("📊 Multi-format conversion completed, results:",t.size);for(const[r,a]of t)if(console.log(`📄 Processing result for ${r}:`,a.success),a.success&&a.output){const e=this.availableFormats.find(e=>e.id===r);e?(this.conversionResults[r]={data:a.output,filename:a.filename||`${this.getCharacterFilename()}.${this.getFormatExtension(r)}`,format:e},console.log(`✅ Successfully stored result for ${r}`)):console.warn(`⚠️ Format definition not found for ${r}`)}else console.error(`❌ Failed to convert to ${r}:`,a.errors),e.addError(`Failed to convert to ${r}`)}catch(r){throw console.error("💥 Multi-format conversion threw error:",r),r}}if(i){const e=this.availableFormats.find(e=>"fantasy-grounds-xml"===e.id);e&&await this.simulateConversion("fantasy-grounds-xml",e)}e.addSuccess(`Successfully converted to ${this.selectedFormats.length} format(s)!`)}catch(error){console.error("Conversion error:",error),e.addError("Failed to convert to selected formats")}},async simulateConversion(e,t){if("fantasy-grounds-xml"!==e)return void console.warn("simulateConversion should only be used for Fantasy Grounds XML");await new Promise(e=>setTimeout(e,500));const r=Yr.store("conversionResults"),a=r.result||"<character>No data</character>",o=r.filename||`${this.getCharacterFilename()}.xml`;this.conversionResults[e]={data:a,filename:o,format:t},console.log(`✅ ${t.name} conversion complete`)},downloadFormat(e){const t=this.conversionResults[e];if(t)try{const r=e.includes("json")?"application/json":"application/xml",a=new Blob([t.data],{type:r}),o=URL.createObjectURL(a),n=document.createElement("a");n.href=o,n.download=t.filename,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o),console.log("📥 Downloaded:",t.filename),Yr.store("notifications").addSuccess(`Downloaded ${t.format.name} file: ${t.filename}`)}catch(error){console.error("Download failed:",error),Yr.store("notifications").addError(`Failed to download ${t.format.name} file`)}else console.warn("No conversion result found for format:",e)},closeModal(){this.showFormatModal=!1,console.log("📋 Format selector modal closed")},getCompatibilityColor(e){switch(e){case"excellent":return"text-green-600";case"good":return"text-blue-600";case"fair":return"text-yellow-600";case"poor":return"text-red-600";default:return"text-gray-600"}},getCompatibilityMessage(e){switch(e){case"excellent":return"Full compatibility";case"good":return"Very good compatibility";case"fair":return"Basic compatibility";case"poor":return"Limited compatibility";default:return"Unknown compatibility"}},getCharacterFilename(){return this.characterData?`${(this.characterData.name||"character").replace(/[^a-zA-Z0-9_-]/g,"_")}_${this.characterData.id||"unknown"}`:"character_unknown"},getFormatExtension(e){const t=this.availableFormats.find(t=>t.id===e);return t?.formatInfo?t.formatInfo.fileExtension.replace(".",""):"fantasy-grounds-xml"===e?"xml":"json"}})),console.log("📋 Simple Format Selector component registered");const Va=new class{constructor(){this.maxFileSize=5242880,this.allowedMimeTypes=["application/json","text/xml","application/xml"],this.maxProcessingTime=3e4,this.maxStringLength=1e4,this.maxArrayLength=1e3,this.maxObjectDepth=15}async processFile(e){try{const t=await this.validateFile(e);if(!t.valid)return{success:!1,errors:t.errors};const r=await this.readFileContentSecurely(e),a=await this.sanitizeContent(r,e.type),o=this.validateSecurity(a);if(!o.safe)return{success:!1,errors:[`Security validation failed: ${o.threats.join(", ")}`]};const n=await this.parseCharacterDataSecurely(a,e.type);return{success:!0,characterData:n,sourceType:this.determineSourceType(e,n),filename:this.sanitizeFilename(e.name)}}catch(error){return console.error("File processing error:",error),{success:!1,errors:[`Processing failed: ${this.sanitizeErrorMessage(error.message)}`]}}}async validateFile(e){const t=[];e.size>this.maxFileSize&&t.push(`File too large. Maximum size: ${this.maxFileSize/1024/1024}MB`),0===e.size&&t.push("File is empty"),this.allowedMimeTypes.includes(e.type)||t.push(`Unsupported file type: ${e.type||"unknown"}. Supported types: JSON, XML`);const r=this.getFileExtension(e.name);return[".json",".xml"].includes(r)||t.push(`Unsupported file extension: ${r}. Allowed: .json, .xml`),this.isValidFilename(e.name)||t.push("Invalid filename. Filenames cannot contain path traversal or special characters."),{valid:0===t.length,errors:t}}async readFileContentSecurely(e){return new Promise((t,r)=>{const a=new FileReader,o=setTimeout(()=>{a.abort(),r(new Error("File reading timeout"))},this.maxProcessingTime);a.onload=e=>{clearTimeout(o);const a=e.target?.result;a&&0!==a.length?t(a):r(new Error("File content is empty"))},a.onerror=()=>{clearTimeout(o),r(new Error("Failed to read file"))},a.readAsText(e,"utf-8")})}async sanitizeContent(e,t){let r=e.replace(/\0/g,"").replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"");return"application/json"===t?r=this.sanitizeJsonContent(r):t.includes("xml")&&(r=this.sanitizeXmlContent(r)),r}sanitizeJsonContent(e){return e.replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/javascript:/gi,"").replace(/data:text\/html/gi,"").replace(/vbscript:/gi,"")}sanitizeXmlContent(e){return e.replace(/<!DOCTYPE[^>]*>/gi,"").replace(/<\?.*?\?>/g,e=>e.includes("xml version")?e:"").replace(/<!ENTITY[^>]*>/gi,"").replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/javascript:/gi,"").replace(/vbscript:/gi,"")}validateSecurity(e){const t=[],r=[{pattern:/<script[^>]*>.*?<\/script>/gi,threat:"Script injection"},{pattern:/javascript:/gi,threat:"JavaScript URL"},{pattern:/vbscript:/gi,threat:"VBScript URL"},{pattern:/data:text\/html/gi,threat:"HTML data URL"},{pattern:/<!ENTITY/gi,threat:"XML entity declaration"},{pattern:/SYSTEM\s+['"]/gi,threat:"XML external entity"},{pattern:/%00/g,threat:"Null byte injection"}];for(const{pattern:a,threat:o}of r)a.test(e)&&t.push(o);return this.detectStructureBomb(e)&&t.push("Potential structure bomb (excessive nesting or size)"),{safe:0===t.length,threats:t}}detectStructureBomb(e){try{let t=0,r=0,a=0,o=0,n=!1;for(let i=0;i<e.length;i++){const s=e[i];if("{"===s||"["===s||"<"===s?(r++,"["===s&&(n=!0,o=0)):"}"===s||"]"===s||">"===s?(r--,"]"===s&&(a=Math.max(a,o),n=!1)):","===s&&n&&o++,t=Math.max(t,r),t>25||a>1e4)return!0}return!1}catch{return!0}}async parseCharacterDataSecurely(e,t){try{if("application/json"===t){const t=JSON.parse(e,this.jsonReviver.bind(this));return this.validateCharacterStructure(t)}if(t.includes("xml")){const t=(new DOMParser).parseFromString(e,"text/xml");if(t.querySelector("parsererror"))throw new Error("Invalid XML structure");return this.convertXmlToCharacterData(t)}throw new Error("Unsupported file type for parsing")}catch(error){throw new Error(`Failed to parse file: ${error.message}`)}}jsonReviver(e,t){if(!["__proto__","constructor","prototype"].includes(e))return"string"==typeof t?this.sanitizeStringValue(t):t}sanitizeStringValue(e){return e.length>this.maxStringLength&&(e=e.substring(0,this.maxStringLength)),e.replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/javascript:/gi,"").replace(/data:text\/html/gi,"").replace(/vbscript:/gi,"")}validateCharacterStructure(e){const t=this.validateDataStructure(e);if(!t.valid)throw new Error(`Invalid data structure: ${t.error}`);if(!e||"object"!=typeof e)throw new Error("Invalid character data structure");let r=e;e.success&&e.data&&"object"==typeof e.data&&(r=e.data,console.log("📦 Detected D&D Beyond API response wrapper, extracting character data"));const a=["id","name"];for(const o of a)if(!(o in r))throw new Error(`Missing required field: ${o}`);if("number"!=typeof r.id&&"string"!=typeof r.id)throw new Error("Invalid character ID format");if("string"!=typeof r.name||0===r.name.trim().length)throw new Error("Invalid character name");return r}validateDataStructure(e,t=0){if(t>this.maxObjectDepth)return{valid:!1,error:"Object structure too deep"};if(Array.isArray(e)){if(e.length>this.maxArrayLength)return{valid:!1,error:"Array too large"};for(const r of e){const e=this.validateDataStructure(r,t+1);if(!e.valid)return e}}else if("object"==typeof e&&null!==e){if(Object.keys(e).length>1e3)return{valid:!1,error:"Object has too many properties"};for(const[r,a]of Object.entries(e)){if(!this.isValidPropertyName(r))return{valid:!1,error:`Invalid property name: ${r}`};const e=this.validateDataStructure(a,t+1);if(!e.valid)return e}}else if("string"==typeof e&&e.length>this.maxStringLength)return{valid:!1,error:"String value too long"};return{valid:!0}}convertXmlToCharacterData(e){const t=e.querySelector("character");if(!t)throw new Error("Invalid Fantasy Grounds XML: missing character element");const r=t.querySelector("name")?.textContent?.trim()||"Unknown Character";return{id:Date.now(),name:r,sourceType:"fantasy-grounds-xml"}}determineSourceType(e,t){return e.type.includes("xml")?"fantasy-grounds-xml":t.classes&&t.stats&&t.race?"dndbeyond-json":"custom-json"}isValidPropertyName(e){return!["__proto__","constructor","prototype"].includes(e)&&(!(e.length>200)&&![/javascript:/i,/vbscript:/i,/data:/i,/<script/i,/eval\(/i,/function\(/i,/\0/,/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/].some(t=>t.test(e)))}isValidFilename(e){return!(e.includes("..")||e.includes("/")||e.includes("\\"))&&![/^(con|prn|aux|nul|com[1-9]|lpt[1-9])(\.|$)/i,/[<>:"|?*]/,/^\./,/^$/].some(t=>t.test(e))}sanitizeFilename(e){return e.replace(/[^a-zA-Z0-9._-]/g,"_").substring(0,100)}sanitizeErrorMessage(e){return e.replace(/[<>]/g,"").substring(0,200)}getFileExtension(e){const t=e.lastIndexOf(".");return-1===t?"":e.substring(t).toLowerCase()}};Yr.data("fileUploader",()=>({isDragging:!1,isProcessing:!1,uploadProgress:0,currentStep:"",selectedFile:null,fileName:"",fileSize:"",fileType:"",processResult:null,showValidationDetails:!1,init(){console.log("📁 File Uploader component initialized"),document.addEventListener("dragover",e=>e.preventDefault()),document.addEventListener("drop",e=>e.preventDefault())},handleDragOver(e){e.preventDefault(),e.stopPropagation()},handleDragEnter(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!0},handleDragLeave(e){e.preventDefault(),e.stopPropagation(),e.currentTarget&&e.currentTarget.contains(e.relatedTarget)||(this.isDragging=!1)},async handleDrop(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!1;const t=e.dataTransfer?.files;if(t&&t.length>0){const e=t[0];await this.processFile(e)}},async handleFileSelect(e){const t=e.target;if(t.files&&t.files.length>0){const e=t.files[0];await this.processFile(e)}},async processFile(e){try{this.processResult=null,this.selectedFile=e,this.fileName=e.name,this.fileSize=this.formatFileSize(e.size),this.fileType=e.type||"unknown",this.isProcessing=!0,this.uploadProgress=0,this.currentStep="Validating file...",console.log("📁 Processing file:",{name:e.name,size:e.size,type:e.type}),this.currentStep="Validating file properties...",this.uploadProgress=20,await this.delay(200),this.currentStep="Running security checks...",this.uploadProgress=40,await this.delay(300),this.currentStep="Processing file content...",this.uploadProgress=60,await this.delay(200),this.currentStep="Parsing character data...",this.uploadProgress=80;const r=await Va.processFile(e);this.processResult=r,this.currentStep="Processing complete!",this.uploadProgress=100,await this.delay(300);const a=Yr.store("notifications");if(r.success&&r.characterData){this.currentStep="Converting to Fantasy Grounds XML...",this.uploadProgress=90,await this.delay(200);try{const e=window.characterConverterFacade;if(!e)throw new Error("CharacterConverterFacade not available");const t=await e.convertCharacterData(r.characterData);if(!t.success||!t.xml)throw new Error(t.error||"Failed to convert character to XML");this.currentStep="Complete!",this.uploadProgress=100,await this.delay(300);const o=r.characterData.name||"Unknown Character",n=r.characterData.id||"unknown";Yr.store("conversionResults").setResult(t.xml,o,n);const i=new CustomEvent("characterDataLoaded",{detail:{characterData:r.characterData,xml:t.xml,characterName:o}});if(document.dispatchEvent(i),this.$dispatch)console.log("📁 Dispatching file-converted event to parent"),this.$dispatch("file-converted",{characterData:r.characterData,xml:t.xml,characterName:o,characterId:`file_${r.characterData.id||Date.now()}`});else{console.log("📁 $dispatch not available, trying direct access");const e=document.querySelector('[x-data*="enhancedCharacterConverter"]');if(e&&e._x_dataStack){const t=e._x_dataStack[0];t&&(console.log("📁 Directly updating parent converter component"),t.characterId=`file_${r.characterData.id||Date.now()}`,t.isValidId=!0,t.isConverting=!1,t.progress=100,t.currentStep="File conversion complete!",t.characterData=r.characterData)}}a.addSuccess(`📁 Character "${o}" converted successfully!`),console.log("✅ File processed and converted successfully:",{character:r.characterData.name,source:r.sourceType,filename:r.filename})}catch(t){console.error("❌ XML conversion failed:",t);const e=t instanceof Error?t.message:"Conversion failed";a.addError(`❌ File processed but conversion failed: ${e}`),this.currentStep="Conversion error",this.uploadProgress=80}}else{const e=r.errors?r.errors.join("; "):"Unknown error";a.addError(`❌ File processing failed: ${e}`),console.error("❌ File processing failed:",r.errors)}r.warnings&&r.warnings.length>0&&r.warnings.forEach(e=>{a.addWarning(`⚠️ ${e}`)})}catch(error){console.error("File processing error:",error);const t=Yr.store("notifications"),r=error instanceof Error?error.message:"Unknown error occurred";t.addError(`File processing failed: ${r}`),this.currentStep="Error occurred",this.uploadProgress=0,this.processResult={success:!1,errors:[r]}}finally{this.isProcessing=!1}},clearFile(){this.selectedFile=null,this.fileName="",this.fileSize="",this.fileType="",this.processResult=null,this.uploadProgress=0,this.currentStep="",this.showValidationDetails=!1;const e=document.querySelector("#file-input");e&&(e.value=""),console.log("📁 File uploader cleared")},formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},getFileIcon:e=>e.includes("json")?"📋":e.includes("xml")?"📄":"📁",getValidationIcon:e=>e?"✅":"❌",showHelp(){Yr.store("notifications").addInfo("\n      📁 <strong>File Upload Help:</strong><br>\n      • Supported formats: JSON (.json), XML (.xml)<br>\n      • Maximum file size: 5MB<br>\n      • Drag & drop or click to select files<br>\n      • Files are processed with comprehensive security validation<br>\n      • D&D Beyond JSON and Fantasy Grounds XML formats supported\n    ")},delay:e=>new Promise(t=>setTimeout(t,e))})),console.log("📁 File Uploader component registered"),console.log("D&D Beyond to Fantasy Grounds Converter v2.0 - Phase 2 Integration"),console.log("Design System & Progressive Disclosure & Multi-Format Export Initialized"),"undefined"!=typeof window&&(window.featureFlags=Kr,window.characterFetcher=pa,window.characterConverterFacade=Xa,window.gameConfigService=ma,window.ObjectSearch=ha,window.StringSanitizer=fa,window.SafeAccess=ba,window.AbilityScoreUtils=wa,window.AbilityScoreProcessor=xa,window.SpellSlotCalculator=$a,window.designTokens=Jr,window.CSSTokenGenerator=Qr),document.addEventListener("DOMContentLoaded",async()=>{console.log("🚀 Initializing modern D&D converter...");try{await(async()=>{try{const e=Qr.generateCustomProperties(Jr);if(!document.getElementById("design-tokens")){const t=document.createElement("style");t.id="design-tokens",t.textContent=e,document.head.appendChild(t),console.log("✅ Design tokens injected successfully")}na(),console.log("✅ Animation engine initialized");const t=da();return console.log("✅ Accessibility infrastructure initialized"),t.announce("Design system loaded successfully","polite"),Promise.resolve()}catch(error){throw console.error("❌ Design system initialization failed:",error),error}})(),console.log("🔧 Initializing Phase 2 systems...");try{await ma.loadConfigs(),console.log("✅ Game configuration loaded successfully")}catch(error){console.warn("⚠️ Failed to load game configuration, using fallbacks:",error)}if(Yr.start(),console.log("✅ Alpine.js started"),Kr.isEnabled("performance_metrics")){if(console.log("📊 Performance metrics enabled"),!document.querySelector(".performance-dashboard")){const e=document.createElement("div");e.className="performance-dashboard",e.innerHTML='\n          <div class="performance-metrics">\n            <div class="metric-item metric-good">\n              <div class="metric-name">FPS</div>\n              <div class="metric-value">60</div>\n            </div>\n            <div class="metric-item metric-good">\n              <div class="metric-name">Memory</div>\n              <div class="metric-value">25MB</div>\n            </div>\n          </div>\n        ',document.body.appendChild(e)}console.log("Active feature flags:",Object.entries(Kr.getAllFlags()).filter(([e])=>Kr.isEnabled(e)).map(([e])=>e))}console.log("🎉 Enhanced converter initialization complete!"),console.log("📋 Phase 2 Integration Status:"),console.log("  ✅ Design Token System"),console.log("  ✅ Animation Engine (60fps hardware acceleration)"),console.log("  ✅ Accessibility Infrastructure (WCAG AA)"),console.log("  ✅ Performance Monitoring"),console.log("  ✅ Progressive Disclosure System"),console.log("  ✅ Character Preview with Validation"),console.log("  ✅ Multi-Format Export Selection"),console.log("  ✅ Enhanced User Experience Workflow"),window.accessibilityManager&&window.accessibilityManager.announce("D&D Beyond to Fantasy Grounds converter loaded successfully. Enhanced accessibility and animation features are now available.","polite")}catch(error){console.error("❌ Critical initialization failure:",error);const r=document.createElement("div");r.className="alert alert-error",r.innerHTML='\n      <div class="alert-content">\n        <div class="alert-title">Initialization Error</div>\n        <div class="alert-message">Some advanced features may not be available. Please refresh the page.</div>\n      </div>\n    ',document.body.insertBefore(r,document.body.firstChild);try{Yr.start(),console.log("⚠️ Alpine.js started in fallback mode")}catch(e){console.error("❌ Alpine.js failed to start:",e)}}})}}});
